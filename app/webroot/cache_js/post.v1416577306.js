var POST_TYPE_TEXT="text",POST_TYPE_LINK="link",POST_TYPE_VIDEO="video",POST_TYPE_IMAGE="image",POST_TYPE_POLL="poll",POST_TYPE_ECARD="ecard",POST_TYPE_BLOG="blog",isTextPresent=!1,isLinkDataPresent=!1,isPhotoPresent=!1,isVideoPresent=!1,isCrawling=!1,isEcard=!1,isBlog=!1,urlRegex=/(https?\:\/\/|\s)[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})(\/+[a-z0-9_.\:\;-]*)*(\?[\&\%\|\+a-z0-9_=,\.\:\;-]*)?([\&\%\|\+&a-z0-9_=,\:\;\.-]*)([\!\#\/\&\%\|\+a-z0-9_=,\:\;\.-]*)}*/i,previewImagesCount=0,currentPreviewImgPos=
1,nextImg=null,prevImg=null,isPollDataPresent=!1,defaultPlaceHolderText="Add more text",NEW_POST_COUNT=0,NEW_QUESTION_COUNT=0,NEW_POST_IDS=[],NEW_QUESTION_IDS=[];$(document).on("click",".start_discussion",function(){showPostingOption();$("#share_post_btn").attr("disabled","disabled")});$(document).on("click","#cancel_post_btn",function(){cancelPosting()});function cancelPosting(){$(".discussion_matter").hide();$(".start_discussion").show();resetForm()}
function showPostingOption(){$(".discussion_matter").show();$(".start_discussion").hide();$("#posting_text_form").show();$("#PostDescription").focus()}
$(document).on("click",".posting_items ul.post_options li",function(){$(".posting_options_form").hide();$(this).parent().find("li").removeClass("active");$(this).addClass("active");$("#"+$(this).data("elem")+"_form").show();var a=$(this).data("posttype");$("#PostPostType").val(a);$("#posting_more_action").show();"posting_text"==$(this).data("elem")?$("#PostDescription").addClass("post_no_border_bottom"):$("#PostDescription").removeClass("post_no_border_bottom");var c;switch(a){case POST_TYPE_TEXT:c=
defaultPlaceHolderText;break;case POST_TYPE_LINK:case POST_TYPE_VIDEO:case POST_TYPE_IMAGE:case POST_TYPE_POLL:c="Add a note";break;case POST_TYPE_ECARD:c="Type message here";break;case POST_TYPE_BLOG:c="Add title"}$("#PostDescription").attr("placeholder",c);$("div#posting_errors").html("").hide();$("div#video_posting_error").html("").hide();a===POST_TYPE_TEXT?handlePostTextChange():changeShareBtnStatus()});
function setPostFormRules(){""!==$.trim($("#PostLinkUrl").val())&&null!==$.trim($("#PostLinkUrl").val())?(0<$("#PostTitle").length&&$("#PostTitle").rules("remove","required"),$("#PostDescription").rules("remove","required")):""!==$.trim($("#PollForm_title").val())&&null!==$.trim($("#PollForm_title").val())?(0<$("#PostTitle").length&&$("#PostTitle").rules("remove","required"),$("#PostDescription").rules("remove","required")):$("#PostPostType").val()===POST_TYPE_IMAGE?(0<$("#PostTitle").length&&$("#PostTitle").rules("remove",
"required"),$("#PostDescription").rules("remove","required")):$("#PostPostType").val()===POST_TYPE_VIDEO?(0<$("#PostTitle").length&&$("#PostTitle").rules("remove","required"),$("#PostDescription").rules("remove","required")):(0<$("#PostTitle").length&&$("#PostTitle").rules("add",{required:!0}),$("#PostDescription").rules("add",{required:!0}))}function isPostFormValid(){setPostFormRules();return $("#postForm").valid()}
$(document).on("click","#PostIsAnonymous",function(){$(this).is(":checked")?($(".normal_post_thumb").addClass("hidden"),$(".anonymous_post_thumb").removeClass("hidden")):($(".normal_post_thumb").removeClass("hidden"),$(".anonymous_post_thumb").addClass("hidden"))});
$(document).on("click","#share_post_btn",function(){var a=this,c=$(".btn_leave");if(isPostFormValid()&&($("#PostPostType").val()!=POST_TYPE_POLL||validatePollForm())){var b=Ladda.create(a);b.start();$.ajax({type:"POST",url:"/post/api/createPost",data:$(form).serialize(),dataType:"json",beforeSend:function(){$(a).attr("disabled","disabled");c.attr("disabled","disabled")},success:function(d){cancelPosting();$(a).removeAttr("disabled");c.removeAttr("disabled");b.stop();!0===d.success?($(a).attr("disabled",
"disabled"),$("#PostPostType").val(POST_TYPE_TEXT),$("#new_posts_notification").is(":visible")?$("#new_posts_notification").click():$("#post_list").prepend(d.content),setTimeout(function(){applyTimeAgo()},6E4),$("#post_container").hasClass("hide")&&($("#no_posts_msg").addClass("hide"),$("#post_container").removeClass("hide")),emitEventToRooms("new_post",d)):!0===d.error&&bootbox.alert(d.message,function(){d.errorType&&"fatal"===d.errorType&&(window.location.reload(),window.scrollTo(0,0))})}})}});
function resetLinkForm(){clearPreview()}function resetForm(){$(form)[0].reset();resetPollForm();resetLinkForm();resetPostVideoForm();resetPostingOptions();resetPostPhotoForm();isTextPresent=!1;$("#PostDescription").attr("placeholder",defaultPlaceHolderText);$("#posting_errors").html("").hide();$("#video_posting_error").html("").hide();$(".normal_post_thumb").removeClass("hidden");$(".anonymous_post_thumb").addClass("hidden")}
function resetPostingOptions(){$(".posting_options_form").hide();$("ul.post_options").find("li").removeClass("active");$("ul.post_options").find("li.posting_post").addClass("active")}function applyTimeAgo(){$(".timeago").timeago()}function paginatePostData(){$.autopager&&$.autopager({link:"span.next a",content:".posting_area",appendTo:"#post_list",start:function(){$("#post_loading").removeClass("hide")},load:function(){$("#post_loading").addClass("hide");applyTimeAgo()}})}
$(document).ready(function(){applyTimeAgo();paginatePostData()});$(document).on("keyup","#PostTitle, #PostDescription",function(){handlePostTextChange()});$(document).on("drop","#PostTitle, #PostDescription",function(){setTimeout(function(){handlePostTextChange()},100)});$(document).on("paste","#PostTitle, #PostDescription",function(){setTimeout(function(){handlePostTextChange()},100)});
function handlePostTextChange(){0<$("#PostTitle").length&&$("#PostTitle").rules("remove","required");0<$("#PostDescription").length&&$("#PostDescription").rules("remove","required");var a=""!==$.trim($("#PostDescription").val())?!0:!1;isTextPresent=$("#PostTitle").is(":visible")?""!==$.trim($("#PostTitle").val())&&a?!0:!1:a;changeShareBtnStatus()}
function changeShareBtnStatus(){var a=!1;switch($("#PostPostType").val()){case POST_TYPE_TEXT:a=isTextPresent;break;case POST_TYPE_LINK:a=isLinkDataPresent;break;case POST_TYPE_VIDEO:a=isVideoPresent;break;case POST_TYPE_IMAGE:a=isPhotoPresent;break;case POST_TYPE_POLL:a=isPollDataPresent;break;case POST_TYPE_ECARD:a=isEcard}!0===a?$("#share_post_btn").removeAttr("disabled"):$("#share_post_btn").attr("disabled","disabled")}
$(document).on("click",".like_btn",function(){var a=this;if(!$(this).attr("disabled")){var c=$(this).data("post_id");$.ajax({type:"POST",url:"/post/api/likePost",data:{postId:c},dataType:"json",beforeSend:function(){$(a).attr("disabled","disabled")},success:function(b){$(a).removeAttr("disabled");if(!0===b.success){$(a).removeClass("like_btn").addClass("unlike_btn");$(a).html("Unlike");var d=$("#liked_users_list_"+c);0<b.likeCount?(d.removeClass("hide"),d.find("span").html(b.content)):d.addClass("hide");
emitEventToRooms("new_like",{likeBtn:this,postId:c,likeCount:b.likeCount,username:app.loggedInUserName,postInfo:b.postInfo,lastLikedUsers:b.lastLikedUsers})}else!0===b.error&&bootbox.alert(b.message,function(){$("#post_"+c).remove();hidePostListingIfNoPosts()})}})}});
$(document).on("click",".unlike_btn",function(){var a=this;if(!$(this).attr("disabled")){var c=$(this).data("post_id");$.ajax({type:"POST",url:"/post/api/unlikePost",data:{postId:c},dataType:"json",beforeSend:function(){$(a).attr("disabled","disabled")},success:function(b){$(a).removeAttr("disabled");if(!0===b.success){$(a).removeClass("unlike_btn").addClass("like_btn");$(a).html("Like");var d=$("#liked_users_list_"+c);0<b.likeCount?(d.removeClass("hide"),d.find("span").html(b.content)):d.addClass("hide");
emitEventToRooms("new_unlike",{likeBtn:this,postId:c,likeCount:b.likeCount,username:app.loggedInUserName,lastLikedUsers:b.lastLikedUsers,postInfo:b.postInfo})}else!0===b.error&&bootbox.alert(b.message,function(){$("#post_"+c).remove();hidePostListingIfNoPosts()})}})}});
$(document).on("click",".view_likes",function(){var a=$(this).data("post_id");loadingDialog=bootbox.dialog({className:"likes_modal",message:$("#loading_dialog").html(),title:"People Who Like This"});$.ajax({type:"POST",url:"/post/api/listLikes",data:{postId:a},dataType:"json",success:function(a){bootbox.dialog({className:"likes_modal",message:a.message,title:"People Who Like This"});loadingDialog.modal("hide")}})});
$(document).on("click",'.comment_form input[type="checkbox"]',function(){var a=$(this).closest(".post_comment_section_form");$(this).is(":checked")?(a.find(".normal_thumb").addClass("hidden"),a.find(".anonymous_thumb").removeClass("hidden")):(a.find(".normal_thumb").removeClass("hidden"),a.find(".anonymous_thumb").addClass("hidden"))});
$(document).on("keyup",'.comment_form textarea, .comment_anonymous_box input[type="checkbox"]',function(a){var c=null;if(!1===$(this).prop("disabled")&&null===c&&13===a.keyCode&&!1===a.shiftKey){var b=$(this).closest("form.comment_form");isCommentFormValid(b)&&(a=b.serialize(),b.find("textarea").prop("disabled",!0),b.find("checkbox").prop("disabled",!0),c=$.ajax({type:"POST",url:"/post/api/addComment",data:a,dataType:"json",success:function(a){c=null;b.find("textarea").prop("disabled",!1);b.find("checkbox").prop("disabled",
!1);!0===a.success?(updateNewComment(a),b.find("textarea").html("").val(""),emitEventToRooms("new_comment",a)):!0===a.error&&bootbox.alert(a.message,function(){a.errorType&&"postDeleted"===a.errorType?($("#post_"+a.postId).remove(),hidePostListingIfNoPosts()):a.errorType&&"fatal"===a.errorType&&(window.location.reload(),window.scrollTo(0,0))})}}))}else return!1});
function hidePostListingIfNoPosts(){0===$("#post_container .posting_area").length&&($("#post_container").addClass("hide"),$("#no_posts_msg").removeClass("hide"))}
function updateNewComment(a){var c=a.postId;$("#comment_list_"+c).prepend(a.content);setTimeout(function(){applyTimeAgo()},6E4);$("#comment_count_"+c).html(a.commentCount);var b=parseInt(app.loggedInUserId),d=parseInt(a.postedUserId),c=parseInt(a.commentedUserId),b=(c=b===c)||b===d?!0:!1,a=a.commentId,d=$("#comment_"+a);b||d.find(".delete_comment_btn").parent("li").remove();c||d.find(".edit_field .dropdown-menu").append('<li><a class="report_abuse report_abuse_comment" data-comment_id="'+a+'">Report Abuse</a></li>')}
function emitEventToRooms(a,c){$.ajax({type:"POST",url:"/post/api/getPostFollowingRooms",data:{post:c.postInfo},dataType:"json",success:function(b){b.forEach(function(b){b={room:b};$.extend(b,c);socket.emit(a,b)})}})}
function isCommentFormValid(a){a.validate({errorPlacement:function(a,b){a.appendTo(b.parent())},errorLabelContainer:!1,errorElement:"span",errorClass:"help-block",highlight:function(a){$(a).closest(".form-group").addClass("error")},unhighlight:function(a){$(a).closest(".form-group").removeClass("error")},rules:{"data[Comment][comment_text]":{required:!0,maxlength:5E3}},messages:{"data[Comment][comment_text]":{required:"Please enter your comment before submission",maxlength:"Cannot be more than 5000 characters long"}}});
return a.valid()}$(document).on("click",".load_more_comments",function(){var a=$(this),c=a.find("a").data("post_id"),b=$("#PostPostedInType").val();$.ajax({type:"POST",url:"/post/api/listComments",data:{postId:c,postedInType:b},dataType:"json",beforeSend:function(){a.html('<div class="text-center"><img alt="Loading..." src="/img/loading.gif"></div>')},success:function(b){a.remove();!0===b.success&&$("#comment_list_"+c).html(b.message)}})});$(document).on("mouseover",".comment_section",function(){$(this).find(".edit_field").removeClass("hide")});
$(document).on("mouseout",".comment_section",function(){$(this).find(".edit_field").addClass("hide")});
$(document).on("click",".delete_comment_btn",function(){var a=$(this).data("comment_id");if(0<a){var c=$(this).closest(".posting_area").find(".comment_count"),b=c.html();bootbox.confirm("Are you sure you want to delete this comment?",function(d){d&&($("#comment_"+a).remove(),b-=1,c.html(b),$.ajax({type:"POST",url:"/post/api/deleteComment",data:{commentId:a},dataType:"json",success:function(c){!0===c.success&&(postId=c.postId,emitEventToRooms("comment_delete",{commentId:a,postId:postId,commentCount:b,
postInfo:c.postInfo}))}}))})}});
$(document).on("click","ul#post_filter li a",function(){var a=$(this).data("filter_value"),c=$("#PostPostedIn").val(),b=$("#PostPostedInType").val(),d=$("#isLibray").val()?$("#isLibray").val():!1;$("#filter_value_hidden").val(a);$("#new_posts_notification").hide();resetNewPostCount();$.ajax({type:"POST",url:"/post/list/filterPosts",data:{filterValue:a,postedIn:c,postedInType:b,isLibray:d},dataType:"json",beforeSend:function(){$("#post_list").html('<div class="posting_area"><div class="text-center"><img alt="Loading..." src="/img/loader.gif"></div></div>');disableAutoPagination()},
success:function(a){!0===a.success?($("#post_list").html(a.content),paginatePostData()):!0===a.error&&(a='<div class="posting_area">'+a.content+"</div>",$("#post_list").html(a))}})});function disableAutoPagination(){$.autopager&&$.autopager({autoLoad:!1})}$(document).on("mouseover",".posting_area, .questionnaire_div",function(){$(this).find(".delete_post_btn").removeClass("hide")});$(document).on("mouseout",".posting_area, .questionnaire_div",function(){$(this).find(".delete_post_btn").addClass("hide")});
$(document).on("click",".delete_post_btn",function(){var a=$(this).data("post_id");if(0<a){var c=$("#post_"+a),b="post";c.hasClass("questionnaire_div")&&(b="question");bootbox.confirm("Are you sure you want to delete this "+b+"?",function(d){if(d){c.remove();var e="post_delete";"post"===b?hidePostListingIfNoPosts():"question"===b&&(e="question_delete",0===$("#questions_list .questionnaire_div").length&&$("#no_questions_msg").removeClass("hide"));$.ajax({type:"POST",url:"/post/api/deletePost",data:{postId:a},
dataType:"json",success:function(a){emitEventToRooms(e,a)}})}})}});$(document).on("click","li.posting_url",function(){$("#posting_url_form").removeClass("hide");$("#link_input_section").removeClass("hide");$("#PostLink").val("").removeAttr("disabled")});
function grabUrl(){var a=$("#PostLink").val();$.ajax({type:"POST",url:"/post/api/textCrawler",data:{link:a},dataType:"json",beforeSend:function(){$("#grab_url_btn").attr("disabled","disabled");$("#PostLink").addClass("textbox_loader").attr("disabled","disabled");$("#preview").hide();isCrawling=!0},success:function(a){$("#grab_url_btn").removeAttr("disabled");if(a.url&&(""!==a.title||"no"!==a.video||""!==a.images&&!1!==a.images&&null!==a.images)){$("#PostLink").removeClass("textbox_loader");$("#link_input_section").addClass("hide");
$("#preview").show();$("#previewTitle").html(a.title);$("#previewUrl").html(a.cannonicalUrl);$("#previewDescription").html(a.description);try{if(""!==a.images&&!1!==a.images&&null!==a.images){images=a.images.split("|");a.images=images;$("#previewImages").show();images.length=parseInt(images.length);previewImagesCount=images.length;1<previewImagesCount?($("#previewImagesNav").show(),currentPreviewImgPos=1):$("#previewImagesNav").hide();var b="";for(i=0;i<images.length;i++)b=0===i?b+("<img id='imagePreview"+
i+"' src='"+images[i]+"' style='width: 130px; height: auto' ></img>"):b+("<img id='imagePreview"+i+"' src='"+images[i]+"' style='width: 130px; height: auto; display: none' ></img>");$("#previewImage").html("<a href='"+a.pageUrl+"' target='_blank'>"+b+"</a><div id='whiteImage' style='width: 130px; color: transparent; display:none;'>...</div>")}else $("#previewImages").hide()}catch(d){$("#previewImages").hide()}setLinkData(a);isLinkDataPresent=!0;isCrawling=!1;changeShareBtnStatus();isPostFormValid()}else isCrawling=
!1,setPostFormRules(),showPostLinkError("Please post a valid URL."),$("#PostLink").removeClass("textbox_loader").removeAttr("disabled")}})}$(document).on("click","#previewImagesNav a.prev",function(){var a=$("#previewImage img:visible");a.hide();1===currentPreviewImgPos?(currentPreviewImgPos=previewImagesCount,prevImg=$("#previewImage img:last")):(currentPreviewImgPos--,prevImg=a.prev("img"));prevImg.show();$("#PostLinkImage").val(prevImg.attr("src"))});
$(document).on("click","#previewImagesNav a.next",function(){var a=$("#previewImage img:visible");a.hide();currentPreviewImgPos===previewImagesCount?(currentPreviewImgPos=1,nextImg=$("#previewImage img:first")):(currentPreviewImgPos++,nextImg=a.next("img"));nextImg.show();$("#PostLinkImage").val(nextImg.attr("src"))});
$(document).on("click","#closePreview",function(){$("#preview").fadeOut("fast",function(){clearPreview();$("#PostLink").val("").removeClass("textbox_loader").removeAttr("disabled");$("#link_input_section").removeClass("hide")})});function clearPreview(){$("#preview").hide();$("#previewImage").html("");$("#previewTitle").html("");$("#previewUrl").html("");$("#previewDescription").html("");resetLinkData();changeShareBtnStatus();$("#grab_url_btn").attr("disabled","disabled")}
function setLinkData(a){$("#PostLinkTitle").val(a.title);$("#PostLinkUrl").val(a.url);$("#PostLinkPageUrl").val(a.pageUrl);$("#PostLinkCannonicalUrl").val(a.cannonicalUrl);$("#PostLinkDescription").val(a.description);var c="";!1!==a.images&&(c=a.images instanceof Array?a.images[0]:a.images);$("#PostLinkImage").val(c);$("#PostLinkVideo").val(a.video);c="";"yes"===a.video&&(c=a.videoIframe);$("#PostLinkVideoIframe").val(c)}
function resetLinkData(){$("#PostLinkTitle").val("");$("#PostLinkUrl").val("");$("#PostLinkPageUrl").val("");$("#PostLinkCannonicalUrl").val("");$("#PostLinkDescription").val("");$("#PostLinkImage").val("");$("#PostLinkVideo").val("");$("#PostLinkVideoIframe").val("");isLinkDataPresent=!1}
function showPostLinkError(a){0<$("#posting_errors span[for='PostLink']").length?$("#posting_errors span[for='PostLink']").html(a).show():$("#posting_errors").append('<span for="PostLink" class="help-block">'+a+"</span>");$("#posting_errors").show()}var postLink;$(document).on("keyup","#PostLink",function(){postLink=this;checkPostLink()});$(document).on("paste","#PostLink",function(){postLink=this;setTimeout(function(){$("#PostLink").valid()&&grabUrl()},100)});
$(document).on("drop","#PostLink",function(){postLink=this;setTimeout(function(){$("#PostLink").valid()&&grabUrl()},100)});
function checkPostLink(){isLinkDataPresent=!1;if(""!==$.trim($(postLink).val())){var a=$(postLink).val();"http://"!==a.substr(0,7)&&"https://"!=a.substr(0,8)&&(a="http://"+a);"/"!==a.substr(a.length-1,1)&&(a+="/");urlRegex.test(a)?$("#grab_url_btn").removeAttr("disabled"):($("#grab_url_btn").attr("disabled","disabled"),$("#preview").fadeOut("fast",function(){clearPreview()}))}else $("#grab_url_btn").attr("disabled","disabled")}$(document).on("click","#grab_url_btn",function(){grabUrl()});
$(document).on("click",".frnd_request_respond_btn",function(){$(this).next(".frnd_request_respond_box").removeClass("hide");$(this).hide()});
$(document).on("click","#new_posts_notification",function(){var a=$("#PostPostedIn").val(),c=$("#PostPostedInType").val(),b=$("#isLibray").val()?$("#isLibray").val():!1;$.ajax({type:"POST",url:"/post/list/filterPosts",data:{filterValue:9,postedIn:a,postedInType:c,isLibray:b},dataType:"json",beforeSend:function(){$("#new_posts_notification").html('<div class="text-center"><img alt="Loading..." src="/img/loading.gif"></div>');disableAutoPagination()},success:function(a){!0===a.success?($("#post_container").hasClass("hide")&&
($("#no_posts_msg").addClass("hide"),$("#post_container").removeClass("hide")),$("#post_list").html(a.content),paginatePostData(),$("#new_posts_notification").html(""),$("#new_posts_notification").hide(),resetNewPostCount()):!0===a.error&&(a='<div class="posting_area">'+a.content+"</div>",$("#post_list").html(a))}})});function getNewPostCount(){return NEW_POST_COUNT}
function updateNewPostCount(){if(0<parseInt(NEW_POST_COUNT)){var a="Show "+NEW_POST_COUNT+" new update(s) with default filter option";$("#new_posts_notification").html(a);$("#new_posts_notification").show()}else $("#new_posts_notification").hide()}function incNewPostCount(a){NEW_POST_COUNT+=1;NEW_POST_IDS.push(a);updateNewPostCount()}function decNewPostCount(a){a=$.inArray(a,NEW_POST_IDS);-1<a&&(NEW_POST_IDS.splice(a,1),NEW_POST_COUNT-=1,updateNewPostCount())}
function resetNewPostCount(){NEW_POST_COUNT=0;NEW_POST_IDS=[]}
$(document).on("click","#new_questions_notification",function(){diseaseId=$("#question_form #PostPostedIn").val();$.ajax({type:"POST",url:"/listForumQuestions/"+diseaseId,beforeSend:function(){$("#new_questions_notification").html('<div class="text-center"><img alt="Loading..." src="/img/loading.gif"></div>')},success:function(a){$("#questions_list").html(a);$("#new_questions_notification").html("");$("#new_questions_notification").addClass("hide");resetNewQuestionCount()}})});
function updateNewQuestionCount(){if(0<parseInt(NEW_QUESTION_COUNT)){var a="Show "+NEW_QUESTION_COUNT+" new update(s)";$("#new_questions_notification").html(a);$("#new_questions_notification").removeClass("hide")}else $("#new_questions_notification").addClass("hide")}function incNewQuestionCount(a){NEW_QUESTION_COUNT+=1;NEW_QUESTION_IDS.push(a);updateNewQuestionCount()}
function decNewQuestionCount(a){a=$.inArray(a,NEW_QUESTION_IDS);-1<a&&(NEW_QUESTION_IDS.splice(a,1),NEW_QUESTION_COUNT-=1,updateNewQuestionCount())}function resetNewQuestionCount(){NEW_QUESTION_COUNT=0;NEW_QUESTION_IDS=[]}var commentCountElement,commentCount,commentId;
$(document).on("click",".report_abuse_comment",function(){commentId=$(this).data("comment_id");0<commentId&&(commentCountElement=$(this).closest(".posting_area").find(".comment_count"),commentCount=commentCountElement.html(),$('#report_abuse_comment_dialog form input[type="hidden"]').val(commentId),$("#report_abuse_comment_dialog form textarea").val(""),$('#report_abuse_comment_dialog form input[type="checkbox"]').prop("checked",!1),$("#report_abuse_comment_dialog").modal("show"))});
$(document).on("click","#confirm_report_abuse_comment",function(){$("#comment_"+commentId).remove();commentCount-=1;commentCountElement.html(commentCount);var a=$("#report_abuse_comment_dialog form").serialize();$('#report_abuse_comment_dialog form input[type="hidden"]').val("");$("#report_abuse_comment_dialog").modal("hide");$.ajax({type:"POST",url:"/post/api/reportAbuseComment",data:a,dataType:"json",success:function(a){!0===a.error&&bootbox.alert(a.message)}})});var postId;
$(document).on("click",".report_abuse_post",function(){postId=$(this).data("post_id");0<postId&&($('#report_abuse_post_dialog form input[type="hidden"]').val(postId),$("#report_abuse_post_dialog form textarea").val(""),$('#report_abuse_post_dialog form input[type="checkbox"]').prop("checked",!1),$("#report_abuse_post_dialog").modal("show"))});
$(document).on("click","#confirm_report_abuse_post",function(){$("#post_"+postId).remove();hidePostListingIfNoPosts();var a=$("#report_abuse_post_dialog form").serialize();$('#report_abuse_post_dialog form input[type="hidden"]').val("");$("#report_abuse_post_dialog").modal("hide");$.ajax({type:"POST",url:"/post/api/reportAbusePost",data:a,dataType:"json",success:function(a){!0===a.error&&bootbox.alert(a.message)}})});
$(document).on("click",".play_video",function(){var a=$(this).find("img.img-responsive"),c=a.width(),a=a.height(),b=$(this).attr("data-video_id");$(this).embedVimeoPlayer(b,c,a)});
$(document).on("click","#add_question_btn",function(){var a=this;if(isQuestionFormValid()){var c=Ladda.create(a);c.start();$.ajax({type:"POST",url:"/post/api/addQuestion",data:$("#question_form").serialize(),dataType:"json",beforeSend:function(){$(a).prop("disabled",!0)},success:function(b){$("#question_form")[0].reset();$(a).prop("disabled",!1);c.stop();if(!0===b.success){$("#no_questions_msg").addClass("hide");$("#questions_list").prepend(b.content);if(0<$(".show_more_questions").length){var d=
$(".show_more_questions a").attr("data-offset"),d=parseInt(d)+1;$(".show_more_questions a").attr("data-offset",d)}setTimeout(function(){applyTimeAgo()},6E4);b={room:$("#PostPostedInRoom").val(),postId:b.postId};socket.emit("new_question",b)}else!0===b.error&&bootbox.alert(b.message)}})}});
function isQuestionFormValid(){var a=$("#question_form");a.validate({errorLabelContainer:"div#question_form_error",errorClass:"error-block",highlight:function(a){$(a).addClass("error")},unhighlight:function(a){$(a).removeClass("error")},rules:{"data[Post][question]":{required:!0,maxlength:150}},messages:{"data[Post][question]":{required:"Please enter the question.",maxlength:"Question cannot be more than 150 characters long."}}});return a.valid()}var diseaseId;
$(document).ready(function(){0<$("#questions_list").length&&(diseaseId=$("#question_form #PostPostedIn").val(),$.ajax({type:"POST",url:"/listForumQuestions/"+diseaseId,success:function(a){$("#questions_loading").addClass("hide");$("#questions_list").html(a)}}))});
$(document).on("click",".show_more_questions",function(){var a=$(this).find("a").attr("data-offset"),a="/listForumQuestions/"+diseaseId+"/offset:"+a;$(this).remove();$("#questions_loading").removeClass("hide");$.ajax({type:"POST",url:a,success:function(a){$("#questions_loading").addClass("hide");$("#questions_list").append(a);setTimeout(function(){applyTimeAgo()},6E4)}})});
$(document).on("click",'.answer_form input[type="checkbox"]',function(){var a=$(this).closest(".answer_form_container");$(this).is(":checked")?(a.find(".normal_thumb, .original_username").addClass("hidden"),a.find(".anonymous_thumb, .anonymous_username").removeClass("hidden")):(a.find(".normal_thumb, .original_username").removeClass("hidden"),a.find(".anonymous_thumb, .anonymous_username").addClass("hidden"))});
$(document).on("click",".add_answer_btn",function(){if(!1===$(this).prop("disabled")){var a=$(this).closest("form.answer_form");if(isAnswerFormValid(a)){var c=a.serialize();a.find("textarea, checkbox, button").prop("disabled",!0);var b=Ladda.create(this);b.start();$.ajax({type:"POST",url:"/post/api/addAnswer",data:c,dataType:"json",success:function(c){a.find("textarea, checkbox, button").prop("disabled",!1);b.stop();if(!0===c.success){updateNewAnswer(c);a.find("textarea").html("").val("");var e={room:$("#PostPostedInRoom").val()};
$.extend(e,c);socket.emit("new_answer",e)}else!0===c.error&&bootbox.alert(c.message,function(){c.errorType&&"postDeleted"===c.errorType?$("#post_"+c.postId).remove():c.errorType&&"fatal"===c.errorType&&(window.location.reload(),window.scrollTo(0,0))})}})}}else return!1});
function updateNewAnswer(a){var c=$("#post_"+a.postId),b=c.find(".question_answers_div"),c=c.find(".answer_count");b.find(".no_answers_msg").addClass("hide");b.prepend(a.content);setTimeout(function(){applyTimeAgo()},6E4);b=c.text();b=parseInt(b)+1;c.html(b);canCurrentUserDeleteAnswer(a)||$("#answer_"+a.answerId).find(".delete_answer_btn").remove()}
function canCurrentUserDeleteAnswer(a){var c=parseInt(app.loggedInUserId),b=parseInt(a.questionAskedUserId),a=parseInt(a.answeredUserId);return c===a||c===b?!0:!1}
function isAnswerFormValid(a){a.validate({errorPlacement:function(a,b){a.appendTo(b.parent().find(".error_container"))},errorLabelContainer:!1,errorElement:"span",errorClass:"error-block",highlight:function(a){$(a).addClass("error")},unhighlight:function(a){$(a).removeClass("error")},rules:{"data[Answer][answer]":{required:!0,maxlength:5E3}},messages:{"data[Answer][answer]":{required:"Please enter your answer before submission",maxlength:"Cannot be more than 5000 characters long"}}});return a.valid()}
$(document).on("click",".more_text",function(){var a=$(this).parent(".truncated_text");a.addClass("hide");a.next(".full_text").removeClass("hide").children(".less_text").removeClass("hide");$(this).addClass("hide")});$(document).on("click",".less_text",function(){var a=$(this).parent(".full_text");a.addClass("hide");a.prev(".truncated_text").removeClass("hide").children(".more_text").removeClass("hide");$(this).addClass("hide")});
$(document).on("click",".add_answer_link",function(){var a=$(this).closest(".questionnaire_div").find(".answer_form_container");a.hasClass("hide")?a.removeClass("hide"):a.find("textarea").focus()});
$(document).on("click",".load_more_answer",function(){var a=$(this),c=a.find("a").attr("data-postid"),b=$("#post_"+c).find(".question_answers_div");$.ajax({type:"POST",url:"/disease/diseases/listQuestionAnswers",data:{postId:c},beforeSend:function(){a.html('<div class="text-center"><img alt="Loading..." src="/img/loading.gif"></div>')},success:function(c){a.remove();b.html(c);setTimeout(function(){applyTimeAgo()},6E4)}})});$(document).on("mouseover",".disease_answer_div",function(){$(this).find(".delete_answer_btn").removeClass("hide")});
$(document).on("mouseout",".disease_answer_div",function(){$(this).find(".delete_answer_btn").addClass("hide")});$(document).on("click",".delete_answer_btn",function(){var a=$(this).data("answer_id");0<a&&bootbox.confirm("Are you sure you want to delete this answer?",function(c){c&&(deleteAnswer(a),$.ajax({type:"POST",url:"/post/api/deleteAnswer",data:{answerId:a},dataType:"json"}),c={room:$("#PostPostedInRoom").val(),answerId:a},socket.emit("delete_answer",c))})});
function deleteAnswer(a){var a=$("#answer_"+a),c=a.closest(".questionnaire_div"),b=c.find(".answer_count"),d=b.html();a.remove();d=parseInt(d)-1;b.html(d);0===d&&c.find(".no_answers_msg").removeClass("hide")};