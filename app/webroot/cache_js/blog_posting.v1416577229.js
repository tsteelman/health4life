/*
 MIT License - http://www.opensource.org/licenses/mit-license.php

 For usage and examples, visit:
 http://timeago.yarp.com/

 Copyright (c) 2008-2013, Ryan McGeary (ryan -[at]- mcgeary [*dot*] org)
*/
(function(d){"function"===typeof define&&define.amd?define(["jquery"],d):d(jQuery)})(function(d){function r(){var j;j=d(this);j.data("timeago")||(j.data("timeago",{datetime:h.datetime(j)}),d.trim(j.text()));j=j.data("timeago");var i=h.settings;isNaN(j.datetime)||(0==i.cutoff||($appDateTime?$appDateTime:new Date).getTime()-j.datetime.getTime()<i.cutoff)&&d(this).text(n(j.datetime));return this}function n(d){return h.inWords(($appDateTime?$appDateTime:new Date).getTime()-d.getTime())}d.timeago=function(j){return j instanceof
Date?n(j):"string"===typeof j?n(d.timeago.parse(j)):"number"===typeof j?n(new Date(j)):n(d.timeago.datetime(j))};var h=d.timeago;d.extend(d.timeago,{settings:{refreshMillis:6E4,allowFuture:!1,localeTitle:!1,cutoff:6048E5,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",second:"just now",seconds:"%d seconds",minute:"%d minute",minutes:"%d minutes",hour:"%d hour",hours:"%d hours",day:"%d day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",
years:"%d years",wordSeparator:" ",numbers:[]}},inWords:function(j){function i(f,i){return(d.isFunction(f)?f(i,j):f).replace(/%d/i,h.numbers&&h.numbers[i]||i)}var h=this.settings.strings,m=h.prefixAgo,n=h.suffixAgo;this.settings.allowFuture&&0>j&&(m=h.prefixFromNow,n=h.suffixFromNow);$diff=Math.abs(j)/1E3;$years=$months=$weeks=0;$days=Math.floor($diff/86400);$diff-=86400*$days;$hours=Math.floor($diff/3600);$diff-=3600*$hours;$minutes=Math.floor($diff/60);$diff-=60*$minutes;$seconds=Math.round($diff);
$accuracy=[];$accuracy.year="day";$accuracy.month="day";$accuracy.week="day";$accuracy.day="day";$accuracy.hour="minute";$accuracy.minute="minute";$accuracy.second="second";$fWord=$accuracy.second;0<$years?$fWord=$accuracy.year:0<Math.abs($months)?$fWord=$accuracy.month:0<Math.abs($weeks)?$fWord=$accuracy.week:0<Math.abs($days)?$fWord=$accuracy.day:0<Math.abs($hours)?$fWord=$accuracy.hour:0<Math.abs($minutes)&&($fWord=$accuracy.minute);$fNum=function(d,f,i,h){var j=0,m=0,n="",r="",w=0,C=0,d=[].concat(d),
f=[].concat(f),G=Object.prototype.toString.call(f)==="[object Array]",H=Object.prototype.toString.call(i)==="[object Array]",i=[].concat(i);h&&(this.window[h]=0);j=0;for(w=i.length;j<w;j++)if(i[j]!==""){m=0;for(C=d.length;m<C;m++){n=i[j]+"";r=G?f[m]!==void 0?f[m]:"":f[0];i[j]=n.split(d[m]).join(r);h&&i[j]!==n&&(this.window[h]=this.window[h]+(n.length-i[j].length)/d[m].length)}}return H?i:i[0]}("year month week day hour minute second".split(" "),[1,2,3,4,5,6,7],$fWord);relativeDate="";4<=$fNum&&0<
$days&&(words=1===$days?i(h.day,1):i(h.days,$days),relativeDate+=(relativeDate?", ":"")+words);5<=$fNum&&0<$hours&&(words=1===$hours?i(h.hour,1):i(h.hours,$hours),relativeDate+=(relativeDate?", ":"")+words);6<=$fNum&&0<$minutes&&(words=1===$minutes?i(h.minute,1):i(h.minutes,$minutes),relativeDate+=(relativeDate?", ":"")+words);7<=$fNum&&0<$seconds&&(1===$seconds?(words=i(h.second,1),n=null):words=i(h.seconds,$seconds),relativeDate+=(relativeDate?", ":"")+words);var f=h.wordSeparator||"";void 0===
h.wordSeparator&&(f=" ");return d.trim([m,relativeDate,n].join(f))},parse:function(h){h=d.trim(h);h=h.replace(/\.\d+/,"");h=h.replace(/-/,"/").replace(/-/,"/");h=h.replace(/T/," ").replace(/Z/," UTC");h=h.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2");return new Date(h)},datetime:function(j){j=d(j).attr("datetime")?d(j).attr("datetime"):d(j).attr("title");return h.parse(j)},isTime:function(h){return"time"===d(h).get(0).tagName.toLowerCase()}});var m={init:function(){var j=d.proxy(r,this);j();var i=h.settings;
0<i.refreshMillis&&setInterval(j,i.refreshMillis)},update:function(j){d(this).data("timeago",{datetime:h.parse(j)});r.apply(this)},updateFromDOM:function(){d(this).data("timeago",{datetime:h.parse(d(this).attr("datetime")?d(this).attr("datetime"):d(this).attr("title"))});r.apply(this)}};d.fn.timeago=function(d,h){var n=d?m[d]:m.init;if(!n)throw Error("Unknown function name '"+d+"' for timeago");this.each(function(){n.call(this,h)});return this};document.createElement("abbr");document.createElement("time")});
var POST_TYPE_ECARD="ecard",POST_TYPE_BLOG="blog",isEcard=!1,isBlog=!1;$(document).on("click",".start_discussion",function(){$(".discussion_matter").show();$(".start_discussion").hide();$("#posting_blog_form").show();$("#PostTitle").focus()});$(document).on("click","#cancel_post_btn",function(){cancelPosting()});function cancelPosting(){$(".discussion_matter").hide();$(".start_discussion").show();resetForm()}
$(document).on("click",".posting_items ul.post_options li",function(){$(".posting_options_form").hide();$(this).parent().find("li").removeClass("active");$(this).addClass("active");$("#"+$(this).data("elem")+"_form").show();var d=$(this).data("posttype");$("#PostPostType").val(d);$("#posting_more_action").show();$("div#posting_errors").html("").hide();changeShareBtnStatus()});function changeShareBtnStatus(){$("#PostPostType").val()}
$(document).on("click","#share_post_btn",function(){var d=this;if(isPostFormValid()){if($("#PostPostType").val()==POST_TYPE_BLOG)var r=$("#PostTitle").val();var n=Ladda.create(d);n.start();$.ajax({type:"POST",url:"/post/api/createPost",data:$(form).serialize(),dataType:"json",beforeSend:function(){$(d).attr("disabled","disabled")},success:function(h){$(d).removeAttr("disabled");n.stop();!0===h.success?(cancelPosting(),$("#post_container").hasClass("hide")&&($("#no_posts_msg").addClass("hide"),$("#post_container").removeClass("hide")),
$("#PostPostType").val()==POST_TYPE_BLOG&&($(".latest_blog_title").text(r),$(".comment_time").text("Just now")),bootbox.alert(h.message,function(){if(h.errorType&&h.errorType==="fatal"){window.location.reload();window.scrollTo(0,0)}})):!0===h.error?bootbox.alert(h.message,function(){h.errorType&&"fatal"===h.errorType&&(window.location.reload(),window.scrollTo(0,0))}):bootbox.alert(h)}})}});function isPostFormValid(){return!0}
function resetForm(){$(form)[0].reset();$(".posting_options_form").hide();$("ul.post_options").find("li").removeClass("active");$("ul.post_options").find("li.posting_blog").addClass("active");$("#posting_errors").html("").hide();$("#PostDescription").code("");$("#posting_ecard_form .ecard_link").removeClass("active");$("#PostEcardTitle").val("");$("#EcardToUserId").val("");$("#posting_ecard_form .token").remove();$("#PostEcardSelected").val("")}$(document).ready(function(){initEcardSender();initBlogPost()});
function initEcardSender(){$("#PostToUser").facelist("/FrontApp/searchUsername",properties={matchContains:!0,minChars:2,selectFirst:!1,intro_text:"Type Userame",no_result:"No users",multiple:!1,result_field:"EcardToUserId",result_list_field:"ecard_user_list",enableImage:!0});$(document).on("click","#posting_ecard_form .ecard_link",function(){$(this).hasClass("active")?$(this).removeClass("active"):$(this).addClass("active");if(0>=$("#posting_ecard_form .ecard_link.active").length)$("#share_post_btn").attr("disabled",
"disabled");else{var d="";$("#share_post_btn").removeAttr("disabled");$("#posting_ecard_form .ecard_link.active").each(function(){d+=$(this).data("ecard_id")+","});$("#PostEcardSelected").val(d)}})}
function initBlogPost(){$("#PostDescription").summernote({height:200,minHeight:100,maxHeight:800,toolbar:[["style",["bold","italic","underline","clear"]],["font",["strikethrough"]],["fontsize",["fontsize"]],["color",["color"]],["para",["ul","ol","paragraph"]],["insert",["link","video","picture"]],["misc",["fullscreen","undo","redo","help"]]],onpaste:function(d){bootbox.alert("Sorry, pasting is not allowed due to security reasons!");d.preventDefault();d.stopPropagation()},onblur:function(){$("#PostDescription").html($("#PostDescription").code())},
onkeydown:function(){}})}$(document).on("click",".read_more_text",function(){var d=$(this).parent(".truncated_text");d.addClass("hide");d.next(".full_text").removeClass("hide").children(".read_less_text").removeClass("hide");$(this).addClass("hide");d=document.querySelector("#blog_container");(new Masonry(d,{columnWidth:10})).layout()});
$(document).on("click",".read_less_text",function(){var d=$(this).parent(".full_text");d.addClass("hide");d.prev(".truncated_text").removeClass("hide").children(".read_more_text").removeClass("hide");$(this).addClass("hide");d=document.querySelector("#blog_container");(new Masonry(d,{columnWidth:10})).layout()});
!function(d){"function"==typeof define&&define.amd?define(["jquery"],d):d(window.jQuery)}(function(d){"function"!=typeof Array.prototype.reduce&&(Array.prototype.reduce=function(a,b){var c,e,d=this.length>>>0,g=!1;1<arguments.length&&(e=b,g=!0);for(c=0;d>c;++c)this.hasOwnProperty(c)&&(g?e=a(e,this[c],c,this):(e=this[c],g=!0));if(!g)throw new TypeError("Reduce of empty array with no initial value");return e});"function"!=typeof Array.prototype.filter&&(Array.prototype.filter=function(a){if(void 0===
this||null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var e=[],d=2<=arguments.length?arguments[1]:void 0,g=0;c>g;g++)if(g in b){var f=b[g];a.call(d,f,g,b)&&e.push(f)}return e});var r,n="function"==typeof define&&define.amd,h={isMac:-1<navigator.appVersion.indexOf("Mac"),isMSIE:-1<navigator.userAgent.indexOf("MSIE")||-1<navigator.userAgent.indexOf("Trident"),isFF:-1<navigator.userAgent.indexOf("Firefox"),jqueryVersion:parseFloat(d.fn.jquery),
isSupportAmd:n,hasCodeMirror:n?require.specified("CodeMirror"):!!window.CodeMirror,isFontInstalled:function(a){var b="Comic Sans MS"===a?"Courier New":"Comic Sans MS",c=d("<div>").css({position:"absolute",left:"-9999px",top:"-9999px",fontSize:"200px"}).text("mmmmmmmmmwwwwwww").appendTo(document.body),e=c.css("fontFamily",b).width(),a=c.css("fontFamily",a+","+b).width();return c.remove(),e!==a},isW3CRangeSupport:!!document.createRange},m,j=0;m={eq:function(a){return function(b){return a===b}},eq2:function(a,
b){return a===b},peq2:function(a){return function(b,c){return b[a]===c[a]}},ok:function(){return!0},fail:function(){return!1},self:function(a){return a},not:function(a){return function(){return!a.apply(a,arguments)}},and:function(a,b){return function(c){return a(c)&&b(c)}},uniqueId:function(a){var b=++j+"";return a?a+b:b},rect2bnd:function(a){var b=d(document);return{top:a.top+b.scrollTop(),left:a.left+b.scrollLeft(),width:a.right-a.left,height:a.bottom-a.top}},invertObject:function(a){var b={},c;
for(c in a)a.hasOwnProperty(c)&&(b[a[c]]=c);return b}};var i,w=function(a){return a[a.length-1]},aa=function(a){return a.slice(1)},ba=function(a,b){return-1!==d.inArray(b,a)};i={head:function(a){return a[0]},last:w,initial:function(a){return a.slice(0,a.length-1)},tail:aa,prev:function(a,b){var c=a.indexOf(b);return-1===c?null:a[c-1]},next:function(a,b){var c=a.indexOf(b);return-1===c?null:a[c+1]},find:function(a,b){for(var c=0,e=a.length;e>c;c++){var d=a[c];if(b(d))return d}},contains:ba,all:function(a,
b){for(var c=0,e=a.length;e>c;c++)if(!b(a[c]))return!1;return!0},sum:function(a,b){return b=b||m.self,a.reduce(function(a,e){return a+b(e)},0)},from:function(a){for(var b=[],c=-1,e=a.length;++c<e;)b[c]=a[c];return b},clusterBy:function(a,b){return!a.length?[]:aa(a).reduce(function(a,e){var d=w(a);return b(w(d),e)?d[d.length]=e:a[a.length]=[e],a},[[a[0]]])},compact:function(a){for(var b=[],c=0,e=a.length;e>c;c++)a[c]&&b.push(a[c]);return b},unique:function(a){for(var b=[],c=0,e=a.length;e>c;c++)ba(b,
a[c])||b.push(a[c]);return b}};var n=String.fromCharCode(160),f,u=function(a){return a&&d(a).hasClass("note-editable")},q=function(a){return a=a.toUpperCase(),function(b){return b&&b.nodeName.toUpperCase()===a}},F=function(a){return a&&3===a.nodeType},P=function(a){return a&&/^BR|^IMG|^HR/.test(a.nodeName.toUpperCase())},A=function(a){return u(a)?!1:a&&/^DIV|^P|^LI|^H[1-7]/.test(a.nodeName.toUpperCase())},ca=q("LI"),Q=function(a){return!G(a)&&!da(a)&&!A(a)},da=function(a){return a&&/^UL|^OL/.test(a.nodeName.toUpperCase())},
ea=function(a){return a&&/^TD|^TH/.test(a.nodeName.toUpperCase())},C=q("BLOCKQUOTE"),G=function(a){return ea(a)||C(a)||u(a)},H=q("A"),oa=q("BODY"),I=h.isMSIE?"&nbsp;":"<br>",v=function(a){return F(a)?a.nodeValue.length:a.childNodes.length},R=function(a){var b=v(a);return 0===b?!0:f.isText(a)||1!==b||a.innerHTML!==I?!1:!0},J=function(a){P(a)||v(a)||(a.innerHTML=I)},K=function(a,b){for(;a;){if(b(a))return a;if(u(a))break;a=a.parentNode}return null},D=function(a,b){var b=b||m.fail,c=[];return K(a,function(a){return u(a)||
c.push(a),b(a)}),c},S=function(a,b){for(var b=b||m.fail,c=[];a&&!b(a);)c.push(a),a=a.nextSibling;return c},L=function(a,b){var c=b.nextSibling,e=b.parentNode;return c?e.insertBefore(a,c):e.appendChild(a),a},M=function(a,b){return d.each(b,function(b,e){a.appendChild(e)}),a},T=function(a){return 0===a.offset},U=function(a){return a.offset===v(a.node)},x=function(a){for(var b=0;a=a.previousSibling;)b+=1;return b},N=function(a){return!(!a||!a.childNodes||!a.childNodes.length)},fa=function(a,b){var c,
e;if(0===a.offset){if(u(a.node))return null;c=a.node.parentNode;e=x(a.node)}else N(a.node)?(c=a.node.childNodes[a.offset-1],e=v(c)):(c=a.node,e=b?0:a.offset-1);return{node:c,offset:e}},V=function(a,b){var c,e;if(v(a.node)===a.offset){if(u(a.node))return null;c=a.node.parentNode;e=x(a.node)+1}else N(a.node)?(c=a.node.childNodes[a.offset],e=0):(c=a.node,e=b?v(a.node):a.offset+1);return{node:c,offset:e}},ga=function(a,b){return a.node===b.node&&a.offset===b.offset},ha=function(a,b){if(F(a.node))return T(a)?
a.node:U(a)?a.node.nextSibling:a.node.splitText(a.offset);var c=a.node.childNodes[a.offset],e=L(a.node.cloneNode(!1),a.node);return M(e,S(c)),b||(J(a.node),J(e)),e},ia=function(a){return document.createElement(a)},W=function(a,b){if(a&&a.parentNode){if(a.removeNode)return a.removeNode(b);var c=a.parentNode;if(!b){var e,d,g=[];e=0;for(d=a.childNodes.length;d>e;e++)g.push(a.childNodes[e]);e=0;for(d=g.length;d>e;e++)c.insertBefore(g[e],a)}c.removeChild(a)}},ja=q("TEXTAREA");f={NBSP_CHAR:n,ZERO_WIDTH_NBSP_CHAR:"\ufeff",
blank:I,emptyPara:"<p>"+I+"</p>",isEditable:u,isControlSizing:function(a){return a&&d(a).hasClass("note-control-sizing")},buildLayoutInfo:function(a){var b;if(a.hasClass("note-air-editor")){var c=i.last(a.attr("id").split("-"));return b=function(a){return function(){return d(a+c)}},{editor:function(){return a},editable:function(){return a},popover:b("#note-popover-"),handle:b("#note-handle-"),dialog:b("#note-dialog-")}}return b=function(b){return function(){return a.find(b)}},{editor:function(){return a},
dropzone:b(".note-dropzone"),toolbar:b(".note-toolbar"),editable:b(".note-editable"),codable:b(".note-codable"),statusbar:b(".note-statusbar"),popover:b(".note-popover"),handle:b(".note-handle"),dialog:b(".note-dialog")}},isText:F,isPara:A,isPurePara:function(a){return A(a)&&!ca(a)},isInline:Q,isBodyInline:function(a){return Q(a)&&!K(a,A)},isBody:oa,isParaInline:function(a){return Q(a)&&!!K(a,A)},isList:da,isTable:q("TABLE"),isCell:ea,isBlockquote:C,isBodyContainer:G,isAnchor:H,isDiv:q("DIV"),isLi:ca,
isSpan:q("SPAN"),isB:q("B"),isU:q("U"),isS:q("S"),isI:q("I"),isImg:q("IMG"),isTextarea:ja,isEmpty:R,isEmptyAnchor:m.and(H,R),nodeLength:v,isLeftEdgePoint:T,isRightEdgePoint:U,isEdgePoint:function(a){return T(a)||U(a)},isLeftEdgeOf:function(a,b){for(;a&&a!==b;){if(0!==x(a))return!1;a=a.parentNode}return!0},isRightEdgeOf:function(a,b){for(;a&&a!==b;){if(x(a)!==v(a.parentNode)-1)return!1;a=a.parentNode}return!0},prevPoint:fa,nextPoint:V,isSamePoint:ga,isVisiblePoint:function(a){if(F(a.node)||!N(a.node)||
R(a.node))return!0;var b=a.node.childNodes[a.offset-1],a=a.node.childNodes[a.offset];return b&&!P(b)||a&&!P(a)?!1:!0},prevPointUntil:function(a,b){for(;a;){if(b(a))return a;a=fa(a)}return null},nextPointUntil:function(a,b){for(;a;){if(b(a))return a;a=V(a)}return null},walkPoint:function(a,b,c,e){for(var d=a;d&&(c(d),!ga(d,b));)d=V(d,e&&a.node!==d.node&&b.node!==d.node)},ancestor:K,listAncestor:D,lastAncestor:function(a,b){var c=D(a);return i.last(c.filter(b))},listNext:S,listPrev:function(a,b){for(var b=
b||m.fail,c=[];a&&!b(a);)c.push(a),a=a.previousSibling;return c},listDescendant:function(a,b){var c=[];return b=b||m.ok,function k(d){a!==d&&b(d)&&c.push(d);for(var f=0,l=d.childNodes.length;l>f;f++)k(d.childNodes[f])}(a),c},commonAncestor:function(a,b){for(var c=D(a),e=b;e;e=e.parentNode)if(-1<d.inArray(e,c))return e;return null},wrap:function(a,b){var c=a.parentNode,e=d("<"+b+">")[0];return c.insertBefore(e,a),e.appendChild(a),e},insertAfter:L,appendChildNodes:M,position:x,hasChildren:N,makeOffsetPath:function(a,
b){var c=D(b,m.eq(a));return d.map(c,x).reverse()},fromOffsetPath:function(a,b){for(var c=a,e=0,d=b.length;d>e;e++)c=c.childNodes.length<=b[e]?c.childNodes[c.childNodes.length-1]:c.childNodes[b[e]];return c},splitTree:function(a,b,c){a=D(b.node,m.eq(a));return a.length?1===a.length?ha(b,c):a.reduce(function(a,d){var f=L(d.cloneNode(!1),d);return a===b.node&&(a=ha(b,c)),M(f,S(a)),c||(J(d),J(f)),f}):null},create:ia,createText:function(a){return document.createTextNode(a)},remove:W,removeWhile:function(a,
b){for(;a&&!u(a)&&b(a);){var c=a.parentNode;W(a);a=c}},replace:function(a,b){if(a.nodeName.toUpperCase()===b.toUpperCase())return a;var c=ia(b);return a.style.cssText&&(c.style.cssText=a.style.cssText),M(c,i.from(a.childNodes)),L(c,a),W(a),c},html:function(a,b){var c=ja(a[0])?a.val():a.html();b&&(c=c.replace(/<(\/?)(\b(?!!)[^>\s]*)(.*?)(\s*\/?>)/g,function(a,b,c){c=c.toUpperCase();b=/^DIV|^TD|^TH|^P|^LI|^H[1-7]/.test(c)&&!!b;c=/^BLOCKQUOTE|^TABLE|^TBODY|^TR|^HR|^UL|^OL/.test(c);return a+(b||c?"\n":
"")}),c=d.trim(c));return c},value:function(a){return a.val().replace(/[\n\r]/g,"")}};var X;X={readFileAsDataURL:function(a){return d.Deferred(function(b){d.extend(new FileReader,{onload:function(a){b.resolve(a.target.result)},onerror:function(){b.reject(this)}}).readAsDataURL(a)}).promise()},createImage:function(a,b){return d.Deferred(function(c){d("<img>").one("load",function(){c.resolve(d(this))}).one("error abort",function(){c.reject(d(this))}).css({display:"none"}).appendTo(document.body).attr("src",
a).attr("data-filename",b)}).promise()}};var Y={isEdit:function(a){return i.contains([8,9,13,32],a)},nameFromCode:{8:"BACKSPACE",9:"TAB",13:"ENTER",32:"SPACE",48:"NUM0",49:"NUM1",50:"NUM2",51:"NUM3",52:"NUM4",53:"NUM5",54:"NUM6",55:"NUM7",56:"NUM8",66:"B",69:"E",73:"I",74:"J",75:"K",76:"L",82:"R",83:"S",85:"U",89:"Y",90:"Z",191:"SLASH",219:"LEFTBRACKET",220:"BACKSLASH",221:"RIGHTBRACKET"}},pa=function(){this.stylePara=function(a,b){d.each(a.nodes(f.isPara,{includeAncestor:!0}),function(a,e){d(e).css(b)})};
this.current=function(a,b){var c;var e=d(f.isText(a.sc)?a.sc.parentNode:a.sc);c=["font-family","font-size","text-align","list-style-type","line-height"];if(1.9>h.jqueryVersion){var k={};c=(d.each(c,function(a,b){k[b]=e.css(b)}),k)}else c=e.css.call(e,c);c=c||{};if(c["font-size"]=parseInt(c["font-size"],10),c["font-bold"]=document.queryCommandState("bold")?"bold":"normal",c["font-italic"]=document.queryCommandState("italic")?"italic":"normal",c["font-underline"]=document.queryCommandState("underline")?
"underline":"normal",c["font-strikethrough"]=document.queryCommandState("strikeThrough")?"strikethrough":"normal",c["font-superscript"]=document.queryCommandState("superscript")?"superscript":"normal",c["font-subscript"]=document.queryCommandState("subscript")?"subscript":"normal",a.isOnList()){var g=-1<d.inArray(c["list-style-type"],["circle","disc","disc-leading-zero","square"]);c["list-style"]=g?"unordered":"ordered"}else c["list-style"]="none";(g=f.ancestor(a.sc,f.isPara))&&g.style["line-height"]?
c["line-height"]=g.style.lineHeight:(g=parseInt(c["line-height"],10)/parseInt(c["font-size"],10),c["line-height"]=g.toFixed(1));return c.image=f.isImg(b)&&b,c.anchor=a.isOnAnchor()&&f.ancestor(a.sc,f.isAnchor),c.ancestors=f.listAncestor(a.sc,f.isEditable),c.range=a,c}},o,ka=function(a,b){var c,e,d=a.parentElement(),g=document.body.createTextRange(),p=i.from(d.childNodes);for(c=0;c<p.length;c++)if(!f.isText(p[c])){if(g.moveToElementText(p[c]),0<=g.compareEndPoints("StartToStart",a))break;e=p[c]}if(0!==
c&&f.isText(p[c-1])){g=document.body.createTextRange();c=null;g.moveToElementText(e||d);g.collapse(!e);c=e?e.nextSibling:d.firstChild;d=a.duplicate();d.setEndPoint("StartToStart",g);for(e=d.text.replace(/[\r\n]/g,"").length;e>c.nodeValue.length&&c.nextSibling;)e-=c.nodeValue.length,c=c.nextSibling;c.nodeValue;b&&c.nextSibling&&f.isText(c.nextSibling)&&e===c.nodeValue.length&&(e-=c.nodeValue.length,c=c.nextSibling);d=c;c=e}return{cont:d,offset:c}},la=function(a){var b=function(a,c){var d,p;if(f.isText(a)){p=
f.listPrev(a,m.not(f.isText));var l=i.last(p).previousSibling;d=l||a.parentNode;c+=i.sum(i.tail(p),f.nodeLength);p=!l}else{if(d=a.childNodes[c]||a,f.isText(d))return b(d,0);c=0;p=!1}return{node:d,collapseToStart:p,offset:c}},c=document.body.createTextRange(),a=b(a.node,a.offset);return c.moveToElementText(a.node),c.collapse(a.collapseToStart),c.moveStart("character",a.offset),c},s=function(a,b,c,e){this.sc=a;this.so=b;this.ec=c;this.eo=e;var k=function(){if(h.isW3CRangeSupport){var d=document.createRange();
return d.setStart(a,b),d.setEnd(c,e),d}d=la({node:a,offset:b});return d.setEndPoint("EndToEnd",la({node:c,offset:e})),d};this.getPoints=function(){return{sc:a,so:b,ec:c,eo:e}};this.getStartPoint=function(){return{node:a,offset:b}};this.getEndPoint=function(){return{node:c,offset:e}};this.select=function(){var a=k();if(h.isW3CRangeSupport){var b=document.getSelection();0<b.rangeCount&&b.removeAllRanges();b.addRange(a)}else a.select()};this.normalize=function(){var a=function(a){return f.isVisiblePoint(a)||
(f.isLeftEdgePoint(a)?a=f.nextPointUntil(a,f.isVisiblePoint):f.isRightEdgePoint(a)&&(a=f.prevPointUntil(a,f.isVisiblePoint))),a},b=a(this.getStartPoint()),a=a(this.getStartPoint());return new s(b.node,b.offset,a.node,a.offset)};this.nodes=function(a,b){var a=a||m.ok,c=b&&b.includeAncestor,e=b&&b.fullyContains,d=this.getStartPoint(),g=this.getEndPoint(),B=[],k=[];return f.walkPoint(d,g,function(b){if(!f.isEditable(b.node)){var d;e?(f.isLeftEdgePoint(b)&&k.push(b.node),f.isRightEdgePoint(b)&&i.contains(k,
b.node)&&(d=b.node)):d=c?f.ancestor(b.node,a):b.node;d&&a(d)&&B.push(d)}},!0),i.unique(B)};this.commonAncestor=function(){return f.commonAncestor(a,c)};this.expand=function(d){var g=f.ancestor(a,d),d=f.ancestor(c,d);if(!g&&!d)return new s(a,b,c,e);var k=this.getPoints();return g&&(k.sc=g,k.so=0),d&&(k.ec=d,k.eo=f.nodeLength(d)),new s(k.sc,k.so,k.ec,k.eo)};this.collapse=function(d){return d?new s(a,b,a,b):new s(c,e,c,e)};this.splitText=function(){var d=a===c,g=this.getPoints();return f.isText(c)&&
!f.isEdgePoint(this.getEndPoint())&&c.splitText(e),f.isText(a)&&!f.isEdgePoint(this.getStartPoint())&&(g.sc=a.splitText(b),g.so=0,d&&(g.ec=g.sc,g.eo=e-b)),new s(g.sc,g.so,g.ec,g.eo)};this.deleteContents=function(){if(this.isCollapsed())return this;var a=this.splitText(),b=a.nodes(null,{fullyContains:!0}),c=f.prevPointUntil(a.getStartPoint(),function(a){return!i.contains(b,a.node)}),e=[];return d.each(b,function(a,b){var d=b.parentNode;c.node!==d&&1===f.nodeLength(d)&&e.push(d);f.remove(b,!1)}),d.each(e,
function(a,b){f.remove(b,!1)}),new s(c.node,c.offset,c.node,c.offset)};var g=function(b){return function(){var e=f.ancestor(a,b);return!!e&&e===f.ancestor(c,b)}};this.isOnEditable=g(f.isEditable);this.isOnList=g(f.isList);this.isOnAnchor=g(f.isAnchor);this.isOnCell=g(f.isCell);this.isLeftEdgeOf=function(a){return!f.isLeftEdgePoint(this.getStartPoint())?!1:(a=f.ancestor(this.sc,a))&&f.isLeftEdgeOf(this.sc,a)};this.isCollapsed=function(){return a===c&&b===e};this.wrapBodyInlineWithPara=function(){if(f.isBodyContainer(a)&&
f.isEmpty(a))return a.innerHTML=f.emptyPara,new s(a.firstChild,0);if(!f.isInline(a)||f.isParaInline(a))return this;var c=f.listAncestor(a,m.not(f.isInline)),e=i.last(c);f.isInline(e)||(e=c[c.length-2]||a.childNodes[b]);c=f.listPrev(e,f.isParaInline).reverse();if(c=c.concat(f.listNext(e.nextSibling,f.isParaInline)),c.length)e=f.wrap(i.head(c),"p"),f.appendChildNodes(e,i.tail(c));return this};this.insertNode=function(a,b){var c,e,d=this.wrapBodyInlineWithPara().getStartPoint();if(b)e=f.isPara(d.node)?
d.node:d.node.parentNode,c=f.isPara(d.node)?d.node.childNodes[d.offset]:f.splitTree(d.node,d);else{var g=f.listAncestor(d.node,f.isBodyContainer),B=i.last(g)||d.node;f.isBodyContainer(B)?(c=g[g.length-2],e=B):(c=B,e=c.parentNode);c=c&&f.splitTree(c,d)}return c?c.parentNode.insertBefore(a,c):e.appendChild(a),a};this.toString=function(){var a=k();return h.isW3CRangeSupport?a.toString():a.text};this.bookmark=function(d){return{s:{path:f.makeOffsetPath(d,a),offset:b},e:{path:f.makeOffsetPath(d,c),offset:e}}};
this.getClientRects=function(){return k().getClientRects()}};o={create:function(a,b,c,e){if(arguments.length)2===arguments.length&&(c=a,e=b);else if(h.isW3CRangeSupport){var d=document.getSelection();if(0===d.rangeCount||f.isBody(d.anchorNode))return null;d=d.getRangeAt(0);a=d.startContainer;b=d.startOffset;c=d.endContainer;e=d.endOffset}else{var g=document.selection.createRange(),d=g.duplicate();d.collapse(!1);g.collapse(!0);g=ka(g,!0);d=ka(d,!1);f.isText(g.node)&&f.isLeftEdgePoint(g)&&f.isTextNode(d.node)&&
f.isRightEdgePoint(d)&&d.node.nextSibling===g.node&&(g=d);a=g.cont;b=g.offset;c=d.cont;e=d.offset}return new s(a,b,c,e)},createFromNode:function(a){return this.create(a,0,a,1)},createFromBookmark:function(a,b){var c=f.fromOffsetPath(a,b.s.path),d=b.s.offset,k=f.fromOffsetPath(a,b.e.path);return new s(c,d,k,b.e.offset)}};var qa=function(){this.insertTab=function(a,b,c){a=f.createText(Array(c+1).join(f.NBSP_CHAR));b=b.deleteContents();b.insertNode(a,!0);b=o.create(a,c);b.select()};this.insertParagraph=
function(){var a=o.create(),a=a.deleteContents(),a=a.wrapBodyInlineWithPara(),b,c=f.ancestor(a.sc,f.isPara);c?(b=f.splitTree(c,a.getStartPoint()),a=f.listDescendant(c,f.isEmptyAnchor),a=a.concat(f.listDescendant(b,f.isEmptyAnchor)),d.each(a,function(a,b){f.remove(b)})):(c=a.sc.childNodes[a.so],b=d(f.emptyPara)[0],c?a.sc.insertBefore(b,c):a.sc.appendChild(b));o.create(b,0).normalize().select()}},ra=function(){this.tab=function(a,b){var c=f.ancestor(a.commonAncestor(),f.isCell),d=f.ancestor(c,f.isTable),
d=f.listDescendant(d,f.isCell);(c=i[b?"prev":"next"](d,c))&&o.create(c,0).select()};this.createTable=function(a,b){var c;c=[];for(var e=0;a>e;e++)c.push("<td>"+f.blank+"</td>");c=c.join("");for(var k,e=[],g=0;b>g;g++)e.push("<tr>"+c+"</tr>");return k=e.join(""),d('<table class="table table-bordered">'+k+"</table>")[0]}},sa=function(){this.insertOrderedList=function(){this.toggleList("OL")};this.insertUnorderedList=function(){this.toggleList("UL")};this.indent=function(){var a=this,b=o.create().wrapBodyInlineWithPara(),
c=b.nodes(f.isPara,{includeAncestor:!0}),c=i.clusterBy(c,m.peq2("parentNode"));d.each(c,function(b,c){var g=i.head(c);f.isLi(g)?a.wrapList(c,g.parentNode.nodeName):d.each(c,function(a,b){d(b).css("marginLeft",function(a,b){return(parseInt(b,10)||0)+25})})});b.select()};this.outdent=function(){var a=this,b=o.create().wrapBodyInlineWithPara(),c=b.nodes(f.isPara,{includeAncestor:!0}),c=i.clusterBy(c,m.peq2("parentNode"));d.each(c,function(b,c){var g=i.head(c);f.isLi(g)?a.releaseList([c]):d.each(c,function(a,
b){d(b).css("marginLeft",function(a,b){return b=parseInt(b,10)||0,25<b?b-25:""})})});b.select()};this.toggleList=function(a){var b=this,c=o.create().wrapBodyInlineWithPara(),e=c.nodes(f.isPara,{includeAncestor:!0}),k=i.clusterBy(e,m.peq2("parentNode"));i.find(e,f.isPurePara)?d.each(k,function(c,d){b.wrapList(d,a)}):(e=c.nodes(f.isList,{includeAncestor:!0}).filter(function(b){return!d.nodeName(b,a)}),e.length?d.each(e,function(b,c){f.replace(c,a)}):this.releaseList(k,!0));c.select()};this.wrapList=
function(a,b){var c=i.head(a),e=i.last(a),k=f.isList(c.previousSibling)&&c.previousSibling,c=f.isList(e.nextSibling)&&e.nextSibling,e=k||f.insertAfter(f.create(b||"UL"),e),a=d.map(a,function(a){return f.isPurePara(a)?f.replace(a,"LI"):a});f.appendChildNodes(e,a);c&&(f.appendChildNodes(e,i.from(c.childNodes)),f.remove(c))};this.releaseList=function(a,b){var c=[];return d.each(a,function(a,k){var g=i.head(k),h=i.last(k),l=b?f.lastAncestor(g,f.isList):g.parentNode,h=1<l.childNodes.length?f.splitTree(l,
{node:h.parentNode,offset:f.position(h)+1},!0):null,g=f.splitTree(l,{node:g.parentNode,offset:f.position(g)},!0),k=b?f.listDescendant(g,f.isLi):i.from(g.childNodes).filter(f.isLi);(b||!f.isList(l.parentNode))&&(k=d.map(k,function(a){return f.replace(a,"P")}));d.each(i.from(k).reverse(),function(a,b){f.insertAfter(b,l)});g=i.compact([l,g,h]);d.each(g,function(a,b){var c=[b].concat(f.listDescendant(b,f.isList));d.each(c.reverse(),function(a,b){f.nodeLength(b)||f.remove(b,!0)})});c=c.concat(k)}),c}},
ta=function(){var a=new pa,b=new ra,c=new qa,e=new sa;this.saveRange=function(a,b){a.focus();a.data("range",o.create());b&&o.create().collapse().select()};this.restoreRange=function(a){var b=a.data("range");b&&(b.select(),a.focus())};this.currentStyle=function(b){var c=o.create();return c?c.isOnEditable()&&a.current(c,b):!1};var k=this.triggerOnChange=function(a){var b=a.data("callbacks").onChange;b&&b(a.html(),a)};this.undo=function(a){a.data("NoteHistory").undo();k(a)};this.redo=function(a){a.data("NoteHistory").redo();
k(a)};for(var g=this.afterCommand=function(a){a.data("NoteHistory").recordUndo();k(a)},p="bold italic underline strikethrough superscript subscript justifyLeft justifyCenter justifyRight justifyFull formatBlock removeFormat backColor foreColor insertHorizontalRule fontName".split(" "),l=0,j=p.length;j>l;l++)this[p[l]]=function(a){return function(b,c){document.execCommand(a,!1,c);g(b)}}(p[l]);this.tab=function(a,d){var e=o.create();e.isCollapsed()&&e.isOnCell()?b.tab(e):(c.insertTab(a,e,d.tabsize),
g(a))};this.untab=function(){var a=o.create();a.isCollapsed()&&a.isOnCell()&&b.tab(a,!0)};this.insertParagraph=function(a){c.insertParagraph(a);g(a)};this.insertOrderedList=function(a){e.insertOrderedList(a);g(a)};this.insertUnorderedList=function(a){e.insertUnorderedList(a);g(a)};this.indent=function(a){e.indent(a);g(a)};this.outdent=function(a){e.outdent(a);g(a)};this.insertImage=function(a,b,c){X.createImage(b,c).then(function(b){b.css({display:"",width:Math.min(a.width(),b.width())});o.create().insertNode(b[0]);
g(a)}).fail(function(){var b=a.data("callbacks");b.onImageUploadError&&b.onImageUploadError()})};this.insertVideo=function(a,b){var c,e=b.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/),f=b.match(/\/\/instagram.com\/p\/(.[a-zA-Z0-9]*)/),k=b.match(/\/\/vine.co\/v\/(.[a-zA-Z0-9]*)/),h=b.match(/\/\/(player.)?vimeo.com\/([a-z]*\/)*([0-9]{6,11})[?]?.*/),i=b.match(/.+dailymotion.com\/(video|hub)\/([^_]+)[^#]*(#video=([^_&]+))?/),p=b.match(/\/\/v\.youku\.com\/v_show\/id_(\w+)\.html/);
e&&11===e[2].length?(c=e[2],c=d("<iframe>").attr("src","//www.youtube.com/embed/"+c).attr("width","640").attr("height","360")):f&&f[0].length?c=d("<iframe>").attr("src",f[0]+"/embed/").attr("width","612").attr("height","710").attr("scrolling","no").attr("allowtransparency","true"):k&&k[0].length?c=d("<iframe>").attr("src",k[0]+"/embed/simple").attr("width","600").attr("height","600").attr("class","vine-embed"):h&&h[3].length?c=d("<iframe webkitallowfullscreen mozallowfullscreen allowfullscreen>").attr("src",
"//player.vimeo.com/video/"+h[3]).attr("width","640").attr("height","360"):i&&i[2].length?c=d("<iframe>").attr("src","//www.dailymotion.com/embed/video/"+i[2]).attr("width","640").attr("height","360"):p&&p[1].length&&(c=d("<iframe webkitallowfullscreen mozallowfullscreen allowfullscreen>").attr("height","498").attr("width","510").attr("src","//player.youku.com/embed/"+p[1]));c&&(c.attr("frameborder",0),o.create().insertNode(c[0]),g(a))};this.formatBlock=function(a,b){b=h.isMSIE?"<"+b+">":b;document.execCommand("FormatBlock",
!1,b);g(a)};this.formatPara=function(a){this.formatBlock(a,"P");g(a)};for(l=1;6>=l;l++)this["formatH"+l]=function(a){return function(b){this.formatBlock(b,"H"+a)}}(l);this.fontSize=function(a,b){document.execCommand("fontSize",!1,3);h.isFF?a.find("font[size=3]").removeAttr("size").css("font-size",b+"px"):a.find("span").filter(function(){return"medium"===this.style.fontSize}).css("font-size",b+"px");g(a)};this.lineHeight=function(b,c){a.stylePara(o.create(),{lineHeight:c});g(b)};this.unlink=function(a){var b=
o.create();b.isOnAnchor()&&(b=f.ancestor(b.sc,f.isAnchor),b=o.createFromNode(b),b.select(),document.execCommand("unlink"),g(a))};this.createLink=function(a,b,c){var e=b.url,f=b.text,k=b.newWindow,b=b.range;c.onCreateLink&&(e=c.onCreateLink(e));b=b.deleteContents();c=b.insertNode(d("<A>"+f+"</A>")[0],!0);d(c).attr({href:e,target:k?"_blank":""});o.createFromNode(c).select();g(a)};this.getLinkInfo=function(a){a.focus();var a=o.create().expand(f.isAnchor),b=d(i.head(a.nodes(f.isAnchor)));return{range:a,
text:a.toString(),isNewWindow:b.length?"_blank"===b.attr("target"):!0,url:b.length?b.attr("href"):""}};this.getVideoInfo=function(a){a.focus();a=o.create();a.isOnAnchor()&&(a=f.ancestor(a.sc,f.isAnchor),a=o.createFromNode(a));return{text:a.toString()}};this.color=function(a,b){var c=JSON.parse(b),d=c.foreColor,c=c.backColor;d&&document.execCommand("foreColor",!1,d);c&&document.execCommand("backColor",!1,c);g(a)};this.insertTable=function(a,c){var d=c.split("x"),e=o.create(),e=e.deleteContents();e.insertNode(b.createTable(d[0],
d[1]));g(a)};this.floatMe=function(a,b,c){c.css("float",b);g(a)};this.imageShape=function(a,b,c){c.removeClass("img-rounded img-circle img-thumbnail");b&&c.addClass(b)};this.resize=function(a,b,c){c.css({width:100*b+"%",height:""});g(a)};this.resizeTo=function(a,b,c){if(c)var c=a.y/a.x,d=b.data("ratio"),a={width:d>c?a.x:a.y/d,height:d>c?a.x*d:a.y};else a={width:a.x,height:a.y};b.css(a)};this.removeMedia=function(a,b,c){c.detach();g(a)}},ua=function(a){var b=[],c=-1,d=a[0],f=function(){var b=o.create(),
c={s:{path:[0],offset:0},e:{path:[0],offset:0}};return{contents:a.html(),bookmark:b?b.bookmark(d):c}},g=function(b){null!==b.contents&&a.html(b.contents);null!==b.bookmark&&o.createFromBookmark(d,b.bookmark).select()};this.undo=function(){0<c&&(c--,g(b[c]))};this.redo=function(){b.length-1>c&&(c++,g(b[c]))};this.recordUndo=function(){c++;b.length>c&&(b=b.slice(0,c));b.push(f())};this.recordUndo()},ma=function(){this.update=function(a,b){var c=function(a,b){a.find(".dropdown-menu li a").each(function(){this.className=
d(this).data("value")+""==b+""?"checked":""})},e=function(b,c){a.find(b).toggleClass("active",c())},f=a.find(".note-fontname");if(f.length){var g=b["font-family"];g&&(g=i.head(g.split(",")),g=g.replace(/\'/g,""),f.find(".note-current-fontname").text(g),c(f,g))}f=a.find(".note-fontsize");f.find(".note-current-fontsize").text(b["font-size"]);c(f,parseFloat(b["font-size"]));f=a.find(".note-height");c(f,parseFloat(b["line-height"]));e('button[data-event="bold"]',function(){return"bold"===b["font-bold"]});
e('button[data-event="italic"]',function(){return"italic"===b["font-italic"]});e('button[data-event="underline"]',function(){return"underline"===b["font-underline"]});e('button[data-event="strikethrough"]',function(){return"strikethrough"===b["font-strikethrough"]});e('button[data-event="superscript"]',function(){return"superscript"===b["font-superscript"]});e('button[data-event="subscript"]',function(){return"subscript"===b["font-subscript"]});e('button[data-event="justifyLeft"]',function(){return"left"===
b["text-align"]||"start"===b["text-align"]});e('button[data-event="justifyCenter"]',function(){return"center"===b["text-align"]});e('button[data-event="justifyRight"]',function(){return"right"===b["text-align"]});e('button[data-event="justifyFull"]',function(){return"justify"===b["text-align"]});e('button[data-event="insertUnorderedList"]',function(){return"unordered"===b["list-style"]});e('button[data-event="insertOrderedList"]',function(){return"ordered"===b["list-style"]})};this.updateRecentColor=
function(a,b,c){var a=d(a).closest(".note-color").find(".note-recent-color"),e=JSON.parse(a.attr("data-value"));e[b]=c;a.attr("data-value",JSON.stringify(e));a.find("i").css("backColor"===b?"background-color":"color",c)}},va=function(){var a=new ma;this.update=function(b,c){a.update(b,c)};this.updateRecentColor=function(b,c,d){a.updateRecentColor(b,c,d)};this.activate=function(a){a.find("button").not('button[data-event="codeview"]').removeClass("disabled")};this.deactivate=function(a){a.find("button").not('button[data-event="codeview"]').addClass("disabled")};
this.updateFullscreen=function(a,c){a.find('button[data-event="fullscreen"]').toggleClass("active",c)};this.updateCodeview=function(a,c){a.find('button[data-event="codeview"]').toggleClass("active",c)}},wa=function(){var a=new ma,b=function(a,b){var c=d(a),f=b?c.offset():c.position(),c=c.outerHeight(!0);return{left:f.left,top:f.top+c}},c=function(a,b){a.css({display:"block",left:b.left,top:b.top})};this.update=function(e,f,g){a.update(e,f);var h=e.find(".note-link-popover");if(f.anchor){var l=h.find("a"),
j=d(f.anchor).attr("href");l.attr("href",j).html(j);c(h,b(f.anchor,g))}else h.hide();h=e.find(".note-image-popover");f.image?c(h,b(f.image,g)):h.hide();e=e.find(".note-air-popover");g&&!f.range.isCollapsed()?(f=m.rect2bnd(i.last(f.range.getClientRects())),c(e,{left:Math.max(f.left+f.width/2-20,0),top:f.top+f.height})):e.hide()};this.updateRecentColor=function(a,b,c){a.updateRecentColor(a,b,c)};this.hide=function(a){a.children().hide()}},xa=function(){this.update=function(a,b,c){a=a.find(".note-control-selection");
if(b.image){var e=d(b.image),c=c?e.offset():e.position(),f=e.outerWidth(!0),e=e.outerHeight(!0);a.css({display:"block",left:c.left,top:c.top,width:f,height:e}).data("target",b.image);a.find(".note-control-selection-info").text(f+"x"+e)}else a.hide()};this.hide=function(a){a.children().hide()}},ya=function(){var a=function(a,c){a.toggleClass("disabled",!c);a.attr("disabled",!c)};this.showImageDialog=function(b,c){return d.Deferred(function(b){var d=c.find(".note-image-dialog"),f=c.find(".note-image-input"),
h=c.find(".note-image-url"),i=c.find(".note-image-btn");d.one("shown.bs.modal",function(){f.replaceWith(f.clone().on("change",function(){b.resolve(this.files);d.modal("hide")}).val(""));i.click(function(a){a.preventDefault();b.resolve(h.val());d.modal("hide")});h.on("keyup paste",function(b){b="paste"===b.type?b.originalEvent.clipboardData.getData("text"):h.val();a(i,b)}).val("").trigger("focus")}).one("hidden.bs.modal",function(){f.off("change");h.off("keyup paste");i.off("click");"pending"===b.state()&&
b.reject()}).modal("show")})};this.showVideoDialog=function(b,c,e){return d.Deferred(function(b){var d=c.find(".note-video-dialog"),f=d.find(".note-video-url"),h=d.find(".note-video-btn");d.one("shown.bs.modal",function(){f.val(e.text).keyup(function(){a(h,f.val())}).trigger("keyup").trigger("focus");h.click(function(a){a.preventDefault();b.resolve(f.val());d.modal("hide")})}).one("hidden.bs.modal",function(){f.off("keyup");h.off("click");"pending"===b.state()&&b.reject()}).modal("show")})};this.showLinkDialog=
function(b,c,e){return d.Deferred(function(b){var d=c.find(".note-link-dialog"),f=d.find(".note-link-text"),h=d.find(".note-link-url"),i=d.find(".note-link-btn"),j=d.find("input[type=checkbox]");d.one("shown.bs.modal",function(){f.val(e.text);f.keyup(function(){e.text=f.val()});e.url||(e.url=e.text,a(i,e.text));h.keyup(function(){a(i,h.val());e.text||f.val(h.val())}).val(e.url).trigger("focus").trigger("select");j.prop("checked",e.newWindow);i.one("click",function(a){a.preventDefault();b.resolve({range:e.range,
url:h.val(),text:f.val(),newWindow:j.is(":checked")});d.modal("hide")})}).one("hidden.bs.modal",function(){f.off("keyup");h.off("keyup");i.off("click");"pending"===b.state()&&b.reject()}).modal("show")}).promise()};this.showHelpDialog=function(a,c){return d.Deferred(function(a){c.find(".note-help-dialog").one("hidden.bs.modal",function(){a.resolve()}).modal("show")}).promise()}};h.hasCodeMirror&&(h.isSupportAmd?require(["CodeMirror"],function(a){r=a}):r=window.CodeMirror);d.summernote=d.summernote||
{};d.extend(d.summernote,{version:"0.5.10",options:{width:null,height:null,minHeight:null,maxHeight:null,focus:!1,tabsize:4,styleWithSpan:!0,disableLinkTarget:!1,disableDragAndDrop:!1,disableResizeEditor:!1,codemirror:{mode:"text/html",htmlMode:!0,lineNumbers:!0},lang:"en-US",direction:null,toolbar:[["style",["style"]],["font","bold italic underline superscript subscript strikethrough clear".split(" ")],["fontname",["fontname"]],["color",["color"]],["para",["ul","ol","paragraph"]],["height",["height"]],
["table",["table"]],["insert",["link","picture","video","hr"]],["view",["fullscreen","codeview"]],["help",["help"]]],airMode:!1,airPopover:[["color",["color"]],["font",["bold","underline","clear"]],["para",["ul","paragraph"]],["table",["table"]],["insert",["link","picture"]]],styleTags:"p blockquote pre h1 h2 h3 h4 h5 h6".split(" "),defaultFontName:"Helvetica Neue",fontNames:"Arial;Arial Black;Comic Sans MS;Courier New;Helvetica Neue;Impact;Lucida Grande;Tahoma;Times New Roman;Verdana".split(";"),
colors:["#000000 #424242 #636363 #9C9C94 #CEC6CE #EFEFEF #F7F7F7 #FFFFFF".split(" "),"#FF0000 #FF9C00 #FFFF00 #00FF00 #00FFFF #0000FF #9C00FF #FF00FF".split(" "),"#F7C6CE #FFE7CE #FFEFC6 #D6EFD6 #CEDEE7 #CEE7F7 #D6D6E7 #E7D6DE".split(" "),"#E79C9C #FFC69C #FFE79C #B5D6A5 #A5C6CE #9CC6EF #B5A5D6 #D6A5BD".split(" "),"#E76363 #F7AD6B #FFD663 #94BD7B #73A5AD #6BADDE #8C7BC6 #C67BA5".split(" "),"#CE0000 #E79439 #EFC631 #6BA54A #4A7B8C #3984C6 #634AA5 #A54A7B".split(" "),"#9C0000 #B56308 #BD9400 #397B21 #104A5A #085294 #311873 #731842".split(" "),
"#630000 #7B3900 #846300 #295218 #083139 #003163 #21104A #4A1031".split(" ")],fontSizes:"8 9 10 11 12 14 18 24 36".split(" "),lineHeights:"1.0 1.2 1.4 1.5 1.6 1.8 2.0 3.0".split(" "),insertTableMaxSize:{col:10,row:10},oninit:null,onfocus:null,onblur:null,onenter:null,onkeyup:null,onkeydown:null,onImageUpload:null,onImageUploadError:null,onToolbarClick:null,onCreateLink:function(a){return-1!==a.indexOf("@")&&-1===a.indexOf(":")?a="mailto:"+a:-1===a.indexOf("://")&&(a="http://"+a),a},keyMap:{pc:{ENTER:"insertParagraph",
"CTRL+Z":"undo","CTRL+Y":"redo",TAB:"tab","SHIFT+TAB":"untab","CTRL+B":"bold","CTRL+I":"italic","CTRL+U":"underline","CTRL+SHIFT+S":"strikethrough","CTRL+BACKSLASH":"removeFormat","CTRL+SHIFT+L":"justifyLeft","CTRL+SHIFT+E":"justifyCenter","CTRL+SHIFT+R":"justifyRight","CTRL+SHIFT+J":"justifyFull","CTRL+SHIFT+NUM7":"insertUnorderedList","CTRL+SHIFT+NUM8":"insertOrderedList","CTRL+LEFTBRACKET":"outdent","CTRL+RIGHTBRACKET":"indent","CTRL+NUM0":"formatPara","CTRL+NUM1":"formatH1","CTRL+NUM2":"formatH2",
"CTRL+NUM3":"formatH3","CTRL+NUM4":"formatH4","CTRL+NUM5":"formatH5","CTRL+NUM6":"formatH6","CTRL+ENTER":"insertHorizontalRule","CTRL+K":"showLinkDialog"},mac:{ENTER:"insertParagraph","CMD+Z":"undo","CMD+SHIFT+Z":"redo",TAB:"tab","SHIFT+TAB":"untab","CMD+B":"bold","CMD+I":"italic","CMD+U":"underline","CMD+SHIFT+S":"strikethrough","CMD+BACKSLASH":"removeFormat","CMD+SHIFT+L":"justifyLeft","CMD+SHIFT+E":"justifyCenter","CMD+SHIFT+R":"justifyRight","CMD+SHIFT+J":"justifyFull","CMD+SHIFT+NUM7":"insertUnorderedList",
"CMD+SHIFT+NUM8":"insertOrderedList","CMD+LEFTBRACKET":"outdent","CMD+RIGHTBRACKET":"indent","CMD+NUM0":"formatPara","CMD+NUM1":"formatH1","CMD+NUM2":"formatH2","CMD+NUM3":"formatH3","CMD+NUM4":"formatH4","CMD+NUM5":"formatH5","CMD+NUM6":"formatH6","CMD+ENTER":"insertHorizontalRule","CMD+K":"showLinkDialog"}}},lang:{"en-US":{font:{bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strikethrough",subscript:"Subscript",superscript:"Superscript",clear:"Remove Font Style",height:"Line Height",
name:"Font Family",size:"Font Size"},image:{image:"Picture",insert:"Insert Image",resizeFull:"Resize Full",resizeHalf:"Resize Half",resizeQuarter:"Resize Quarter",floatLeft:"Float Left",floatRight:"Float Right",floatNone:"Float None",shapeRounded:"Shape: Rounded",shapeCircle:"Shape: Circle",shapeThumbnail:"Shape: Thumbnail",shapeNone:"Shape: None",dragImageHere:"Drag an image here",selectFromFiles:"Select from files",url:"Image URL",remove:"Remove Image"},link:{link:"Link",insert:"Insert Link",unlink:"Unlink",
edit:"Edit",textToDisplay:"Text to display",url:"To what URL should this link go?",openInNewWindow:"Open in new window"},video:{video:"Video",videoLink:"Video Link",insert:"Insert Video",url:"Video URL?",providers:"(YouTube, Vimeo, Vine, Instagram, DailyMotion or Youku)"},table:{table:"Table"},hr:{insert:"Insert Horizontal Rule"},style:{style:"Style",normal:"Normal",blockquote:"Quote",pre:"Code",h1:"Header 1",h2:"Header 2",h3:"Header 3",h4:"Header 4",h5:"Header 5",h6:"Header 6"},lists:{unordered:"Unordered list",
ordered:"Ordered list"},options:{help:"Help",fullscreen:"Full Screen",codeview:"Code View"},paragraph:{paragraph:"Paragraph",outdent:"Outdent",indent:"Indent",left:"Align left",center:"Align center",right:"Align right",justify:"Justify full"},color:{recent:"Recent Color",more:"More Color",background:"Background Color",foreground:"Foreground Color",transparent:"Transparent",setTransparent:"Set transparent",reset:"Reset",resetToDefault:"Reset to default"},shortcut:{shortcuts:"Keyboard shortcuts",close:"Close",
textFormatting:"Text formatting",action:"Action",paragraphFormatting:"Paragraph formatting",documentStyle:"Document Style"},history:{undo:"Undo",redo:"Redo"}}}});var y=new function(){var a=function(a,b){var c=b.event,d=b.value,e=b.title,f=b.className,g=b.dropdown,t=b.hide;return'<button type="button" class="btn btn-default btn-sm btn-small'+(f?" "+f:"")+(g?" dropdown-toggle":"")+'"'+(g?' data-toggle="dropdown"':"")+(e?' title="'+e+'"':"")+(c?' data-event="'+c+'"':"")+(d?" data-value='"+d+"'":"")+
(t?" data-hide='"+t+"'":"")+' tabindex="-1">'+a+(g?' <span class="caret"></span>':"")+"</button>"+(g||"")},b=function(b,c){return a('<i class="'+b+'"></i>',c)},c=function(a,b){return'<div class="'+a+' popover bottom in" style="display: none;"><div class="arrow"></div><div class="popover-content">'+b+"</div></div>"},e=function(a,b,c,d){return'<div class="'+a+' modal" aria-hidden="false"><div class="modal-dialog"><div class="modal-content">'+(b?'<div class="modal-header"><button type="button" class="close" aria-hidden="true" tabindex="-1">&times;</button><h4 class="modal-title">'+
b+"</h4></div>":"")+'<form class="note-modal-form"><div class="modal-body"><div class="row-fluid">'+c+"</div></div>"+(d?'<div class="modal-footer">'+d+"</div>":"")+"</form></div></div></div>"},i={picture:function(a){return b("fa fa-picture-o icon-picture",{event:"showImageDialog",title:a.image.image,hide:!0})},link:function(a){return b("fa fa-link icon-link",{event:"showLinkDialog",title:a.link.link,hide:!0})},video:function(a){return b("fa fa-youtube-play icon-play",{event:"showVideoDialog",title:a.video.video,
hide:!0})},table:function(a){return b("fa fa-table icon-table",{title:a.table.table,dropdown:'<ul class="note-table dropdown-menu"><div class="note-dimension-picker"><div class="note-dimension-picker-mousecatcher" data-event="insertTable" data-value="1x1"></div><div class="note-dimension-picker-highlighted"></div><div class="note-dimension-picker-unhighlighted"></div></div><div class="note-dimension-display"> 1 x 1 </div></ul>'})},style:function(a,c){var d=c.styleTags.reduce(function(b,c){var d=a.style["p"===
c?"normal":c];return b+'<li><a data-event="formatBlock" href="#" data-value="'+c+'">'+("p"===c||"pre"===c?d:"<"+c+">"+d+"</"+c+">")+"</a></li>"},"");return b("fa fa-magic icon-magic",{title:a.style.style,dropdown:'<ul class="dropdown-menu">'+d+"</ul>"})},fontname:function(b,c){var d=c.fontNames.reduce(function(a,b){return h.isFontInstalled(b)?a+'<li><a data-event="fontName" href="#" data-value="'+b+'"><i class="fa fa-check icon-ok"></i> '+b+"</a></li>":a},"");return a('<span class="note-current-fontname">'+
c.defaultFontName+"</span>",{title:b.font.name,dropdown:'<ul class="dropdown-menu">'+d+"</ul>"})},fontsize:function(b,c){var d=c.fontSizes.reduce(function(a,b){return a+'<li><a data-event="fontSize" href="#" data-value="'+b+'"><i class="fa fa-check icon-ok"></i> '+b+"</a></li>"},"");return a('<span class="note-current-fontsize">11</span>',{title:b.font.size,dropdown:'<ul class="dropdown-menu">'+d+"</ul>"})},color:function(b){var c=a('<i class="fa fa-font icon-font" style="color:black;background-color:yellow;"></i>',
{className:"note-recent-color",title:b.color.recent,event:"color",value:'{"backColor":"yellow"}'}),b=a("",{title:b.color.more,dropdown:'<ul class="dropdown-menu"><li><div class="btn-group"><div class="note-palette-title">'+b.color.background+'</div><div class="note-color-reset" data-event="backColor" data-value="inherit" title="'+b.color.transparent+'">'+b.color.setTransparent+'</div><div class="note-color-palette" data-target-event="backColor"></div></div><div class="btn-group"><div class="note-palette-title">'+
b.color.foreground+'</div><div class="note-color-reset" data-event="foreColor" data-value="inherit" title="'+b.color.reset+'">'+b.color.resetToDefault+'</div><div class="note-color-palette" data-target-event="foreColor"></div></div></li></ul>'});return c+b},bold:function(a){return b("fa fa-bold icon-bold",{event:"bold",title:a.font.bold})},italic:function(a){return b("fa fa-italic icon-italic",{event:"italic",title:a.font.italic})},underline:function(a){return b("fa fa-underline icon-underline",{event:"underline",
title:a.font.underline})},strikethrough:function(a){return b("fa fa-strikethrough icon-strikethrough",{event:"strikethrough",title:a.font.strikethrough})},superscript:function(a){return b("fa fa-superscript icon-superscript",{event:"superscript",title:a.font.superscript})},subscript:function(a){return b("fa fa-subscript icon-subscript",{event:"subscript",title:a.font.subscript})},clear:function(a){return b("fa fa-eraser icon-eraser",{event:"removeFormat",title:a.font.clear})},ul:function(a){return b("fa fa-list-ul icon-list-ul",
{event:"insertUnorderedList",title:a.lists.unordered})},ol:function(a){return b("fa fa-list-ol icon-list-ol",{event:"insertOrderedList",title:a.lists.ordered})},paragraph:function(a){var c=b("fa fa-align-left icon-align-left",{title:a.paragraph.left,event:"justifyLeft"}),d=b("fa fa-align-center icon-align-center",{title:a.paragraph.center,event:"justifyCenter"}),e=b("fa fa-align-right icon-align-right",{title:a.paragraph.right,event:"justifyRight"}),f=b("fa fa-align-justify icon-align-justify",{title:a.paragraph.justify,
event:"justifyFull"}),g=b("fa fa-outdent icon-indent-left",{title:a.paragraph.outdent,event:"outdent"}),h=b("fa fa-indent icon-indent-right",{title:a.paragraph.indent,event:"indent"});return b("fa fa-align-left icon-align-left",{title:a.paragraph.paragraph,dropdown:'<div class="dropdown-menu"><div class="note-align btn-group">'+c+d+e+f+'</div><div class="note-list btn-group">'+h+g+"</div></div>"})},height:function(a,c){var d=c.lineHeights.reduce(function(a,b){return a+'<li><a data-event="lineHeight" href="#" data-value="'+
parseFloat(b)+'"><i class="fa fa-check icon-ok"></i> '+b+"</a></li>"},"");return b("fa fa-text-height icon-text-height",{title:a.font.height,dropdown:'<ul class="dropdown-menu">'+d+"</ul>"})},help:function(a){return b("fa fa-question icon-question",{event:"showHelpDialog",title:a.options.help,hide:!0})},fullscreen:function(a){return b("fa fa-arrows-alt icon-fullscreen",{event:"fullscreen",title:a.options.fullscreen})},codeview:function(a){return b("fa fa-code icon-code",{event:"codeview",title:a.options.codeview})},
undo:function(a){return b("fa fa-undo icon-undo",{event:"undo",title:a.history.undo})},redo:function(a){return b("fa fa-repeat icon-repeat",{event:"redo",title:a.history.redo})},hr:function(a){return b("fa fa-minus icon-hr",{event:"insertHorizontalRule",title:a.hr.insert})}},g=function(d,e){var f=b("fa fa-edit icon-edit",{title:d.link.edit,event:"showLinkDialog",hide:!0}),g=b("fa fa-unlink icon-unlink",{title:d.link.unlink,event:"unlink"}),f='<div class="note-popover">'+c("note-link-popover",'<a href="http://www.google.com" target="_blank">www.google.com</a>&nbsp;&nbsp;<div class="note-insert btn-group">'+
f+g+"</div>"),g=a('<span class="note-fontsize-10">100%</span>',{title:d.image.resizeFull,event:"resize",value:"1"}),h=a('<span class="note-fontsize-10">50%</span>',{title:d.image.resizeHalf,event:"resize",value:"0.5"}),j=a('<span class="note-fontsize-10">25%</span>',{title:d.image.resizeQuarter,event:"resize",value:"0.25"}),l=b("fa fa-align-left icon-align-left",{title:d.image.floatLeft,event:"floatMe",value:"left"}),t=b("fa fa-align-right icon-align-right",{title:d.image.floatRight,event:"floatMe",
value:"right"}),z=b("fa fa-align-justify icon-align-justify",{title:d.image.floatNone,event:"floatMe",value:"none"}),Z=b("fa fa-square icon-unchecked",{title:d.image.shapeRounded,event:"imageShape",value:"img-rounded"}),za=b("fa fa-circle-o icon-circle-blank",{title:d.image.shapeCircle,event:"imageShape",value:"img-circle"}),Aa=b("fa fa-picture-o icon-picture",{title:d.image.shapeThumbnail,event:"imageShape",value:"img-thumbnail"}),E=b("fa fa-times icon-times",{title:d.image.shapeNone,event:"imageShape",
value:""}),O=b("fa fa-trash-o icon-trash",{title:d.image.remove,event:"removeMedia",value:"none"}),g=c("note-image-popover",'<div class="btn-group">'+g+h+j+'</div><div class="btn-group">'+l+t+z+'</div><div class="btn-group">'+Z+za+Aa+E+'</div><div class="btn-group">'+O+"</div>"),f=f+g;if(e.airMode){g="";h=0;for(j=e.airPopover.length;j>h;h++){l=e.airPopover[h];g+='<div class="note-'+l[0]+' btn-group">';t=0;for(z=l[1].length;z>t;t++)g+=i[l[1][t]](d,e);g+="</div>"}g=c("note-air-popover",g)}else g="";
return f+g+"</div>"},j=function(){return'<div class="note-handle"><div class="note-control-selection"><div class="note-control-selection-bg"></div><div class="note-control-holder note-control-nw"></div><div class="note-control-holder note-control-ne"></div><div class="note-control-holder note-control-sw"></div><div class="note-control-sizing note-control-se"></div><div class="note-control-selection-info"></div></div></div>'},l=function(a,b){return'<table class="note-shortcut"><thead><tr><th></th><th>'+
a+"</th></tr></thead><tbody>"+b+"</tbody></table>"},n=function(a,b){var c='<table class="note-shortcut-layout"><tbody><tr><td>'+l(a.shortcut.action,"<tr><td>\u2318 + Z</td><td>"+a.history.undo+"</td></tr><tr><td>\u2318 + \u21e7 + Z</td><td>"+a.history.redo+"</td></tr><tr><td>\u2318 + ]</td><td>"+a.paragraph.indent+"</td></tr><tr><td>\u2318 + [</td><td>"+a.paragraph.outdent+"</td></tr><tr><td>\u2318 + ENTER</td><td>"+a.hr.insert+"</td></tr>")+"</td><td>",d;d=l(a.shortcut.textFormatting,"<tr><td>\u2318 + B</td><td>"+
a.font.bold+"</td></tr><tr><td>\u2318 + I</td><td>"+a.font.italic+"</td></tr><tr><td>\u2318 + U</td><td>"+a.font.underline+"</td></tr><tr><td>\u2318 + \u21e7 + S</td><td>"+a.font.strikethrough+"</td></tr><tr><td>\u2318 + \\</td><td>"+a.font.clear+"</td></tr>");c=c+d+"</td></tr><tr><td>";d=l(a.shortcut.documentStyle,"<tr><td>\u2318 + NUM0</td><td>"+a.style.normal+"</td></tr><tr><td>\u2318 + NUM1</td><td>"+a.style.h1+"</td></tr><tr><td>\u2318 + NUM2</td><td>"+a.style.h2+"</td></tr><tr><td>\u2318 + NUM3</td><td>"+
a.style.h3+"</td></tr><tr><td>\u2318 + NUM4</td><td>"+a.style.h4+"</td></tr><tr><td>\u2318 + NUM5</td><td>"+a.style.h5+"</td></tr><tr><td>\u2318 + NUM6</td><td>"+a.style.h6+"</td></tr>");c=c+d+"</td><td>";d=l(a.shortcut.paragraphFormatting,"<tr><td>\u2318 + \u21e7 + L</td><td>"+a.paragraph.left+"</td></tr><tr><td>\u2318 + \u21e7 + E</td><td>"+a.paragraph.center+"</td></tr><tr><td>\u2318 + \u21e7 + R</td><td>"+a.paragraph.right+"</td></tr><tr><td>\u2318 + \u21e7 + J</td><td>"+a.paragraph.justify+"</td></tr><tr><td>\u2318 + \u21e7 + NUM7</td><td>"+
a.lists.ordered+"</td></tr><tr><td>\u2318 + \u21e7 + NUM8</td><td>"+a.lists.unordered+"</td></tr>");c=c+d+"</td></tr>";if(b.extraKeys){var e;d=b.extraKeys;var f="";for(e in d)d.hasOwnProperty(e)&&(f+="<tr><td>"+e+"</td><td>"+d[e]+"</td></tr>");e=l(a.shortcut.extraKeys,f);c+='<tr><td colspan="2">'+e+"</td></tr>"}return c+"</tbody></table>"},o=function(a,b){var c='<div class="note-dialog">'+e("note-image-dialog",a.image.insert,'<div class="note-group-select-from-files"><h5>'+a.image.selectFromFiles+
'</h5><input class="note-image-input" type="file" name="files" accept="image/*" /></div><h5>'+a.image.url+'</h5><input class="note-image-url form-control span12" type="text" />','<button href="#" class="btn btn-primary note-image-btn disabled" disabled>'+a.image.insert+"</button>"),d;d=e("note-link-dialog",a.link.insert,'<div class="form-group"><label>'+a.link.textToDisplay+'</label><input class="note-link-text form-control span12" type="text" /></div><div class="form-group"><label>'+a.link.url+'</label><input class="note-link-url form-control span12" type="text" /></div>'+
(b.disableLinkTarget?"":'<div class="checkbox"><label><input type="checkbox" checked> '+a.link.openInNewWindow+"</label></div>"),'<button href="#" class="btn btn-primary note-link-btn disabled" disabled>'+a.link.insert+"</button>");c+=d;d=e("note-video-dialog",a.video.insert,'<div class="form-group"><label>'+a.video.url+'</label>&nbsp;<small class="text-muted">'+a.video.providers+'</small><input class="note-video-url form-control span12" type="text" /></div>','<button href="#" class="btn btn-primary note-video-btn disabled" disabled>'+
a.video.insert+"</button>");c+=d;d='<a class="modal-close pull-right" aria-hidden="true" tabindex="-1">'+a.shortcut.close+'</a><div class="title">'+a.shortcut.shortcuts+"</div>";var f;f=h.isMac?n(a,b):n(a,b).replace(/\u2318/g,"Ctrl").replace(/\u21e7/g,"Shift");d=e("note-help-dialog","",d+f+'<p class="text-center"><a href="//hackerwins.github.io/summernote/" target="_blank">Summernote 0.5.10</a> \u00b7 <a href="//github.com/HackerWins/summernote" target="_blank">Project</a> \u00b7 <a href="//github.com/HackerWins/summernote/issues" target="_blank">Issues</a></p>',
"");return c+d+"</div>"},r=function(a,b,c){var e=m.invertObject(b);a.find("button").each(function(a,b){var c=d(b),f=e[c.data("event")];f&&c.attr("title",function(a,b){var c=b+" (",d,e=f;d=(h.isMac&&(e=e.replace("CMD","\u2318").replace("SHIFT","\u21e7")),e.replace("BACKSLASH","\\").replace("SLASH","/").replace("LEFTBRACKET","[").replace("RIGHTBRACKET","]"));return c+d+")"})}).tooltip({container:"body",trigger:"hover",placement:c||"top"}).on("click",function(){d(this).tooltip("hide")})},q=function(a,
b){var c=b.colors;a.find(".note-color-palette").each(function(){for(var a=d(this),b=a.attr("data-target-event"),e=[],f=0,g=c.length;g>f;f++){for(var h=c[f],i=[],k=0,j=h.length;j>k;k++){var E=h[k];i.push(['<button type="button" class="note-color-btn" style="background-color:',E,';" data-event="',b,'" data-value="',E,'" title="',E,'" data-toggle="button" tabindex="-1"></button>'].join(""))}e.push('<div class="note-color-row">'+i.join("")+"</div>")}a.html(e.join(""))})};this.createLayoutByAirMode=function(a,
b){var c=b.keyMap[h.isMac?"mac":"pc"],e=d.extend(d.summernote.lang["en-US"],d.summernote.lang[b.lang]),f=m.uniqueId();a.addClass("note-air-editor note-editable");a.attr({id:"note-editor-"+f,contentEditable:!0});var i=document.body,k=d(g(e,b));k.addClass("note-air-layout");k.attr("id","note-popover-"+f);k.appendTo(i);r(k,c);q(k,b);c=d(j());c.addClass("note-air-layout");c.attr("id","note-handle-"+f);c.appendTo(i);e=d(o(e,b));e.addClass("note-air-layout");e.attr("id","note-dialog-"+f);e.find("button.close, a.modal-close").click(function(){d(this).closest(".modal").modal("hide")});
e.appendTo(i)};this.createLayoutByFrame=function(a,b){var c=d('<div class="note-editor"></div>');b.width&&c.width(b.width);0<b.height&&d('<div class="note-statusbar">'+(b.disableResizeEditor?"":'<div class="note-resizebar"><div class="note-icon-bar"></div><div class="note-icon-bar"></div><div class="note-icon-bar"></div></div>')+"</div>").prependTo(c);var e=!a.is(":disabled"),e=d('<div class="note-editable" contentEditable="'+e+'"></div>').prependTo(c);b.height&&e.height(b.height);b.direction&&e.attr("dir",
b.direction);e.html(f.html(a)||f.emptyPara);d('<textarea class="note-codable"></textarea>').prependTo(c);for(var e=d.extend(d.summernote.lang["en-US"],d.summernote.lang[b.lang]),l="",m=0,n=b.toolbar.length;n>m;m++){for(var t=b.toolbar[m][1],l=l+('<div class="note-'+b.toolbar[m][0]+' btn-group">'),z=0,Z=t.length;Z>z;z++)d.isFunction(i[t[z]])&&(l+=i[t[z]](e,b));l+="</div>"}m=d('<div class="note-toolbar btn-toolbar">'+l+"</div>").prependTo(c);l=b.keyMap[h.isMac?"mac":"pc"];q(m,b);r(m,l,"bottom");m=d(g(e,
b)).prependTo(c);q(m,b);r(m,l);d(j()).prependTo(c);d(o(e,b)).prependTo(c).find("button.close, a.modal-close").click(function(){d(this).closest(".modal").modal("hide")});d('<div class="note-dropzone"><div class="note-dropzone-message"></div></div>').prependTo(c);c.insertAfter(a);a.hide()};this.noteEditorFromHolder=function(a){return a.hasClass("note-air-editor")?a:a.next().hasClass("note-editor")?a.next():d()};this.createLayout=function(a,b){this.noteEditorFromHolder(a).length||(b.airMode?this.createLayoutByAirMode(a,
b):this.createLayoutByFrame(a,b))};this.layoutInfoFromHolder=function(a){a=this.noteEditorFromHolder(a);if(a.length){var a=f.buildLayoutInfo(a),b;for(b in a)a.hasOwnProperty(b)&&(a[b]=a[b].call());return a}};this.removeLayout=function(a,b,c){c.airMode?(a.removeClass("note-air-editor note-editable").removeAttr("id contentEditable"),b.popover.remove(),b.handle.remove(),b.dialog.remove()):(a.html(b.editable.html()),b.editor.remove(),a.show())}},na=new function(){var a=d(window),b=d(document),c=d("html, body"),
e=new ta,k=new va,g=new wa,j=new xa,l=new ya,m=function(a){a=d(a).closest(".note-editor, .note-air-editor, .note-air-layout");if(!a.length)return null;var b;return b=a.is(".note-editor, .note-air-editor")?a:d("#note-editor-"+i.last(a.attr("id").split("-"))),f.buildLayoutInfo(b)},n=function(a,b){var c=a.data("callbacks");c.onImageUpload?c.onImageUpload(b,e,a):d.each(b,function(b,d){var f=d.name;X.readFileAsDataURL(d).then(function(b){e.insertImage(a,b,f)}).fail(function(){c.onImageUploadError&&c.onImageUploadError()})})},
o={showLinkDialog:function(a){var b=a.editor(),c=a.dialog(),d=a.editable(),f=e.getLinkInfo(d),h=b.data("options");e.saveRange(d);l.showLinkDialog(d,c,f).then(function(b){e.restoreRange(d);e.createLink(d,b,h);g.hide(a.popover())}).fail(function(){e.restoreRange(d)})},showImageDialog:function(a){var b=a.dialog(),c=a.editable();e.saveRange(c);l.showImageDialog(c,b).then(function(a){e.restoreRange(c);"string"==typeof a?e.insertImage(c,a):n(c,a)}).fail(function(){e.restoreRange(c)})},showVideoDialog:function(a){var b=
a.dialog(),c=a.editable(),a=e.getVideoInfo(c);e.saveRange(c);l.showVideoDialog(c,b,a).then(function(a){e.restoreRange(c);e.insertVideo(c,a)}).fail(function(){e.restoreRange(c)})},showHelpDialog:function(a){var b=a.dialog(),c=a.editable();e.saveRange(c,!0);l.showHelpDialog(c,b).then(function(){e.restoreRange(c)})},fullscreen:function(b){var d=b.editor(),e=b.toolbar(),f=b.editable(),g=b.codable(),b=d.data("options"),h=function(a){d.css("width",a.w);f.css("height",a.h);g.css("height",a.h);g.data("cmeditor")&&
g.data("cmeditor").setsize(null,a.h)};d.toggleClass("fullscreen");var i=d.hasClass("fullscreen");i?(f.data("orgheight",f.css("height")),a.on("resize",function(){h({w:a.width(),h:a.height()-e.outerHeight()})}).trigger("resize"),c.css("overflow","hidden")):(a.off("resize"),h({w:b.width||"",h:f.data("orgheight")}),c.css("overflow","visible"));k.updateFullscreen(e,i)},codeview:function(a){var b,c,d=a.editor(),e=a.toolbar(),i=a.editable(),j=a.codable(),m=a.popover(),l=d.data("options");d.toggleClass("codeview");
(d=d.hasClass("codeview"))?(j.val(f.html(i,!0)),j.height(i.height()),k.deactivate(e),g.hide(m),j.focus(),h.hasCodeMirror&&(b=r.fromTextArea(j[0],l.codemirror),l.codemirror.tern&&(c=new r.TernServer(l.codemirror.tern),b.ternServer=c,b.on("cursorActivity",function(a){c.updateArgHints(a)})),b.setSize(null,i.outerHeight()),j.data("cmEditor",b))):(h.hasCodeMirror&&(b=j.data("cmEditor"),j.val(b.getValue()),b.toTextArea()),i.html(f.value(j)||f.emptyPara),i.height(l.height?j.height():"auto"),k.activate(e),
i.focus());k.updateCodeview(a.toolbar(),d)}},q=function(a){f.isImg(a.target)&&a.preventDefault()},s=function(a){setTimeout(function(){var b=m(a.currentTarget||a.target),c=e.currentStyle(a.target);if(c){var d=b.editor().data("options").airMode;d||k.update(b.toolbar(),c);g.update(b.popover(),c,d);j.update(b.handle(),c,d)}},0)},u=function(a){a=m(a.currentTarget||a.target);g.hide(a.popover());j.hide(a.handle())},v=function(a){var b=a.originalEvent.clipboardData;b&&(b.items&&b.items.length)&&(a=m(a.currentTarget||
a.target).editable(),b=i.head(b.items),"file"===b.kind&&-1!==b.type.indexOf("image/")&&n(a,[b.getAsFile()]),e.afterCommand(a))},y=function(a){if(f.isControlSizing(a.target)){a.preventDefault();a.stopPropagation();var c=m(a.target),h=c.handle(),i=c.popover(),a=c.editable(),c=c.editor(),k=h.find(".note-control-selection").data("target"),l=d(k),O=l.offset(),n=b.scrollTop(),o=c.data("options").airMode;b.on("mousemove",function(a){e.resizeTo({x:a.clientX-O.left,y:a.clientY-(O.top-n)},l,!a.shiftKey);j.update(h,
{image:k},o);g.update(i,{image:k},o)}).one("mouseup",function(){b.off("mousemove")});l.data("ratio")||l.data("ratio",l.height()/l.width());e.afterCommand(a)}},w=function(a){d(a.target).closest("[data-event]").length&&a.preventDefault()},x=function(a){var b=d(a.target).closest("[data-event]");if(b.length){var c=b.attr("data-event"),f=b.attr("data-value"),h=b.attr("data-hide"),j=m(a.target);a.preventDefault();var l;-1!==d.inArray(c,["resize","floatMe","removeMedia","imageShape"])&&(l=j.handle().find(".note-control-selection"),
l=d(l.data("target")));(h&&b.parents(".popover").hide(),e[c])?(h=j.editable(),h.trigger("focus"),e[c](h,f,l)):o[c]&&o[c].call(this,j);if(-1!==d.inArray(c,["backColor","foreColor"])){var n=j.editor().data("options",n);(n.airMode?g:k).updateRecentColor(i.head(b),c,f)}s(a)}},A=function(a){a.preventDefault();a.stopPropagation();var c=m(a.target).editable(),d=c.offset().top-b.scrollTop(),e=m(a.currentTarget||a.target).editor().data("options");b.on("mousemove",function(a){a=a.clientY-(d+24);a=0<e.minHeight?
Math.max(a,e.minHeight):a;a=0<e.maxHeight?Math.min(a,e.maxHeight):a;c.height(a)}).one("mouseup",function(){b.off("mousemove")})};this.bindKeyMap=function(a,b){var c=a.editor,d=a.editable,a=m(d);d.on("keydown",function(f){var g=[];f.metaKey&&g.push("CMD");f.ctrlKey&&!f.altKey&&g.push("CTRL");f.shiftKey&&g.push("SHIFT");var h=Y.nameFromCode[f.keyCode];h&&g.push(h);(g=b[g.join("+")])?(f.preventDefault(),e[g]?e[g](d,c.data("options")):o[g]&&o[g].call(this,a)):Y.isEdit(f.keyCode)&&e.afterCommand(d)})};
this.attach=function(a,c){this.bindKeyMap(a,c.keyMap[h.isMac?"mac":"pc"]);a.editable.on("mousedown",q);a.editable.on("keyup mouseup",s);a.editable.on("scroll",u);a.editable.on("paste",v);a.handle.on("mousedown",y);a.popover.on("click",x);a.popover.on("mousedown",w);if(!c.airMode){if(c.disableDragAndDrop)b.on("drop",function(a){a.preventDefault()});else{var f=d(),g=a.dropzone,i=a.dropzone.find(".note-dropzone-message");b.on("dragenter",function(b){a.editor.hasClass("codeview")||f.length||(a.editor.addClass("dragover"),
g.width(a.editor.width()),g.height(a.editor.height()),i.text("Drag Image Here"));f=f.add(b.target)}).on("dragleave",function(b){f=f.not(b.target);f.length||a.editor.removeClass("dragover")}).on("drop",function(){f=d();a.editor.removeClass("dragover")});g.on("dragenter",function(){g.addClass("hover");i.text("Drop Image")}).on("dragleave",function(){g.removeClass("hover");i.text("Drag Image Here")});g.on("drop",function(a){a.preventDefault();var b=a.originalEvent.dataTransfer;b&&b.files&&(a=m(a.currentTarget||
a.target),a.editable().focus(),n(a.editable(),b.files))}).on("dragover",!1)}a.toolbar.on("click",x);a.toolbar.on("mousedown",w);c.disableResizeEditor||a.statusbar.on("mousedown",A)}(c.airMode?a.popover:a.toolbar).find(".note-dimension-picker-mousecatcher").css({width:c.insertTableMaxSize.col+"em",height:c.insertTableMaxSize.row+"em"}).on("mousemove",function(a){var b,e=d(a.target.parentNode),f=e.next(),g=e.find(".note-dimension-picker-mousecatcher"),h=e.find(".note-dimension-picker-highlighted"),
e=e.find(".note-dimension-picker-unhighlighted");if(void 0===a.offsetX){var i=d(a.target).offset();b=a.pageX-i.left;a=a.pageY-i.top}else b=a.offsetX,a=a.offsetY;b=Math.ceil(b/18)||1;a=Math.ceil(a/18)||1;h.css({width:b+"em",height:a+"em"});g.attr("data-value",b+"x"+a);3<b&&b<c.insertTableMaxSize.col&&e.css({width:b+1+"em"});3<a&&a<c.insertTableMaxSize.row&&e.css({height:a+1+"em"});f.html(b+" x "+a)});a.editor.data("options",c);c.styleWithSpan&&!h.isMSIE&&setTimeout(function(){document.execCommand("styleWithCSS",
0,!0)},0);var j=new ua(a.editable);if(a.editable.data("NoteHistory",j),c.onenter&&a.editable.keypress(function(a){a.keyCode===Y.ENTER&&c.onenter(a)}),c.onfocus&&a.editable.focus(c.onfocus),c.onblur&&a.editable.blur(c.onblur),c.onkeyup&&a.editable.keyup(c.onkeyup),c.onkeydown&&a.editable.keydown(c.onkeydown),c.onpaste&&a.editable.on("paste",c.onpaste),c.onToolbarClick&&a.toolbar.click(c.onToolbarClick),c.onChange)if(j=function(){e.triggerOnChange(a.editable)},h.isMSIE)a.editable.on("DOMCharacterDataModified DOMSubtreeModified DOMNodeInserted",
j);else a.editable.on("input",j);a.editable.data("callbacks",{onChange:c.onChange,onAutoSave:c.onAutoSave,onImageUpload:c.onImageUpload,onImageUploadError:c.onImageUploadError,onFileUpload:c.onFileUpload,onFileUploadError:c.onFileUpload})};this.dettach=function(a,b){a.editable.off();a.popover.off();a.handle.off();a.dialog.off();b.airMode||(a.dropzone.off(),a.toolbar.off(),a.statusbar.off())}};d.fn.extend({summernote:function(a){(a=d.extend({},d.summernote.options,a),this.each(function(b,c){var e=
d(c);y.createLayout(e,a);var h=y.layoutInfoFromHolder(e);na.attach(h,a);f.isTextarea(e[0])&&e.closest("form").submit(function(){e.val(e.code())})}),this.first().length&&a.focus)&&y.layoutInfoFromHolder(this.first()).editable.focus();return this.length&&a.oninit&&a.oninit(),this},code:function(a){if(void 0===a){var b=this.first();if(!b.length)return;var c=y.layoutInfoFromHolder(b);return c&&c.editable?(b=c.editor.hasClass("codeview"),b&&h.hasCodeMirror&&c.codable.data("cmEditor").save(),b?c.codable.val():
c.editable.html()):f.isTextarea(b[0])?b.val():b.html()}return this.each(function(b,c){var f=y.layoutInfoFromHolder(d(c));f&&f.editable&&f.editable.html(a)}),this},destroy:function(){return this.each(function(a,b){var c=d(b),e=y.layoutInfoFromHolder(c);if(e&&e.editable){var f=e.editor.data("options");na.dettach(e,f);y.removeLayout(c,e,f)}}),this}})});