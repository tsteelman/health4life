/*
 MIT License - http://www.opensource.org/licenses/mit-license.php

 For usage and examples, visit:
 http://timeago.yarp.com/

 Copyright (c) 2008-2013, Ryan McGeary (ryan -[at]- mcgeary [*dot*] org)
*/
(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){function b(){var b;b=a(this);b.data("timeago")||(b.data("timeago",{datetime:d.datetime(b)}),a.trim(b.text()));b=b.data("timeago");var e=d.settings;isNaN(b.datetime)||(0==e.cutoff||($appDateTime?$appDateTime:new Date).getTime()-b.datetime.getTime()<e.cutoff)&&a(this).text(c(b.datetime));return this}function c(a){return d.inWords(($appDateTime?$appDateTime:new Date).getTime()-a.getTime())}a.timeago=function(b){return b instanceof
Date?c(b):"string"===typeof b?c(a.timeago.parse(b)):"number"===typeof b?c(new Date(b)):c(a.timeago.datetime(b))};var d=a.timeago;a.extend(a.timeago,{settings:{refreshMillis:6E4,allowFuture:!1,localeTitle:!1,cutoff:6048E5,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",second:"just now",seconds:"%d seconds",minute:"%d minute",minutes:"%d minutes",hour:"%d hour",hours:"%d hours",day:"%d day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",
years:"%d years",wordSeparator:" ",numbers:[]}},inWords:function(b){function c(e,g){return(a.isFunction(e)?e(g,b):e).replace(/%d/i,d.numbers&&d.numbers[g]||g)}var d=this.settings.strings,e=d.prefixAgo,j=d.suffixAgo;this.settings.allowFuture&&0>b&&(e=d.prefixFromNow,j=d.suffixFromNow);$diff=Math.abs(b)/1E3;$years=$months=$weeks=0;$days=Math.floor($diff/86400);$diff-=86400*$days;$hours=Math.floor($diff/3600);$diff-=3600*$hours;$minutes=Math.floor($diff/60);$diff-=60*$minutes;$seconds=Math.round($diff);
$accuracy=[];$accuracy.year="day";$accuracy.month="day";$accuracy.week="day";$accuracy.day="day";$accuracy.hour="minute";$accuracy.minute="minute";$accuracy.second="second";$fWord=$accuracy.second;0<$years?$fWord=$accuracy.year:0<Math.abs($months)?$fWord=$accuracy.month:0<Math.abs($weeks)?$fWord=$accuracy.week:0<Math.abs($days)?$fWord=$accuracy.day:0<Math.abs($hours)?$fWord=$accuracy.hour:0<Math.abs($minutes)&&($fWord=$accuracy.minute);$fNum=function(a,b,c,d){var f=0,e=0,g="",h="",j=0,l=0,a=[].concat(a),
b=[].concat(b),k=Object.prototype.toString.call(b)==="[object Array]",m=Object.prototype.toString.call(c)==="[object Array]",c=[].concat(c);d&&(this.window[d]=0);f=0;for(j=c.length;f<j;f++)if(c[f]!==""){e=0;for(l=a.length;e<l;e++){g=c[f]+"";h=k?b[e]!==void 0?b[e]:"":b[0];c[f]=g.split(a[e]).join(h);d&&c[f]!==g&&(this.window[d]=this.window[d]+(g.length-c[f].length)/a[e].length)}}return m?c:c[0]}("year month week day hour minute second".split(" "),[1,2,3,4,5,6,7],$fWord);relativeDate="";4<=$fNum&&0<
$days&&(words=1===$days?c(d.day,1):c(d.days,$days),relativeDate+=(relativeDate?", ":"")+words);5<=$fNum&&0<$hours&&(words=1===$hours?c(d.hour,1):c(d.hours,$hours),relativeDate+=(relativeDate?", ":"")+words);6<=$fNum&&0<$minutes&&(words=1===$minutes?c(d.minute,1):c(d.minutes,$minutes),relativeDate+=(relativeDate?", ":"")+words);7<=$fNum&&0<$seconds&&(1===$seconds?(words=c(d.second,1),j=null):words=c(d.seconds,$seconds),relativeDate+=(relativeDate?", ":"")+words);var k=d.wordSeparator||"";void 0===
d.wordSeparator&&(k=" ");return a.trim([e,relativeDate,j].join(k))},parse:function(b){b=a.trim(b);b=b.replace(/\.\d+/,"");b=b.replace(/-/,"/").replace(/-/,"/");b=b.replace(/T/," ").replace(/Z/," UTC");b=b.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2");return new Date(b)},datetime:function(b){b=a(b).attr("datetime")?a(b).attr("datetime"):a(b).attr("title");return d.parse(b)},isTime:function(b){return"time"===a(b).get(0).tagName.toLowerCase()}});var e={init:function(){var c=a.proxy(b,this);c();var e=d.settings;
0<e.refreshMillis&&setInterval(c,e.refreshMillis)},update:function(c){a(this).data("timeago",{datetime:d.parse(c)});b.apply(this)},updateFromDOM:function(){a(this).data("timeago",{datetime:d.parse(a(this).attr("datetime")?a(this).attr("datetime"):a(this).attr("title"))});b.apply(this)}};a.fn.timeago=function(a,b){var c=a?e[a]:e.init;if(!c)throw Error("Unknown function name '"+a+"' for timeago");this.each(function(){c.call(this,b)});return this};document.createElement("abbr");document.createElement("time")});
(function(a){inputCount=3;var b=function(b,d){a(b);var e=this;a.extend({param:"defaultValue"},d||{});this.init=function(b){"object"===typeof b&&(this.pollFormId=b.pollFormId,this.pollHolder=b.pollHolder,this.pollOptHolder=b.pollOptHolder,this.pollOptClass=b.pollOptClass,this.pollOptLimit=b.pollOptLimit,this.pollOptLimitCurrent=3);b=this.pollOptHolder+" "+this.pollOptClass+':last input[type="text"]';a(document).on("focus",b,function(){if(inputCount<e.pollOptLimit){a(Poll.pollOptHolder+" "+Poll.pollOptClass).last().clone(true,
true).appendTo(Poll.pollOptHolder);a(this).attr("placeholder","Option");a(this).attr("name","data[Post][poll_options][]");inputCount=inputCount+1}else a(this).attr("placeholder","Option")})};this.publicMethod=function(){}};a.fn.mypoll=function(c){return this.each(function(){a(this);return(new b(this,c)).init(c)})}})(jQuery);var Poll={pollFormId:"#frm_group_poll",pollHolder:"#ask_section",pollOptHolder:"#option_area",pollOptClass:".poll_inputarea",pollOptLimit:10};
$(document).on("click",".vote_for_poll",function(){var a=this,b=$(a).closest(".posting_area").find("#poll_id_hidden").val(),c=$(a).closest(".posting_area").find("input[name=optionsRadios]:checked").attr("id"),d=$(".btn_leave"),e=Ladda.create(a);e.start();$.ajax({type:"POST",url:"/post/api/updatePollVote/poll_id:"+b+"/option_id:"+c,dataType:"json",beforeSend:function(){$(a).attr("disabled","disabled");d.attr("disabled","disabled")},success:function(c){$(a).removeAttr("disabled");d.removeAttr("disabled");
e.stop();!0===c.success?($(a).attr("disabled","disabled"),$(a).closest(".posting_area").replaceWith(c.content),socket.emit("poll_update",{room:$("#PostPostedInRoom").val(),attendedUsers:c.attendedUsers,content:c.content,pollId:b}),setTimeout(function(){applyTimeAgo()},6E4),$("#post_container").hasClass("hide")&&($(".alert").hide(),$("#post_container").removeClass("hide"))):!0===c.error&&bootbox.alert(c.message,function(){window.location.reload();window.scrollTo(0,0)})}})});
$(document).on("keyup","#PollForm_title, .poll_input",function(){isPollDataPresent=!1;var a=""!==$.trim($(".poll_input").first().val())?!0:!1;isPollDataPresent=""!==$.trim($("#PollForm_title").val())&&a?!0:!1;changeShareBtnStatus()});
function resetPollForm(){var a=$("#option_area div.poll_inputarea").length;$("#PollForm_title").val("");$(".poll_input").val("");3<a&&$("#option_area").find("div").slice(-(a-1),-2).remove();$("#option_area div:last-child").children("input").attr("placeholder","add an option");inputCount=3;isPollDataPresent=!1}function showPollErrorMessage(a){alert(a.error_message);$("#PollFormErrorMessage").text(a.error_message).show()}
function validatePollForm(){var a=[],b=!1,c=0,d=" ";$("div#posting_errors").html("").hide();""!=$.trim($("#PollForm_title").val())&&null!=$.trim($("#PollForm_title").val())?($(".poll_input").each(function(){null!=$.trim($(this).val())&&""!=$.trim($(this).val())&&(c=$.inArray($(this).val(),a),-1==c?a.push($(this).val()):(b=!0,d="Options have duplicate values."))}),!0!==b&&2>a.length&&(b=!0,d="Please enter minimum two options.")):(b=!0,d="Please enter poll title.");return!0==b?($("div#posting_errors").html("<span>"+
d+"</span>").show(),!1):!0}$(document).on("click",".poll_options_radios",function(){$(this).closest(".posting_area").find(".vote_for_poll").removeAttr("disabled")});
$(document).on("click",".poll_popup_area",function(){var a=this,b=$(a).closest(".posting_area").find("#poll_id_hidden").val();$(".poll_result_modal").remove();$.ajax({type:"POST",url:"/post/api/getPollDetails/poll_id:"+b,dataType:"json",beforeSend:function(){$(a).removeClass("poll_popup_area")},success:function(b){$(a).addClass("poll_popup_area");$("#post_list").prepend(b.content);$("#pollPopupModal").modal("show")}})});var postPhotoUploader=null,totalSelectedPhotos=0,totalPhotos=0;$(document).ready(function(){initPostPhotoUploader()});
function initPostPhotoUploader(){function a(a){e.html("<span class='help-block'>"+a+"</span>");e.show()}var b=$("#no_post_photos"),c=$("#post_photos_uploader"),d=$("#post_photos_preview"),e=$("#posting_errors"),f=$("#m_u_p_t .photo_holder");postPhotoUploader=new qq.FineUploaderBasic({itemLimit:5,button:c[0],debug:!1,multiple:!0,request:{endpoint:"/post/api/previewPhoto"},validation:{acceptFiles:"image/*",allowedExtensions:["jpeg","jpg","gif","png","bmp"],minSizeLimit:"1024",sizeLimit:"5242880"},callbacks:{onError:function(b,
c,d){a(d);totalSelectedPhotos--},onSubmit:function(a){totalSelectedPhotos++;b.removeClass("hide").hide();$clone_elem=f.clone();$clone_elem.attr("id","photofile-"+a);d.append($clone_elem);d.removeClass("hide").show()},onUpload:function(a){$("#photofile-"+a).find(".m_u_p_bar").show()},onProgress:function(a,b,c,d){c<d&&(b=Math.round(100*(c/d))+"%",$("#photofile-"+a).find(".m_u_p_bar").css("width",b));isPhotoPresent=!1;changeShareBtnStatus()},onComplete:function(c,f,h){cloneElemId="#photofile-"+c;h.success?
(b.hide(),$(cloneElemId).find(".m_u_p_bar").css("width","100%"),e.html("").hide(),$(cloneElemId).html(h.filehtml),$(cloneElemId).removeClass("post_tmp_photo"),d.removeClass("hide"),totalPhotos++,isPhotoPresent=!0,changeShareBtnStatus()):($(cloneElemId).remove(),h.error?a("Error with \u201c"+f+"\u201d: "+h.error):a("Failed to upload photo."),0<=parseInt(totalPhotos)&&(isPhotoPresent=!0,changeShareBtnStatus()))}}});$(document).on("click","#posting_image_form .remove_photo",function(){$(this).closest(".photo_holder").remove();
totalPhotos--;0>=parseInt(totalPhotos)&&resetPostPhotoForm()});$(document).on("mouseover","#post_photos_preview .photo_holder",function(){$(this).find(".m_u_p_bar").is(":visible")||$(this).find(".remove_photo").removeClass("hide")});$(document).on("mouseout","#post_photos_preview .photo_holder",function(){$(this).find(".remove_photo").addClass("hide")})}
function resetPostPhotoForm(){$("#post_photos_preview").addClass("hide");$("#post_photos_preview").html("");$("#posting_errors").html("");totalSelectedPhotos=totalPhotos=0;$("#no_post_photos").show();postPhotoUploader.cancelAll();isPhotoPresent=!1;changeShareBtnStatus()}$(document).ready(function(){initPostVideoUploader()});
function initPostVideoUploader(){function a(a){d.html('<span class="help-block">'+a+"</span>");d.show()}var b=$("#post_video_uploader"),c=$("#post_video_preview"),d=$("#video_posting_error"),e=c.find("#video_preview"),f=e.find(".m_u_p_bar"),g=c.find("#no_videos");new qq.FineUploaderBasic({button:b[0],debug:!1,multiple:!1,request:{endpoint:"/post/api/uploadVideos"},validation:{allowedExtensions:"avi mp4 3gp mpeg mov flv wmv mpg".split(" "),minSizeLimit:"1024",sizeLimit:"100000000"},callbacks:{onError:function(b,
c,d){a(d)},onSubmit:function(){g.hide();$("#video_form_bottom").addClass("hide");$("#post_video_preview").addClass("no_border");e.removeClass("hide")},onUpload:function(){f.show()},onComplete:function(b,c,e){e.success?($(".preview_video_name_container").removeClass("hide"),$("#preview_video_name").html(c).removeClass("hide"),isVideoPresent=!0,f.hide(),$("#PostVideoFileName").val(e.fileName),d.html("").hide(),changeShareBtnStatus()):e.error?a("Error with \u201c"+c+"\u201d: "+e.error):a("Failed to upload video.")}}});
$(document).on("click","#closeVideoPreview",function(){resetPostVideoForm()});$(document).on("mouseover","#video_preview",function(){$(this).find(".m_u_p_bar").is(":visible")||$("#closeVideoPreview").removeClass("hide")});$(document).on("mouseout","#video_preview",function(){$("#closeVideoPreview").addClass("hide")})}
function resetPostVideoForm(){$("#video_preview").addClass("hide");$("#video_preview").find(".m_u_p_bar").hide();$(".preview_video_name_container").addClass("hide");$("#preview_video_name").html("").addClass("hide");$("#video_form_bottom").removeClass("hide");$("#post_video_preview").removeClass("no_border");$("#no_videos").show();$("#post_video_uploader").show();$("#PostVideoFileName").val("");isVideoPresent=!1;changeShareBtnStatus()}
var POST_TYPE_TEXT="text",POST_TYPE_LINK="link",POST_TYPE_VIDEO="video",POST_TYPE_IMAGE="image",POST_TYPE_POLL="poll",POST_TYPE_ECARD="ecard",POST_TYPE_BLOG="blog",isTextPresent=!1,isLinkDataPresent=!1,isPhotoPresent=!1,isVideoPresent=!1,isCrawling=!1,isEcard=!1,isBlog=!1,urlRegex=/(https?\:\/\/|\s)[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})(\/+[a-z0-9_.\:\;-]*)*(\?[\&\%\|\+a-z0-9_=,\.\:\;-]*)?([\&\%\|\+&a-z0-9_=,\:\;\.-]*)([\!\#\/\&\%\|\+a-z0-9_=,\:\;\.-]*)}*/i,previewImagesCount=0,currentPreviewImgPos=
1,nextImg=null,prevImg=null,isPollDataPresent=!1,defaultPlaceHolderText="Add more text",NEW_POST_COUNT=0,NEW_QUESTION_COUNT=0,NEW_POST_IDS=[],NEW_QUESTION_IDS=[];$(document).on("click",".start_discussion",function(){showPostingOption();$("#share_post_btn").attr("disabled","disabled")});$(document).on("click","#cancel_post_btn",function(){cancelPosting()});function cancelPosting(){$(".discussion_matter").hide();$(".start_discussion").show();resetForm()}
function showPostingOption(){$(".discussion_matter").show();$(".start_discussion").hide();$("#posting_text_form").show();$("#PostDescription").focus()}
$(document).on("click",".posting_items ul.post_options li",function(){$(".posting_options_form").hide();$(this).parent().find("li").removeClass("active");$(this).addClass("active");$("#"+$(this).data("elem")+"_form").show();var a=$(this).data("posttype");$("#PostPostType").val(a);$("#posting_more_action").show();"posting_text"==$(this).data("elem")?$("#PostDescription").addClass("post_no_border_bottom"):$("#PostDescription").removeClass("post_no_border_bottom");var b;switch(a){case POST_TYPE_TEXT:b=
defaultPlaceHolderText;break;case POST_TYPE_LINK:case POST_TYPE_VIDEO:case POST_TYPE_IMAGE:case POST_TYPE_POLL:b="Add a note";break;case POST_TYPE_ECARD:b="Type message here";break;case POST_TYPE_BLOG:b="Add title"}$("#PostDescription").attr("placeholder",b);$("div#posting_errors").html("").hide();$("div#video_posting_error").html("").hide();a===POST_TYPE_TEXT?handlePostTextChange():changeShareBtnStatus()});
function setPostFormRules(){""!==$.trim($("#PostLinkUrl").val())&&null!==$.trim($("#PostLinkUrl").val())?(0<$("#PostTitle").length&&$("#PostTitle").rules("remove","required"),$("#PostDescription").rules("remove","required")):""!==$.trim($("#PollForm_title").val())&&null!==$.trim($("#PollForm_title").val())?(0<$("#PostTitle").length&&$("#PostTitle").rules("remove","required"),$("#PostDescription").rules("remove","required")):$("#PostPostType").val()===POST_TYPE_IMAGE?(0<$("#PostTitle").length&&$("#PostTitle").rules("remove",
"required"),$("#PostDescription").rules("remove","required")):$("#PostPostType").val()===POST_TYPE_VIDEO?(0<$("#PostTitle").length&&$("#PostTitle").rules("remove","required"),$("#PostDescription").rules("remove","required")):(0<$("#PostTitle").length&&$("#PostTitle").rules("add",{required:!0}),$("#PostDescription").rules("add",{required:!0}))}function isPostFormValid(){setPostFormRules();return $("#postForm").valid()}
$(document).on("click","#PostIsAnonymous",function(){$(this).is(":checked")?($(".normal_post_thumb").addClass("hidden"),$(".anonymous_post_thumb").removeClass("hidden")):($(".normal_post_thumb").removeClass("hidden"),$(".anonymous_post_thumb").addClass("hidden"))});
$(document).on("click","#share_post_btn",function(){var a=this,b=$(".btn_leave");if(isPostFormValid()&&($("#PostPostType").val()!=POST_TYPE_POLL||validatePollForm())){var c=Ladda.create(a);c.start();$.ajax({type:"POST",url:"/post/api/createPost",data:$(form).serialize(),dataType:"json",beforeSend:function(){$(a).attr("disabled","disabled");b.attr("disabled","disabled")},success:function(d){cancelPosting();$(a).removeAttr("disabled");b.removeAttr("disabled");c.stop();!0===d.success?($(a).attr("disabled",
"disabled"),$("#PostPostType").val(POST_TYPE_TEXT),$("#new_posts_notification").is(":visible")?$("#new_posts_notification").click():$("#post_list").prepend(d.content),setTimeout(function(){applyTimeAgo()},6E4),$("#post_container").hasClass("hide")&&($("#no_posts_msg").addClass("hide"),$("#post_container").removeClass("hide")),emitEventToRooms("new_post",d)):!0===d.error&&bootbox.alert(d.message,function(){d.errorType&&"fatal"===d.errorType&&(window.location.reload(),window.scrollTo(0,0))})}})}});
function resetLinkForm(){clearPreview()}function resetForm(){$(form)[0].reset();resetPollForm();resetLinkForm();resetPostVideoForm();resetPostingOptions();resetPostPhotoForm();isTextPresent=!1;$("#PostDescription").attr("placeholder",defaultPlaceHolderText);$("#posting_errors").html("").hide();$("#video_posting_error").html("").hide();$(".normal_post_thumb").removeClass("hidden");$(".anonymous_post_thumb").addClass("hidden")}
function resetPostingOptions(){$(".posting_options_form").hide();$("ul.post_options").find("li").removeClass("active");$("ul.post_options").find("li.posting_post").addClass("active")}function applyTimeAgo(){$(".timeago").timeago()}function paginatePostData(){$.autopager&&$.autopager({link:"span.next a",content:".posting_area",appendTo:"#post_list",start:function(){$("#post_loading").removeClass("hide")},load:function(){$("#post_loading").addClass("hide");applyTimeAgo()}})}
$(document).ready(function(){applyTimeAgo();paginatePostData()});$(document).on("keyup","#PostTitle, #PostDescription",function(){handlePostTextChange()});$(document).on("drop","#PostTitle, #PostDescription",function(){setTimeout(function(){handlePostTextChange()},100)});$(document).on("paste","#PostTitle, #PostDescription",function(){setTimeout(function(){handlePostTextChange()},100)});
function handlePostTextChange(){0<$("#PostTitle").length&&$("#PostTitle").rules("remove","required");0<$("#PostDescription").length&&$("#PostDescription").rules("remove","required");var a=""!==$.trim($("#PostDescription").val())?!0:!1;isTextPresent=$("#PostTitle").is(":visible")?""!==$.trim($("#PostTitle").val())&&a?!0:!1:a;changeShareBtnStatus()}
function changeShareBtnStatus(){var a=!1;switch($("#PostPostType").val()){case POST_TYPE_TEXT:a=isTextPresent;break;case POST_TYPE_LINK:a=isLinkDataPresent;break;case POST_TYPE_VIDEO:a=isVideoPresent;break;case POST_TYPE_IMAGE:a=isPhotoPresent;break;case POST_TYPE_POLL:a=isPollDataPresent;break;case POST_TYPE_ECARD:a=isEcard}!0===a?$("#share_post_btn").removeAttr("disabled"):$("#share_post_btn").attr("disabled","disabled")}
$(document).on("click",".like_btn",function(){var a=this;if(!$(this).attr("disabled")){var b=$(this).data("post_id");$.ajax({type:"POST",url:"/post/api/likePost",data:{postId:b},dataType:"json",beforeSend:function(){$(a).attr("disabled","disabled")},success:function(c){$(a).removeAttr("disabled");if(!0===c.success){$(a).removeClass("like_btn").addClass("unlike_btn");$(a).html("Unlike");var d=$("#liked_users_list_"+b);0<c.likeCount?(d.removeClass("hide"),d.find("span").html(c.content)):d.addClass("hide");
emitEventToRooms("new_like",{likeBtn:this,postId:b,likeCount:c.likeCount,username:app.loggedInUserName,postInfo:c.postInfo,lastLikedUsers:c.lastLikedUsers})}else!0===c.error&&bootbox.alert(c.message,function(){$("#post_"+b).remove();hidePostListingIfNoPosts()})}})}});
$(document).on("click",".unlike_btn",function(){var a=this;if(!$(this).attr("disabled")){var b=$(this).data("post_id");$.ajax({type:"POST",url:"/post/api/unlikePost",data:{postId:b},dataType:"json",beforeSend:function(){$(a).attr("disabled","disabled")},success:function(c){$(a).removeAttr("disabled");if(!0===c.success){$(a).removeClass("unlike_btn").addClass("like_btn");$(a).html("Like");var d=$("#liked_users_list_"+b);0<c.likeCount?(d.removeClass("hide"),d.find("span").html(c.content)):d.addClass("hide");
emitEventToRooms("new_unlike",{likeBtn:this,postId:b,likeCount:c.likeCount,username:app.loggedInUserName,lastLikedUsers:c.lastLikedUsers,postInfo:c.postInfo})}else!0===c.error&&bootbox.alert(c.message,function(){$("#post_"+b).remove();hidePostListingIfNoPosts()})}})}});
$(document).on("click",".view_likes",function(){var a=$(this).data("post_id");loadingDialog=bootbox.dialog({className:"likes_modal",message:$("#loading_dialog").html(),title:"People Who Like This"});$.ajax({type:"POST",url:"/post/api/listLikes",data:{postId:a},dataType:"json",success:function(a){bootbox.dialog({className:"likes_modal",message:a.message,title:"People Who Like This"});loadingDialog.modal("hide")}})});
$(document).on("click",'.comment_form input[type="checkbox"]',function(){var a=$(this).closest(".post_comment_section_form");$(this).is(":checked")?(a.find(".normal_thumb").addClass("hidden"),a.find(".anonymous_thumb").removeClass("hidden")):(a.find(".normal_thumb").removeClass("hidden"),a.find(".anonymous_thumb").addClass("hidden"))});
$(document).on("keyup",'.comment_form textarea, .comment_anonymous_box input[type="checkbox"]',function(a){var b=null;if(!1===$(this).prop("disabled")&&null===b&&13===a.keyCode&&!1===a.shiftKey){var c=$(this).closest("form.comment_form");isCommentFormValid(c)&&(a=c.serialize(),c.find("textarea").prop("disabled",!0),c.find("checkbox").prop("disabled",!0),b=$.ajax({type:"POST",url:"/post/api/addComment",data:a,dataType:"json",success:function(a){b=null;c.find("textarea").prop("disabled",!1);c.find("checkbox").prop("disabled",
!1);!0===a.success?(updateNewComment(a),c.find("textarea").html("").val(""),emitEventToRooms("new_comment",a)):!0===a.error&&bootbox.alert(a.message,function(){a.errorType&&"postDeleted"===a.errorType?($("#post_"+a.postId).remove(),hidePostListingIfNoPosts()):a.errorType&&"fatal"===a.errorType&&(window.location.reload(),window.scrollTo(0,0))})}}))}else return!1});
function hidePostListingIfNoPosts(){0===$("#post_container .posting_area").length&&($("#post_container").addClass("hide"),$("#no_posts_msg").removeClass("hide"))}
function updateNewComment(a){var b=a.postId;$("#comment_list_"+b).prepend(a.content);setTimeout(function(){applyTimeAgo()},6E4);$("#comment_count_"+b).html(a.commentCount);var c=parseInt(app.loggedInUserId),d=parseInt(a.postedUserId),b=parseInt(a.commentedUserId),c=(b=c===b)||c===d?!0:!1,a=a.commentId,d=$("#comment_"+a);c||d.find(".delete_comment_btn").parent("li").remove();b||d.find(".edit_field .dropdown-menu").append('<li><a class="report_abuse report_abuse_comment" data-comment_id="'+a+'">Report Abuse</a></li>')}
function emitEventToRooms(a,b){$.ajax({type:"POST",url:"/post/api/getPostFollowingRooms",data:{post:b.postInfo},dataType:"json",success:function(c){c.forEach(function(c){c={room:c};$.extend(c,b);socket.emit(a,c)})}})}
function isCommentFormValid(a){a.validate({errorPlacement:function(a,c){a.appendTo(c.parent())},errorLabelContainer:!1,errorElement:"span",errorClass:"help-block",highlight:function(a){$(a).closest(".form-group").addClass("error")},unhighlight:function(a){$(a).closest(".form-group").removeClass("error")},rules:{"data[Comment][comment_text]":{required:!0,maxlength:5E3}},messages:{"data[Comment][comment_text]":{required:"Please enter your comment before submission",maxlength:"Cannot be more than 5000 characters long"}}});
return a.valid()}$(document).on("click",".load_more_comments",function(){var a=$(this),b=a.find("a").data("post_id"),c=$("#PostPostedInType").val();$.ajax({type:"POST",url:"/post/api/listComments",data:{postId:b,postedInType:c},dataType:"json",beforeSend:function(){a.html('<div class="text-center"><img alt="Loading..." src="/img/loading.gif"></div>')},success:function(c){a.remove();!0===c.success&&$("#comment_list_"+b).html(c.message)}})});$(document).on("mouseover",".comment_section",function(){$(this).find(".edit_field").removeClass("hide")});
$(document).on("mouseout",".comment_section",function(){$(this).find(".edit_field").addClass("hide")});
$(document).on("click",".delete_comment_btn",function(){var a=$(this).data("comment_id");if(0<a){var b=$(this).closest(".posting_area").find(".comment_count"),c=b.html();bootbox.confirm("Are you sure you want to delete this comment?",function(d){d&&($("#comment_"+a).remove(),c-=1,b.html(c),$.ajax({type:"POST",url:"/post/api/deleteComment",data:{commentId:a},dataType:"json",success:function(b){!0===b.success&&(postId=b.postId,emitEventToRooms("comment_delete",{commentId:a,postId:postId,commentCount:c,
postInfo:b.postInfo}))}}))})}});
$(document).on("click","ul#post_filter li a",function(){var a=$(this).data("filter_value"),b=$("#PostPostedIn").val(),c=$("#PostPostedInType").val(),d=$("#isLibray").val()?$("#isLibray").val():!1;$("#filter_value_hidden").val(a);$("#new_posts_notification").hide();resetNewPostCount();$.ajax({type:"POST",url:"/post/list/filterPosts",data:{filterValue:a,postedIn:b,postedInType:c,isLibray:d},dataType:"json",beforeSend:function(){$("#post_list").html('<div class="posting_area"><div class="text-center"><img alt="Loading..." src="/img/loader.gif"></div></div>');disableAutoPagination()},
success:function(a){!0===a.success?($("#post_list").html(a.content),paginatePostData()):!0===a.error&&(a='<div class="posting_area">'+a.content+"</div>",$("#post_list").html(a))}})});function disableAutoPagination(){$.autopager&&$.autopager({autoLoad:!1})}$(document).on("mouseover",".posting_area, .questionnaire_div",function(){$(this).find(".delete_post_btn").removeClass("hide")});$(document).on("mouseout",".posting_area, .questionnaire_div",function(){$(this).find(".delete_post_btn").addClass("hide")});
$(document).on("click",".delete_post_btn",function(){var a=$(this).data("post_id");if(0<a){var b=$("#post_"+a),c="post";b.hasClass("questionnaire_div")&&(c="question");bootbox.confirm("Are you sure you want to delete this "+c+"?",function(d){if(d){b.remove();var e="post_delete";"post"===c?hidePostListingIfNoPosts():"question"===c&&(e="question_delete",0===$("#questions_list .questionnaire_div").length&&$("#no_questions_msg").removeClass("hide"));$.ajax({type:"POST",url:"/post/api/deletePost",data:{postId:a},
dataType:"json",success:function(a){emitEventToRooms(e,a)}})}})}});$(document).on("click","li.posting_url",function(){$("#posting_url_form").removeClass("hide");$("#link_input_section").removeClass("hide");$("#PostLink").val("").removeAttr("disabled")});
function grabUrl(){var a=$("#PostLink").val();$.ajax({type:"POST",url:"/post/api/textCrawler",data:{link:a},dataType:"json",beforeSend:function(){$("#grab_url_btn").attr("disabled","disabled");$("#PostLink").addClass("textbox_loader").attr("disabled","disabled");$("#preview").hide();isCrawling=!0},success:function(a){$("#grab_url_btn").removeAttr("disabled");if(a.url&&(""!==a.title||"no"!==a.video||""!==a.images&&!1!==a.images&&null!==a.images)){$("#PostLink").removeClass("textbox_loader");$("#link_input_section").addClass("hide");
$("#preview").show();$("#previewTitle").html(a.title);$("#previewUrl").html(a.cannonicalUrl);$("#previewDescription").html(a.description);try{if(""!==a.images&&!1!==a.images&&null!==a.images){images=a.images.split("|");a.images=images;$("#previewImages").show();images.length=parseInt(images.length);previewImagesCount=images.length;1<previewImagesCount?($("#previewImagesNav").show(),currentPreviewImgPos=1):$("#previewImagesNav").hide();var c="";for(i=0;i<images.length;i++)c=0===i?c+("<img id='imagePreview"+
i+"' src='"+images[i]+"' style='width: 130px; height: auto' ></img>"):c+("<img id='imagePreview"+i+"' src='"+images[i]+"' style='width: 130px; height: auto; display: none' ></img>");$("#previewImage").html("<a href='"+a.pageUrl+"' target='_blank'>"+c+"</a><div id='whiteImage' style='width: 130px; color: transparent; display:none;'>...</div>")}else $("#previewImages").hide()}catch(d){$("#previewImages").hide()}setLinkData(a);isLinkDataPresent=!0;isCrawling=!1;changeShareBtnStatus();isPostFormValid()}else isCrawling=
!1,setPostFormRules(),showPostLinkError("Please post a valid URL."),$("#PostLink").removeClass("textbox_loader").removeAttr("disabled")}})}$(document).on("click","#previewImagesNav a.prev",function(){var a=$("#previewImage img:visible");a.hide();1===currentPreviewImgPos?(currentPreviewImgPos=previewImagesCount,prevImg=$("#previewImage img:last")):(currentPreviewImgPos--,prevImg=a.prev("img"));prevImg.show();$("#PostLinkImage").val(prevImg.attr("src"))});
$(document).on("click","#previewImagesNav a.next",function(){var a=$("#previewImage img:visible");a.hide();currentPreviewImgPos===previewImagesCount?(currentPreviewImgPos=1,nextImg=$("#previewImage img:first")):(currentPreviewImgPos++,nextImg=a.next("img"));nextImg.show();$("#PostLinkImage").val(nextImg.attr("src"))});
$(document).on("click","#closePreview",function(){$("#preview").fadeOut("fast",function(){clearPreview();$("#PostLink").val("").removeClass("textbox_loader").removeAttr("disabled");$("#link_input_section").removeClass("hide")})});function clearPreview(){$("#preview").hide();$("#previewImage").html("");$("#previewTitle").html("");$("#previewUrl").html("");$("#previewDescription").html("");resetLinkData();changeShareBtnStatus();$("#grab_url_btn").attr("disabled","disabled")}
function setLinkData(a){$("#PostLinkTitle").val(a.title);$("#PostLinkUrl").val(a.url);$("#PostLinkPageUrl").val(a.pageUrl);$("#PostLinkCannonicalUrl").val(a.cannonicalUrl);$("#PostLinkDescription").val(a.description);var b="";!1!==a.images&&(b=a.images instanceof Array?a.images[0]:a.images);$("#PostLinkImage").val(b);$("#PostLinkVideo").val(a.video);b="";"yes"===a.video&&(b=a.videoIframe);$("#PostLinkVideoIframe").val(b)}
function resetLinkData(){$("#PostLinkTitle").val("");$("#PostLinkUrl").val("");$("#PostLinkPageUrl").val("");$("#PostLinkCannonicalUrl").val("");$("#PostLinkDescription").val("");$("#PostLinkImage").val("");$("#PostLinkVideo").val("");$("#PostLinkVideoIframe").val("");isLinkDataPresent=!1}
function showPostLinkError(a){0<$("#posting_errors span[for='PostLink']").length?$("#posting_errors span[for='PostLink']").html(a).show():$("#posting_errors").append('<span for="PostLink" class="help-block">'+a+"</span>");$("#posting_errors").show()}var postLink;$(document).on("keyup","#PostLink",function(){postLink=this;checkPostLink()});$(document).on("paste","#PostLink",function(){postLink=this;setTimeout(function(){$("#PostLink").valid()&&grabUrl()},100)});
$(document).on("drop","#PostLink",function(){postLink=this;setTimeout(function(){$("#PostLink").valid()&&grabUrl()},100)});
function checkPostLink(){isLinkDataPresent=!1;if(""!==$.trim($(postLink).val())){var a=$(postLink).val();"http://"!==a.substr(0,7)&&"https://"!=a.substr(0,8)&&(a="http://"+a);"/"!==a.substr(a.length-1,1)&&(a+="/");urlRegex.test(a)?$("#grab_url_btn").removeAttr("disabled"):($("#grab_url_btn").attr("disabled","disabled"),$("#preview").fadeOut("fast",function(){clearPreview()}))}else $("#grab_url_btn").attr("disabled","disabled")}$(document).on("click","#grab_url_btn",function(){grabUrl()});
$(document).on("click",".frnd_request_respond_btn",function(){$(this).next(".frnd_request_respond_box").removeClass("hide");$(this).hide()});
$(document).on("click","#new_posts_notification",function(){var a=$("#PostPostedIn").val(),b=$("#PostPostedInType").val(),c=$("#isLibray").val()?$("#isLibray").val():!1;$.ajax({type:"POST",url:"/post/list/filterPosts",data:{filterValue:9,postedIn:a,postedInType:b,isLibray:c},dataType:"json",beforeSend:function(){$("#new_posts_notification").html('<div class="text-center"><img alt="Loading..." src="/img/loading.gif"></div>');disableAutoPagination()},success:function(a){!0===a.success?($("#post_container").hasClass("hide")&&
($("#no_posts_msg").addClass("hide"),$("#post_container").removeClass("hide")),$("#post_list").html(a.content),paginatePostData(),$("#new_posts_notification").html(""),$("#new_posts_notification").hide(),resetNewPostCount()):!0===a.error&&(a='<div class="posting_area">'+a.content+"</div>",$("#post_list").html(a))}})});function getNewPostCount(){return NEW_POST_COUNT}
function updateNewPostCount(){if(0<parseInt(NEW_POST_COUNT)){var a="Show "+NEW_POST_COUNT+" new update(s) with default filter option";$("#new_posts_notification").html(a);$("#new_posts_notification").show()}else $("#new_posts_notification").hide()}function incNewPostCount(a){NEW_POST_COUNT+=1;NEW_POST_IDS.push(a);updateNewPostCount()}function decNewPostCount(a){a=$.inArray(a,NEW_POST_IDS);-1<a&&(NEW_POST_IDS.splice(a,1),NEW_POST_COUNT-=1,updateNewPostCount())}
function resetNewPostCount(){NEW_POST_COUNT=0;NEW_POST_IDS=[]}
$(document).on("click","#new_questions_notification",function(){diseaseId=$("#question_form #PostPostedIn").val();$.ajax({type:"POST",url:"/listForumQuestions/"+diseaseId,beforeSend:function(){$("#new_questions_notification").html('<div class="text-center"><img alt="Loading..." src="/img/loading.gif"></div>')},success:function(a){$("#questions_list").html(a);$("#new_questions_notification").html("");$("#new_questions_notification").addClass("hide");resetNewQuestionCount()}})});
function updateNewQuestionCount(){if(0<parseInt(NEW_QUESTION_COUNT)){var a="Show "+NEW_QUESTION_COUNT+" new update(s)";$("#new_questions_notification").html(a);$("#new_questions_notification").removeClass("hide")}else $("#new_questions_notification").addClass("hide")}function incNewQuestionCount(a){NEW_QUESTION_COUNT+=1;NEW_QUESTION_IDS.push(a);updateNewQuestionCount()}
function decNewQuestionCount(a){a=$.inArray(a,NEW_QUESTION_IDS);-1<a&&(NEW_QUESTION_IDS.splice(a,1),NEW_QUESTION_COUNT-=1,updateNewQuestionCount())}function resetNewQuestionCount(){NEW_QUESTION_COUNT=0;NEW_QUESTION_IDS=[]}var commentCountElement,commentCount,commentId;
$(document).on("click",".report_abuse_comment",function(){commentId=$(this).data("comment_id");0<commentId&&(commentCountElement=$(this).closest(".posting_area").find(".comment_count"),commentCount=commentCountElement.html(),$('#report_abuse_comment_dialog form input[type="hidden"]').val(commentId),$("#report_abuse_comment_dialog form textarea").val(""),$('#report_abuse_comment_dialog form input[type="checkbox"]').prop("checked",!1),$("#report_abuse_comment_dialog").modal("show"))});
$(document).on("click","#confirm_report_abuse_comment",function(){$("#comment_"+commentId).remove();commentCount-=1;commentCountElement.html(commentCount);var a=$("#report_abuse_comment_dialog form").serialize();$('#report_abuse_comment_dialog form input[type="hidden"]').val("");$("#report_abuse_comment_dialog").modal("hide");$.ajax({type:"POST",url:"/post/api/reportAbuseComment",data:a,dataType:"json",success:function(a){!0===a.error&&bootbox.alert(a.message)}})});var postId;
$(document).on("click",".report_abuse_post",function(){postId=$(this).data("post_id");0<postId&&($('#report_abuse_post_dialog form input[type="hidden"]').val(postId),$("#report_abuse_post_dialog form textarea").val(""),$('#report_abuse_post_dialog form input[type="checkbox"]').prop("checked",!1),$("#report_abuse_post_dialog").modal("show"))});
$(document).on("click","#confirm_report_abuse_post",function(){$("#post_"+postId).remove();hidePostListingIfNoPosts();var a=$("#report_abuse_post_dialog form").serialize();$('#report_abuse_post_dialog form input[type="hidden"]').val("");$("#report_abuse_post_dialog").modal("hide");$.ajax({type:"POST",url:"/post/api/reportAbusePost",data:a,dataType:"json",success:function(a){!0===a.error&&bootbox.alert(a.message)}})});
$(document).on("click",".play_video",function(){var a=$(this).find("img.img-responsive"),b=a.width(),a=a.height(),c=$(this).attr("data-video_id");$(this).embedVimeoPlayer(c,b,a)});
$(document).on("click","#add_question_btn",function(){var a=this;if(isQuestionFormValid()){var b=Ladda.create(a);b.start();$.ajax({type:"POST",url:"/post/api/addQuestion",data:$("#question_form").serialize(),dataType:"json",beforeSend:function(){$(a).prop("disabled",!0)},success:function(c){$("#question_form")[0].reset();$(a).prop("disabled",!1);b.stop();if(!0===c.success){$("#no_questions_msg").addClass("hide");$("#questions_list").prepend(c.content);if(0<$(".show_more_questions").length){var d=
$(".show_more_questions a").attr("data-offset"),d=parseInt(d)+1;$(".show_more_questions a").attr("data-offset",d)}setTimeout(function(){applyTimeAgo()},6E4);c={room:$("#PostPostedInRoom").val(),postId:c.postId};socket.emit("new_question",c)}else!0===c.error&&bootbox.alert(c.message)}})}});
function isQuestionFormValid(){var a=$("#question_form");a.validate({errorLabelContainer:"div#question_form_error",errorClass:"error-block",highlight:function(a){$(a).addClass("error")},unhighlight:function(a){$(a).removeClass("error")},rules:{"data[Post][question]":{required:!0,maxlength:150}},messages:{"data[Post][question]":{required:"Please enter the question.",maxlength:"Question cannot be more than 150 characters long."}}});return a.valid()}var diseaseId;
$(document).ready(function(){0<$("#questions_list").length&&(diseaseId=$("#question_form #PostPostedIn").val(),$.ajax({type:"POST",url:"/listForumQuestions/"+diseaseId,success:function(a){$("#questions_loading").addClass("hide");$("#questions_list").html(a)}}))});
$(document).on("click",".show_more_questions",function(){var a=$(this).find("a").attr("data-offset"),a="/listForumQuestions/"+diseaseId+"/offset:"+a;$(this).remove();$("#questions_loading").removeClass("hide");$.ajax({type:"POST",url:a,success:function(a){$("#questions_loading").addClass("hide");$("#questions_list").append(a);setTimeout(function(){applyTimeAgo()},6E4)}})});
$(document).on("click",'.answer_form input[type="checkbox"]',function(){var a=$(this).closest(".answer_form_container");$(this).is(":checked")?(a.find(".normal_thumb, .original_username").addClass("hidden"),a.find(".anonymous_thumb, .anonymous_username").removeClass("hidden")):(a.find(".normal_thumb, .original_username").removeClass("hidden"),a.find(".anonymous_thumb, .anonymous_username").addClass("hidden"))});
$(document).on("click",".add_answer_btn",function(){if(!1===$(this).prop("disabled")){var a=$(this).closest("form.answer_form");if(isAnswerFormValid(a)){var b=a.serialize();a.find("textarea, checkbox, button").prop("disabled",!0);var c=Ladda.create(this);c.start();$.ajax({type:"POST",url:"/post/api/addAnswer",data:b,dataType:"json",success:function(b){a.find("textarea, checkbox, button").prop("disabled",!1);c.stop();if(!0===b.success){updateNewAnswer(b);a.find("textarea").html("").val("");var e={room:$("#PostPostedInRoom").val()};
$.extend(e,b);socket.emit("new_answer",e)}else!0===b.error&&bootbox.alert(b.message,function(){b.errorType&&"postDeleted"===b.errorType?$("#post_"+b.postId).remove():b.errorType&&"fatal"===b.errorType&&(window.location.reload(),window.scrollTo(0,0))})}})}}else return!1});
function updateNewAnswer(a){var b=$("#post_"+a.postId),c=b.find(".question_answers_div"),b=b.find(".answer_count");c.find(".no_answers_msg").addClass("hide");c.prepend(a.content);setTimeout(function(){applyTimeAgo()},6E4);c=b.text();c=parseInt(c)+1;b.html(c);canCurrentUserDeleteAnswer(a)||$("#answer_"+a.answerId).find(".delete_answer_btn").remove()}
function canCurrentUserDeleteAnswer(a){var b=parseInt(app.loggedInUserId),c=parseInt(a.questionAskedUserId),a=parseInt(a.answeredUserId);return b===a||b===c?!0:!1}
function isAnswerFormValid(a){a.validate({errorPlacement:function(a,c){a.appendTo(c.parent().find(".error_container"))},errorLabelContainer:!1,errorElement:"span",errorClass:"error-block",highlight:function(a){$(a).addClass("error")},unhighlight:function(a){$(a).removeClass("error")},rules:{"data[Answer][answer]":{required:!0,maxlength:5E3}},messages:{"data[Answer][answer]":{required:"Please enter your answer before submission",maxlength:"Cannot be more than 5000 characters long"}}});return a.valid()}
$(document).on("click",".more_text",function(){var a=$(this).parent(".truncated_text");a.addClass("hide");a.next(".full_text").removeClass("hide").children(".less_text").removeClass("hide");$(this).addClass("hide")});$(document).on("click",".less_text",function(){var a=$(this).parent(".full_text");a.addClass("hide");a.prev(".truncated_text").removeClass("hide").children(".more_text").removeClass("hide");$(this).addClass("hide")});
$(document).on("click",".add_answer_link",function(){var a=$(this).closest(".questionnaire_div").find(".answer_form_container");a.hasClass("hide")?a.removeClass("hide"):a.find("textarea").focus()});
$(document).on("click",".load_more_answer",function(){var a=$(this),b=a.find("a").attr("data-postid"),c=$("#post_"+b).find(".question_answers_div");$.ajax({type:"POST",url:"/disease/diseases/listQuestionAnswers",data:{postId:b},beforeSend:function(){a.html('<div class="text-center"><img alt="Loading..." src="/img/loading.gif"></div>')},success:function(b){a.remove();c.html(b);setTimeout(function(){applyTimeAgo()},6E4)}})});$(document).on("mouseover",".disease_answer_div",function(){$(this).find(".delete_answer_btn").removeClass("hide")});
$(document).on("mouseout",".disease_answer_div",function(){$(this).find(".delete_answer_btn").addClass("hide")});$(document).on("click",".delete_answer_btn",function(){var a=$(this).data("answer_id");0<a&&bootbox.confirm("Are you sure you want to delete this answer?",function(b){b&&(deleteAnswer(a),$.ajax({type:"POST",url:"/post/api/deleteAnswer",data:{answerId:a},dataType:"json"}),b={room:$("#PostPostedInRoom").val(),answerId:a},socket.emit("delete_answer",b))})});
function deleteAnswer(a){var a=$("#answer_"+a),b=a.closest(".questionnaire_div"),c=b.find(".answer_count"),d=c.html();a.remove();d=parseInt(d)-1;c.html(d);0===d&&b.find(".no_answers_msg").removeClass("hide")};