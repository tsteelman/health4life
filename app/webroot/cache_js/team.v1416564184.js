var friendsCheckBoxList;$(document).ready(function(){0<$("#teamForm").length&&createUploader();friendsCheckBoxList=$('input[name="friends_list[]"]');$("#team_privacy_help").popover({placement:"right",trigger:"hover focus",title:"Team privacy",html:!0,container:"#team_privacy_popover"})});
function load_myteam(a){"undefined"===typeof a&&(a=1);if(1!==a){var c=Ladda.create(document.querySelector("#load-more"));c.start()}$.ajax({url:"/myteam/loadTeamSupportingMe/page:"+a,dataType:"json",success:function(b){$(".loader").hide();1===a?$("#team_supporting_me #myTeamList").html(b.htm_content):$("#team_supporting_me #myTeamList").append(b.htm_content);0<b.paginator.count&&$("#team_supporting_me").show();!0==b.paginator.nextPage&&$("#team_supporting_me").append('<div id="more_button_my_team'+
(b.paginator.page+1)+'" class="block"><a href="javascript:load_myteam('+(b.paginator.page+1)+')" id="load-more" class="btn btn_more pull-right ladda-button more-arrow" data-style="expand-right" data-size="l" data-spinner-color="#3581ED"><span class="ladda-label">more</span></a></div>')}}).always(function(){1!==a&&(c.stop(),$("#team_supporting_me #more_button_my_team"+a).remove())})}
function load_user_supported_team(a){"undefined"===typeof a&&(a=1);if(1!==a){var c=Ladda.create(document.querySelector("#load-more-user-supported"));c.start()}$.ajax({url:"/myteam/loadTeamUserSupport/page:"+a,dataType:"json",success:function(b){$(".loader").hide();1===a?$("#team_user_support #mySupportTeamList").html(b.htm_content):$("#team_user_support #mySupportTeamList").append(b.htm_content);0<b.paginator.count&&$("#team_user_support").show();!0==b.paginator.nextPage&&$("#team_user_support").append('<div id="more_button_support_team'+
(b.paginator.page+1)+'" class="block"><a href="javascript:load_user_supported_team('+(b.paginator.page+1)+')" id="load-more-user-supported" class="btn btn_more pull-right ladda-button more-arrow" data-style="expand-right" data-size="l" data-spinner-color="#3581ED"><span class="ladda-label">more</span></a></div>')}}).always(function(){1!==a&&(c.stop(),$("#team_user_support #more_button_support_team"+a).remove())})}
function load_team_invitation(a){"undefined"===typeof a&&(a=1);if(1!==a){var c=Ladda.create(document.querySelector("#load-more-invitation"));c.start()}$.ajax({url:"/myteam/loadTeamInvitation/page:"+a,dataType:"json",success:function(b){$(".loader").hide();1===a?$("#team_invitation #team_invitation_list").html(b.htm_content):$("#team_invitation #team_invitation_list").append(b.htm_content);0<b.paginator.count&&$("#team_invitation").show();!0==b.paginator.nextPage&&$("#team_invitation").append('<div id="more_button_team_invitation'+
(b.paginator.page+1)+'" class="block"><a href="javascript:load_team_invitation('+(b.paginator.page+1)+')" id="load-more-invitation" class="btn btn_more pull-right ladda-button more-arrow" data-style="expand-right" data-size="l" data-spinner-color="#3581ED"><span class="ladda-label">more</span></a></div>')}}).always(function(){1!==a&&(c.stop(),$("#team_invitation #more_button_team_invitation"+a).remove())})}
function load_recommended_teams(a){"undefined"===typeof a&&(a=1);if(1!==a){var c=Ladda.create(document.querySelector("#load-more-recommendation"));c.start()}$.ajax({url:"/myteam/loadRecommendedTeam/page:"+a,dataType:"json",success:function(b){$(".loader").hide();1===a?($("#team_recommendation #myRecommendedTeamList").html(b.htm_content),$(".team_details").length&&$(".page-header").removeClass("hide")):$("#team_recommendation #myRecommendedTeamList").append(b.htm_content);0<b.paginator.count&&$("#team_recommendation").show();
!0==b.paginator.nextPage&&$("#team_recommendation").append('<div id="more_button_team_recommendation'+(b.paginator.page+1)+'" class="block"><a href="javascript:load_recommended_teams('+(b.paginator.page+1)+')" id="load-more-recommendation" class="btn btn_more pull-right ladda-button more-arrow" data-style="expand-right" data-size="l" data-spinner-color="#3581ED"><span class="ladda-label">more</span></a></div>')}}).always(function(){1!==a&&(c.stop(),$("#team_recommendation #more_button_team_recommendation"+
a).remove())})}$(document).on("click","#cancel_edit",function(){var a=$(this).attr("data-href");$(location).attr("href",a)});
$(document).on("click",".public_join_team",function(){var a=$(this).data("team_id");if(0<a){var c=Ladda.create(this),b=$(this);$.ajax({type:"POST",url:"/myteam/api/joinTeam",data:{team_id:a},dataType:"json",beforeSend:function(){disableBtn(b);b.html("Waiting for approval");c.start()},success:function(d){!0===d.success?window.location="/myteam/"+a:!0===d.error&&bootbox.alert(d.message,function(){d.errorType&&"fatal"===d.errorType?$(location).attr("href","/myteam"):(enableBtn(b),c.stop())})}})}});
$(document).on("click",".approve_team",function(){var a=$(this).data("team_id");if(0<a){var c=Ladda.create(this),b=$(this),d=$(this).next(".decline_team");$.ajax({type:"POST",url:"/myteam/api/approveTeam",data:{team_id:a},dataType:"json",beforeSend:function(){disableBtn(b);disableBtn(d);d.hide();b.html("Redirecting to the team...");c.start()},success:function(e){!0===e.success?window.location="/myteam/"+a:!0===e.error&&bootbox.alert(e.message,function(){e.errorType&&"fatal"===e.errorType?$(location).attr("href",
"/myteam"):(enableBtn(b),enableBtn(d),d.show(),c.stop())})}})}});$(document).on("click",".decline_team",function(){var a=this;bootbox.dialog({message:"Do you really want to decline this team?",title:"Decline team request",closeButton:!0,backdrop:!0,onEscape:function(){},buttons:{main:{label:"Yes",className:"btn btn_active",callback:function(c){c&&declineTeam(a)}},danger:{label:"No",className:"btn btn_clear"}}})});
function declineTeam(a){var c=$(a).data("team_id");if(0<c){var b=Ladda.create(a),d=$(a),e=$(a).prev(".approve_team");$.ajax({type:"POST",url:"/myteam/api/declineTeam",data:{team_id:c},dataType:"json",beforeSend:function(){disableBtn(e);disableBtn(d);b.start()},success:function(a){!0===a.success?0<$("#team_invitation").length?$("#team_invite_"+c).hide():$(location).attr("href","/myteam"):!0===a.error&&bootbox.alert(a.message,function(){a.errorType&&"fatal"===a.errorType?$(location).attr("href","/myteam"):
(enableBtn(e),enableBtn(d),b.stop())})}})}}
$(document).on("click",".accept_team_invite",function(){var a=$(this).data("team_id");if(0<a){var c=Ladda.create(this),b=$(this),d=$(this).next(".decline_team_invite");$.ajax({type:"POST",url:"/myteam/api/acceptTeamInvitation",data:{team_id:a},dataType:"json",beforeSend:function(){disableBtn(b);disableBtn(d);d.hide();b.html("Redirecting to the team...");c.start()},success:function(e){!0===e.success?window.location="/myteam/"+a:!0===e.error&&bootbox.alert(e.message,function(){e.errorType&&"fatal"===
e.errorType?$(location).attr("href","/myteam"):(enableBtn(b),enableBtn(d),d.show(),c.stop())})}})}});$(document).on("click",".decline_team_invite",function(){var a=this;bootbox.dialog({message:"Do you really want to decline this team invitation?",title:"Decline Invitation",closeButton:!0,backdrop:!0,onEscape:function(){},buttons:{main:{label:"Yes",className:"btn btn_active",callback:function(c){c&&declineTeamInvitation(a)}},danger:{label:"No",className:"btn btn_clear"}}})});
function declineTeamInvitation(a){var c=$(a).data("team_id");if(0<c){var b=Ladda.create(a),d=$(a),e=$(a).prev(".accept_team_invite");$.ajax({type:"POST",url:"/myteam/api/declineTeamInvitation",data:{team_id:c},dataType:"json",beforeSend:function(){disableBtn(e);disableBtn(d);b.start()},success:function(a){!0===a.success?$(location).attr("href","/myteam"):!0===a.error&&bootbox.alert(a.message,function(){a.errorType&&"fatal"===a.errorType?$(location).attr("href","/myteam"):(enableBtn(e),enableBtn(d),
b.stop())})}})}}function enableBtn(a){a.prop("disabled",!1)}function disableBtn(a){a.prop("disabled",!0)}
function createUploader(){function a(a){d.html('<div class="alert alert-error">'+a+"</div>")}function c(a){d.html('<div class="alert alert-info">'+a+"</div>")}var b=$("#bootstrapped-fine-uploader"),d=$("#uploadmessages"),e=$("#preview_img"),f;new qq.FineUploaderBasic({button:b[0],debug:!1,multiple:!1,request:{endpoint:"/myteam/api/uploadPhoto"},validation:{acceptFiles:"image/*",allowedExtensions:app.imageExtensions,minSizeLimit:"1024",sizeLimit:"5242880"},callbacks:{onError:function(c,e,f){a(f);d.show();
b.show();$("#team_step3 .team_for .btn").removeAttr("disabled")},onSubmit:function(){b.hide();d.show();$("#team_step3 .team_for .btn").attr("disabled","disabled")},onUpload:function(a,b){c('<img src="'+app.site_url+'/img/loading.gif" alt="Initializing. Please hold."> Initializing "'+b+'"')},onProgress:function(a,b,d,e){d<e&&(a=Math.round(100*(d/e))+"% of "+Math.round(e/1024)+" kB",c('<img src="'+app.site_url+'/img/loading.gif" alt="In progress. Please hold."> Uploading "'+b+'" '+a))},onComplete:function(c,
i,g){b.show();if(g.success){d.hide();var h=bootbox.dialog({closeButton:!1,message:"test",title:"Crop Team Photo",show:!0,animate:!1,buttons:{success:{label:"Accept",className:"accept btn-success",callback:function(){var a=f.getSelection(!1);$.ajax({dataType:"json",type:"POST",url:"/myteam/api/cropPhoto",data:{crop_image:!0,x1:a.x1,y1:a.y1,w:a.width,h:a.height,cropfileName:g.fileName},beforeSend:function(){e.attr("src",app.site_url+"theme/App/img/loading.gif")},success:function(a){$("#TeamImage").val(a.fileName);
e.attr("src",a.fileUrl)}})}},cancel:{label:"Cancel",className:"btn-default"}}});h.find(".modal-footer .btn-success").attr("disabled","disabled");c='<div class="upload_area"><img src="'+g.fileurl+'" alt="Uploaded photo" /></div>';h.find(".bootbox-body").html(c+'<div>To make adjustments, please drag around the white rectangle below. When you are happy with the photos, click "Accept" button. Your beautiful, clean, non-pixelated image should be at minimum 120x120 pixels.</div>');setTimeout(function(){var a=
240,b=106;g.imageWidth<a?(b=b/a*g.imageWidth,a=g.imageWidth):g.imageHeight<b&&(a=b/a*g.imageHeight,b=g.imageHeight);f=h.find(".bootbox-body img").imgAreaSelect({parent:".bootbox",autoHide:!1,mustMatch:!0,handles:!0,instance:!0,aspectRatio:"120 : 53",x1:0,y1:0,x2:a,y2:b,minHeight:b,minWidth:a,onInit:function(){h.find(".modal-footer .btn-success").removeAttr("disabled")},onSelectStart:function(){h.find(".modal-footer .btn-success").removeAttr("disabled")},onCancelSelection:function(){h.find(".modal-footer .btn-success").attr("disabled",
"disabled")}})},500)}else d.show(),a('Error with "'+i+'": '+g.error);$("#team_step3 .team_for .btn").removeAttr("disabled")}}})}
function listFriends(a,c){var b=friendsCheckBoxList.serialize(),d="";data=b+"&teamId="+c;1==a||2==a?d="/myteam/api/inviteFriend":3==a&&(setSelectedPatient($("input.patient-select:checked").data()),$("#choose-patient-friend").modal("hide"),friendsCheckBoxList.prop("checked",!1),$("input.patient-select").removeAttr("disabled"),$("#import_contact_step_1 .contact_persons").removeClass("active"));0==b.length?$("#team_error_message").text("Please select friend(s).").show():""!=d&&($("#team_error_message").hide(),
$.ajax({url:d,type:"POST",data:data,dataType:"json",success:function(b){b.success===true?a==1?location.reload():a==2&&$(location).attr("href","/myteam/"+c):$(location).attr("href","/myteam")}}))}$(document).on("click",".patient-select",function(){var a=$("#import_contact_step_1 .contact_persons");this.checked&&($("input.patient-select").not(this).attr("checked",!1),a.removeClass("active"),$(this).closest(".contact_persons").addClass("active"))});
$(document).on("click","#search_friends",function(){$("input.patient-select").removeAttr("disabled");var a=$("#import_contact_step_1 .contact_persons");friendsCheckBoxList.prop("checked",!1);a.removeClass("active")});
$(document).on("change","#select_all_friends",function(){var a=$("#import_contact_step_1 .contact_persons");friendsList=$('input[name="friends_list[]"]').not(":hidden");$(this).is(":checked")?(friendsList.prop("checked",!0),a.addClass("active")):(friendsList.prop("checked",!1),a.removeClass("active"));handleSelectedCountChange()});function handleSelectedCountChange(){var a=$('input[name="friends_list[]"]:checked').not(":hidden").length;$("#selected_friends_count").html(a)}
$(document).on("change",'input[name="friends_list[]"]',function(){handleSelectedCountChange();var a=$(this).closest(".contact_persons");$(this).is(":checked")?a.addClass("active"):a.removeClass("active")});
$(document).on("click","#leave_team_btn",function(){var a=this,c=$(a).data("team-id"),b=Ladda.create(a);$.ajax({type:"POST",url:"/myteam/api/getUserTeamStatus",data:{team_id:c},dataType:"json",beforeSend:function(){b.start()},success:function(d){!0===d.success?($(a).data("team-id",c),$(a).data("role",d.role),$(a).data("total-members",d.total_members),$(a).data("organizer-count",d.organizer_count),leaveTeamPopup(a,b)):!0===d.error&&bootbox.alert(d.message,function(){d.errorType&&"fatal"===d.errorType?
$(location).attr("href","/myteam"):(enableBtn(a),b.stop())})}})});
function leaveTeamPopup(a,c){var b=$(a).data("role");$(a).data("total-members");var d=$(a).data("organizer-count");0==b?bootbox.dialog({message:"Are you sure you want to leave this team?",title:"Leave Team",closeButton:!0,backdrop:!0,onEscape:function(){},buttons:{main:{label:"Yes",className:"btn btn_active",callback:function(b){b&&leaveTeam(a)}},danger:{label:"No",className:"btn btn_clear",callback:function(){c.stop()}}}}):1==b||3==b?bootbox.dialog({message:"The team will be discontinued and the members will be notified. Are you sure?",
title:"Leave Team",closeButton:!0,backdrop:!0,onEscape:function(){},buttons:{main:{label:"Yes",className:"btn btn_active",callback:function(b){b&&leaveTeam(a)}},danger:{label:"No",className:"btn btn_clear",callback:function(){c.stop()}}}}):1<d?bootbox.dialog({message:"Are you sure you want to leave this team?",title:"Leave Team",closeButton:!0,backdrop:!0,onEscape:function(){},buttons:{main:{label:"Yes",className:"btn btn_active",callback:function(b){b&&leaveTeam(a)}},danger:{label:"No",className:"btn btn_clear",
callback:function(){c.stop()}}}}):($("#transfer-organizer").modal("show"),c.stop())}function leaveTeam(a){a=$(a).data("team-id");0<a&&$.ajax({type:"POST",url:"/myteam/api/leaveTeam",data:{team_id:a},dataType:"json",success:function(a){!0===a.success&&$(location).attr("href","/myteam")}})}
$(document).on("click","#assign_organizer_button",function(){var a=$("#assign_organizer_dropdown").val(),c=$("#transfer-organizer").data("team-id");$("#assign_message").html("");0<a&&$.ajax({type:"POST",url:"/myteam/api/assignOrganizer",data:{team_member_id:a},dataType:"json",success:function(a){!0===a.success&&("member"==a.type?($("#assign_message").html(a.username+" is promoted as the Team Lead. Waiting for approval."),$("#assign_message").show(),window.location="/myteam/"+c+"/members"):($("#assign_message").html(a.username+
" is promoted as the Team Lead and is notified."),$("#assign_message").show(),window.location="/myteam"))}})});
$("#manage-user-menu li").on("click",function(){var a=$(this).attr("class"),c=$(this).parent().data("member-id"),b=$(this).parent().data("username");"promote-option"===a?(promoteAsOrganizer(c,b),$(this).hide(),$(this).parent().prepend('<li class="approval-wait-option"><a href="#">Waiting for Approval</a></li>')):"remove-option"===a?($("#remove-user-reason").modal("show"),$("#remove_user_button").data("member-id",c)):"demote-option"===a&&bootbox.dialog({message:"Are you sure you want to remove Team Lead privilege?",
title:"Demote from Team Lead",closeButton:!0,backdrop:!0,onEscape:function(){},buttons:{main:{label:"Yes",className:"btn btn_active",callback:function(a){a&&demoteOrganizer(c)}},danger:{label:"No",className:"btn btn_clear"}}})});
function promoteAsOrganizer(a,c){$.ajax({type:"POST",url:"/myteam/api/upgradeToOrganizer",data:{team_member_id:a},dataType:"json",success:function(a){!0===a.success&&bootbox.dialog({message:"Your request to promote "+c+" to Team Lead has been sent for approval",title:"Promotion to Team Lead",closeButton:!0,backdrop:!0,onEscape:function(){},buttons:{main:{label:"Ok",className:"btn btn_active",callback:function(){}}}})}})}
function demoteOrganizer(a){$.ajax({type:"POST",url:"/myteam/api/demoteOrganizer",data:{team_member_id:a},dataType:"json",success:function(a){!0===a.success&&bootbox.dialog({message:"Team Lead privilage has been removed successfully",title:"Demote to Member",closeButton:!0,backdrop:!0,onEscape:function(){},buttons:{main:{label:"Ok",className:"btn btn_active",callback:function(a){a&&location.reload()}}}})}})}
$(document).on("click","#remove_user_button",function(){$("#remove-user-reason").modal("hide");var a=$(this).data("member-id"),c=$("#remove-reason").val();bootbox.dialog({message:"Are you sure to remove this member from team?",title:"Remove User",closeButton:!0,backdrop:!0,onEscape:function(){},buttons:{main:{label:"Yes",className:"btn btn_active",callback:function(b){b&&$.ajax({type:"POST",url:"/myteam/api/removeTeamUser",data:{team_member_id:a,reason:c},dataType:"json",success:function(b){!0===
b.success&&($("#team_member_"+a).remove(),location.reload())}})}},danger:{label:"No",className:"btn btn_clear"}}})});
$(document).on("click",".approve_role",function(){var a=$(this).data("team_id");if(0<a){var c=Ladda.create(this),b=$(this),d=$(this).next(".decline_role");$.ajax({type:"POST",url:"/myteam/api/approveRole",data:{team_id:a},dataType:"json",beforeSend:function(){disableBtn(b);disableBtn(d);c.start()},success:function(a){if(!0===a.success){var f=$("<div/>").html(a.members_container).text();$(".role_approval").hide();$("#members_container").html(f);window.location.reload()}else!0===a.error&&bootbox.alert(a.message,
function(){a.errorType&&"fatal"===a.errorType?($(location).attr("href","/myteam"),location.reload()):(enableBtn(b),enableBtn(d),c.stop())})}})}});$(document).on("click",".decline_role",function(){var a=this;bootbox.dialog({message:"Do you really want to decline role request?",title:"Decline Team Lead request",closeButton:!0,backdrop:!0,onEscape:function(){},buttons:{main:{label:"Yes",className:"btn btn_active",callback:function(c){c&&declineRole(a)}},danger:{label:"No",className:"btn btn_clear"}}})});
function declineRole(a){var c=$(a).data("team_id");if(0<c){var b=Ladda.create(a),d=$(a),e=$(a).prev(".approve_role");$.ajax({type:"POST",url:"/myteam/api/declineRole",data:{team_id:c},dataType:"json",beforeSend:function(){disableBtn(e);disableBtn(d);b.start()},success:function(a){!0===a.success?($(".role_approval").hide(),location.reload()):!0===a.error&&bootbox.alert(a.message,function(){a.errorType&&"fatal"===a.errorType?$(location).attr("href","/myteam"):(enableBtn(e),enableBtn(d),b.stop())})}})}}
$(document).on("click",".approve-join-request",function(){var a=$(this).data("member-id");$.ajax({type:"POST",url:"/myteam/api/approveTeamJoinRequest",data:{team_member_id:a},dataType:"json",success:function(a){!0===a.success&&location.reload()}})});
$(document).on("click",".decline-join-request",function(){var a=$(this).data("member-id");bootbox.dialog({message:"Are you sure to decline this request?",title:"Decline Request",closeButton:!0,onEscape:function(){},buttons:{main:{label:"Yes",className:"btn btn_active",callback:function(c){c&&$.ajax({type:"POST",url:"/myteam/api/cancelTeamJoinRequest",data:{team_member_id:a},dataType:"json",success:function(a){!0===a.success&&location.reload()}})}},danger:{label:"No",className:"btn btn_clear"}}})});
$(document).on("click","#cancel-join-request",function(){var a=$(this).data("member-id");bootbox.dialog({message:"Are you sure to cancel this request?",title:"Cancel Request",closeButton:!0,onEscape:function(){},buttons:{main:{label:"Yes",className:"btn btn_active",callback:function(c){c&&$.ajax({type:"POST",url:"/myteam/api/cancelTeamJoinRequest",data:{team_member_id:a},dataType:"json",success:function(a){!0===a.success&&location.reload()}})}},danger:{label:"No",className:"btn btn_clear"}}})});
$(document).on("click",".invite_cancel",function(){$(".search_widget_txt").val("");$(".none_found").addClass("hidden");$("#search_friends").keyup();$('input[type="checkbox"]').prop("checked",!1);$('input[type="checkbox"]').removeAttr("disabled");$(".contact_persons").removeClass("active");$("#selected_friends_count").html(0);$("#team_error_message").hide()});$("#remove-user-reason").on("hidden.bs.modal",function(){$("#remove-reason").val("")});
$(document).on("click",'input[name="data[TeamSetting][enable_notification]"]',function(){$(this).is(":checked")?$("#team_site_email_notifications").removeClass("hide"):$("#team_site_email_notifications").addClass("hide")});
$(document).on("click",".req_medical_data_permision",function(){var a=$(this).data("team-id");0<a&&$.ajax({type:"POST",url:"/myteam/api/requestMedicalDataAccess",data:{team_id:a},dataType:"json",beforeSend:function(){$(".req_medical_data_permision").html("Requesting...")},success:function(a){!0===a.success?($(".req_medical_data_permision").html("Waiting for approval"),$(".req_medical_data_permision").addClass("no-text-decoration").addClass("cursor-default").removeClass("req_medical_data_permision")):
bootbox.alert(a.message,function(){location.reload()})}})});
function managePermissionRequest(a,c,b,d){var e=$(d),f=e.parent();e.parent().html();var j="",i=Ladda.create(d);0<a&&0<c&&$.ajax({type:"POST",url:"/myteam/api/managePermissionRequest",data:{user_id:a,team_id:c,action:b},dataType:"json",beforeSend:function(){$("#change_all_requests_btn").attr("disabled","disabled");i.start();0==b?j="No permission":1==b&&(j="Approved")},success:function(a){i.stop();e.hide();f.parent().find(".approve_reject_msg").html(j).show();a.success?f.find(".approve_reject_btn").not(e).show():
a.error&&bootbox.alert("Some error occured. Please try agin.",function(){location.reload()})}})}
$(document).on("click",".approve_public_privacy",function(){var a=$(this).data("team_id");if(0<a){var c=Ladda.create(this),b=$(this),d=$(this).next(".decline_public_privacy");$.ajax({type:"POST",url:"/myteam/api/changeTeamPrivacy",data:{team_id:a,action:"approve"},dataType:"json",beforeSend:function(){disableBtn(b);disableBtn(d);d.hide();b.html("Redirecting to the team...");c.start()},success:function(a){if(!0===a.success){if($(".approval_container").remove(),showSuccessMessage(a.message),$("#teamForm #TeamPrivacy").length){var f=
$("#teamForm #TeamPrivacy");f.prop("disabled",!1);f.val(1);f.next("i").remove()}}else!0===a.error&&bootbox.alert(a.message,function(){a.errorType&&"fatal"===a.errorType?$(location).attr("href","/myteam"):(enableBtn(b),enableBtn(d),d.show(),c.stop())})}})}});
$(document).on("click",".decline_public_privacy",function(){var a=$(this).data("team_id");if(0<a){var c=Ladda.create(this),b=$(this),d=$(this).prev(".approve_public_privacy");$.ajax({type:"POST",url:"/myteam/api/changeTeamPrivacy",data:{team_id:a,action:"decline"},dataType:"json",beforeSend:function(){disableBtn(d);disableBtn(b);d.hide();c.start()},success:function(a){if(!0===a.success){if($(".approval_container").remove(),showSuccessMessage(a.message),$("#teamForm #TeamPrivacy").length){var b=$("#teamForm #TeamPrivacy");
b.prop("disabled",!1);b.val(2);b.next("i").remove()}}else!0===a.error&&bootbox.alert(a.message,function(){a.errorType&&"fatal"===a.errorType?$(location).attr("href","/myteam"):(enableBtn(acceptTeamInviteBtn),enableBtn(declineTeamInviteBtn),declineTeamInviteBtn.show(),c.stop())})}})}});
function showSuccessMessage(a){$(".main_container .container #header-alert").after('<div class="alert alert-success"><button data-dismiss="alert" class="close" type="button" aria-hidden="true">\u00d7</button><div class="message">'+a+"</div></div>")}var myTeam=Array;
$(document).ready(function(){$(document).on("click",".userType",function(){0<$("#frmCreateTeam").length&&createUploader();"self"==$(this).data("usertype")&&setSelectedPatient($(this).data())});$(document).on("click",".cancelUser",function(){resetUserSelection()});$(document).on("click",".skipInvite",function(){""!=$(this).data("team_url")&&(window.location.href=$(this).data("team_url"))});$(document).on("click",".gotoStep3",function(){var a=getTeamDetails();$("#team_step3 .username").html(a.username);
$("#team_step3 .team_userid").val(a.userid);$("#team_name").val("Team "+a.username);$(".teamstep").hide();$("#team_step3").show()});$(document).on("click",".createTeam",function(){$("#team_name_error").hide();createTeam()})});
function createTeam(){0<parseInt($("#frmCreateTeam .team_userid").val())&&""!=$("#frmCreateTeam #team_name").val()?($(this).attr("disabled","disabled"),$(".cancelUser").attr("disabled","disabled"),$(this).html("<img width='20px' src='"+app.site_url+"theme/App/img/loading.gif' />"),$.ajax({dataType:"json",type:"POST",url:"/myteam/create/finish",data:$("#frmCreateTeam").serialize(),success:function(a){a.success?(myTeam=a.team,"invite"===a.redirect_url?($(".teamstep").hide(),$("#team_step4").show(),
$(".skipInvite").data("team_url",myTeam.team_url),$("#team_step4 .username").html(myTeam.name)):window.location.href=a.redirect_url):(alert(a.message),$(".createTeam").removeAttr("disabled"),$(".cancelUser").removeAttr("disabled"),$(".createTeam").html("Create"))}})):$("#team_name_error").show()}function initTeamDetails(a){var c="",c=a.userid==app.loggedInUserId?"Me":a.username;$("#team_username").html(c);$(".teamstep").hide();$("#team_step2").show()}
function resetUserSelection(){$(".teamstep").hide();$("#team_step1").show();$("#team_step3 .userphoto").attr("src",$("#team_step3 .userphoto").data("default_image"))}function setSelectedPatient(a){setTeamDetails(a);initTeamDetails(a)}function setTeamDetails(a){myTeam.userid=a.userid;myTeam.username=a.username;myTeam.userphoto=a.userphoto;myTeam.hasuserphoto=a.hasuserphoto}function getTeamDetails(){return myTeam};