if("undefined"==typeof jQuery)throw Error("jQuery is not loaded");
$.fn.zabuto_calendar=function(b){var e=$.extend({},$.fn.zabuto_calendar_defaults(),b),b=$.fn.zabuto_calendar_language(e.language),e=$.extend({},e,b);this.each(function(){function b(k,o,h,e){k.data("currDate",new Date(h,e,1,0,0,0,0));k.data("currYear",h);k.data("currMonth",e);o.empty();var j=o,f=k.data("navIcons"),p=$('<span><img src="/theme/App/img/calendar_prev.png" /></span>'),o=$('<span><img src="/theme/App/img/calendar_next.png" /></span>');"object"===typeof f&&("prev"in f&&p.html(f.prev),"next"in
f&&o.html(f.next));var n=k.data("showPrevious");if("number"===typeof n||!1===n)n=B(k.data("showPrevious"),!0);f=$('<div class="calendar-month-navigation"></div>');f.attr("id",k.attr("id")+"_nav-prev");f.data("navigation","prev");!1!==n&&(prevMonth=e-1,prevYear=h,-1==prevMonth&&(prevYear-=1,prevMonth=11),f.data("to",{year:prevYear,month:prevMonth+1}),f.append(p),"function"===typeof k.data("actionNavFunction")&&f.click(k.data("actionNavFunction")),f.click(function(){b(k,j,prevYear,prevMonth)}));n=k.data("showNext");
if("number"===typeof n||!1===n)n=B(k.data("showNext"),!1);p=$('<div class="calendar-month-navigation"></div>');p.attr("id",k.attr("id")+"_nav-next");p.data("navigation","next");!1!==n&&(nextMonth=e+1,nextYear=h,12==nextMonth&&(nextYear+=1,nextMonth=0),p.data("to",{year:nextYear,month:nextMonth+1}),p.append(o),"function"===typeof k.data("actionNavFunction")&&p.click(k.data("actionNavFunction")),p.click(function(){b(k,j,nextYear,nextMonth)}));n=k.data("monthLabels");o=$("<th></th>").append(f);f=$("<th></th>").append(p);
n=$('<a href="/calendar" class="calendar-header">'+n[e]+" "+h+"</a>");n.dblclick(function(){var a=k.data("initDate");b(k,j,a.getFullYear(),a.getMonth())});p=$('<th colspan="5"></th>');p.append(n);n=$('<tr class="calendar-month-header"></tr>');n.append(o,p,f);j.append(n);o=j;if(!0===k.data("showDays")){f=k.data("weekStartsOn");p=k.data("dowLabels");0===f&&(f=$.extend([],p),p=Array(f.pop()).concat(f));var q=$('<tr class="calendar-dow-header"></tr>');$(p).each(function(a,b){q.append("<th>"+b+"</th>")});
o.append(q)}k.data("ajaxSettings");n=r(h,e);f=c(h,e,1);p=c(h,e,n);f-=p;0<f&&(n+=f);var f=Math.ceil(n/7),p=r(h,e),n=c(h,e,1),w=c(h,e,p),x=1;0===k.data("weekStartsOn")&&(6==w&&f++,6==n&&(0==w||1==w||5==w)&&f--,n++,7==n&&(n=0));for(w=0;w<f;w++){for(var v=$('<tr class="calendar-dow"></tr>'),z=0;7>z;z++){if(z<n||x>p)v.append("<td></td>");else{var s=k.attr("id")+"_"+a(h,e,x),y=s+"_day",D=("0"+x).slice(-2),y=$('<div id="'+y+'" class="day" >'+D+"</div>");y.data("day",x);!0===k.data("showToday")&&$.datepicker.formatDate("M dd yy",
new Date(h,e,x))==zabuto_today&&y.addClass("badge badge-today");s=$('<td id="'+s+'"></td>');s.append(y);s.data("date",a(h,e,x));s.data("hasEvent",!1);"function"===typeof k.data("actionFunction")&&(s.addClass("dow-clickable"),s.click(function(){k.data("selectedDate",$(this).data("date"))}),s.click(k.data("actionFunction")),s.dblclick(k.data("dblclickFunction")));v.append(s);x++}6==z&&(n=0)}o.append(v)}f=k.data("ajaxSettings");k.data("events",!1);!1!==f&&("object"!=typeof f||"undefined"==typeof f.url?
alert("Invalid calendar event settings"):$.ajax({type:"GET",url:f.url,data:{year:h,month:e+1},dataType:"json"}).done(function(a){var b=[];$.each(a,function(c){b.push(a[c])});k.data("events",b);var c=k.data("ajaxSettings"),h=k.data("events");h!==false&&$(h).each(function(a,l){var b=k.attr("id")+"_"+l.date,h=$("#"+b),f=$("#"+b+"_day");h.data("hasEvent",true);typeof l.title!=="undefined"&&h.attr("title",l.title);if(typeof l.classname==="undefined"){var e=new Date,o=e.getDate(),g=e.getMonth()+1;e.getFullYear();
o<10&&(o="0"+o);g<10&&(g="0"+g);l.date!=event_class_today&&h.addClass("event")}else{h.addClass("event-styled");f.addClass(l.classname)}if(typeof l.badge!=="undefined"&&l.badge!==false){e=l.badge===true?"":" badge-"+l.badge;o=f.data("day");f.html('<span class="badge badge-event'+e+'">'+o+"</span>")}if(typeof l.body!=="undefined"&&"modal"in c&&c.modal===true){h.addClass("event-clickable");h=l.title;e=l.body;f=l.footer;o=$('<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>');
g=$('<h4 class="modal-title" id="'+b+'_modal_title">'+h+"</h4>");h=$('<div class="modal-header"></div>');h.append(o);h.append(g);e=$('<div class="modal-body" id="'+b+'_modal_body">'+e+"</div>");o=$('<div class="modal-footer" id="'+b+'_modal_footer"></div>');if(typeof f!=="undefined"){f=$("<div>"+f+"</div>");o.append(f)}f=$('<div class="modal-content"></div>');f.append(h);f.append(e);f.append(o);h=$('<div class="modal-dialog"></div>');h.append(f);f=$('<div class="modal fade" id="'+b+'_modal" tabindex="-1" role="dialog" aria-labelledby="'+
b+'_modal_title" aria-hidden="true"></div>');f.append(h);f.data("dateId",b);f.attr("dateId",b);$("body").append(f);$("#"+b).click(function(){$("#"+b+"_modal").modal()})}});h=k.data("events");$("#events").val(JSON.stringify(h));if(g.data("first")){g.data("first",false);getDateEvents()}}));return o}function a(a,b,c){d=10>c?"0"+c:c;m=b+1;m=10>m?"0"+m:m;return a+"-"+m+"-"+d}function c(a,b,c){a=(new Date(a,b,c,0,0,0,0)).getDay();0==a?a=6:a--;return a}function r(a,b){for(var c=28;0<b+1&&13>b+1&&0<a&&32768>
a&&0<c+1&&c+1<=(new Date(a,b+1,0)).getDate();)c++;return c}function B(a,b){!1===a&&(a=0);var c=g.data("currDate"),e=g.data("initDate"),j;j=12*(e.getFullYear()-c.getFullYear());j-=c.getMonth()+1;j+=e.getMonth();if(!0===b){if(j<parseInt(a)-1)return!0}else if(j>=0-parseInt(a))return!0;return!1}var g=$(this);g.attr("id","zabuto_calendar_"+Math.floor(99999*Math.random()).toString(36));g.data("initYear",e.year);g.data("initMonth",e.month);g.data("monthLabels",e.month_labels);g.data("weekStartsOn",e.weekstartson);
g.data("navIcons",e.nav_icon);g.data("dowLabels",e.dow_labels);g.data("showToday",e.today);g.data("showDays",e.show_days);g.data("showPrevious",e.show_previous);g.data("showNext",e.show_next);g.data("cellBorder",e.cell_border);g.data("ajaxSettings",e.ajax);g.data("legendList",e.legend);g.data("actionFunction",e.action);g.data("actionNavFunction",e.action_nav);g.data("first",e.first);g.data("dblclickFunction",e.dblclick);var j=parseInt(g.data("initYear")),q=parseInt(g.data("initMonth"))-1,j=new Date(j,
q,1,0,0,0,0);g.data("initDate",j);q=!0===g.data("cellBorder")?" table-bordered":"";$tableObj=$('<table class="table'+q+'"></table>');$tableObj=b(g,$tableObj,j.getFullYear(),j.getMonth());var j=g,v=$('<div class="legend" id="'+j.attr("id")+'_legend"></div>'),j=j.data("legendList");"object"==typeof j&&0<j.length&&$(j).each(function(a,b){if("object"==typeof b&&"type"in b){var c="";"label"in b&&(c=b.label);switch(b.type){case "text":if(""!==c){var e="";"badge"in b&&(e='<span class="badge '+("undefined"===
typeof b.classname?"badge-event":b.classname)+'">'+b.badge+"</span> ");v.append('<span class="legend-'+b.type+'">'+e+c+"</span>")}break;case "block":""!==c&&(c="<span>"+c+"</span>");v.append('<span class="legend-'+b.type+'"><ul class="legend"><li class="'+("undefined"===typeof b.classname?"event":"event-styled "+b.classname)+'"></li></u>'+c+"</span>");break;case "list":if("list"in b&&"object"==typeof b.list&&0<b.list.length){var g=$('<ul class="legend"></u>');$(b.list).each(function(a,b){g.append('<li class="'+
b+'"></li>')});v.append(g)}break;case "spacer":v.append('<span class="legend-'+b.type+'"> </span>')}}});$legendObj=v;j=$('<div class="zabuto_calendar" id="'+g.attr("id")+'"></div>');j.append($tableObj);j.append($legendObj);g.append(j)});return this};$.fn.zabuto_calendar_defaults=function(){var b=new Date,e=b.getFullYear(),b=b.getMonth()+1;return{language:!1,year:e,month:b,show_previous:!0,show_next:!0,cell_border:!1,today:!1,show_days:!0,weekstartson:1,nav_icon:!1,ajax:!1,legend:!1,action:!1,action_nav:!1}};
$.fn.zabuto_calendar_language=function(b){if("undefined"==typeof b||!1===b)b="en";switch(b.toLowerCase()){case "de":return{month_labels:"Januar Februar M\u00e4rz April Mai Juni Juli August September Oktober November Dezember".split(" "),dow_labels:"Mo Di Mi Do Fr Sa So".split(" ")};case "en":return{month_labels:"Jan. Feb. Mar. Apr. May June July Aug. Sept. Oct. Nov. Dec.".split(" "),dow_labels:"Mon Tue Wed Thu Fri Sat Sun".split(" ")};case "es":return{month_labels:"Enero Febrero Marzo Abril Mayo Junio Julio Agosto Septiembre Octubre Noviembre Diciembre".split(" "),
dow_labels:"Lu Ma Mi Ju Vi S\u00e1 Do".split(" ")};case "fr":return{month_labels:"Janvier F\u00e9vrier Mars Avril Mai Juin Juillet Ao\u00fbt Septembre Octobre Novembre D\u00e9cembre".split(" "),dow_labels:"Lun Mar Mer Jeu Ven Sam Dim".split(" ")};case "it":return{month_labels:"Gennaio Febbraio Marzo Aprile Maggio Giugno Luglio Agosto Settembre Ottobre Novembre Dicembre".split(" "),dow_labels:"Lun Mar Mer Gio Ven Sab Dom".split(" ")};case "nl":return{month_labels:"Januari Februari Maart April Mei Juni Juli Augustus September Oktober November December".split(" "),
dow_labels:"Ma Di Wo Do Vr Za Zo".split(" ")}}};
!function(b){var e={mode:"horizontal",slideSelector:"",infiniteLoop:!0,hideControlOnEnd:!1,speed:500,easing:null,slideMargin:0,startSlide:0,randomStart:!1,captions:!1,ticker:!1,tickerHover:!1,adaptiveHeight:!1,adaptiveHeightSpeed:500,video:!1,useCSS:!0,preloadImages:"visible",responsive:!0,touchEnabled:!0,swipeThreshold:50,oneToOneTouch:!0,preventDefaultSwipeX:!0,preventDefaultSwipeY:!1,pager:!0,pagerType:"full",pagerShortSeparator:" / ",pagerSelector:null,buildPager:null,pagerCustom:null,controls:!0,
nextText:"Next",prevText:"Prev",nextSelector:null,prevSelector:null,autoControls:!1,startText:"Start",stopText:"Stop",autoControlsCombine:!1,autoControlsSelector:null,auto:!1,pause:4E3,autoStart:!0,autoDirection:"next",autoHover:!1,autoDelay:0,minSlides:1,maxSlides:1,moveSlides:0,slideWidth:0,onSliderLoad:function(){},onSlideBefore:function(){},onSlideAfter:function(){},onSlideNext:function(){},onSlidePrev:function(){}};b.fn.bxSlider=function(u){if(0==this.length)return this;if(1<this.length)return this.each(function(){b(this).bxSlider(u)}),
this;var a={},c=this,r=b(window).width(),B=b(window).height(),g=function(){a.settings=b.extend({},e,u);a.settings.slideWidth=parseInt(a.settings.slideWidth);a.children=c.children(a.settings.slideSelector);a.children.length<a.settings.minSlides&&(a.settings.minSlides=a.children.length);a.children.length<a.settings.maxSlides&&(a.settings.maxSlides=a.children.length);a.settings.randomStart&&(a.settings.startSlide=Math.floor(Math.random()*a.children.length));a.active={index:a.settings.startSlide};a.carousel=
1<a.settings.minSlides||1<a.settings.maxSlides;a.carousel&&(a.settings.preloadImages="all");a.minThreshold=a.settings.minSlides*a.settings.slideWidth+(a.settings.minSlides-1)*a.settings.slideMargin;a.maxThreshold=a.settings.maxSlides*a.settings.slideWidth+(a.settings.maxSlides-1)*a.settings.slideMargin;a.working=!1;a.controls={};a.interval=null;a.animProp="vertical"==a.settings.mode?"top":"left";var l;if(l=a.settings.useCSS)if(l="fade"!=a.settings.mode)a:{l=document.createElement("div");var t=["WebkitPerspective",
"MozPerspective","OPerspective","msPerspective"],f;for(f in t)if(void 0!==l.style[t[f]]){l=(a.cssPrefix=t[f].replace("Perspective","").toLowerCase(),a.animProp="-"+a.cssPrefix+"-transform",!0);break a}l=!1}a.usingCSS=l;"vertical"==a.settings.mode&&(a.settings.maxSlides=a.settings.minSlides);c.data("origStyle",c.attr("style"));c.children(a.settings.slideSelector).each(function(){b(this).data("origStyle",b(this).attr("style"))});c.wrap('<div class="bx-wrapper"><div class="bx-viewport"></div></div>');
a.viewport=c.parent();a.loader=b('<div class="bx-loading" />');a.viewport.prepend(a.loader);c.css({width:"horizontal"==a.settings.mode?100*a.children.length+215+"%":"auto",position:"relative"});a.usingCSS&&a.settings.easing?c.css("-"+a.cssPrefix+"-transition-timing-function",a.settings.easing):a.settings.easing||(a.settings.easing="swing");o();a.viewport.css({width:"100%",overflow:"hidden",position:"relative"});a.viewport.parent().css({maxWidth:v()});a.settings.pager||a.viewport.parent().css({margin:"0 auto 0px"});
a.children.css({"float":"horizontal"==a.settings.mode?"left":"none",listStyle:"none",position:"relative"});a.children.css("width",k());"horizontal"==a.settings.mode&&0<a.settings.slideMargin&&a.children.css("marginRight",a.settings.slideMargin);"vertical"==a.settings.mode&&0<a.settings.slideMargin&&a.children.css("marginBottom",a.settings.slideMargin);"fade"==a.settings.mode&&(a.children.css({position:"absolute",zIndex:0,display:"none"}),a.children.eq(a.settings.startSlide).css({zIndex:50,display:"block"}));
a.controls.el=b('<div class="bx-controls" />');a.settings.captions&&a.children.each(function(){var a=b(this).find("img:first").attr("title");void 0!=a&&(""+a).length&&b(this).append('<div class="bx-caption"><span>'+a+"</span></div>")});a.active.last=a.settings.startSlide==h()-1;a.settings.video&&c.fitVids();f=a.children.eq(a.settings.startSlide);"all"==a.settings.preloadImages&&(f=a.children);a.settings.ticker?a.settings.pager=!1:(a.settings.pager&&(a.settings.pagerCustom?a.pagerEl=b(a.settings.pagerCustom):
(a.pagerEl=b('<div class="bx-pager" />'),a.settings.pagerSelector?b(a.settings.pagerSelector).html(a.pagerEl):a.controls.el.addClass("bx-has-pager").append(a.pagerEl),p()),a.pagerEl.delegate("a","click",K)),a.settings.controls&&(a.controls.next=b('<a class="bx-next" href="">'+a.settings.nextText+"</a>"),a.controls.prev=b('<a class="bx-prev" href="">'+a.settings.prevText+"</a>"),a.controls.next.bind("click",n),a.controls.prev.bind("click",I),a.settings.nextSelector&&b(a.settings.nextSelector).append(a.controls.next),
a.settings.prevSelector&&b(a.settings.prevSelector).append(a.controls.prev),a.settings.nextSelector||a.settings.prevSelector||(a.controls.directionEl=b('<div class="bx-controls-direction" />'),a.controls.directionEl.append(a.controls.prev).append(a.controls.next),a.controls.el.addClass("bx-has-controls-direction").append(a.controls.directionEl))),a.settings.auto&&a.settings.autoControls&&(a.controls.start=b('<div class="bx-controls-auto-item"><a class="bx-start" href="">'+a.settings.startText+"</a></div>"),
a.controls.stop=b('<div class="bx-controls-auto-item"><a class="bx-stop" href="">'+a.settings.stopText+"</a></div>"),a.controls.autoEl=b('<div class="bx-controls-auto" />'),a.controls.autoEl.delegate(".bx-start","click",w),a.controls.autoEl.delegate(".bx-stop","click",x),a.settings.autoControlsCombine?a.controls.autoEl.append(a.controls.start):a.controls.autoEl.append(a.controls.start).append(a.controls.stop),a.settings.autoControlsSelector?b(a.settings.autoControlsSelector).html(a.controls.autoEl):
a.controls.el.addClass("bx-has-controls-auto").append(a.controls.autoEl),y(a.settings.autoStart?"stop":"start")),(a.settings.controls||a.settings.autoControls||a.settings.pager)&&a.viewport.after(a.controls.el));var g=j,r=f.find("img, iframe").length;if(0==r)g();else{var q=0;f.find("img, iframe").each(function(){b(this).one("load",function(){++q==r&&g()}).each(function(){this.complete&&b(this).load()})})}},j=function(){if(a.settings.infiniteLoop&&"fade"!=a.settings.mode&&!a.settings.ticker){var l=
"vertical"==a.settings.mode?a.settings.minSlides:a.settings.maxSlides,t=a.children.slice(0,l).clone().addClass("bx-clone"),l=a.children.slice(-l).clone().addClass("bx-clone");c.append(t).prepend(l)}a.loader.remove();E();"vertical"==a.settings.mode&&(a.settings.adaptiveHeight=!0);a.viewport.height(q());c.redrawSlider();a.settings.onSliderLoad(a.active.index);a.initialized=!0;a.settings.responsive&&b(window).bind("resize",F);a.settings.auto&&a.settings.autoStart&&(0<a.settings.autoDelay?setTimeout(c.startAuto,
a.settings.autoDelay):c.startAuto(),a.settings.autoHover&&c.hover(function(){a.interval&&(c.stopAuto(!0),a.autoPaused=!0)},function(){a.autoPaused&&(c.startAuto(!0),a.autoPaused=null)}));a.settings.ticker&&(t=0,"next"==a.settings.autoDirection?c.append(a.children.clone().addClass("bx-clone")):(c.prepend(a.children.clone().addClass("bx-clone")),t=a.children.first().position(),t="horizontal"==a.settings.mode?-t.left:-t.top),f(t,"reset",0),a.settings.pager=!1,a.settings.controls=!1,a.settings.autoControls=
!1,a.settings.tickerHover&&!a.usingCSS&&a.viewport.hover(function(){c.stop()},function(){var l=0;a.children.each(function(){l=l+("horizontal"==a.settings.mode?b(this).outerWidth(true):b(this).outerHeight(true))});var t=a.settings.speed/l*(l-Math.abs(parseInt(c.css("horizontal"==a.settings.mode?"left":"top"))));C(t)}),C());a.settings.pager&&z(a.settings.startSlide);a.settings.controls&&D();a.settings.touchEnabled&&!a.settings.ticker&&(a.touch={start:{x:0,y:0},end:{x:0,y:0}},a.viewport.bind("touchstart",
J))},q=function(){var l=0,c=b();if("vertical"==a.settings.mode||a.settings.adaptiveHeight)if(a.carousel){var f=1==a.settings.moveSlides?a.active.index:a.active.index*A(),c=a.children.eq(f);for(i=1;i<=a.settings.maxSlides-1;i++)c=f+i>=a.children.length?c.add(a.children.eq(i-1)):c.add(a.children.eq(f+i))}else c=a.children.eq(a.active.index);else c=a.children;return"vertical"==a.settings.mode?(c.each(function(){l+=b(this).outerHeight()}),0<a.settings.slideMargin&&(l+=a.settings.slideMargin*(a.settings.minSlides-
1))):l=Math.max.apply(Math,c.map(function(){return b(this).outerHeight(!1)}).get()),l},v=function(){return"100%"},k=function(){var l=a.settings.slideWidth,b=a.viewport.width();return 0==a.settings.slideWidth||a.settings.slideWidth>b&&!a.carousel||"vertical"==a.settings.mode?l=b:1<a.settings.maxSlides&&"horizontal"==a.settings.mode&&(b>a.maxThreshold||b<a.minThreshold&&(l=(b-a.settings.slideMargin*(a.settings.minSlides-1))/a.settings.minSlides)),l},o=function(){var b=1;"horizontal"==a.settings.mode&&
0<a.settings.slideWidth?a.viewport.width()<a.minThreshold?b=a.settings.minSlides:a.viewport.width()>a.maxThreshold?b=a.settings.maxSlides:(b=a.children.first().width(),b=Math.floor(a.viewport.width()/b)):"vertical"==a.settings.mode&&(b=a.settings.minSlides);return b},h=function(){var b=0;if(0<a.settings.moveSlides)if(a.settings.infiniteLoop)b=a.children.length/A();else for(var c=0,f=0;c<a.children.length;)++b,c=f+o(),f+=a.settings.moveSlides<=o()?a.settings.moveSlides:o();else b=Math.ceil(a.children.length/
o());return b},A=function(){return 0<a.settings.moveSlides&&a.settings.moveSlides<=o()?a.settings.moveSlides:o()},E=function(){if(a.children.length>a.settings.maxSlides&&a.active.last&&!a.settings.infiniteLoop)if("horizontal"==a.settings.mode){var b=a.children.last(),c=b.position();f(-(c.left-(a.viewport.width()-b.width())),"reset",0)}else"vertical"==a.settings.mode&&(c=a.children.eq(a.children.length-a.settings.minSlides).position(),f(-c.top,"reset",0));else c=a.children.eq(a.active.index*A()).position(),
a.active.index==h()-1&&(a.active.last=!0),void 0!=c&&("horizontal"==a.settings.mode?f(-c.left,"reset",0):"vertical"==a.settings.mode&&f(-c.top,"reset",0))},f=function(b,e,g,h){if(a.usingCSS)b="vertical"==a.settings.mode?"translate3d(0, "+b+"px, 0)":"translate3d("+b+"px, 0, 0)",c.css("-"+a.cssPrefix+"-transition-duration",g/1E3+"s"),"slide"==e?(c.css(a.animProp,b),c.bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){c.unbind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd");
s()})):"reset"==e?c.css(a.animProp,b):"ticker"==e&&(c.css("-"+a.cssPrefix+"-transition-timing-function","linear"),c.css(a.animProp,b),c.bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){c.unbind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd");f(h.resetValue,"reset",0);C()}));else{var k={};k[a.animProp]=b;"slide"==e?c.animate(k,g,a.settings.easing,function(){s()}):"reset"==e?c.css(a.animProp,b):"ticker"==e&&c.animate(k,speed,"linear",function(){f(h.resetValue,
"reset",0);C()})}},p=function(){for(var c="",f=h(),e=0;f>e;e++){var g="";a.settings.buildPager&&b.isFunction(a.settings.buildPager)?(g=a.settings.buildPager(e),a.pagerEl.addClass("bx-custom-pager")):(g=e+1,a.pagerEl.addClass("bx-default-pager"));c+='<div class="bx-pager-item"><a href="" data-slide-index="'+e+'" class="bx-pager-link">'+g+"</a></div>"}a.pagerEl.html(c)},n=function(b){a.settings.auto&&c.stopAuto();c.goToNextSlide();b.preventDefault()},I=function(b){a.settings.auto&&c.stopAuto();c.goToPrevSlide();
b.preventDefault()},w=function(a){c.startAuto();a.preventDefault()},x=function(a){c.stopAuto();a.preventDefault()},K=function(l){a.settings.auto&&c.stopAuto();var f=b(l.currentTarget),f=parseInt(f.attr("data-slide-index"));f!=a.active.index&&c.goToSlide(f);l.preventDefault()},z=function(c){var f=a.children.length;return"short"==a.settings.pagerType?(1<a.settings.maxSlides&&(f=Math.ceil(a.children.length/a.settings.maxSlides)),a.pagerEl.html(c+1+a.settings.pagerShortSeparator+f),void 0):(a.pagerEl.find("a").removeClass("active"),
a.pagerEl.each(function(a,f){b(f).find("a").eq(c).addClass("active")}),void 0)},s=function(){if(a.settings.infiniteLoop){var b="";0==a.active.index?b=a.children.eq(0).position():a.active.index==h()-1&&a.carousel?b=a.children.eq((h()-1)*A()).position():a.active.index==a.children.length-1&&(b=a.children.eq(a.children.length-1).position());"horizontal"==a.settings.mode?f(-b.left,"reset",0):"vertical"==a.settings.mode&&f(-b.top,"reset",0)}a.working=!1;a.settings.onSlideAfter(a.children.eq(a.active.index),
a.oldIndex,a.active.index)},y=function(b){a.settings.autoControlsCombine?a.controls.autoEl.html(a.controls[b]):(a.controls.autoEl.find("a").removeClass("active"),a.controls.autoEl.find("a:not(.bx-"+b+")").addClass("active"))},D=function(){1==h()?(a.controls.prev.addClass("disabled"),a.controls.next.addClass("disabled")):!a.settings.infiniteLoop&&a.settings.hideControlOnEnd&&(0==a.active.index?(a.controls.prev.addClass("disabled"),a.controls.next.removeClass("disabled")):a.active.index==h()-1?(a.controls.next.addClass("disabled"),
a.controls.prev.removeClass("disabled")):(a.controls.prev.removeClass("disabled"),a.controls.next.removeClass("disabled")))},C=function(b){speed=b?b:a.settings.speed;var b={left:0,top:0},e={left:0,top:0};"next"==a.settings.autoDirection?b=c.find(".bx-clone").first().position():e=a.children.first().position();f("horizontal"==a.settings.mode?-b.left:-b.top,"ticker",speed,{resetValue:"horizontal"==a.settings.mode?-e.left:-e.top})},J=function(b){a.working?b.preventDefault():(a.touch.originalPos=c.position(),
b=b.originalEvent,a.touch.start.x=b.changedTouches[0].pageX,a.touch.start.y=b.changedTouches[0].pageY,a.viewport.bind("touchmove",G),a.viewport.bind("touchend",H))},G=function(b){var c=b.originalEvent,e=Math.abs(c.changedTouches[0].pageX-a.touch.start.x),g=Math.abs(c.changedTouches[0].pageY-a.touch.start.y);if(3*e>g&&a.settings.preventDefaultSwipeX?b.preventDefault():3*g>e&&a.settings.preventDefaultSwipeY&&b.preventDefault(),"fade"!=a.settings.mode&&a.settings.oneToOneTouch)b=0,"horizontal"==a.settings.mode?
(c=c.changedTouches[0].pageX-a.touch.start.x,b=a.touch.originalPos.left+c):(c=c.changedTouches[0].pageY-a.touch.start.y,b=a.touch.originalPos.top+c),f(b,"reset",0)},H=function(b){a.viewport.unbind("touchmove",G);var e=b.originalEvent,b=0;(a.touch.end.x=e.changedTouches[0].pageX,a.touch.end.y=e.changedTouches[0].pageY,"fade"==a.settings.mode)?(e=Math.abs(a.touch.start.x-a.touch.end.x),e>=a.settings.swipeThreshold&&(a.touch.start.x>a.touch.end.x?c.goToNextSlide():c.goToPrevSlide(),c.stopAuto())):(e=
0,"horizontal"==a.settings.mode?(e=a.touch.end.x-a.touch.start.x,b=a.touch.originalPos.left):(e=a.touch.end.y-a.touch.start.y,b=a.touch.originalPos.top),!a.settings.infiniteLoop&&(0==a.active.index&&0<e||a.active.last&&0>e)?f(b,"reset",200):Math.abs(e)>=a.settings.swipeThreshold?(0>e?c.goToNextSlide():c.goToPrevSlide(),c.stopAuto()):f(b,"reset",200));a.viewport.unbind("touchend",H)},F=function(){var a=b(window).width(),e=b(window).height();(r!=a||B!=e)&&(r=a,B=e,c.redrawSlider())};return c.goToSlide=
function(e,g){if(!a.working&&a.active.index!=e)if(a.working=!0,a.oldIndex=a.active.index,a.active.index=0>e?h()-1:e>=h()?0:e,a.settings.onSlideBefore(a.children.eq(a.active.index),a.oldIndex,a.active.index),"next"==g?a.settings.onSlideNext(a.children.eq(a.active.index),a.oldIndex,a.active.index):"prev"==g&&a.settings.onSlidePrev(a.children.eq(a.active.index),a.oldIndex,a.active.index),a.active.last=a.active.index>=h()-1,a.settings.pager&&z(a.active.index),a.settings.controls&&D(),"fade"==a.settings.mode)a.settings.adaptiveHeight&&
a.viewport.height()!=q()&&a.viewport.animate({height:q()},a.settings.adaptiveHeightSpeed),a.children.filter(":visible").fadeOut(a.settings.speed).css({zIndex:0}),a.children.eq(a.active.index).css("zIndex",51).fadeIn(a.settings.speed,function(){b(this).css("zIndex",50);s()});else{a.settings.adaptiveHeight&&a.viewport.height()!=q()&&a.viewport.animate({height:q()},a.settings.adaptiveHeightSpeed);var k=0,j={left:0,top:0};if(!a.settings.infiniteLoop&&a.carousel&&a.active.last)if("horizontal"==a.settings.mode)var n=
a.children.eq(a.children.length-1),j=n.position(),k=a.viewport.width()-n.outerWidth();else j=a.children.eq(a.children.length-a.settings.minSlides).position();else a.carousel&&a.active.last&&"prev"==g?(j=1==a.settings.moveSlides?a.settings.maxSlides-A():(h()-1)*A()-(a.children.length-a.settings.maxSlides),n=c.children(".bx-clone").eq(j),j=n.position()):"next"==g&&0==a.active.index?(j=c.find("> .bx-clone").eq(a.settings.maxSlides).position(),a.active.last=!1):0<=e&&(j=e*A(),j=a.children.eq(j).position());
"undefined"!=typeof j&&f("horizontal"==a.settings.mode?-(j.left-k):-j.top,"slide",a.settings.speed)}},c.goToNextSlide=function(){if(a.settings.infiniteLoop||!a.active.last){var b=parseInt(a.active.index)+1;c.goToSlide(b,"next")}},c.goToPrevSlide=function(){if(a.settings.infiniteLoop||0!=a.active.index){var b=parseInt(a.active.index)-1;c.goToSlide(b,"prev")}},c.startAuto=function(b){a.interval||(a.interval=setInterval(function(){"next"==a.settings.autoDirection?c.goToNextSlide():c.goToPrevSlide()},
a.settings.pause),a.settings.autoControls&&1!=b&&y("stop"))},c.stopAuto=function(b){a.interval&&(clearInterval(a.interval),a.interval=null,a.settings.autoControls&&1!=b&&y("start"))},c.getCurrentSlide=function(){return a.active.index},c.getSlideCount=function(){return a.children.length},c.redrawSlider=function(){a.children.add(c.find(".bx-clone")).outerWidth(k());a.viewport.css("height",q());a.settings.ticker||E();a.active.last&&(a.active.index=h()-1);a.active.index>=h()&&(a.active.last=!0);a.settings.pager&&
!a.settings.pagerCustom&&(p(),z(a.active.index))},c.destroySlider=function(){a.initialized&&(a.initialized=!1,b(".bx-clone",this).remove(),a.children.each(function(){void 0!=b(this).data("origStyle")?b(this).attr("style",b(this).data("origStyle")):b(this).removeAttr("style")}),void 0!=b(this).data("origStyle")?this.attr("style",b(this).data("origStyle")):b(this).removeAttr("style"),b(this).unwrap().unwrap(),a.controls.el&&a.controls.el.remove(),a.controls.next&&a.controls.next.remove(),a.controls.prev&&
a.controls.prev.remove(),a.pagerEl&&a.pagerEl.remove(),b(".bx-caption",this).remove(),a.controls.autoEl&&a.controls.autoEl.remove(),clearInterval(a.interval),a.settings.responsive&&b(window).unbind("resize",F))},c.reloadSlider=function(a){void 0!=a&&(u=a);c.destroySlider();g()},g(),this}}(jQuery);var defaultPhotoSrc="/theme/App/img/dashboard_default.jpg",isSlideShowEnabled=!1,removeImgIcon='<img src="/theme/App/img/close.gif" alt="X" class="remove_img hide" />';
$(document).ready(function(){$("#UserIsDashboardSlideshowEnabled").is(":checked")&&(isSlideShowEnabled=!0,showSlideShow());initDashboardPhotoUploader()});$(document).on("change","#UserIsDashboardSlideshowEnabled",function(){handleSlideShowEnabledStatusChange($(this).is(":checked"))});$(document).on("click","#dashboard_image_list li",function(){$("#dashboard_image_list").hasClass("all_selected")||($("#dashboard_image_list li").removeClass("selected"),$(this).addClass("selected"))});
var $uploadBtn,uploader;
function initDashboardPhotoUploader(){$uploadBtn=$("#bootstrapped-fine-uploader");$saveBtn=$("#save_image_settings");uploader=new qq.FineUploaderBasic({button:$uploadBtn[0],debug:!1,multiple:!1,request:{endpoint:"/user/dashboard/uploadPhoto"},validation:{allowedExtensions:["jpeg","jpg","gif","png"]},callbacks:{onError:function(b,a,c){showDashboardPhotoUploadError(c);$uploadBtn.show()},onSubmit:function(){$saveBtn.prop("disabled",!0);$uploadBtn.hide()},onUpload:function(b,a){showDashboardPhotoUploadLoadingMessage("Uploading \u201c"+a+
"\u201d ")},onProgress:function(b,a,c,e){c<e&&(b=Math.round(100*(c/e))+"% of "+Math.round(e/1024)+" kB",showDashboardPhotoUploadLoadingMessage("Uploading \u201c"+a+"\u201d "+b))},onComplete:function(u,a,c){$uploadBtn.show();$saveBtn.prop("disabled",!1);c.success?(a='<div class="crop_area"><img src="'+c.fileUrl+'" alt="Uploaded photo" /></div>',b=bootbox.dialog({closeButton:!1,message:a+'<div>To make adjustments, please drag around the white rectangle. When you are happy with the photo, click "Accept" button.</div>',
title:"Crop Image",animate:!1,buttons:{success:{label:"Accept",className:"accept btn-success",callback:function(){var a=e.getSelection(!1);$.ajax({dataType:"json",type:"POST",url:"/user/dashboard/cropPhoto",data:{x1:a.x1,y1:a.y1,w:a.width,h:a.height,fileName:c.fileName},success:function(a){hideDashboardPhotoUploadMessage();var b=(new Date).getTime(),b=a.fileUrl+"?"+b;$("#hidden_images_container").append('<input type="hidden" id="hidden_img_'+u+'" name="data[User][images][]" value="'+a.fileName+'" />');
$("#dashboard_image_list").append('<li class="tmp" data-id="'+u+'"><img src="'+b+'" />'+removeImgIcon+"</li>");$("#dashboard_image_list").animate({scrollTop:$("#dashboard_image_list li:last").offset().top},100);handleSlideShowEnabledStatusChange()}})}},cancel:{label:"Cancel",className:"btn-default",callback:function(){uploader.cancelAll();hideDashboardPhotoUploadMessage()}}}}),b.find(".modal-footer .btn-success").attr("disabled","disabled"),setTimeout(function(){var a=b,u=a.find(".bootbox-body img");
srcWidth=c.imageWidth;srcHeight=c.imageHeight;var g=["58","32"],j=g[0],g=g[1],q=Math.min(Math.floor(srcWidth/j),Math.floor(srcHeight/g));e=u.imgAreaSelect({parent:".bootbox",autoHide:!1,mustMatch:!0,handles:!0,instance:!0,imageWidth:srcWidth,imageHeight:srcHeight,aspectRatio:"58:32",x1:0,y1:0,x2:q*j,y2:q*g,onInit:function(){a.find(".modal-footer .btn-success").removeAttr("disabled")},onSelectStart:function(){a.find(".modal-footer .btn-success").removeAttr("disabled")},onCancelSelection:function(){a.find(".modal-footer .btn-success").attr("disabled",
"disabled")}})},500)):c.error?showDashboardPhotoUploadError("Error with \u201c"+a+"\u201d: "+c.error):showDashboardPhotoUploadError("Failed to upload photo.")}}});var b,e}$messages=$("#uploadmessages");$loadingImg='<img src="/img/loading.gif" /> ';function showDashboardPhotoUploadError(b){$messages.html(b);$messages.removeClass("success").addClass("error").show()}
function showDashboardPhotoUploadLoadingMessage(b){$messages.html($loadingImg+b);$messages.removeClass("error").addClass("success").show()}function hideDashboardPhotoUploadMessage(){$messages.html("").hide()}var dashboardSlider=null,slideShowOptions={auto:!1,minSlides:1,maxSlides:1,pager:!1,speed:500,pause:3E3,autoHover:!0,mode:"fade",controls:!1};
function showSlideShow(){$("#dashboard_image_container").addClass("hide");$("#dashboard_slideshow_container").removeClass("hide");slideShowOptions.auto=1<$(".bxslider img").length?!0:!1;dashboardSlider=$(".bxslider").bxSlider(slideShowOptions)}
$(document).on("click",".my_photos .setting",function(){$("#dashboard_image_container").removeClass("hide");$("#dashboard_slideshow_container").addClass("hide");$("#settings_container").removeClass("hide");handleSlideShowEnabledStatusChange(isSlideShowEnabled);styleImageListScrollBar()});function styleImageListScrollBar(){$(".slim-scroll").slimScroll({color:"#838886",railColor:"#646a68",size:"8px",height:"130px",railVisible:!0,disableFadeOut:!0})}
function resetDashboardImageSettingsForm(){$("#hidden_images_container").html("");$("#deleted_photos_container").html("");!0===isSlideShowEnabled?$("#UserIsDashboardSlideshowEnabled").prop("checked",!0):$("#UserIsDashboardSlideshowEnabled").prop("checked",!1);handleSlideShowEnabledStatusChange(isSlideShowEnabled);$("#dashboard_image_list li").removeClass("selected").removeClass("hidden");if(0<$("#UserDefaultPhotoId").val()){var b=$("#UserDefaultPhotoId").val();$("#dashboard_image_list li").each(function(){$(this).find("img").attr("data-photo_id")===
b&&$(this).addClass("selected")})}hideDashboardPhotoUploadMessage()}function handleSlideShowEnabledStatusChange(b){void 0===b&&(b=$("#UserIsDashboardSlideshowEnabled").is(":checked"));!0===b?($("#select_default_img_msg").addClass("hide"),$("#dashboard_image_list").addClass("all_selected")):(0<$("#dashboard_image_list li").not(".hidden").length?$("#select_default_img_msg").removeClass("hide"):$("#select_default_img_msg").addClass("hide"),$("#dashboard_image_list").removeClass("all_selected"))}
$(document).on("reset","#user_dashboard_images_form",function(){$("#dashboard_image_list li.tmp").remove();resetDashboardImageSettingsForm();reloadMyPhotos();uploader.cancelAll();hideDashboardPhotoUploadMessage();$("#save_image_settings").prop("disabled",!1);$uploadBtn.show()});
$(document).on("click","#save_image_settings",function(){var b=$(this),e=Ladda.create(this),u=$("#dashboard_image_list li.selected img"),a=u.attr("data-photo_id");0<a?($("#UserDefaultPhotoId").val(a),$("#UserDefaultPhoto").val("")):($("#UserDefaultPhoto").val(u.attr("src")),$("#UserDefaultPhotoId").val(0));$.ajax({method:"POST",url:"/user/dashboard/saveImageSettings",data:$("#user_dashboard_images_form").serialize(),dataType:"json",beforeSend:function(){b.prop("disabled",true);e.start()},success:function(a){b.prop("disabled",
false);e.stop();if(a.success===true){isSlideShowEnabled=$("#UserIsDashboardSlideshowEnabled").is(":checked");a.deletedPhotos&&$("#dashboard_image_list li.hidden").remove();resetDashboardImageSettingsForm();if(a.photos){$("#dashboard_image_list li.tmp").remove();$(a.photos).each(function(b,e){var j=a.defaultPhotoId>0&&a.defaultPhotoId===e.id?"selected":"";$("#dashboard_image_list").append('<li class="'+j+'"><img class="photo" data-photo_id="'+e.id+'" src="'+e.src+'" />'+removeImgIcon+"</li>")})}if(a.photos||
a.deletedPhotos){var r=$("#dashboard_image_list").clone();if(r.find("li").length>0){r.find("li").removeClass("selected");r.find("img.remove_img").remove();$(".bxslider").html(r.html())}else $(".bxslider").html('<li><img src="'+defaultPhotoSrc+'" /></li><li><img src="/theme/App/img/dashboard_default2.jpg" /></li>')}r=$("#dashboard_image_list li").length>0?$("#dashboard_image_list li.selected").length>0?$("#dashboard_image_list li.selected img").attr("src"):$("#dashboard_image_list li:first img").attr("src"):
defaultPhotoSrc;$("#dashboard_image_container img").attr("src",r);$("#chat_notification_container").is(":visible")&&showBlurDashboardImages();reloadMyPhotos()}}})});
function reloadMyPhotos(){!0===isSlideShowEnabled?($("#dashboard_image_container").addClass("hide"),$("#dashboard_slideshow_container").removeClass("hide"),slideShowOptions.auto=1<$(".bxslider img").length?!0:!1,null===dashboardSlider?dashboardSlider=$(".bxslider").bxSlider(slideShowOptions):dashboardSlider.reloadSlider()):($("#dashboard_slideshow_container").addClass("hide"),$("#dashboard_image_container").removeClass("hide"));$("#settings_container").addClass("hide")}
$(document).on("mouseover","#dashboard_image_list li",function(){$(this).find("img.remove_img").removeClass("hide")});$(document).on("mouseout","#dashboard_image_list li",function(){$(this).find("img.remove_img").addClass("hide")});
$(document).on("click","#dashboard_image_list li img.remove_img",function(){var b=$(this).parent("li");if(b.hasClass("tmp")){var e=b.attr("data-id");$("#hidden_img_"+e).remove();b.remove()}else b.addClass("hidden"),b=b.find("img.photo").attr("data-photo_id"),$("#deleted_photos_container").append('<input type="hidden" name="data[User][deleted_photos][]" value="'+b+'" />');handleSlideShowEnabledStatusChange()});
$(document).on("click",".my_photos #chat_notification_container",function(){var b=$(this).find(".name").attr("data-id");jqac.arrowchat.chatWith(b)});