var EVENT_TYPE_PUBLIC=1,EVENT_TYPE_PRIVATE=2,EVENT_TYPE_SITE=3,ORDINARY_EVENT=0,VIRTUAL_EVENT=1,REPEAT_MODE_DAILY=1,REPEAT_MODE_WEEKLY=2,REPEAT_MODE_MONTHLY=3,REPEAT_MODE_YEARLY=4,REPEAT_END_NEVER=1,REPEAT_END_AFTER=2,REPEAT_END_DATE=3,defaultDateFormat="mm/dd/yy",defaultTimeFormat="g:i A",dateObj=getUserNow(),defaultCalendarDate=new Date(dateObj.getFullYear(),dateObj.getMonth(),dateObj.getDate(),0,0,0,0);
$(document).ready(function(){$("#event_type_help").popover({placement:"right",trigger:"hover focus",title:"Event type",html:!0,container:"#event_type_popover"});$.datepicker.setDefaults({dateFormat:defaultDateFormat});$("input#EventTags").tagsinput({confirmKeys:[13,32]});var b=$("#eventWizard").wizard();b.on("change",function(b,e){if("undefined"!=typeof e&&"next"==e.direction&&(2===e.step&&handleCountryZipValidation($("#EventCountry")),!$(form).valid()))return!1});b.on("finished",function(){$(form).valid()&&
($(form).submit(),b.find("button").attr("disabled","disabled"))});b.on("changed",function(){window.scrollTo(0,0)});$("#EventStartDate, #EventStartDateTime, #EventUptoDate").datepicker({defaultDate:defaultCalendarDate});$("#EventEndDate").datepicker({minDate:new Date($("#EventStartDateTime").val())});initEventPhotoUploader();$.validator.addMethod("onedayEndTimeValid",function(){var b=$("#EventEndTime").val(),e=$("#EventStartTime").val();return compareTime(b,e)},"Please enter time greater than start time");
$.validator.addMethod("repeatEndTimeValid",function(){var b=$("#repeat_event_mode_time .time.end").val(),e=$("#repeat_event_mode_time .time.start").val(),a=$("#EventUptoDate").datepicker("getDate"),d=$("#EventStartDateTime").datepicker("getDate"),b=compareTime(b,e);return d>a?!1:d<a?!0:b},"Please enter time greater than start time");$.validator.addMethod("repeatStartTimeValid",function(){return $("#EventUptoTimeonly").valid()},"Please enter time less than end time");0<$("#is_full_day").length&&!$("#is_full_day").prop("checked")&&
$("#EventUptoTimeonly").rules("add",{required:!0,regex:/(([0-9]|[1][012])\:[03]0\s(a|p)m)$/i,repeatEndTimeValid:!0,messages:{regex:"Please enter a valid end time",required:"Please enter an end time for the event"}});$(".repeat_radio").first().is(":checked")&&$("#EventEndTime").rules("add",{onedayEndTimeValid:!0,messages:{required:"Please enter an end time for the event"}})});
function getHrMinFromTimeStr(b){console.log("getHrMinFromTimeStr");var c=b.split(" "),b=c[1],e=c[0].split(":"),c=parseInt(e[0]),e=parseInt(e[1]),a;12===c?(a=0,c="am"===b?0:12):a="am"===b?0:12;b=[];b.hour=c+a;b.minute=e;return b}
$(document).on("change","#EventEventType",function(){var b=parseInt($(this).val());b===EVENT_TYPE_PRIVATE?$("#disease_field_group").addClass("hide"):$("#disease_field_group").removeClass("hide");b===EVENT_TYPE_SITE?($("#event_wizard_step3_common").addClass("hide"),$("#event_wizard_step3_sitewide").removeClass("hide")):($("#event_wizard_step3_common").removeClass("hide"),$("#event_wizard_step3_sitewide").addClass("hide"))});
$(document).on("change","#eventForm .repeat_radio",function(){"1"===$(this).val()?($("#eventForm #repeat_event_fields").removeClass("hide"),$("#eventForm #one_day_event_fields").addClass("hide"),$("#EventEndTime").rules("remove","onedayEndTimeValid")):($("#eventForm #repeat_event_fields").addClass("hide"),$("#eventForm #one_day_event_fields").removeClass("hide"),$("#EventEndTime").rules("add",{onedayEndTimeValid:!0,messages:{required:"Please enter a valid end time"}}))});
$(document).on("change","#EventVirtualEvent",function(){console.log("$(this).val():",$(this).val());parseInt($(this).val())===VIRTUAL_EVENT?($("#online_event_fields").removeClass("hide"),$("#onsite_event_fields").addClass("hide")):parseInt($(this).val())===ORDINARY_EVENT?($("#online_event_fields").addClass("hide"),$("#onsite_event_fields").removeClass("hide")):($("#online_event_fields").addClass("hide"),$("#onsite_event_fields").addClass("hide"))});
$(document).on("click","#add_diagnosis_btn",function(){var b=$("#diagnosis_last_index").val(),c=parseInt(b)+1;$.ajax({type:"POST",url:"/event/add/getDiagnosisForm",data:{index:c},beforeSend:function(){},success:function(b){$("#diagnosis_form_container").append(b);$("#diagnosis_last_index").val(c)}})});$(document).on("focus",".disease_search",function(){initDiseaseAutoComplete(this,2)});
$(document).on("change","#EventRepeatMode",function(){$("#repeat_interval_fields").addClass("hide");switch(parseInt($(this).val())){case REPEAT_MODE_DAILY:$("#repeat_interval_fields").removeClass("hide");$("#interval_type").html("days");break;case REPEAT_MODE_WEEKLY:$("#repeat_interval_fields").removeClass("hide");$("#interval_type").html("weeks");break;case REPEAT_MODE_MONTHLY:$("#repeat_interval_fields").removeClass("hide");$("#interval_type").html("months");break;case REPEAT_MODE_YEARLY:$("#repeat_interval_fields").removeClass("hide"),
$("#interval_type").html("years")}});$(document).on("change",'[name="data[Event][repeat_end_type]"]',function(){$("#eventForm #EventRepeatOccurrences").attr("disabled","disabled").val("");$("#eventForm #EventEndDate").attr("disabled","disabled").val("");switch(parseInt($(this).val())){case REPEAT_END_AFTER:$("#eventForm #EventRepeatOccurrences").removeAttr("disabled");break;case REPEAT_END_DATE:$("#eventForm #EventEndDate").removeAttr("disabled")}});
function initEventPhotoUploader(){$uploadBtn=$("#bootstrapped-fine-uploader");$previewImg=$("#uploadPreview img#preview_image");$previewLoadingImg=$("#uploadPreview img#loading_img");var b=new qq.FineUploaderBasic({button:$uploadBtn[0],debug:!1,multiple:!1,request:{endpoint:"/event/add/photo"},validation:{acceptFiles:"image/*",allowedExtensions:app.imageExtensions,minSizeLimit:"1024",sizeLimit:"5242880"},callbacks:{onError:function(a,b,c){showUploadError(c);$uploadBtn.show();$("#btn_event_wizard_step1").prop("disabled",
!1)},onSubmit:function(){$uploadBtn.hide()},onUpload:function(a,b){showUploadLoadingMessage("Uploading \u201c"+b+"\u201d ");$("#btn_event_wizard_step1").prop("disabled",!0)},onProgress:function(a,b,c,e){c<e&&(a=Math.round(100*(c/e))+"% of "+Math.round(e/1024)+" kB",showUploadLoadingMessage("Uploading \u201c"+b+"\u201d "+a))},onComplete:function(a,d,f){$("#btn_event_wizard_step1").prop("disabled",!1);$uploadBtn.show();f.success?(hideUploadMessage(),a='<div class="crop_area"><img src="'+f.fileUrl+'" alt="Uploaded photo" /></div>',
c=bootbox.dialog({closeButton:!1,message:a+'<div>To make adjustments, please drag around the white rectangle. When you are happy with the photo, click "Accept" button.</div>',title:"Crop Image",animate:!1,buttons:{success:{label:"Accept",className:"accept btn-success",callback:function(){var a=e.getSelection(!1);$.ajax({dataType:"json",type:"POST",url:"/event/add/cropImage",beforeSend:function(){$previewLoadingImg.removeClass("hide");$previewImg.hide()},data:{x1:a.x1,y1:a.y1,w:a.width,h:a.height,
fileName:f.fileName},success:function(a){$("#EventImage").val(a.fileName);var b=(new Date).getTime();$previewImg.attr("src",a.fileUrl+"?"+b);$previewImg.load(function(){$previewLoadingImg.addClass("hide");$previewImg.fadeIn()})}})}},cancel:{label:"Cancel",className:"btn-default",callback:function(){b.cancelAll();hideUploadMessage()}}}}),c.find(".modal-footer .btn-success").attr("disabled","disabled"),setTimeout(function(){var a=c,b=a.find(".bootbox-body img");srcWidth=f.imageWidth;srcHeight=f.imageHeight;
var d=["262 "," 114"],n=d[0],d=d[1],s=Math.min(Math.floor(srcWidth/n),Math.floor(srcHeight/d));e=b.imgAreaSelect({parent:".bootbox",autoHide:!1,mustMatch:!0,handles:!0,instance:!0,imageWidth:srcWidth,imageHeight:srcHeight,aspectRatio:"262 : 114",x1:0,y1:0,x2:s*n,y2:s*d,onInit:function(){a.find(".modal-footer .btn-success").removeAttr("disabled")},onSelectStart:function(){a.find(".modal-footer .btn-success").removeAttr("disabled")},onCancelSelection:function(){a.find(".modal-footer .btn-success").attr("disabled",
"disabled")}})},500)):f.error?showUploadError("Error with \u201c"+d+"\u201d: "+f.error):showUploadError("Failed to upload photo.")}}}),c,e}$messages=$("#uploadmessages div");$loadingImg='<img src="/img/loading.gif" /> ';function showUploadError(b){$messages.html(b);$messages.removeClass("alert-info").addClass("alert-error").show();$messages.parent().removeClass("upload_progress")}
function showUploadLoadingMessage(b){$messages.html($loadingImg+b);$messages.first().removeClass("alert-error").addClass("alert-info").show();$messages.parent().addClass("upload_progress")}function hideUploadMessage(){$messages.html("").hide();$messages.parent().removeClass("upload_progress")}$(document).on("click","#cancel_event_wizard, #close_event_wizard",function(){var b=$(form).data("backurl");window.location.href=b});var rotate=null;
$(document).on("click",".rsvp_button",function(){var b=null,c=null,e=null,c=$(this).data("event");$("#yes_"+c).hasClass("active")?$("#yes_"+c+" span.ladda-label").css({color:"#fff"}):$("#no_"+c).hasClass("active")?$("#no_"+c+" span.ladda-label").css({color:"#fff"}):$("#maybe_"+c).hasClass("active")&&$("#maybe_"+c+" span.ladda-label").css({color:"#fff"});$(".rsvp_button").removeClass("active");switch($(this).data("id")){case "rsvp_yes_button":b="1";e="#yes_"+$(this).data("event");break;case "rsvp_no_button":e=
"#no_"+$(this).data("event");b="2";break;case "rsvp_maybe_button":e="#maybe_"+$(this).data("event"),b="3"}rotate=Ladda.create(this);if("undefined"===typeof isCommunityEvent)c="listing";else{c="details";if(isCommunityEvent&&!isCommunityMember||isCommunityEvent&&isInvited)return $("#join_community").modal(),!1;if(isCommunityEvent&&isCommunityMember&&!isApprovedCommunityMember)return $("#waiting_community_approval").modal(),!1}null!=rotate&&rotate.start();disableButton(this);null!=b&&markAttendance($(this).data("event"),
b,c,e,rotate)});function disableButton(b){$(b).css({border:"1px solid #004f7f","background-color":"#2c589e",color:"#fff"});$(b).attr("disabled","disabled")}function markAttendance(b,c,e,a,d){$("#yes_"+b).attr("disabled","disabled");$("#maybe_"+b).attr("disabled","disabled");$("#no_"+b).attr("disabled","disabled");$.ajax({url:"/event/details/index/"+b+"/attendance:"+c,beforeSend:function(){},success:function(c){"false"!=c?markAttendanceSuccess(c,b,e,a,d):location.reload()}})}
function markAttendanceSuccess(b,c,e,a,d){$("#yes_"+c).removeAttr("disabled");$("#maybe_"+c).removeAttr("disabled");$("#no_"+c).removeAttr("disabled");"listing"==e?($("#"+c+" button").removeClass("active"),$.ajax({url:"/event/updateCount/"+c,success:function(a){console.log("type listing success data: ",a);$("#"+c+" .member_count").html(a)}})):($("#all_attendess_list_container").html(b),refreshAttendanceCount(c),refreshEventPosts(c));null!=d&&d.stop();changeStyleRsvpButtons(c);disableButton(a);$(a).addClass("active")}
function refreshEventPosts(b){$.ajax({type:"GET",url:"/event/details/index/"+b+"/refresh:1",success:function(b){$("#post_content").html(b);resetNewPostCount()}})}function refreshAttendanceCount(b){$.ajax({type:"GET",url:"/event/details/index/"+b+"/attendance_count:1",dataType:"json",success:function(b){b.success&&($("#event_attending_count").html(b.attending_count),$("#event_maybe_count").html(b.maybe_count))}});return!0}
function changeStyleRsvpButtons(b){$("#yes_"+b).css({"background-color":"",border:"",color:""});$("#maybe_"+b).css({"background-color":"",border:"",color:""});$("#no_"+b).css({"background-color":"",border:"",color:""});$("#yes_"+b+" span.ladda-label").css({color:""});$("#no_"+b+" span.ladda-label").css({color:""});$("#maybe_"+b+" span.ladda-label").css({color:""})}
var eventUrlRegex=/(https?\:\/\/|\s)[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})(\/+[a-z0-9_.\:\;-]*)*(\?[\&\%\|\+a-z0-9_=,\.\:\;-]*)?([\&\%\|\+&a-z0-9_=,\:\;\.-]*)([\!\#\/\&\%\|\+a-z0-9_=,\:\;\.-]*)}*/i,isCrawlingEventUrl=!1,isEventLinkDataPresent=!1,eventLink;$(document).on("keyup","#EventOnlineEventDetails",function(){eventLink=this;checkEventLink()});
$(document).on("paste","#EventOnlineEventDetails",function(){eventLink=this;setTimeout(function(){$("#EventOnlineEventDetails").valid()&&grabVideoUrl()},100)});$(document).on("click","#closeOnlineEventPreview",function(){$("#preview").fadeOut("fast",function(){clearOnlineEventPreview();$("#link_input_section").removeClass("hide");$("#EventOnlineEventDetails").val("").removeClass("textbox_loader").removeAttr("disabled");$("#event_vido_url_form").removeClass("event_video_url_review")})});
$(document).on("click","#event_grab_video_url_btn",function(){grabVideoUrl()});function clearOnlineEventPreview(){$("#preview").hide();$("#previewImage").html("");$("#previewTitle").html("");$("#previewUrl").html("");$("#previewDescription").html("");$("#event_grab_video_url_btn").attr("disabled","disabled")}
function grabVideoUrl(){var b=$("#EventOnlineEventDetails").val();$.ajax({type:"POST",url:"/post/api/textCrawler",data:{link:b},dataType:"json",beforeSend:function(){$("#event_grab_video_url_btn").attr("disabled","disabled");$("#EventOnlineEventDetails").addClass("textbox_loader").attr("disabled","disabled");$("#preview").hide();isCrawlingEventUrl=!0},success:function(b){$("#event_grab_video_url_btn").removeAttr("disabled");if(b.url&&"no"!==b.video){$("#EventOnlineEventDetails").removeClass("textbox_loader").removeAttr("disabled");
$("#event_vido_url_form").addClass("event_video_url_review");$("#link_input_section").addClass("hide");$("#preview").show();$("#previewTitle").html(b.title);$("#previewUrl").html(b.cannonicalUrl);$("#previewDescription").html(b.description);try{if(""!==b.images&&!1!==b.images&&null!==b.images){images=b.images.split("|");b.images=images;$("#previewImages").show();images.length=parseInt(images.length);previewImagesCount=images.length;var e="";for(i=0;i<images.length;i++)e=0===i?e+("<img id='imagePreview"+
i+"' src='"+images[i]+"' style='width: 130px; height: auto' ></img>"):e+("<img id='imagePreview"+i+"' src='"+images[i]+"' style='width: 130px; height: auto; display: none' ></img>");$("#previewImage").html("<a href='"+b.pageUrl+"' target='_blank'>"+e+"</a><div id='whiteImage' style='width: 130px; color: transparent; display:none;'>...</div>")}else $("#previewImages").hide()}catch(a){$("#previewImages").hide()}isEventLinkDataPresent=!0;isCrawlingEventUrl=!1}else isCrawlingEventUrl=!1,$("#EventOnlineEventDetails").removeClass("textbox_loader").removeAttr("disabled")}})}
function showEventVodeoLinkError(b){0<$("#event_vido_url_form span[for='EventOnlineEventDetails']").length?$("#event_vido_url_form span[for='EventOnlineEventDetails']").html(b).show():$("#event_vido_url_form #link_input_section").append('<span for="EventOnlineEventDetails" class="help-block">'+b+"</span>");$("#event_vido_url_form .form-group").addClass("error")}
function setEventVideoData(b){$("#EventLinkTitle").val(b.title);$("#EventLinkUrl").val(b.url);$("#EventLinkPageUrl").val(b.pageUrl);$("#EventLinkCannonicalUrl").val(b.cannonicalUrl);$("#EventLinkDescription").val(b.description);var c="";!1!==b.images&&(c=b.images instanceof Array?b.images[0]:b.images);$("#EventLinkImage").val(c);$("#EventLinkVideo").val(b.video);$("#EventOnlineEventDetails").val(b.videoIframe)}
function checkEventLink(){isEventLinkDataPresent=!1;if(""!==$.trim($(eventLink).val())){var b=$(eventLink).val();"http://"!==b.substr(0,7)&&"https://"!=b.substr(0,8)&&(b="http://"+b);"/"!==b.substr(b.length-1,1)&&(b+="/");eventUrlRegex.test(b)?$("#event_grab_video_url_btn").removeAttr("disabled"):($("#event_grab_video_url_btn").attr("disabled","disabled"),$("#preview").fadeOut("fast",function(){clearOnlineEventPreview()}))}else $("#event_grab_video_url_btn").attr("disabled","disabled")}
function time(b,c,e){"PM"==e?12!=b&&(b+=12):12==b&&(b=0);return 3600*b+60*c}function now(){var b=getUserNow(),c=(new Date(b)).getHours(),b=(new Date(b)).getMinutes(),e="AM";0==c?c=12:12<c&&(c%=12,e="PM");return c+":"+b+" "+e}
$(document).ready(function(){$("#eventDuration .time.start").timepicker({forceRoundTime:!0,showDuration:!0,timeFormat:"g:i a"});$("#eventDuration .time.end").timepicker({forceRoundTime:!0,maxTime:"11:30 pm",showDuration:!0,timeFormat:"g:i a"});$("#eventDuration").datepair({defaultTimeDelta:18E5});$("#repeat_event_mode_time .time.start").timepicker({forceRoundTime:!0,showDuration:!0,timeFormat:"g:i a"});$("#repeat_event_mode_time .time.end").timepicker({forceRoundTime:!0,maxTime:"11:30 pm",showDuration:!0,
timeFormat:"g:i a"})});$(document).on("change",".time.end",function(){var b=$("#eventForm .time.end").val(),c=$("#eventForm .time.start").val();""!=c&&compareTime(c,b)});$(document).on("change","#EventStartTime, #EventEndTime",function(){$("#EventEndTime").valid()});$(document).on("change","#repeat_event_mode_time .time.end",function(){var b=$("#repeat_event_mode_time .time.end").val(),c=$("#repeat_event_mode_time .time.start").val();""!=c&&compareTime(c,b)});
$(document).on("change","#is_full_day",function(){$("#is_full_day").prop("checked")?($(".not_full_day_event").addClass("hidden"),$("#EventUptoTimeonly").rules("remove","required"),$("#EventUptoTimeonly").rules("remove","regex"),$("#EventUptoTimeonly").rules("remove","repeatEndTimeValid"),$("#EventUptoTimeonly").valid()):($(".not_full_day_event").removeClass("hidden"),$("#EventUptoTimeonly").rules("add",{required:!0,regex:/(([0-9]|[1][012])\:[03]0\s(a|p)m)$/i,repeatEndTimeValid:!0,messages:{regex:"Please enter a valid end time",
required:"Please enter a valid end time"}}));$(document).on("change",".setErrorDivRepeat",function(){$("#EventStartDateTimeonly").valid()&&$("#EventUptoTimeonly").valid()});setEndDateValidation()});$(document).on("change","#EventStartDateTime",function(){console.log("change in dates called");compareEventDates()||$("#EventUptoDate").val($(this).val())});$(document).on("change","#EventUptoDate",function(){console.log("change in dates called");compareEventDates()||$("#EventStartDateTime").val($(this).val())});
function compareEventDates(){var b=$("#EventStartDateTime").val(),c=$("#EventUptoDate").val(),e=!1;""!=b&&""!=c&&!$("#is_full_day").prop("checked")&&(startDateObj=new Date(c),endDateObj=new Date(b),endDateObj>startDateObj?(console.log("false"),e=!1):(console.log("true"),e=!0));setEndDateValidation();return e}
function setEndDateValidation(){var b=$("#EventStartDateTime").val(),c=$("#EventUptoDate").val(),e=b,e=$("#is_full_day").prop("checked"),e=""!=c&&!e?c:b;$("#EventEndDate").datepicker("option","minDate",new Date(e))}
function compareTime(b,c){if(0!==c.length&&0!==b.length){var e=c.match(/([0-9]|[1][012]):/),a=b.match(/([0-9]|[1][012]):/);if(null!=e&&null!=a){var e=e[1],d=c.match(/:([0|3]0)/),d=d[1],f=c.match(/((a|p)m)/),f=f[1],a=a[1],q=b.match(/:([0|3]0)/),q=q[1],r=b.match(/((a|p)m)/),r=r[1],c=time(e,d,f.toUpperCase()),b=time(a,q,r.toUpperCase());return b>=c}}return!1}
!function(b){var c={mode:"horizontal",slideSelector:"",infiniteLoop:!0,hideControlOnEnd:!1,speed:500,easing:null,slideMargin:0,startSlide:0,randomStart:!1,captions:!1,ticker:!1,tickerHover:!1,adaptiveHeight:!1,adaptiveHeightSpeed:500,video:!1,useCSS:!0,preloadImages:"visible",responsive:!0,touchEnabled:!0,swipeThreshold:50,oneToOneTouch:!0,preventDefaultSwipeX:!0,preventDefaultSwipeY:!1,pager:!0,pagerType:"full",pagerShortSeparator:" / ",pagerSelector:null,buildPager:null,pagerCustom:null,controls:!0,
nextText:"Next",prevText:"Prev",nextSelector:null,prevSelector:null,autoControls:!1,startText:"Start",stopText:"Stop",autoControlsCombine:!1,autoControlsSelector:null,auto:!1,pause:4E3,autoStart:!0,autoDirection:"next",autoHover:!1,autoDelay:0,minSlides:1,maxSlides:1,moveSlides:0,slideWidth:0,onSliderLoad:function(){},onSlideBefore:function(){},onSlideAfter:function(){},onSlideNext:function(){},onSlidePrev:function(){}};b.fn.bxSlider=function(e){if(0==this.length)return this;if(1<this.length)return this.each(function(){b(this).bxSlider(e)}),
this;var a={},d=this,f=b(window).width(),q=b(window).height(),r=function(){a.settings=b.extend({},c,e);a.settings.slideWidth=parseInt(a.settings.slideWidth);a.children=d.children(a.settings.slideSelector);a.children.length<a.settings.minSlides&&(a.settings.minSlides=a.children.length);a.children.length<a.settings.maxSlides&&(a.settings.maxSlides=a.children.length);a.settings.randomStart&&(a.settings.startSlide=Math.floor(Math.random()*a.children.length));a.active={index:a.settings.startSlide};a.carousel=
1<a.settings.minSlides||1<a.settings.maxSlides;a.carousel&&(a.settings.preloadImages="all");a.minThreshold=a.settings.minSlides*a.settings.slideWidth+(a.settings.minSlides-1)*a.settings.slideMargin;a.maxThreshold=a.settings.maxSlides*a.settings.slideWidth+(a.settings.maxSlides-1)*a.settings.slideMargin;a.working=!1;a.controls={};a.interval=null;a.animProp="vertical"==a.settings.mode?"top":"left";var g;if(g=a.settings.useCSS)if(g="fade"!=a.settings.mode)a:{g=document.createElement("div");var h=["WebkitPerspective",
"MozPerspective","OPerspective","msPerspective"],o;for(o in h)if(void 0!==g.style[h[o]]){g=(a.cssPrefix=h[o].replace("Perspective","").toLowerCase(),a.animProp="-"+a.cssPrefix+"-transform",!0);break a}g=!1}a.usingCSS=g;"vertical"==a.settings.mode&&(a.settings.maxSlides=a.settings.minSlides);d.data("origStyle",d.attr("style"));d.children(a.settings.slideSelector).each(function(){b(this).data("origStyle",b(this).attr("style"))});d.wrap('<div class="bx-wrapper"><div class="bx-viewport"></div></div>');
a.viewport=d.parent();a.loader=b('<div class="bx-loading" />');a.viewport.prepend(a.loader);d.css({width:"horizontal"==a.settings.mode?100*a.children.length+215+"%":"auto",position:"relative"});a.usingCSS&&a.settings.easing?d.css("-"+a.cssPrefix+"-transition-timing-function",a.settings.easing):a.settings.easing||(a.settings.easing="swing");m();a.viewport.css({width:"100%",overflow:"hidden",position:"relative"});a.viewport.parent().css({maxWidth:s()});a.settings.pager||a.viewport.parent().css({margin:"0 auto 0px"});
a.children.css({"float":"horizontal"==a.settings.mode?"left":"none",listStyle:"none",position:"relative"});a.children.css("width",x());"horizontal"==a.settings.mode&&0<a.settings.slideMargin&&a.children.css("marginRight",a.settings.slideMargin);"vertical"==a.settings.mode&&0<a.settings.slideMargin&&a.children.css("marginBottom",a.settings.slideMargin);"fade"==a.settings.mode&&(a.children.css({position:"absolute",zIndex:0,display:"none"}),a.children.eq(a.settings.startSlide).css({zIndex:50,display:"block"}));
a.controls.el=b('<div class="bx-controls" />');a.settings.captions&&a.children.each(function(){var a=b(this).find("img:first").attr("title");void 0!=a&&(""+a).length&&b(this).append('<div class="bx-caption"><span>'+a+"</span></div>")});a.active.last=a.settings.startSlide==l()-1;a.settings.video&&d.fitVids();o=a.children.eq(a.settings.startSlide);"all"==a.settings.preloadImages&&(o=a.children);a.settings.ticker?a.settings.pager=!1:(a.settings.pager&&(a.settings.pagerCustom?a.pagerEl=b(a.settings.pagerCustom):
(a.pagerEl=b('<div class="bx-pager" />'),a.settings.pagerSelector?b(a.settings.pagerSelector).html(a.pagerEl):a.controls.el.addClass("bx-has-pager").append(a.pagerEl),y()),a.pagerEl.delegate("a","click",F)),a.settings.controls&&(a.controls.next=b('<a class="bx-next" href="">'+a.settings.nextText+"</a>"),a.controls.prev=b('<a class="bx-prev" href="">'+a.settings.prevText+"</a>"),a.controls.next.bind("click",G),a.controls.prev.bind("click",H),a.settings.nextSelector&&b(a.settings.nextSelector).append(a.controls.next),
a.settings.prevSelector&&b(a.settings.prevSelector).append(a.controls.prev),a.settings.nextSelector||a.settings.prevSelector||(a.controls.directionEl=b('<div class="bx-controls-direction" />'),a.controls.directionEl.append(a.controls.prev).append(a.controls.next),a.controls.el.addClass("bx-has-controls-direction").append(a.controls.directionEl))),a.settings.auto&&a.settings.autoControls&&(a.controls.start=b('<div class="bx-controls-auto-item"><a class="bx-start" href="">'+a.settings.startText+"</a></div>"),
a.controls.stop=b('<div class="bx-controls-auto-item"><a class="bx-stop" href="">'+a.settings.stopText+"</a></div>"),a.controls.autoEl=b('<div class="bx-controls-auto" />'),a.controls.autoEl.delegate(".bx-start","click",I),a.controls.autoEl.delegate(".bx-stop","click",J),a.settings.autoControlsCombine?a.controls.autoEl.append(a.controls.start):a.controls.autoEl.append(a.controls.start).append(a.controls.stop),a.settings.autoControlsSelector?b(a.settings.autoControlsSelector).html(a.controls.autoEl):
a.controls.el.addClass("bx-has-controls-auto").append(a.controls.autoEl),u(a.settings.autoStart?"stop":"start")),(a.settings.controls||a.settings.autoControls||a.settings.pager)&&a.viewport.after(a.controls.el));var j=E,f=o.find("img, iframe").length;if(0==f)j();else{var k=0;o.find("img, iframe").each(function(){b(this).one("load",function(){++k==f&&j()}).each(function(){this.complete&&b(this).load()})})}},E=function(){if(a.settings.infiniteLoop&&"fade"!=a.settings.mode&&!a.settings.ticker){var g=
"vertical"==a.settings.mode?a.settings.minSlides:a.settings.maxSlides,h=a.children.slice(0,g).clone().addClass("bx-clone"),g=a.children.slice(-g).clone().addClass("bx-clone");d.append(h).prepend(g)}a.loader.remove();z();"vertical"==a.settings.mode&&(a.settings.adaptiveHeight=!0);a.viewport.height(n());d.redrawSlider();a.settings.onSliderLoad(a.active.index);a.initialized=!0;a.settings.responsive&&b(window).bind("resize",A);a.settings.auto&&a.settings.autoStart&&(0<a.settings.autoDelay?setTimeout(d.startAuto,
a.settings.autoDelay):d.startAuto(),a.settings.autoHover&&d.hover(function(){a.interval&&(d.stopAuto(!0),a.autoPaused=!0)},function(){a.autoPaused&&(d.startAuto(!0),a.autoPaused=null)}));a.settings.ticker&&(h=0,"next"==a.settings.autoDirection?d.append(a.children.clone().addClass("bx-clone")):(d.prepend(a.children.clone().addClass("bx-clone")),h=a.children.first().position(),h="horizontal"==a.settings.mode?-h.left:-h.top),k(h,"reset",0),a.settings.pager=!1,a.settings.controls=!1,a.settings.autoControls=
!1,a.settings.tickerHover&&!a.usingCSS&&a.viewport.hover(function(){d.stop()},function(){var g=0;a.children.each(function(){g=g+("horizontal"==a.settings.mode?b(this).outerWidth(true):b(this).outerHeight(true))});var h=a.settings.speed/g*(g-Math.abs(parseInt(d.css("horizontal"==a.settings.mode?"left":"top"))));t(h)}),t());a.settings.pager&&v(a.settings.startSlide);a.settings.controls&&B();a.settings.touchEnabled&&!a.settings.ticker&&(a.touch={start:{x:0,y:0},end:{x:0,y:0}},a.viewport.bind("touchstart",
K))},n=function(){var g=0,h=b();if("vertical"==a.settings.mode||a.settings.adaptiveHeight)if(a.carousel){var d=1==a.settings.moveSlides?a.active.index:a.active.index*p(),h=a.children.eq(d);for(i=1;i<=a.settings.maxSlides-1;i++)h=d+i>=a.children.length?h.add(a.children.eq(i-1)):h.add(a.children.eq(d+i))}else h=a.children.eq(a.active.index);else h=a.children;return"vertical"==a.settings.mode?(h.each(function(){g+=b(this).outerHeight()}),0<a.settings.slideMargin&&(g+=a.settings.slideMargin*(a.settings.minSlides-
1))):g=Math.max.apply(Math,h.map(function(){return b(this).outerHeight(!1)}).get()),g},s=function(){return"100%"},x=function(){var b=a.settings.slideWidth,d=a.viewport.width();return 0==a.settings.slideWidth||a.settings.slideWidth>d&&!a.carousel||"vertical"==a.settings.mode?b=d:1<a.settings.maxSlides&&"horizontal"==a.settings.mode&&(d>a.maxThreshold||d<a.minThreshold&&(b=(d-a.settings.slideMargin*(a.settings.minSlides-1))/a.settings.minSlides)),b},m=function(){var b=1;"horizontal"==a.settings.mode&&
0<a.settings.slideWidth?a.viewport.width()<a.minThreshold?b=a.settings.minSlides:a.viewport.width()>a.maxThreshold?b=a.settings.maxSlides:(b=a.children.first().width(),b=Math.floor(a.viewport.width()/b)):"vertical"==a.settings.mode&&(b=a.settings.minSlides);return b},l=function(){var b=0;if(0<a.settings.moveSlides)if(a.settings.infiniteLoop)b=a.children.length/p();else for(var d=0,c=0;d<a.children.length;)++b,d=c+m(),c+=a.settings.moveSlides<=m()?a.settings.moveSlides:m();else b=Math.ceil(a.children.length/
m());return b},p=function(){return 0<a.settings.moveSlides&&a.settings.moveSlides<=m()?a.settings.moveSlides:m()},z=function(){if(a.children.length>a.settings.maxSlides&&a.active.last&&!a.settings.infiniteLoop)if("horizontal"==a.settings.mode){var b=a.children.last(),d=b.position();k(-(d.left-(a.viewport.width()-b.width())),"reset",0)}else"vertical"==a.settings.mode&&(d=a.children.eq(a.children.length-a.settings.minSlides).position(),k(-d.top,"reset",0));else d=a.children.eq(a.active.index*p()).position(),
a.active.index==l()-1&&(a.active.last=!0),void 0!=d&&("horizontal"==a.settings.mode?k(-d.left,"reset",0):"vertical"==a.settings.mode&&k(-d.top,"reset",0))},k=function(b,c,e,j){if(a.usingCSS)b="vertical"==a.settings.mode?"translate3d(0, "+b+"px, 0)":"translate3d("+b+"px, 0, 0)",d.css("-"+a.cssPrefix+"-transition-duration",e/1E3+"s"),"slide"==c?(d.css(a.animProp,b),d.bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){d.unbind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd");
w()})):"reset"==c?d.css(a.animProp,b):"ticker"==c&&(d.css("-"+a.cssPrefix+"-transition-timing-function","linear"),d.css(a.animProp,b),d.bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){d.unbind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd");k(j.resetValue,"reset",0);t()}));else{var f={};f[a.animProp]=b;"slide"==c?d.animate(f,e,a.settings.easing,function(){w()}):"reset"==c?d.css(a.animProp,b):"ticker"==c&&d.animate(f,speed,"linear",function(){k(j.resetValue,
"reset",0);t()})}},y=function(){for(var d="",c=l(),e=0;c>e;e++){var j="";a.settings.buildPager&&b.isFunction(a.settings.buildPager)?(j=a.settings.buildPager(e),a.pagerEl.addClass("bx-custom-pager")):(j=e+1,a.pagerEl.addClass("bx-default-pager"));d+='<div class="bx-pager-item"><a href="" data-slide-index="'+e+'" class="bx-pager-link">'+j+"</a></div>"}a.pagerEl.html(d)},G=function(b){a.settings.auto&&d.stopAuto();d.goToNextSlide();b.preventDefault()},H=function(b){a.settings.auto&&d.stopAuto();d.goToPrevSlide();
b.preventDefault()},I=function(a){d.startAuto();a.preventDefault()},J=function(a){d.stopAuto();a.preventDefault()},F=function(c){a.settings.auto&&d.stopAuto();var e=b(c.currentTarget),e=parseInt(e.attr("data-slide-index"));e!=a.active.index&&d.goToSlide(e);c.preventDefault()},v=function(d){var c=a.children.length;return"short"==a.settings.pagerType?(1<a.settings.maxSlides&&(c=Math.ceil(a.children.length/a.settings.maxSlides)),a.pagerEl.html(d+1+a.settings.pagerShortSeparator+c),void 0):(a.pagerEl.find("a").removeClass("active"),
a.pagerEl.each(function(a,c){b(c).find("a").eq(d).addClass("active")}),void 0)},w=function(){if(a.settings.infiniteLoop){var b="";0==a.active.index?b=a.children.eq(0).position():a.active.index==l()-1&&a.carousel?b=a.children.eq((l()-1)*p()).position():a.active.index==a.children.length-1&&(b=a.children.eq(a.children.length-1).position());"horizontal"==a.settings.mode?k(-b.left,"reset",0):"vertical"==a.settings.mode&&k(-b.top,"reset",0)}a.working=!1;a.settings.onSlideAfter(a.children.eq(a.active.index),
a.oldIndex,a.active.index)},u=function(b){a.settings.autoControlsCombine?a.controls.autoEl.html(a.controls[b]):(a.controls.autoEl.find("a").removeClass("active"),a.controls.autoEl.find("a:not(.bx-"+b+")").addClass("active"))},B=function(){1==l()?(a.controls.prev.addClass("disabled"),a.controls.next.addClass("disabled")):!a.settings.infiniteLoop&&a.settings.hideControlOnEnd&&(0==a.active.index?(a.controls.prev.addClass("disabled"),a.controls.next.removeClass("disabled")):a.active.index==l()-1?(a.controls.next.addClass("disabled"),
a.controls.prev.removeClass("disabled")):(a.controls.prev.removeClass("disabled"),a.controls.next.removeClass("disabled")))},t=function(b){speed=b?b:a.settings.speed;var b={left:0,top:0},c={left:0,top:0};"next"==a.settings.autoDirection?b=d.find(".bx-clone").first().position():c=a.children.first().position();k("horizontal"==a.settings.mode?-b.left:-b.top,"ticker",speed,{resetValue:"horizontal"==a.settings.mode?-c.left:-c.top})},K=function(b){a.working?b.preventDefault():(a.touch.originalPos=d.position(),
b=b.originalEvent,a.touch.start.x=b.changedTouches[0].pageX,a.touch.start.y=b.changedTouches[0].pageY,a.viewport.bind("touchmove",C),a.viewport.bind("touchend",D))},C=function(b){var d=b.originalEvent,c=Math.abs(d.changedTouches[0].pageX-a.touch.start.x),e=Math.abs(d.changedTouches[0].pageY-a.touch.start.y);if(3*c>e&&a.settings.preventDefaultSwipeX?b.preventDefault():3*e>c&&a.settings.preventDefaultSwipeY&&b.preventDefault(),"fade"!=a.settings.mode&&a.settings.oneToOneTouch)b=0,"horizontal"==a.settings.mode?
(d=d.changedTouches[0].pageX-a.touch.start.x,b=a.touch.originalPos.left+d):(d=d.changedTouches[0].pageY-a.touch.start.y,b=a.touch.originalPos.top+d),k(b,"reset",0)},D=function(b){a.viewport.unbind("touchmove",C);var c=b.originalEvent,b=0;(a.touch.end.x=c.changedTouches[0].pageX,a.touch.end.y=c.changedTouches[0].pageY,"fade"==a.settings.mode)?(c=Math.abs(a.touch.start.x-a.touch.end.x),c>=a.settings.swipeThreshold&&(a.touch.start.x>a.touch.end.x?d.goToNextSlide():d.goToPrevSlide(),d.stopAuto())):(c=
0,"horizontal"==a.settings.mode?(c=a.touch.end.x-a.touch.start.x,b=a.touch.originalPos.left):(c=a.touch.end.y-a.touch.start.y,b=a.touch.originalPos.top),!a.settings.infiniteLoop&&(0==a.active.index&&0<c||a.active.last&&0>c)?k(b,"reset",200):Math.abs(c)>=a.settings.swipeThreshold?(0>c?d.goToNextSlide():d.goToPrevSlide(),d.stopAuto()):k(b,"reset",200));a.viewport.unbind("touchend",D)},A=function(){var a=b(window).width(),c=b(window).height();(f!=a||q!=c)&&(f=a,q=c,d.redrawSlider())};return d.goToSlide=
function(c,e){if(!a.working&&a.active.index!=c)if(a.working=!0,a.oldIndex=a.active.index,a.active.index=0>c?l()-1:c>=l()?0:c,a.settings.onSlideBefore(a.children.eq(a.active.index),a.oldIndex,a.active.index),"next"==e?a.settings.onSlideNext(a.children.eq(a.active.index),a.oldIndex,a.active.index):"prev"==e&&a.settings.onSlidePrev(a.children.eq(a.active.index),a.oldIndex,a.active.index),a.active.last=a.active.index>=l()-1,a.settings.pager&&v(a.active.index),a.settings.controls&&B(),"fade"==a.settings.mode)a.settings.adaptiveHeight&&
a.viewport.height()!=n()&&a.viewport.animate({height:n()},a.settings.adaptiveHeightSpeed),a.children.filter(":visible").fadeOut(a.settings.speed).css({zIndex:0}),a.children.eq(a.active.index).css("zIndex",51).fadeIn(a.settings.speed,function(){b(this).css("zIndex",50);w()});else{a.settings.adaptiveHeight&&a.viewport.height()!=n()&&a.viewport.animate({height:n()},a.settings.adaptiveHeightSpeed);var f=0,j={left:0,top:0};if(!a.settings.infiniteLoop&&a.carousel&&a.active.last)if("horizontal"==a.settings.mode)var m=
a.children.eq(a.children.length-1),j=m.position(),f=a.viewport.width()-m.outerWidth();else j=a.children.eq(a.children.length-a.settings.minSlides).position();else a.carousel&&a.active.last&&"prev"==e?(j=1==a.settings.moveSlides?a.settings.maxSlides-p():(l()-1)*p()-(a.children.length-a.settings.maxSlides),m=d.children(".bx-clone").eq(j),j=m.position()):"next"==e&&0==a.active.index?(j=d.find("> .bx-clone").eq(a.settings.maxSlides).position(),a.active.last=!1):0<=c&&(j=c*p(),j=a.children.eq(j).position());
"undefined"!=typeof j&&k("horizontal"==a.settings.mode?-(j.left-f):-j.top,"slide",a.settings.speed)}},d.goToNextSlide=function(){if(a.settings.infiniteLoop||!a.active.last){var b=parseInt(a.active.index)+1;d.goToSlide(b,"next")}},d.goToPrevSlide=function(){if(a.settings.infiniteLoop||0!=a.active.index){var b=parseInt(a.active.index)-1;d.goToSlide(b,"prev")}},d.startAuto=function(b){a.interval||(a.interval=setInterval(function(){"next"==a.settings.autoDirection?d.goToNextSlide():d.goToPrevSlide()},
a.settings.pause),a.settings.autoControls&&1!=b&&u("stop"))},d.stopAuto=function(b){a.interval&&(clearInterval(a.interval),a.interval=null,a.settings.autoControls&&1!=b&&u("start"))},d.getCurrentSlide=function(){return a.active.index},d.getSlideCount=function(){return a.children.length},d.redrawSlider=function(){a.children.add(d.find(".bx-clone")).outerWidth(x());a.viewport.css("height",n());a.settings.ticker||z();a.active.last&&(a.active.index=l()-1);a.active.index>=l()&&(a.active.last=!0);a.settings.pager&&
!a.settings.pagerCustom&&(y(),v(a.active.index))},d.destroySlider=function(){a.initialized&&(a.initialized=!1,b(".bx-clone",this).remove(),a.children.each(function(){void 0!=b(this).data("origStyle")?b(this).attr("style",b(this).data("origStyle")):b(this).removeAttr("style")}),void 0!=b(this).data("origStyle")?this.attr("style",b(this).data("origStyle")):b(this).removeAttr("style"),b(this).unwrap().unwrap(),a.controls.el&&a.controls.el.remove(),a.controls.next&&a.controls.next.remove(),a.controls.prev&&
a.controls.prev.remove(),a.pagerEl&&a.pagerEl.remove(),b(".bx-caption",this).remove(),a.controls.autoEl&&a.controls.autoEl.remove(),clearInterval(a.interval),a.settings.responsive&&b(window).unbind("resize",A))},d.reloadSlider=function(a){void 0!=a&&(e=a);d.destroySlider();r()},r(),this}}(jQuery);