(function(e){e.arrowchat=function(){function B(t,n){t.each(function(t,r){e(r).hover(function(){e(this).addClass(n)},function(){e(this).removeClass(n)})})}function j(t){e(".arrowchat_hide_loading",t).hide();e(".arrowchat_show_loading",t).show()}function F(t){e(".arrowchat_hide_loading",t).show();e(".arrowchat_show_loading",t).hide()}function I(e,t,n){if(e!==undefined){if(n==1){e.addClass("arrowchat_tabopen_hidden")}else{e.removeClass("arrowchat_tabopen")}}if(t!==undefined){t.removeClass("arrowchat_tabclick arrowchat_userstabclick arrowchat_trayclick arrowchat_usertabclick")}}function q(){if(m){m.hide()}}function R(n,r,i,s,o,u){if(m===null){m=e('<div id="arrowchat_tooltip"><div class="arrowchat_tooltip_content"></div></div>').appendTo(t);g=e(".arrowchat_tooltip_content",m)}g.html(r);var f=n.offset();var l=n.width();var c=n.height();var h=m.width();if(!s){s=0}if(!o){o=0}if(i){m.css({top:f.top-e(window).scrollTop()-c-1-o,left:f.left+l-16-s,display:"block"}).addClass("arrowchat_tooltip_left")}else if(u){m.css({top:f.top-e(window).scrollTop()-c-1-o,left:f.left+l-h+18-s,display:"block","background-position":h-128+"px -60px"}).removeClass("arrowchat_tooltip_left")}else{m.css({top:f.top-e(window).scrollTop()-c-1-o,left:f.left+l-h+18-s,display:"block","background-position":h-23+"px -118px"}).removeClass("arrowchat_tooltip_left")}if(Wn){m.css("position","absolute");m.css("top",parseInt(e(window).height())-parseInt(m.css("bottom"))-parseInt(m.height())+e(window).scrollTop()+"px")}}function z(e){return e.replace(U,"<a href='$1' target='_blank'>$1</a>")}function W(e){if(c_disable_smilies!=1){for(i=0;i<Smiley.length;i++){var t=Smiley[i][1].replace(/</g,"&lt;").replace(/>/g,"&gt;");var n=e.lastIndexOf(t);if(n!=-1){e=e.replace(new RegExp(RegExp.escape(t),"g"),'<img class="arrowchat_smiley" src="'+c_ac_path+"themes/"+u_theme+"/images/smilies/"+Smiley[i][0]+'.gif" alt="" />')}}}return e}function X(t,n){if(t.keyCode==13&&t.shiftKey==0){if(zn==0){setTimeout(function(){zn=0},15e3)}zn++;if(zn>4&&Ln!=1&&kn!=1){ft("arrowchat_chatroom_message_flyout",lang[51],"error")}else{var r=n.val();r=r.replace(/^\s+|\s+$/g,"");n.val("");n.css("height","18px");n.css("overflow-y","hidden");n.focus();r!=""&&e.ajax({url:c_ac_path+"includes/json/send/send_message_chatroom.php",type:"post",cache:false,dataType:"json",data:{userid:u_id,username:u_name,chatroomid:Kn,message:r},beforeSend:function(){e(".arrowchat_chatroom_message_input").addClass("arrowchat_message_sending")},error:function(){e(".arrowchat_chatroom_message_input").removeClass("arrowchat_message_sending");ft("arrowchat_chatroom_message_flyout",lang[135],"error")},success:function(t){e(".arrowchat_chatroom_message_input").removeClass("arrowchat_message_sending");if(t){_t(t,u_name,r);y.scrollTop(y[0].scrollHeight)}}});return false}}}function V(t,n,r,i){if(i!=1){clearTimeout(wr);wr=setTimeout(function(){e.post(c_ac_path+"includes/json/send/send_typing.php",{userid:u_id,typing:r,untype:1},function(){});yr=-1},5e3);if(yr!=r){e.post(c_ac_path+"includes/json/send/send_typing.php",{userid:u_id,typing:r},function(){});yr=r}}if(t.keyCode==27){if(Bn!=""){I(M[Bn],O[Bn]);e(".arrowchat_closebox_bottom",O[Bn]).click();Bn=""}}if(t.keyCode==13&&t.shiftKey==0){var s=n.val();s=s.replace(/^\s+|\s+$/g,"");n.val("").css({height:"18px","overflow-y":"hidden"}).focus();if(i==1&&s!=""){xn(r,s)}else{s!=""&&e.ajax({url:c_ac_path+"includes/json/send/send_message.php",type:"post",cache:false,dataType:"json",data:{userid:u_id,to:r,message:s},beforeSend:function(){e(".arrowchat_textarea").addClass("arrowchat_message_sending")},error:function(){e(".arrowchat_textarea").removeClass("arrowchat_message_sending");ft("arrowchat_chatbox_message_flyout_"+r,lang[135],"error")},success:function(t){e(".arrowchat_textarea").removeClass("arrowchat_message_sending");if(t){if(t=="-1"){ft("arrowchat_chatbox_message_flyout_"+r,lang[102],"error")}else{Dt(r,s,"1","1",t,1,Math.floor((new Date).getTime()/1e3))}}Yn=1}})}return false}}function $(e){var t=e[0].clientHeight;if(t<94){t=Math.max(e[0].scrollHeight,t);t=Math.min(94,t);if(t>e[0].clientHeight){e.css("height",t+4+"px")}}else{e.css("overflow-y","auto")}}function J(e,t){$(t);y.scrollTop(y[0].scrollHeight)}function K(t,n,r){$(n);e(".arrowchat_tabcontenttext",M[r]).scrollTop(e(".arrowchat_tabcontenttext",M[r])[0].scrollHeight)}function Q(){e("#arrowchat_userstab_icon").removeClass("arrowchat_user_available2 arrowchat_user_busy2 arrowchat_user_invisible2 arrowchat_user_away2")}function G(t){e("#arrowchat_userstab_icon").removeClass("arrowchat_user_available2 arrowchat_user_busy2 arrowchat_user_invisible2");e.post(c_ac_path+"includes/json/send/send_status.php",{userid:u_id,status:t},function(){})}function Y(){In=1;Q();e("#arrowchat_userstab_icon").addClass("arrowchat_user_invisible2");G("offline");I(v,p);I(l,u);e("#arrowchat_userstab_text").html(lang[7])}function Z(){r=e(ArrowChat.Templates.maintenance_tab(c_login_url)).appendTo(n);r.mouseover(function(){if(c_guests_login_msg=="1"&&u_id==""){R(r,lang[58])}else{R(r,lang[27])}e(this).addClass("arrowchat_tabmouseover")});r.mouseout(function(){e(this).removeClass("arrowchat_tabmouseover");q()})}function et(){$hide_bar_button=e(ArrowChat.Templates.bar_hide_tab()).appendTo(n);$hide_bar_button.mouseover(function(){R($hide_bar_button,lang[14]);e(this).addClass("arrowchat_tabmouseover")});$hide_bar_button.mouseout(function(){e(this).removeClass("arrowchat_tabmouseover");q()});$hide_bar_button.click(function(){e.post(c_ac_path+"includes/json/send/send_settings.php",{hide:"1"});Y();I(E,h);I(L,C);if(tr!=""){I(N[tr],T[tr]);tr=""}if(Bn!=""){I(M[Bn],O[Bn]);e(".arrowchat_closebox_bottom",O[Bn]).removeClass("arrowchat_closebox_bottom_click");Bn=""}clearTimeout(Vn);e.idleTimer("destroy");en();Ut();n.hide();s.show()})}function tt(){s=e(ArrowChat.Templates.bar_show_tab()).appendTo(t);s.mouseover(function(){R(s,lang[15]);e(this).addClass("arrowchat_tabmouseover")});s.mouseout(function(){e(this).removeClass("arrowchat_tabmouseover");q()});s.click(function(){nt()})}function nt(){e.post(c_ac_path+"includes/json/send/send_settings.php",{hide:"-1"});G("available");e("#arrowchat_userstab_icon").addClass("arrowchat_user_available2");In=0;qt();tn();zt();e.idleTimer(6e4*ArrowChat.IdleTime);s.hide();n.show()}function rt(){var t=e("#arrowchat_chatroom_create_input").val();var n=e("#arrowchat_chatroom_create_password_input").val();e("#arrowchat_chatroom_create_input").val("");e("#arrowchat_chatroom_create_password_input").val("");t=t.replace(/^\s+|\s+$/g,"");t!=""&&e.post(c_ac_path+"includes/json/send/send_chatroom_create.php",{userid:u_id,name:t,password:n},function(t){if(t){x.hide("slide",{direction:"up"},250);e("#arrowchat_chatroom_options_flyout").removeClass("arrowchat_chatroom_options_flyout_display");if(t=="-1"){ft("arrowchat_chatroom_message_flyout",lang[39],"error")}else if(t=="-2"){ft("arrowchat_chatroom_message_flyout",lang[40],"error")}else{Un=0;Bt()}}})}function it(){function r(){e("#arrowchat_chatroom_options_flyout").removeClass("arrowchat_chatroom_options_flyout_display")}function i(){if(x.is(":visible")){x.hide("slide",{direction:"up"},250)}}h=e(ArrowChat.Templates.chatrooms_tab()).appendTo(n);E=e(ArrowChat.Templates.chatrooms_window()).css("display","none").appendTo(t);S=e("#arrowchat_chatroom_create");x=e("#arrowchat_chatroom_create_flyout");h.css("width",c_width_chatroom+"px");e("#arrowchat_chatroom_create_input").placeholder();e("#arrowchat_chatroom_create_password_input").placeholder();if(c_width_chatroom<=25){e("#arrowchat_chatrooms_text",h).hide()}if(u_chatroom_block_chats==1){e("#arrowchat_chatroom_block :input").attr("checked",true)}else{e("#arrowchat_chatroom_block").addClass("arrowchat_menu_unchecked");e("#arrowchat_chatroom_block :input").attr("checked",false)}if(u_chatroom_sound==1){e("#arrowchat_chatroom_sound :input").attr("checked",true)}else{e("#arrowchat_chatroom_sound").addClass("arrowchat_menu_unchecked");e("#arrowchat_chatroom_sound :input").attr("checked",false)}if(u_chatroom_stay!="-1"){e("#arrowchat_chatroom_stay :input").attr("checked",true)}else{e("#arrowchat_chatroom_stay").addClass("arrowchat_menu_unchecked");e("#arrowchat_chatroom_stay :input").attr("checked",false)}if(u_chatroom_open!="-1"){e("#arrowchat_chatroom_window :input").attr("checked",true)}else{e("#arrowchat_chatroom_window").addClass("arrowchat_menu_unchecked");e("#arrowchat_chatroom_window :input").attr("checked",false)}if(c_user_chatrooms=="0"){S.hide()}h.click(function(){An=0;if(c_width_chatroom<=25){q()}if(e(".arrowchat_tabalert",h).length>0){e(".arrowchat_tabalert",h).remove();h.removeClass("arrowchat_tab_new_message")}Bt();I(v,p);I(l,u);E.css("left",h.offset().left-E.outerWidth()+h.outerWidth()).css("bottom","25px");e(this).toggleClass("arrowchat_tabclick").toggleClass("arrowchat_userstabclick");E.toggleClass("arrowchat_tabopen");if(y!==undefined){y.scrollTop(5e4)}e(".arrowchat_chatroom_message_input").focus()});h.mouseover(function(){if(c_width_chatroom<=25){if(h.hasClass("arrowchat_tabclick")){}else{R(h,lang[19])}}e(this).addClass("arrowchat_tabmouseover")});h.mouseout(function(){e(this).removeClass("arrowchat_tabmouseover");q()});e("#arrowchat_chatroom_password_input").keydown(function(t){if(t.keyCode==13){c=e("#arrowchat_chatroom_password_id").val();e("#arrowchat_chatroom_password_flyout").hide();input_value=e("#arrowchat_chatroom_password_input").val();e("#arrowchat_chatroom_password_input").val("");input_value=input_value.replace(/^\s+|\s+$/g,"");e(".arrowchat_chatroom_full_content").html('<div class="arrowchat_nofriends">'+lang[34]+"</div>");S.hide();Kn=c;lt(c,rr[c],input_value)}});e("#arrowchat_password_button").click(function(){c=e("#arrowchat_chatroom_password_id").val();e("#arrowchat_chatroom_password_flyout").hide();input_value=e("#arrowchat_chatroom_password_input").val();e("#arrowchat_chatroom_password_input").val("");input_value=input_value.replace(/^\s+|\s+$/g,"");e(".arrowchat_chatroom_full_content").html('<div class="arrowchat_nofriends">'+lang[34]+"</div>");S.hide();Kn=c;lt(c,rr[c],input_value)});e("#arrowchat_chatroom_stay").click(function(){e(this).toggleClass("arrowchat_menu_unchecked");if(e("#arrowchat_chatroom_stay :input").is(":checked")){e("#arrowchat_chatroom_stay :input").attr("checked",false);_chatroomstay=-1}else{e("#arrowchat_chatroom_stay :input").attr("checked",true);u_chatroom_stay=Kn;_chatroomstay=Kn}if(e("#arrowchat_chatroom_window :input").is(":checked")){e("#arrowchat_chatroom_window").toggleClass("arrowchat_menu_unchecked");e("#arrowchat_chatroom_window :input").attr("checked",false)}e.post(c_ac_path+"includes/json/send/send_settings.php",{chatroom_stay:_chatroomstay},function(){})});e("#arrowchat_chatroom_window").click(function(){e(this).toggleClass("arrowchat_menu_unchecked");if(e("#arrowchat_chatroom_window :input").is(":checked")){e("#arrowchat_chatroom_window :input").attr("checked",false);_chatroomwindow=-1}else{e("#arrowchat_chatroom_window :input").attr("checked",true);u_chatroom_open=Kn;_chatroomwindow=Kn}if(e("#arrowchat_chatroom_stay :input").is(":checked")){e("#arrowchat_chatroom_stay").toggleClass("arrowchat_menu_unchecked");e("#arrowchat_chatroom_stay :input").attr("checked",false)}e.post(c_ac_path+"includes/json/send/send_settings.php",{chatroom_window:_chatroomwindow},function(){})});e("#arrowchat_chatroom_block").click(function(){e(this).toggleClass("arrowchat_menu_unchecked");if(e("#arrowchat_chatroom_block :input").is(":checked")){e("#arrowchat_chatroom_block :input").attr("checked",false);_chatroomblock=-1}else{e("#arrowchat_chatroom_block :input").attr("checked",true);_chatroomblock=1}e.post(c_ac_path+"includes/json/send/send_settings.php",{chatroom_block_chats:_chatroomblock},function(){})});e("#arrowchat_chatroom_sound").click(function(){e(this).toggleClass("arrowchat_menu_unchecked");if(e("#arrowchat_chatroom_sound :input").is(":checked")){e("#arrowchat_chatroom_sound :input").attr("checked",false);_chatroomsound=-1;u_chatroom_sound=0}else{e("#arrowchat_chatroom_sound :input").attr("checked",true);_chatroomsound=1;u_chatroom_sound=1}e.post(c_ac_path+"includes/json/send/send_settings.php",{chatroom_sound:_chatroomsound},function(){})});e(".arrowchat_chatrooms_title",E).click(function(){h.click()}).children().not(".arrowchat_tab_name").click(function(){return false});e(".arrowchat_chatrooms_title",E).mouseenter(function(){e(this).addClass("arrowchat_chatboxtabtitlemouseover3")});e(".arrowchat_chatrooms_title",E).mouseleave(function(){e(this).removeClass("arrowchat_chatboxtabtitlemouseover3")});e("#arrowchat_chatroom_create_input").keydown(function(e){if(e.keyCode==13){rt()}});e("#arrowchat_create_button").click(function(){rt()});e("#arrowchat_chatroom_leave").click(function(){if(e(".arrowchat_smiley_box",E).is(":visible")){e(".arrowchat_smiley_box",E).hide("slide",{direction:"up"},250,function(){})}clearTimeout(Jn);e(".arrowchat_chatrooms_title .arrowchat_tab_name").html(lang[19]);e(".arrowchat_chatroom_full_content").html('<div class="arrowchat_nofriends">'+lang[34]+"</div>");e("#arrowchat_chatroom_leave").hide();e(".arrowchat_chatroom_popout").hide();if(c_user_chatrooms=="1"){S.show()}Un=0;Bt();var t=Kn;Kn=0;if(c_push_engine!=1){Ut();zt()}else{sn("chatroom"+t,0)}});e(".arrowchat_chatroom_leave").mouseenter(function(){R(e(this),lang[92],0,10,5);e(this).addClass("arrowchat_chatroom_leave_hover");e("#arrowchat_chatrooms_popup .arrowchat_chatrooms_title").removeClass("arrowchat_chatboxtabtitlemouseover3")});e(".arrowchat_chatroom_leave").mouseleave(function(){e(this).removeClass("arrowchat_chatroom_leave_hover");e("#arrowchat_chatrooms_popup .arrowchat_chatrooms_title").addClass("arrowchat_chatboxtabtitlemouseover3");q()});e(".arrowchat_chatroom_item").click(function(){r();if(e(".arrowchat_chatroom_item2").hasClass("arrowchat_more_button_selected")){e(".arrowchat_chatroom_item2").toggleClass("arrowchat_more_button_selected")}if(!x.is(":visible")){x.show("slide",{direction:"up"},250)}else{x.hide("slide",{direction:"up"},250)}if(e("#arrowchat_chatroom_password_flyout").is(":visible")){e(".arrowchat_chatroom_list").removeClass("arrowchat_chatroom_clicked");e("#arrowchat_chatroom_password_flyout").hide("slide",{direction:"up"},250)}});e(".arrowchat_chatroom_item").mouseenter(function(){R(e(this),lang[93],0,10,5);e(this).parent().addClass("arrowchat_chatroom_create_hover");e("#arrowchat_chatrooms_popup .arrowchat_chatrooms_title").removeClass("arrowchat_chatboxtabtitlemouseover3")});e(".arrowchat_chatroom_item").mouseleave(function(){q();e(this).parent().removeClass("arrowchat_chatroom_create_hover");e("#arrowchat_chatrooms_popup .arrowchat_chatrooms_title").addClass("arrowchat_chatboxtabtitlemouseover3")});e(".arrowchat_chatroom_item2").click(function(){q();i();e("#arrowchat_chatroom_options_flyout").toggleClass("arrowchat_chatroom_options_flyout_display");e(this).addClass("arrowchat_more_button_hover");e(this).toggleClass("arrowchat_more_button_selected")});e(".arrowchat_chatroom_item2").mouseenter(function(){R(e(this),lang[23],0,10,5);e(this).parent().addClass("arrowchat_more_button_hover");e("#arrowchat_chatrooms_popup .arrowchat_chatrooms_title").removeClass("arrowchat_chatboxtabtitlemouseover3")});e(".arrowchat_chatroom_item2").mouseleave(function(){q();e(this).parent().removeClass("arrowchat_more_button_hover");e("#arrowchat_chatrooms_popup .arrowchat_chatrooms_title").addClass("arrowchat_chatboxtabtitlemouseover3")})}function st(){o=e("<div/>").attr("id","arrowchat_popoutchatbutton").addClass("arrowchat_bar_right").addClass("arrowchat_bar_button").html('<div class="arrowchat_inner_button"><i class="arrowchat_icons arrowchat_popin_icon" /></div>').appendTo(n);o.mouseover(function(){R(o,lang[11]);e(this).addClass("arrowchat_tabmouseover")});o.mouseout(function(){e(this).removeClass("arrowchat_tabmouseover");q()});o.click(function(){e(this).hide();p.show();D.show();_.show();H.show();if(Bn!=""){M[Bn].show()}e.post(c_ac_path+"includes/json/send/send_settings.php",{popoutchat:"99"},function(){});qt();zt();tn();e.idleTimer(6e4*ArrowChat.IdleTime)})}function ot(){function i(e,t){if(e[13]<t[13])return-1;if(e[13]>t[13])return 1;return 0}var r=apps.slice();apps.sort(i);for(b in apps){if(typeof apps[b][0]!="undefined"){if(apps[b][10]==""||apps[b][10]==0)apps[b][10]=16;T[apps[b][0]]=e("<div/>").attr("id","arrowchat_applications_button_"+apps[b][0]).addClass("arrowchat_appname_"+apps[b][2]).addClass("arrowchat_bar_left").addClass("arrowchat_apps_button").css("width",apps[b][10]+"px").html(ArrowChat.Templates.applications_bookmarks_tab(c_ac_path,apps,b)).appendTo(n);if((apps[b][12]=="1"||apps[b][9]!="1"&&u_id==""||u_id!=""&&apps[b][9]!="1"&&u_is_guest=="1")&&c_no_apps_menu!=1){T[apps[b][0]].hide()}if(apps[b][6]==""){N[apps[b][0]]=e("<div/>").attr("id","arrowchat_applications_button_"+apps[b][0]+"_popup").addClass("arrowchat_apppopup").css("display","none").html(ArrowChat.Templates.applications_bookmarks_window(c_ac_path,apps,b)).appendTo(t)}}}apps=r.slice();e(".arrowchat_app_keep_open").addClass("arrowchat_menu_unchecked");e(".arrowchat_app_keep_open :input").attr("checked",false);if(u_apps_open!=""&&u_apps_open!="0"){e("#arrowchat_app_keep_open_"+u_apps_open+" :input").attr("checked",true);e("#arrowchat_app_keep_open_"+u_apps_open).removeClass("arrowchat_menu_unchecked")}e(".arrowchat_apps_button").mouseover(function(){var t=e(this).attr("id").substr(30);if(T[t].hasClass("arrowchat_trayclick")){}else{if(apps[t][10]<=16||apps[t][10]=="")R(T[t],apps[t][1],true)}e(this).addClass("arrowchat_tabmouseover")});e(".arrowchat_apps_button").mouseout(function(){e(this).removeClass("arrowchat_tabmouseover");q()});e(".arrowchat_traytitle").click(function(){var t=e(this).parent().attr("id");t=t.substring(30,t.length-6);if(T[t]){T[t].click()}}).children().not(".arrowchat_tab_name").click(function(){return false});e(".arrowchat_traytitle").each(function(t,n){e(n).mouseenter(function(){e(this).addClass("arrowchat_chatboxtabtitlemouseover")});e(n).mouseleave(function(){e(this).removeClass("arrowchat_chatboxtabtitlemouseover")})});e(".arrowchat_traytitle .arrowchat_more_button").each(function(t,n){e(n).mouseenter(function(){R(e(this),lang[23],0,10,5);e(this).addClass("arrowchat_more_button_hover");e(".arrowchat_traytitle").removeClass("arrowchat_chatboxtabtitlemouseover")});e(n).mouseleave(function(){q();e(this).removeClass("arrowchat_more_button_hover");e(".arrowchat_traytitle").addClass("arrowchat_chatboxtabtitlemouseover")})});e(".arrowchat_traytitle .arrowchat_more_anchor").click(function(){q();var t=e(this).attr("id").substr(20);e("#arrowchat_apps_more_popout_"+t).toggle();e(this).addClass("arrowchat_more_button_hover");e(this).toggleClass("arrowchat_more_button_selected")});B(e(".arrowchat_menu_item"),"arrowchat_more_hover");e(".arrowchat_app_keep_open").click(function(){var t=e(this).attr("id").substr(24);e(".arrowchat_app_keep_open").addClass("arrowchat_menu_unchecked");if(e("#arrowchat_app_keep_open_"+t+" :input").is(":checked")){e("#arrowchat_app_keep_open_"+t+" :input").attr("checked",false);var n=-1;u_apps_open=""}else{e(".arrowchat_app_keep_open :input").attr("checked",false);e("#arrowchat_app_keep_open_"+t+" :input").attr("checked",true);var n=t;u_apps_open=t;e(this).removeClass("arrowchat_menu_unchecked")}e.post(c_ac_path+"includes/json/send/send_settings.php",{app_keep:n},function(){})});e(".arrowchat_apps_button").click(function(){var t=e(this).attr("id").substr(30);I(L,C);e(this).children(".arrowchat_tabalert").remove();if(apps[t][6]==""){if(tr!=t&&tr!==""){if(apps[tr][7]==1){I(N[tr],T[tr],1)}else{I(N[tr],T[tr])}tr=""}if(tr==""){N[t].css("left",T[t].offset().left).css("bottom","25px").css("width",apps[t][4]);N[t].removeClass("arrowchat_tabopen_hidden");N[t].addClass("arrowchat_tabopen");T[t].addClass("arrowchat_trayclick");if(apps[t][7]!="1"||apps[t][14]!="1"){e.get(c_ac_path+"applications/"+apps[t][2]+"/index.php",function(n){e("#arrowchat_applications_button_"+apps[t][0]+"_content").html(n)})}apps[t][14]=1;tr=t}else{if(apps[tr][7]==1){I(N[tr],T[tr],1)}else{I(N[tr],T[tr])}var n=e("#arrowchatapplist_"+tr).parent().attr("id");if(n=="arrowchat_other_applications"){T[tr].hide()}tr=""}}else{window.open(apps[t][6],"self")}})}function ut(){function i(e,t){if(e[13]<t[13])return-1;if(e[13]>t[13])return 1;return 0}C=e("<div/>").attr("id","arrowchat_applications_button").addClass("arrowchat_bar_left").addClass("arrowchat_bar_button").html(ArrowChat.Templates.applications_tab()).appendTo(n);L=e("<div/>").attr("id","arrowchat_applications_button_popup").addClass("arrowchat_tabpopup").css("display","none").html(ArrowChat.Templates.applications_window()).appendTo(t);C.css("width",c_width_apps+"px");if(c_width_apps<=25){e(".arrowchat_tray_name",C).hide()}var r=apps.slice();apps.sort(i);_appslist='<div style="border-bottom: 1px solid #e9e9e9; color: #808080; margin: 3px 2px 4px;">'+lang[20]+'</div><ul id="arrowchat_applications" class="arrowchat_connectedSortable" style="list-style-type: none; margin: 0px; padding: 0px;min-height:20px;">';for(b in apps){if(typeof apps[b][0]!="undefined"){if(apps[b][12]!="1"){if(apps[b][9]=="1"&&u_id==""||u_id!=""&&u_is_guest=="1"&&apps[b][9]=="1"||u_id!=""&&u_is_guest!="1"){_appslist+=ArrowChat.Templates.applications_bookmarks_list(c_ac_path,apps,b)}}}}_appslist+='</ul><div style="border-bottom: 1px solid #e9e9e9; color: #808080; margin: 8px 2px 4px;">'+lang[64]+'</div><ul id="arrowchat_other_applications" class="arrowchat_connectedSortable" style="list-style-type: none; margin: 0px; padding: 0px;min-height:20px;">';for(b in apps){if(typeof apps[b][0]!="undefined"){if(apps[b][12]=="1"){if(apps[b][9]=="1"&&u_id==""||u_id!=""&&u_is_guest=="1"&&apps[b][9]=="1"||u_id!=""&&u_is_guest!="1"){_appslist+=ArrowChat.Templates.applications_bookmarks_list(c_ac_path,apps,b)}}}}_appslist+="</ul>";apps=r.slice();e("#arrowchat_bookmarks").append("<div>"+_appslist+"</div>");if(u_id!=""){e("#arrowchat_applications, #arrowchat_other_applications").sortable({delay:50,connectWith:".arrowchat_connectedSortable",scroll:false,axis:"y",containment:".arrowchat_traycontent",update:function(){var t=e("#arrowchat_other_applications").sortable("toArray");var n=e(this).sortable("serialize")+"&"+e(this).attr("id")+"=1";e.post(c_ac_path+"includes/json/send/send_settings.php",n,function(){});for(var r=0;r<t.length;r++){var i=t[r].substr(17);T[i].hide();apps[i][12]="1"}var n=e("#arrowchat_applications").sortable("toArray");for(var r=0;r<n.length;r++){var s=n[r].substr(17);T[s].show();apps[s][12]=""}}})}else{e(".arrowchat_apps_subtitle").hide()}e(".arrowchat_app_link:not(.ui-sortable-helper)").on("click",function(){var t=e(this).attr("id").substr(19);if(apps[t][6]==""){T[t].show();I(L,C)}T[t].click()});e(".arrowchat_traytitle",L).mouseenter(function(){e(this).addClass("arrowchat_chatboxtabtitlemouseover")});e(".arrowchat_traytitle",L).mouseleave(function(){e(this).removeClass("arrowchat_chatboxtabtitlemouseover")});C.mouseover(function(){if(c_width_apps<=25){if(C.hasClass("arrowchat_tabclick")){}else{R(C,lang[16],true)}}e(this).addClass("arrowchat_tabmouseover")});C.mouseout(function(){e(this).removeClass("arrowchat_tabmouseover");if(c_width_apps<=25){q()}});e(".arrowchat_traytitle",L).click(function(){C.click()});C.click(function(){if(c_width_apps<=25){q()}if(tr!=""){T[tr].click();tr=""}L.css("left",C.offset().left).css("bottom","25px");e(this).toggleClass("arrowchat_tabclick");L.toggleClass("arrowchat_tabopen")})}function at(){u=e("<div/>").attr("id","arrowchat_optionsbutton").addClass("arrowchat_bar_right").addClass("arrowchat_bar_button").html(ArrowChat.Templates.notifications_tab()).appendTo(n);l=e("<div/>").attr("id","arrowchat_optionsbutton_popup").addClass("arrowchat_tabpopup").css("display","none").html(ArrowChat.Templates.notifications_window()).appendTo(t);u.mouseover(function(){l.hasClass("arrowchat_tabopen")||(Fn==0?R(u,lang[0]):R(u,lang[0]));e(this).addClass("arrowchat_tabmouseover")});u.mouseout(function(){e(this).removeClass("arrowchat_tabmouseover");q()});e(".arrowchat_see_all_link").mouseenter(function(){R(e(this),lang[21],0,10,5);e(this).parent().addClass("arrowchat_see_all_button_hover");e("#arrowchat_userstab_popup .arrowchat_userstabtitle").removeClass("arrowchat_chatboxtabtitlemouseover2")});e(".arrowchat_see_all_link").mouseleave(function(){q();e(this).parent().removeClass("arrowchat_see_all_button_hover");e("#arrowchat_userstab_popup .arrowchat_userstabtitle").addClass("arrowchat_chatboxtabtitlemouseover2")});e(".arrowchat_see_all_link").click(function(){e("#arrowchat_notifications_content").html(lang[25]);var t=0;e.ajax({url:c_ac_path+"includes/json/receive/receive_notifications.php",type:"get",cache:false,dataType:"json",success:function(n){if(n&&n!=null){e("#arrowchat_notifications_content").html("");e.each(n,function(n,r){e.each(r,function(n,r){e("<div/>").attr("id","arrowchat_alert_"+r.alert_id).attr("class","arrowchat_notification_message_div").html(r.markup).appendTo(e("#arrowchat_notifications_content"));t++})});if(t==0){e("#arrowchat_notifications_content").html(lang[9])}if(e(window).height()-l.height()<80){e("#arrowchat_notifications_content").css("height",e(window).height()-135)}else{e("#arrowchat_notifications_content").css("height","auto")}}}})});u.click(function(){if(e("#arrowchat_notification_alert").length>0){e("#arrowchat_notification_alert").remove();u.removeClass("arrowchat_tab_new_message")}I(E,h);if(gr>0){e("#arrowchat_optionsbutton .arrowchat_tabalertnf").remove();e.post(c_ac_path+"includes/json/send/send_notifications.php",{userid:u_id},function(){});gr=0}if(Fn==0){if(In==1){In=0;e("#arrowchat_userstab_text").html(lang[4]+" (<b>"+(er+Mr)+"</b>)");zt();e(".available",l).click()}q();l.css("left",u.offset().left-l.outerWidth()+u.outerWidth()).css("bottom","25px");e(this).toggleClass("arrowchat_tabclick");l.toggleClass("arrowchat_tabopen");u.toggleClass("arrowchat_optionsimages_click");I(v,p)}else if(lang[16]!="")location.href=lang[16];if(e(window).height()-l.height()<80){e("#arrowchat_notifications_content").css("height",e(window).height()-135)}else{e("#arrowchat_notifications_content").css("height","auto")}});e(".arrowchat_userstabtitle",l).click(function(){u.click()}).children().not(".arrowchat_tab_name").click(function(){return false});e(".arrowchat_userstabtitle",l).mouseenter(function(){e(this).addClass("arrowchat_chatboxtabtitlemouseover2")});e(".arrowchat_userstabtitle",l).mouseleave(function(){e(this).removeClass("arrowchat_chatboxtabtitlemouseover2")})}function ft(t,n,r){clearTimeout(Qn);if(e("#"+t).is(":visible")){e("#"+t).hide("slide",{direction:"up"},250,function(){e("#"+t+" .arrowchat_message_text").html(n);r=="error"&&e(".arrowchat_message_box").css("background-color","#ffe2e2").css("border-bottom","1px solid #ffbebe");r=="notice"&&e(".arrowchat_message_box").css("background-color","#fffae2").css("border-bottom","1px solid #ffecbe");e("#"+t).show("slide",{direction:"up"},250)})}else{r=="error"&&e(".arrowchat_message_box").css("background-color","#ffe2e2").css("border-bottom","1px solid #ffbebe");r=="notice"&&e(".arrowchat_message_box").css("background-color","#fffae2").css("border-bottom","1px solid #ffecbe");e("#"+t+" .arrowchat_message_text").html(n);e("#"+t).show("slide",{direction:"up"},250)}Qn=setTimeout(function(){e("#"+t).hide("slide",{direction:"up"},250)},5e3)}function lt(t,n,r){var i=0,s=0,o="";kn=0;Ln=0;Un=1;e.ajax({url:c_ac_path+"includes/json/receive/receive_chatroom_room.php",data:{chatroomid:t,chatroom_window:u_chatroom_open,chatroom_stay:u_chatroom_stay,chatroom_pw:r},type:"post",cache:false,dataType:"json",success:function(n){if(n){clearTimeout(Jn);var r=true;n&&e.each(n,function(t,n){if(t=="error"){e.each(n,function(e,t){r=false;Kn=0;Un=0;Bt();ft("arrowchat_chatroom_message_flyout",t.m,"error")})}});if(r){setTimeout(function(){Ft(t)},3e4);if(c_push_engine!=1){Ut();zt()}else{sn("chatroom"+t,1)}if(typeof ir[t]!="undefined"){e(".arrowchat_chatrooms_title .arrowchat_tab_name").html(lang[19]+"&nbsp;&nbsp;("+ir[t]+")")}e("#arrowchat_chatroom_leave").show();e(".arrowchat_chatroom_full_content").html(ArrowChat.Templates.chatrooms_room());y=e("#arrowchat_chatroom_chat");w=e("#arrowchat_chatroom_room_list");if(c_popout_on==1){e(".arrowchat_chatroom_popout",E).show()}e(".arrowchat_chatroom_popout",E).mouseenter(function(){R(e(this),lang[117],0,10,5);e(this).addClass("arrowchat_chatroom_popout_hover");e(".arrowchat_chatrooms_title",E).removeClass("arrowchat_chatboxtabtitlemouseover3")});e(".arrowchat_chatroom_popout",E).mouseleave(function(){e(this).removeClass("arrowchat_chatroom_popout_hover");e(".arrowchat_chatrooms_title",E).addClass("arrowchat_chatboxtabtitlemouseover3");q()});e(".arrowchat_chatroom_popout",E).unbind("click");e(".arrowchat_chatroom_popout",E).click(function(){window.open(c_ac_path+"public/chatroom/?id="+t,"chatroom","menubar=0,resizable=0,width=900,height=650,top=25,left=25,scrollbars=0,status=0")});e(".arrowchat_chatroom_message_input",E).keydown(function(t){return X(t,e(this))});e(".arrowchat_chatroom_message_input",E).keyup(function(t){return J(t,e(this))});var u=[];e(".arrowchat_smiley_box",E).html("");for(var f=0;f<Smiley.length;f++){if(e.inArray(Smiley[f][0],u)>-1){}else{e(".arrowchat_smiley_box",E).append('<div class="arrowchat_smiley_wrapper" data-id="'+f+'"><img class="arrowchat_smiley" src="'+c_ac_path+"themes/"+u_theme+"/images/smilies/"+Smiley[f][0]+'.gif" alt="" /></div>');u.push(Smiley[f][0])}}e(".arrowchat_smiley_button",E).mouseenter(function(){e(this).addClass("arrowchat_smiley_button_hover")});e(".arrowchat_smiley_button",E).mouseleave(function(){e(this).removeClass("arrowchat_smiley_button_hover")});e(".arrowchat_smiley_wrapper",E).click(function(){var t=e(this).attr("data-id");var n=e(".arrowchat_chatroom_message_input",E).val();e(".arrowchat_chatroom_message_input",E).focus().val("").val(n+Smiley[t][1]);e(".arrowchat_smiley_box",E).hide("slide",{direction:"up"},250,function(){})});e(".arrowchat_smiley_button",E).click(function(){if(e(".arrowchat_smiley_box",E).is(":visible")){e(".arrowchat_smiley_box",E).hide("slide",{direction:"up"},250,function(){})}else{e(".arrowchat_smiley_box",E).show("slide",{direction:"up"},250,function(){})}});if(c_disable_smilies==1){e(".arrowchat_smiley_button").hide();e(".arrowchat_chatroom_message_input").css("width","99%")}n&&e.each(n,function(n,r){if(n=="user_title"){e.each(r,function(e,t){if(t.admin==1){s=1;Ln=1}if(t.mod==1){i=1;kn=1}})}if(n=="chat_name"){e.each(r,function(n,r){if(typeof ir[t]=="undefined"){ir[t]=r.n;e(".arrowchat_chatrooms_title .arrowchat_tab_name").html(lang[19]+"&nbsp;&nbsp;("+ir[t]+")")}})}if(n=="chat_users"){var u;e.each(r,function(t,n){if((s==1||i==1)&&n.t==1){o='<div class="arrowchat_chatroom_options_padding"><div id="arrowchat_chatroom_make_mod_'+n.id+'" class="arrowchat_chatroom_flyout_text">'+lang[52]+'</div></div><div class="arrowchat_chatroom_options_padding"><div id="arrowchat_chatroom_ban_user_'+n.id+'" class="arrowchat_chatroom_flyout_text">'+lang[53]+"</div></div>"}if(s==1&&n.t==2){o='<div class="arrowchat_chatroom_options_padding"><div id="arrowchat_chatroom_remove_mod_'+n.id+'" class="arrowchat_chatroom_flyout_text">'+lang[54]+"</div></div>"}u=Tn(n.n);n.n=Tn(n.n).length>16?Tn(n.n).substr(0,16)+"...":n.n;e("<div/>").attr("id","arrowchat_chatroom_user_"+n.id).mouseover(function(){e(this).addClass("arrowchat_chatroom_list_hover")}).mouseout(function(){e(this).removeClass("arrowchat_chatroom_list_hover")}).addClass("arrowchat_chatroom_room_list").addClass("arrowchat_chatroom_admin_"+n.t).html('<img class="arrowchat_chatroom_avatar" src="'+n.a+'"/><span class="arrowchat_chatroom_room_name">'+n.n+'</span><span class="arrowchat_userscontentdot arrowchat_'+n.status+'"></span>').appendTo(w);e("<div/>").attr("id","arrowchat_chatroom_users_flyout_"+n.id).addClass("arrowchat_chatroom_users_flyout").html('<div class="arrowchat_chatroom_title_padding"><div id="arrowchat_chatroom_title_'+n.id+'" class="arrowchat_chatroom_flyout_text">'+u+"<br/>"+lang[43]+'</div></div><hr class="arrowchat_options_divider"/><div class="arrowchat_chatroom_options_padding"><div id="arrowchat_chatroom_visit_profile_'+n.id+'" class="arrowchat_chatroom_flyout_text">'+lang[42]+'</div></div><div class="arrowchat_chatroom_options_padding"><div id="arrowchat_chatroom_private_message_'+n.id+'" class="arrowchat_chatroom_flyout_text">'+lang[41]+'</div></div><div class="arrowchat_chatroom_options_padding"><div id="arrowchat_chatroom_block_user_'+n.id+'" class="arrowchat_chatroom_flyout_text">'+lang[84]+"</div></div>"+o).appendTo(e("#arrowchat_chatroom_user_"+n.id));if(n.t==2){e("#arrowchat_chatroom_title_"+n.id).html(u+"<br/>"+lang[44])}else if(n.t==3){e("#arrowchat_chatroom_title_"+n.id).html(u+"<br/>"+lang[45])}B(e(".arrowchat_chatroom_options_padding"),"arrowchat_options_padding_hover");It(n,s)});e(".arrowchat_chatroom_admin_3").css("background-color","#"+c_admin_bg);e(".arrowchat_chatroom_admin_3").css("color","#"+c_admin_txt)}if(n=="chat_history"){d="";e.each(r,function(e,t){if(typeof blockList[t.userid]=="undefined"){var n="";if(t.mod==1)n=lang[137];if(t.admin==1)n=lang[136];e="";fromname=t.n;if(t.n==u_name){e=" arrowchat_self"}var r=new Date(t.t*1e3);if(t.global==1){d+='<div class="arrowchat_chatroom_box_message" id="arrowchat_chatroom_message_'+t.id+'"><div class="arrowchat_chatroom_message_content'+e+' arrowchat_global_chatroom_message">'+pt(r)+t.m+"</div></div>"}else{d+='<div class="arrowchat_chatroom_box_message" id="arrowchat_chatroom_message_'+t.id+'"><img class="arrowchat_chatroom_message_avatar" src="'+t.a+'" alt="" /><div class="arrowchat_chatroom_message_name">'+fromname+n+':</div><div class="arrowchat_chatroom_message_content'+e+'">'+pt(r)+t.m+"</div></div>"}}});y.html("<div>"+d+"</div>");mt();y.scrollTop(5e4)}});if(c_disable_avatars==1||e("#arrowchat_setting_names_only :input").is(":checked")){e(".arrowchat_chatroom_avatar").addClass("arrowchat_hide_avatars");e(".arrowchat_chatroom_message_avatar").addClass("arrowchat_hide_avatars")}e(".arrowchat_chatroom_message_input").focus()}else{if(c_user_chatrooms=="1"){S.show()}}}}})}function ct(t,n,r,s,o,u,f,l){if(!(t==null||t=="")){if((uc_name[t]==null||uc_name[t]=="")&&t.toString().search("facebook")=="-1"){if(ur[t]!=1){ur[t]=1;e.ajax({url:c_ac_path+"includes/json/receive/receive_user.php",data:{userid:t},type:"post",cache:false,dataType:"json",success:function(l){if(l){n=uc_name[t]=l.n;r=uc_status[t]=l.s;s=uc_avatar[t]=l.a;o=uc_avatar_class[t]=l.ac;u=uc_link[t]=l.l;if(or[t]!=null){e(".arrowchat_closebox_bottom_status",$user[t]).removeClass("arrowchat_available arrowchat_busy arrowchat_offline").addClass("arrowchat_"+r);O[t].removeClass("arrowchat_tab_offline").addClass("arrowchat_tab_"+n);M[t].length>0&&e(".arrowchat_tabsubtitle .arrowchat_message",M[t]).html(i)}ur[t]=0;if(n!=null){ht(t,n,r,s,o,u,f);if(c_mobile_device){an()}}else{e.post(c_ac_path+"includes/json/send/send_settings.php",{unfocus_chat:t},function(){})}}}})}else{setTimeout(function(){ct(t,uc_name[t],uc_status[t],uc_avatar[t],uc_avatar_class[t],uc_link[t],f,l)},500)}}else{if(t.toString().search("facebook")=="-1")ht(t,uc_name[t],uc_status[t],uc_avatar[t],uc_avatar_class[t],uc_link[t],f);else ht(t,uc_name[t],uc_status[t],uc_avatar[t],uc_avatar_class[t],uc_link[t],f,1)}}}function ht(n,r,i,s,o,u,f,l){if(or[n]!=null){if(!O[n].hasClass("arrowchat_tabclick")&&f!=1){if(Bn!=""){I(M[Bn],O[Bn]);Bn=""}if(O[n].offset().left<D.offset().left+D.width()&&O[n].offset().left-D.offset().left>=0)O[n].click();else{e(".arrowchat_tabalert").css("display","none");s=800;if(Lt("initialize")==1)s=0;D.scrollTo(O[n],s,function(){O[n].click();Nt();Tt()})}}Nt()}else{P.width(P.width()+148);St();shortname=Tn(r).length>12?Tn(r).substr(0,12)+"...":r;longname=Tn(r).length>17?Tn(r).substr(0,17)+"...":r;O[n]=e(ArrowChat.Templates.chat_tab(shortname)).attr("data-id",n).appendTo(P);O[n].append('<div class="arrowchat_closebox_bottom_status arrowchat_'+i+'"></div>');O[n].addClass("arrowchat_tab_"+i);l==1&&O[n].addClass("arrowchat_jabber_user_tab");O[n].append('<div class="arrowchat_closebox_bottom"></div>');e(".arrowchat_closebox_bottom",O[n]).mouseenter(function(){e(this).addClass("arrowchat_closebox_bottomhover")});e(".arrowchat_closebox_bottom",O[n]).mouseleave(function(){e(this).removeClass("arrowchat_closebox_bottomhover")});e(".arrowchat_closebox_bottom",O[n]).click(function(){e.post(c_ac_path+"includes/json/send/send_settings.php",{close_chat:n,tab_alert:1},function(){});M[n].remove();O[n].remove();if(Bn==n)Bn="";P.width(P.width()-148);D.scrollTo("-=148px");St();sr[n]=null;or[n]=null;ar[n]=0});h=r="";if(u!=""){r='<a href="'+u+'">';h="</a>"}u="";if(s!="")u='<div class="arrowchat_avatarbox">'+r+'<img src="'+s+'" class="arrowchat_avatar" />'+h+"</div>";M[n]=e(ArrowChat.Templates.chat_window(r,longname,h,u,n)).css("display","none").appendTo(t);if(c_video_chat!=1){e("#arrowchat_video_chat_"+n).hide()}if(c_file_transfer!=1){e("#arrowchat_file_transfer_"+n).hide()}if(c_popout_on!=1){e(".arrowchat_chat_popout").hide()}B(e(".arrowchat_video_chat"),"arrowchat_more_hover");e("#arrowchat_file_cancel_"+n).click(function(){e("#arrowchat_file_upload_div_"+n).hide("slide",{direction:"up"},250)});e("#arrowchat_file_transfer_"+n).click(function(){var t=Math.round((new Date).getTime());var r=c_ac_path.replace("../","/");e("#arrowchat_file_upload_"+n).uploadify({swf:r+"includes/js/uploadify/uploadify.swf",uploader:r+"includes/classes/class_uploads.php",hideButton:true,buttonText:" ",wmode:"transparent",formData:{unixtime:t,user:u_id},height:17,width:42,auto:true,fileTypeExts:"*.jpg;*.gif;*.png;*.zip;*.rar;*.jpeg;*.txt;*.doc;*.mp3;*.wmv;*.avi;*.mp4;*.docx;*.wav",fileTypeDesc:"Supported File Types (.JPG, .JPEG, .GIF, .PNG, .WMV, .AVI, .MP4, .ZIP, .RAR, .MP3, .WAV, .TXT, .DOC, .DOCX)",onSelect:function(){e(".arrowchat_upload_info_text").hide();e(".arrowchat_upload_text").hide();e(".arrowchat_ui_button").css("background","none");e(".arrowchat_ui_button").css("border","none")},onCancel:function(){e("#arrowchat_file_upload_div_"+n).hide("slide",{direction:"up"},250);e(".arrowchat_upload_info_text").show();e(".arrowchat_upload_text").show();e(".arrowchat_ui_button").css("background","#5B74A8");e(".arrowchat_ui_button").css("border","1px solid #999")},onUploadComplete:function(){e.post(c_ac_path+"includes/json/send/send_message.php",{userid:u_id,to:n,message:"file{"+t+"}"},function(t){if(t=="-1"){ft("arrowchat_chatbox_message_flyout_"+n,lang[102],"error")}else{ft("arrowchat_chatbox_message_flyout_"+n,lang[68],"notice")}e(".arrowchat_tabcontenttext",M[n]).scrollTop(e(".arrowchat_tabcontenttext",M[n])[0].scrollHeight)});e("#arrowchat_file_upload_div_"+n).hide();e(".arrowchat_upload_info_text").show();e(".arrowchat_upload_text").show();e(".arrowchat_ui_button").css("background","#5B74A8");e(".arrowchat_ui_button").css("border","1px solid #999")}});e("#arrowchat_more_popout_"+n).toggle();e("#arrowchat_more_"+n).toggleClass("arrowchat_more_button_selected");e("#arrowchat_file_upload_div_"+n).show("slide",{direction:"up"},250)});e("#arrowchat_video_chat_"+n).click(function(){e("#arrowchat_more_popout_"+n).toggle();e("#arrowchat_more_"+n).toggleClass("arrowchat_more_button_selected");var t=Math.floor(Math.random()*9999999999);while(String(t).length<10){t="0"+t}jqac.arrowchat.videoWith(t);e.post(c_ac_path+"includes/json/send/send_message.php",{userid:u_id,to:n,message:"video{"+t+"}"},function(t){if(t=="-1"){ft("arrowchat_chatbox_message_flyout_"+n,lang[102],"error")}else{ft("arrowchat_chatbox_message_flyout_"+n,lang[63],"notice")}e(".arrowchat_tabcontenttext",M[n]).scrollTop(e(".arrowchat_tabcontenttext",M[n])[0].scrollHeight)})});var c=[];for(var h=0;h<Smiley.length;h++){if(e.inArray(Smiley[h][0],c)>-1){}else{e(".arrowchat_smiley_box",M[n]).append('<div class="arrowchat_smiley_wrapper" data-id="'+h+'"><img class="arrowchat_smiley" src="'+c_ac_path+"themes/"+u_theme+"/images/smilies/"+Smiley[h][0]+'.gif" alt="" /></div>');c.push(Smiley[h][0])}}e(".arrowchat_smiley_button",M[n]).mouseenter(function(){e(this).addClass("arrowchat_smiley_button_hover")});e(".arrowchat_smiley_button",M[n]).mouseleave(function(){e(this).removeClass("arrowchat_smiley_button_hover")});e(".arrowchat_smiley_wrapper",M[n]).click(function(){var t=e(this).attr("data-id");var r=e(".arrowchat_textarea",M[n]).val();e(".arrowchat_textarea",M[n]).focus().val("").val(r+Smiley[t][1]);e(".arrowchat_smiley_box",M[n]).hide("slide",{direction:"up"},250,function(){})});e(".arrowchat_smiley_button",M[n]).click(function(){if(e(".arrowchat_smiley_box",M[n]).is(":visible")){e(".arrowchat_smiley_box",M[n]).hide("slide",{direction:"up"},250,function(){})}else{e(".arrowchat_smiley_box",M[n]).show("slide",{direction:"up"},250,function(){})}});if(c_disable_smilies==1){e(".arrowchat_smiley_button").hide();e(".arrowchat_textarea").css("width","99%")}e(".arrowchat_tabtitle .arrowchat_more_button",M[n]).mouseenter(function(){R(e(this),lang[23],0,10,5);e(this).addClass("arrowchat_more_button_hover");e(".arrowchat_tabtitle",M[n]).removeClass("arrowchat_chatboxtabtitlemouseover")});e(".arrowchat_tabtitle .arrowchat_more_button",M[n]).mouseleave(function(){q();e(this).removeClass("arrowchat_more_button_hover");e(".arrowchat_tabtitle",M[n]).addClass("arrowchat_chatboxtabtitlemouseover")});e("#arrowchat_more_"+n).click(function(){q();e("#arrowchat_more_popout_"+n).toggle();e(this).addClass("arrowchat_more_button_hover");e(this).toggleClass("arrowchat_more_button_selected")});e("#arrowchat_block_"+n).click(function(){e("#arrowchat_more_popout_"+n).toggle();e("#arrowchat_more_"+n).toggleClass("arrowchat_more_button_selected");e(".arrowchat_tabtitle .arrowchat_closebox",M[n]).click();e.post(c_ac_path+"includes/json/send/send_settings.php",{block_chat:n},function(){if(typeof blockList[n]=="undefined"){blockList[n]=n}qt()})});e("#arrowchat_clear_"+n).click(function(){e("#arrowchat_more_popout_"+n).toggle();e("#arrowchat_more_"+n).toggleClass("arrowchat_more_button_selected");e("#arrowchat_tabcontenttext_"+n).html("");e.post(c_ac_path+"includes/json/send/send_settings.php",{clear_chat:n},function(){})});e(".arrowchat_textarea",M[n]).keydown(function(t){return V(t,e(this),n,l)});e(".arrowchat_textarea",M[n]).keyup(function(t){return K(t,e(this),n)});e(".arrowchat_tabtitle .arrowchat_closebox",M[n]).mouseenter(function(){R(e(this),lang[89],0,10,5);e(this).addClass("arrowchat_chatboxmouseoverclose");e(".arrowchat_tabtitle",M[n]).removeClass("arrowchat_chatboxtabtitlemouseover")});e(".arrowchat_tabtitle .arrowchat_closebox",M[n]).mouseleave(function(){e(this).removeClass("arrowchat_chatboxmouseoverclose");e(".arrowchat_tabtitle",M[n]).addClass("arrowchat_chatboxtabtitlemouseover");q()});e(".arrowchat_tabtitle .arrowchat_closebox",M[n]).click(function(){q();e.post(c_ac_path+"includes/json/send/send_settings.php",{close_chat:n,tab_alert:1},function(){});M[n].remove();O[n].remove();if(Bn==n)Bn="";P.width(P.width()-148);D.scrollTo("-=148px");St();or[n]=null;sr[n]=null;ar[n]=0});e(".arrowchat_tabtitle .arrowchat_chat_popout",M[n]).mouseenter(function(){R(e(this),lang[88],0,10,5);e(this).addClass("arrowchat_chat_popout_hover");e(".arrowchat_tabtitle",M[n]).removeClass("arrowchat_chatboxtabtitlemouseover")});e(".arrowchat_tabtitle .arrowchat_chat_popout",M[n]).mouseleave(function(){e(this).removeClass("arrowchat_chat_popout_hover");e(".arrowchat_tabtitle",M[n]).addClass("arrowchat_chatboxtabtitlemouseover");q()});e(".arrowchat_tabtitle .arrowchat_chat_popout",M[n]).click(function(){wt()});e(".arrowchat_tabtitle .arrowchat_chat_popout",M[n]).popupWindow({windowURL:c_ac_path+"public/popout/",height:650,width:900,top:25,left:25});e(".arrowchat_tabtitle",M[n]).not(".arrowchat_chat_popout").click(function(){O[n].click()}).children().not(".arrowchat_tab_name").click(function(){return false});e(".arrowchat_tabtitle",M[n]).mouseenter(function(){e(this).addClass("arrowchat_chatboxtabtitlemouseover")});e(".arrowchat_tabtitle",M[n]).mouseleave(function(){e(this).removeClass("arrowchat_chatboxtabtitlemouseover")});O[n].mouseenter(function(){e(this).addClass("arrowchat_tabmouseover");e("div",O[n]).addClass("arrowchat_tabmouseovertext")});O[n].mouseleave(function(){e(this).removeClass("arrowchat_tabmouseover");e("div",O[n]).removeClass("arrowchat_tabmouseovertext")});O[n].click(function(){var t=0;if(e(".arrowchat_tabalert",O[n]).length>0){t=1;e(".arrowchat_tabalert",O[n]).remove();O[n].removeClass("arrowchat_tab_new_message");or[n]=0;sr[n]=0}if(e(this).hasClass("arrowchat_tabclick")){I(M[n],e(this));e(".arrowchat_closebox_bottom",O[n]).removeClass("arrowchat_closebox_bottom_click");Bn="";e.post(c_ac_path+"includes/json/send/send_settings.php",{unfocus_chat:n,tab_alert:1},function(){})}else{if(Bn!=""){I(M[Bn],O[Bn]);e(".arrowchat_closebox_bottom",O[Bn]).removeClass("arrowchat_closebox_bottom_click");Bn=""}if(!(O[n].offset().left<D.offset().left+D.width()&&O[n].offset().left-D.offset().left>=0)){D.scrollTo(O[n]);Nt()}if(ar[n]!=1){if(l==1)wn(n);else dt(n);ar[n]=1}e.post(c_ac_path+"includes/json/send/send_settings.php",{focus_chat:n,tab_alert:t},function(){});M[n].css("left",O[n].offset().left-M[n].outerWidth()+O[n].outerWidth()).css("bottom","25px");e(this).addClass("arrowchat_tabclick").addClass("arrowchat_usertabclick");M[n].addClass("arrowchat_tabopen");e(".arrowchat_closebox_bottom",O[n]).addClass("arrowchat_closebox_bottom_click");Bn=n;if(Wn){M[Bn].css("position","absolute").css("top",parseInt(e(window).height())-parseInt(M[Bn].css("bottom"))-parseInt(M[Bn].height())+e(window).scrollTop()+"px")}}e(".arrowchat_tabcontenttext",M[n]).scrollTop(e(".arrowchat_tabcontenttext",M[n])[0].scrollHeight);At("updatingsession")!=1&&e(".arrowchat_textarea",M[n]).focus()});f!=1&&O[n].click();sr[n]=0;or[n]=0;if(c_disable_avatars==1){e(".arrowchat_avatarbox").hide();e("#arrowchat_setting_names_only").parent("li").hide()}if(l==1){e(".arrowchat_more_button",M[n]).hide();e(".arrowchat_chat_popout",M[n]).hide()}}}function pt(e){var t=e.getTime();var n=e.getTimezoneOffset()*6e4;var r=t+n;var i=parseFloat(app.user_timezone);var s=r+36e5*i;var e=new Date(s);var o="am",u=e.getHours(),a=e.getMinutes(),f=e.getDate();e=e.getMonth();var l=u;if(u>11)o="pm";if(u>12)u-=12;if(u==0)u=12;if(u<10)u=u;if(a<10)a="0"+a;var c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],h="th";if(f==1||f==21||f==31)h="st";else if(f==2||f==22)h="nd";else if(f==3||f==23)h="rd";if(c_us_time!=1){return f!=dr?'<span class="arrowchat_ts">'+l+":"+a+" "+f+h+" "+c[e]+"</span>":'<span class="arrowchat_ts">'+l+":"+a+"</span>"}else{return f!=dr?'<span class="arrowchat_ts">'+u+":"+a+o+" "+f+h+" "+c[e]+"</span>":'<span class="arrowchat_ts">'+u+":"+a+o+"</span>"}}function dt(t,n){if(n){}else n=1;if(n>1){e('<div class="arrowchat_message_history_loading" style="text-align:center;padding:5px 0;"><img src="'+c_ac_path+"themes/"+u_theme+'/images/img-loading.gif" alt="Loading" /></div>').prependTo(e("#arrowchat_tabcontenttext_"+t))}e.ajax({cache:false,url:c_ac_path+"includes/json/receive/receive_history.php",data:{chatbox:t,history:n},type:"post",dataType:"json",success:function(r){e(".arrowchat_message_history_loading").remove();hr[t]=0;numMessages=0;if(r){if(n==1)e(".arrowchat_tabcontenttext",M[t]).html("");lr[t]=null;var i="",s=uc_name[t],o=false;e.each(r,function(n,r){n=="messages"&&e.each(r,function(e,n){numMessages++;e="";if(n.self==1){fromname=u_name;fromid=u_id;e=" arrowchat_self";_aa5=_aa4="";avatar=u_avatar;avatar_class=u_avatar_class;tooltip=lang[90]}else{fromname=s;fromid=t;_aa4='<a href="'+uc_link[t]+'">';_aa5="</a>";avatar=uc_avatar[n.from];avatar_class=uc_avatar_class[n.from];tooltip=fromname}var r=fromid;var u=new Date(n.sent*1e3);if(c_show_full_name!="1"){if(fromname.indexOf(" ")!=-1)fromname=fromname.slice(0,fromname.indexOf(" "))}if(n.sent-lr[n.from]>60||lr[n.from]==null||cr[n.from]!=r){if(o==true){i+="</div>"}i+='<div class="arrowchat_chatboxmessage arrowchat_clearfix" id="arrowchat_message_'+n.id+'"><div class="arrowchat_chatboxmessagefrom'+e+'"><div class="arrowchat_disable_avatars_name">'+fromname+'</div><img alt="'+tooltip+'" class="arrowchat_chatbox_avatar 1 '+avatar_class+'" src="'+avatar+'" /></div><div class="arrowchat_chatboxmessage_wrapper"><div class="arrowchat_chatboxmessagecontent'+e+'">'+pt(u)+n.message+"</div></div>";lr[n.from]=n.sent;cr[n.from]=r;o=true;fr[n.from]=n.id}else{i+='<div id="arrowchat_message_'+n.id+'" class="arrowchat_chatboxmessagecontent'+e+'">'+n.message+"</div>"}})});var u=e("#arrowchat_tabcontenttext_"+t).children().children().first();if(n>1){e(i).prependTo(e("#arrowchat_tabcontenttext_"+t).children("div"))}else{e("#arrowchat_tabcontenttext_"+t).html("<div>"+i+"</div>")}vt();if(c_disable_avatars==1||e("#arrowchat_setting_names_only :input").is(":checked")){yt(1)}var f=0;u.prevAll().each(function(){f+=e(this).outerHeight()});if(n==1)e("#arrowchat_tabcontenttext_"+t).scrollTop(5e4);else e("#arrowchat_tabcontenttext_"+t).scrollTop(f);e("#arrowchat_tabcontenttext_"+t).scroll(function(){if(e("#arrowchat_tabcontenttext_"+t).scrollTop()<50&&hr[t]!=1){hr[t]=1;if(numMessages==20){n++;dt(t,n)}}})}}})}function vt(){e(".arrowchat_chatbox_avatar").mouseenter(function(){R(e(this),e(this).attr("alt"),false,55,-38,1)});e(".arrowchat_chatbox_avatar").mouseleave(function(){q()});e(".arrowchat_chatboxmessage").mouseenter(function(){e(this).children().children(".arrowchat_chatboxmessagecontent").children(".arrowchat_ts").show()});e(".arrowchat_chatboxmessage").mouseleave(function(){e(this).children().children(".arrowchat_chatboxmessagecontent").children(".arrowchat_ts").hide()})}function mt(){e(".arrowchat_chatroom_box_message").mouseenter(function(){e(this).children(".arrowchat_chatroom_message_content").children(".arrowchat_ts").show()});e(".arrowchat_chatroom_box_message").mouseleave(function(){e(this).children(".arrowchat_chatroom_message_content").children(".arrowchat_ts").hide()})}function gt(t,n,r){if(uc_name[t]==null||uc_name[t]=="")setTimeout(function(){gt(t,n,r)},500);else{ct(t,uc_name[t],uc_status[t],uc_avatar[t],uc_avatar_class[t],uc_link[t],1);if(r==1)if(e(".arrowchat_tabalert",O[t]).length>0)n=parseInt(e(".arrowchat_tabalert",O[t]).html())+parseInt(n);if(n==0){O[t].removeClass("arrowchat_tab_new_message");e(".arrowchat_tabalert",O[t]).remove()}else{if(e(".arrowchat_tabalert",O[t]).length>0){e(".arrowchat_tabalert",O[t]).html(n);if(Cn==1){Cn=0;e(".arrowchat_tabalert",O[t]).stop(true,true).effect("bounce",{times:3,distance:5},200,function(){Cn=1})}}else e("<div/>").css("top","-11px").css("left","112px").addClass("arrowchat_tabalert").html(n).appendTo(O[t]);O[t].removeClass("arrowchat_tab_new_message").addClass("arrowchat_tab_new_message")}sr[t]=n;Tt()}}function yt(t){if(t==1){e(".arrowchat_userlist_avatar").addClass("arrowchat_hide_avatars");e(".arrowchat_chatroom_avatar").addClass("arrowchat_hide_avatars");e(".arrowchat_chatroom_message_avatar").addClass("arrowchat_hide_avatars");e(".arrowchat_chatbox_avatar").hide();e(".arrowchat_disable_avatars_name").show();e(".arrowchat_chatboxmessage_wrapper").addClass("arrowchat_chatboxmessage_wrapper2");e(".arrowchat_chatboxmessagecontent").addClass("arrowchat_chatboxmessagecontent2")}else{e(".arrowchat_userlist_avatar").removeClass("arrowchat_hide_avatars");e(".arrowchat_chatroom_avatar").removeClass("arrowchat_hide_avatars");e(".arrowchat_chatroom_message_avatar").removeClass("arrowchat_hide_avatars");e(".arrowchat_chatbox_avatar").show();e(".arrowchat_disable_avatars_name").hide();e(".arrowchat_chatboxmessage_wrapper").removeClass("arrowchat_chatboxmessage_wrapper2");e(".arrowchat_chatboxmessagecontent").removeClass("arrowchat_chatboxmessagecontent2")}}function bt(){var r="";p=e("<div/>").attr("id","arrowchat_buddy_list_tab").addClass("arrowchat_bar_button").addClass("arrowchat_bar_right").html(ArrowChat.Templates.buddylist_tab()).appendTo(n);v=e("<div/>").attr("id","arrowchat_userstab_popup").addClass("arrowchat_tabpopup").css("display","none").html(ArrowChat.Templates.buddylist_window(r,Pr,br)).appendTo(t);e(".arrowchat_facebook_connect").append('<img style="position:relative;left:2px;top:1px" src="'+c_ac_path+"themes/"+u_theme+'/images/img-facebook-icon.gif" alt="Connect to Facebook" /><span style="position:relative;top:-2px;left:5px;"><a href="javascript:void(0);">'+lang[140]+"</a></span>").mouseover(function(){e(this).addClass("arrowchat_facebook_connect_hover")}).mouseout(function(){e(this).removeClass("arrowchat_facebook_connect_hover")});e(".arrowchat_facebook_connect").click(function(){arrowchatdoLogin();return false});if(c_disable_avatars==1){e("#arrowchat_name_box").hide();e("#arrowchat_setting_names_only").parent("li").hide()}p.css("width",c_width_blist+"px");if(c_width_blist<=25){e("#arrowchat_userstab_text").hide()}if(c_theme_change!=1){e(".arrowchat_theme_button").hide()}e(".arrowchat_powered_by").css("display","none");e(".arrowchat_search_friends_text").placeholder();if(u_sounds==1){e("#arrowchat_setting_sound :input").attr("checked",true)}else{e("#arrowchat_setting_sound").addClass("arrowchat_menu_unchecked");e("#arrowchat_setting_sound :input").attr("checked",false)}if(u_blist_open==1){e("#arrowchat_setting_window_open :input").attr("checked",true)}else{e("#arrowchat_setting_window_open").addClass("arrowchat_menu_unchecked");e("#arrowchat_setting_window_open :input").attr("checked",false)}if(u_no_avatars==1){e("#arrowchat_setting_names_only :input").attr("checked",true)}else{e("#arrowchat_setting_names_only").addClass("arrowchat_menu_unchecked");e("#arrowchat_setting_names_only :input").attr("checked",false)}u_is_guest==1&&c_guest_name_change==1&&u_guest_name==""&&e(".arrowchat_enter_name_wrapper").show();e("#arrowchat_guest_name_input").placeholder();e("#arrowchat_guest_name_input").keydown(function(t){if(t.keyCode==13){e.post(c_ac_path+"includes/json/send/send_settings.php",{chat_name:e(this).val()},function(t){if(t!="1"){ft("arrowchat_buddylist_message_flyout",t,"error")}else{e(".arrowchat_enter_name_wrapper").slideUp("fast");u_name=e(this).val()}})}});e(".arrowchat_search_friends_text").keyup(function(){e(".arrowchat_search_not_found").remove();var t=1,n=true,r="",i=e(this).val();if(i==""){e(".arrowchat_userlist").each(function(){r=e(this).attr("id").substr(19);e("#arrowchat_userlist_"+r).removeClass("arrowchat_userlist_hover2").show();e("#arrowchat_userlist_"+r+" > span.arrowchat_userscontentname:icontains('"+i+"')").removeHighlight()});n=false}else e(".arrowchat_userlist").each(function(){r=e(this).attr("id").substr(19);if(e("#arrowchat_userlist_"+r+" > span.arrowchat_userscontentname:icontains('"+i+"')").length>0){e("#arrowchat_userlist_"+r).removeClass("arrowchat_userlist_hover2").show();t==1&&e("#arrowchat_userlist_"+r).addClass("arrowchat_userlist_hover2");e("#arrowchat_userlist_"+r+" > span.arrowchat_userscontentname:icontains('"+i+"')").removeHighlight();e("#arrowchat_userlist_"+r+" > span.arrowchat_userscontentname:icontains('"+i+"')").highlight(i);n=false;t++}else e("#arrowchat_userlist_"+r).hide()});n&&e("<div/>").attr("class","arrowchat_search_not_found arrowchat_nofriends").html(lang[26]).prependTo("#arrowchat_userscontent")});e(document).bind("idle.idleTimer",function(){if(In!=1){Q();e("#arrowchat_userstab_icon").addClass("arrowchat_user_away2");G("away");Rn=1}});e(document).bind("active.idleTimer",function(){if(In!=1){Q();G("available");e("#arrowchat_userstab_icon").addClass("arrowchat_user_available2");Rn=0}});e.idleTimer(6e4*ArrowChat.IdleTime);e("#arrowchat_theme_button").click(function(){e("#arrowchat_theme_flyout").toggleClass("arrowchat_theme_flyout_display");e(".arrowchat_theme_link").addClass("arrowchat_theme_button_hover");e(".arrowchat_theme_link").toggleClass("arrowchat_more_button_selected");var t=e(".arrowchat_themeswitcher").val();e.post(c_ac_path+"includes/json/send/send_settings.php",{theme:t},function(n){e("#arrowchat_css").attr({href:c_ac_path+"external.php?type=css&t="+t});window.location.reload()})});e("#arrowchat_setting_sound").click(function(){e(this).toggleClass("arrowchat_menu_unchecked");if(e("#arrowchat_setting_sound :input").is(":checked")){e("#arrowchat_setting_sound :input").attr("checked",false);_soundcheck=-1;u_sounds=0}else{e("#arrowchat_setting_sound :input").attr("checked",true);_soundcheck=1;u_sounds=1}e.post(c_ac_path+"includes/json/send/send_settings.php",{sound:_soundcheck},function(){})});e("#arrowchat_setting_window_open").click(function(){e(this).toggleClass("arrowchat_menu_unchecked");if(e("#arrowchat_setting_window_open :input").is(":checked")){e("#arrowchat_setting_window_open :input").attr("checked",false);_windowcheck=-1}else{e("#arrowchat_setting_window_open :input").attr("checked",true);_windowcheck=1}e.post(c_ac_path+"includes/json/send/send_settings.php",{window:_windowcheck},function(){})});e("#arrowchat_setting_names_only").click(function(){e(this).toggleClass("arrowchat_menu_unchecked");if(e("#arrowchat_setting_names_only :input").is(":checked")){e("#arrowchat_setting_names_only :input").prop("checked",false);yt(0);_namecheck=-1}else{e("#arrowchat_setting_names_only :input").prop("checked",true);yt(1);_namecheck=1}e.post(c_ac_path+"includes/json/send/send_settings.php",{name:_namecheck},function(){})});e("#arrowchat_setting_block_list").click(function(){e(this).parent().parent(".arrowchat_inner_menu").hide();e(".arrowchat_block_menu").show();e.ajax({url:c_ac_path+"includes/json/receive/receive_block_list.php",type:"get",cache:false,dataType:"json",success:function(t){if(t&&t!=null){e(".arrowchat_block_menu select").html("");e("<option/>").attr("value","0").html(lang[118]).appendTo(e(".arrowchat_block_menu select"));e.each(t,function(t,n){e.each(n,function(t,n){e("<option/>").attr("value",n.id).html(n.username).appendTo(e(".arrowchat_block_menu select"))})})}}})});e("#arrowchat_unblock_button").click(function(){e(".arrowchat_panel_item").click();var t=e(".arrowchat_block_menu select").val();if(t!="0"){e.post(c_ac_path+"includes/json/send/send_settings.php",{unblock_chat:t},function(){if(typeof blockList[t]!="undefined"){blockList.splice(t,1)}qt()})}});e(".arrowchat_theme_link").mouseenter(function(){R(e(this),lang[94],0,10,5);e(this).parent().addClass("arrowchat_theme_button_hover");e("#arrowchat_userstab_popup .arrowchat_userstabtitle").removeClass("arrowchat_chatboxtabtitlemouseover2")});e(".arrowchat_theme_link").mouseleave(function(){q();e(this).parent().removeClass("arrowchat_theme_button_hover");e("#arrowchat_userstab_popup .arrowchat_userstabtitle").addClass("arrowchat_chatboxtabtitlemouseover2")});e(".arrowchat_theme_link").click(function(){q();e("#arrowchat_userscontent").height()<150?e("#arrowchat_theme_flyout").addClass("flyout_reversed"):e("#arrowchat_theme_flyout").removeClass("flyout_reversed");e("#arrowchat_theme_flyout").toggleClass("arrowchat_theme_flyout_display");e(this).addClass("arrowchat_theme_button_hover");e(this).toggleClass("arrowchat_more_button_selected");if(e(".arrowchat_panel_item").hasClass("arrowchat_more_button_selected")){e(".arrowchat_panel_item").toggleClass("arrowchat_more_button_selected");e("#arrowchat_options_flyout").toggleClass("arrowchat_options_flyout_display")}});e(".arrowchat_panel_item").mouseenter(function(){R(e(this),lang[23],0,10,5);e(this).parent().addClass("arrowchat_more_button_hover");e("#arrowchat_userstab_popup .arrowchat_userstabtitle").removeClass("arrowchat_chatboxtabtitlemouseover2")});e(".arrowchat_panel_item").mouseleave(function(){q();e(this).parent().removeClass("arrowchat_more_button_hover");e("#arrowchat_userstab_popup .arrowchat_userstabtitle").addClass("arrowchat_chatboxtabtitlemouseover2")});e(".arrowchat_panel_item").click(function(){q();e("#arrowchat_userscontent").height()<150?e("#arrowchat_options_flyout").addClass("flyout_reversed"):e("#arrowchat_options_flyout").removeClass("flyout_reversed");e("#arrowchat_options_flyout").toggleClass("arrowchat_options_flyout_display");e(this).addClass("arrowchat_more_button_hover");e(this).toggleClass("arrowchat_more_button_selected");if(e(".arrowchat_theme_link").hasClass("arrowchat_more_button_selected")){e(".arrowchat_theme_link").toggleClass("arrowchat_more_button_selected");e("#arrowchat_theme_flyout").toggleClass("arrowchat_theme_flyout_display")}e(".arrowchat_inner_menu").show();e(".arrowchat_block_menu").hide()});B(e(".arrowchat_menu_item"),"arrowchat_more_hover");e("#arrowchat_gooffline").click(function(){e(".arrowchat_panel_item").click();e(".arrowchat_userstabtitle").toggleClass("arrowchat_userstabtitle_button_click");en();Ut();e.idleTimer("destroy");clearTimeout(Vn);if(Bn!=""){I(M[Bn],O[Bn]);e(".arrowchat_closebox_bottom",O[Bn]).removeClass("arrowchat_closebox_bottom_click");Bn=""}e("#arrowchat_panel_options").removeClass("arrowchat_panel_hover");Y();e("#arrowchat_userstab_icon").addClass("arrowchat_user_invisible2");D.hide()});e("#arrowchat_userstab_popup .arrowchat_userstabtitle").click(function(){p.click()}).children().not(".arrowchat_tab_name").click(function(){return false});e("#arrowchat_userstab_popup .arrowchat_userstabtitle").mouseenter(function(){e(this).addClass("arrowchat_chatboxtabtitlemouseover2")});e("#arrowchat_userstab_popup .arrowchat_userstabtitle").mouseleave(function(){e(this).removeClass("arrowchat_chatboxtabtitlemouseover2")});p.mouseover(function(){if(c_width_blist<=25){if(p.hasClass("arrowchat_tabclick")){}else{R(p,lang[4])}}e(this).addClass("arrowchat_tabmouseover")});p.mouseout(function(){e(this).removeClass("arrowchat_tabmouseover");q()});p.click(function(){if(c_width_blist<=25){q()}I(E,h);if(In==1||qn==1){clearTimeout(Vn);if(u_blist_open!=1){qt()}qn=0}if(In==1){In=0;e("#arrowchat_userstab_text").html("<b>"+lang[4]+"</b> (<b>"+(er+Mr)+"</b>)");zt();tn();e.idleTimer(6e4*ArrowChat.IdleTime);G("available");e("#arrowchat_userstab_icon").addClass("arrowchat_user_available2");D.show()}I(l,u);v.css("left",p.offset().left-v.outerWidth()+p.outerWidth()).css("bottom","25px");e(this).toggleClass("arrowchat_tabclick").toggleClass("arrowchat_userstabclick");v.toggleClass("arrowchat_tabopen");Et()})}function wt(){en();Ut();e.idleTimer("destroy");clearTimeout(Vn);p.hide();o.show();D.hide();_.hide();H.hide();I(v,p);I(l,u);I(E,h);if(Bn!=""){I(M[Bn],O[Bn]);e(".arrowchat_closebox_bottom",O[Bn]).removeClass("arrowchat_closebox_bottom_click");Bn=""}e.post(c_ac_path+"includes/json/send/send_settings.php",{popoutchat:"1"},function(){})}function Et(){var t=0,n=0,r=0;if(e("#arrowchat_search_friends").is(":visible")){t=e("#arrowchat_search_friends").outerHeight()}if(e(".arrowchat_enter_name_wrapper").is(":visible")){n=e(".arrowchat_enter_name_wrapper").outerHeight()}if(e(".arrowchat_powered_by").is(":visible")){r=e(".arrowchat_powered_by").outerHeight()}if(e(".arrowchat_facebook_connect").is(":visible")){r=r+e(".arrowchat_facebook_connect").outerHeight()}if(e(window).outerHeight()-v.outerHeight()<=70&&e("#arrowchat_userscontent").outerHeight()<=e("#arrowchat_userslist_available").outerHeight()+e("#arrowchat_userslist_away").outerHeight()+e("#arrowchat_facebook_friends").outerHeight(true)+e("#arrowchat_facebook_friends_list").outerHeight(true)+e("#arrowchat_site_users").outerHeight(true)){e("#arrowchat_userscontent").css("height",e(window).outerHeight()-(94+t+n+r)+"px")}else{e("#arrowchat_userscontent").css("height","auto")}}function St(){if(c_chat_maintenance!=1&&u_id!=""){if(l!==undefined){var t=0;e(".arrowchat_notification_message_div").each(function(){t+=parseInt(e(this).outerHeight())+5});if(e(window).height()-l.height()<80&&e("#arrowchat_notifications_content").height()<=t){e("#arrowchat_notifications_content").css("height",e(window).height()-110+"px")}else{e("#arrowchat_notifications_content").css("height","auto")}}Et()}var r=e(window).width(),i=0;_.hasClass("arrowchat_chatbox_lr")||(i=19);for(t=0;t<barLinks.length;t++){i+=e("#arrowchat_trayicon_"+t).outerWidth()}if(u!==undefined)i+=u.outerWidth();if(h!==undefined)i+=h.outerWidth();if(e("#arrowchat_hide_bar_button")!==undefined)i+=e("#arrowchat_hide_bar_button").outerWidth();var s=0;for(bha in apps){if(apps[bha][12]!="1"&&typeof T[apps[bha][0]]!="undefined"){i+=T[apps[bha][0]].outerWidth()}}if(C!==undefined){i+=C.outerWidth()}if(c_no_apps_menu==1)i+=130;if(barLinks.length>0&&s>0)i+=30;xt(i);if(c_chat_maintenance!=1&&u_id!=""){if(P.width()<=n.width()-250-i){D.css("width",P.width());D.scrollTo("0px",0)}else{r=D.width();var o=Math.floor((n.width()-250-i)/148)*148;if(o<148)o=148;D.css("width",o+"px");i=D.width();r!=i&&D.scrollTo("-=148px",0)}c_notifications!=0&&l.css("left",u.offset().left-l.outerWidth()+u.outerWidth()).css("bottom","25px");c_chatrooms!=0&&E.css("left",h.offset().left-E.outerWidth()+h.outerWidth()).css("bottom","25px");if(typeof L!="undefined"){c_applications_on!=0&&L.css("left",C.offset().left).css("bottom","25px")}v.css("left",p.offset().left-v.outerWidth()+p.outerWidth()).css("bottom","25px");if(tr!=""){N[tr].css("left",T[tr].offset().left).css("bottom","25px")}if(Bn!="")if(O[Bn].offset().left<D.offset().left+D.width()&&O[Bn].offset().left-D.offset().left>=0)M[Bn].css("left",O[Bn].offset().left-M[Bn].outerWidth()+O[Bn].outerWidth()).css("bottom","25px");else{I(M[Bn],O[Bn]);i=O[Bn].offset().left-P.offset().left-(Math.floor(D.width()/148)-1)*148;D.scrollTo(i,0,function(){if(typeof O[Bn]!="undefined")O[Bn].click()})}Tt();Nt();Wn&&hn()}if(c_mobile_device==1){an()}}function xt(t){var r=e(window).width();if(c_bar_fixed==1){n.css("width",c_bar_fixed_width);if(c_bar_fixed_alignment=="left"){n.css("left",c_bar_padding)}if(c_bar_fixed_alignment=="center"){var i=(r-c_bar_fixed_width)/2;n.css("left",i)}if(c_bar_fixed_alignment=="right"){var i=r-c_bar_fixed_width;n.css("left",i-c_bar_padding)}}else{var s=parseInt(450)+parseInt(t)+parseInt(c_bar_padding*2);if(r<s){r=s}n.css("left",c_bar_padding+"px");n.css("width",r-c_bar_padding*2)}}function Tt(){var t=e(".arrowchat_tabalertlr",H);var n=e(".arrowchat_tabalertlr",_);t.html("0").css("display","none");n.html("0").css("display","none");e(".arrowchat_tabalert").each(function(){if(e(this).parent().attr("id")!="arrowchat_chatrooms_button"&&!e(this).parent().hasClass("arrowchat_apps_button")){if(e(this).parent().offset().left<D.offset().left+D.width()&&e(this).parent().offset().left-D.offset().left>=0){e(this).css("display","block")}else{e(this).css("display","none");if(e(this).parent().offset().left-D.offset().left>=0){var r=_.offset().left+_.width()-30;n.html(parseInt(e(".arrowchat_tabalertlr",_).html())+parseInt(e(this).html())).css({display:"block",left:r})}else{r=H.offset().left+H.width()-22;t.html(parseInt(e(".arrowchat_tabalertlr",H).html())+parseInt(e(this).html())).css({display:"block",left:r})}}}})}function Nt(){var t=0,n=false,r=false;if(_.hasClass("arrowchat_chatbox_right_last"))n=true;if(_.hasClass("arrowchat_chatbox_lr"))r=true;if(D.scrollLeft()==0){e(".arrowchat_tabtext",H).html("0");H.addClass("arrowchat_chatbox_left_last");e(".arrowchat_previous_tab").addClass("arrowchat_previous_tab_last");t++}else{var i=Math.floor(D.scrollLeft()/148);e(".arrowchat_tabtext",H).html(i);H.removeClass("arrowchat_chatbox_left_last");e(".arrowchat_previous_tab").removeClass("arrowchat_previous_tab_last")}if(D.scrollLeft()+D.width()==P.width()){e(".arrowchat_tabtext",_).html("0");_.addClass("arrowchat_chatbox_right_last");e(".arrowchat_next_tab").addClass("arrowchat_next_tab_last");t++}else{i=Math.floor((P.width()-(D.scrollLeft()+D.width()))/148);e(".arrowchat_tabtext",_).html(i);_.removeClass("arrowchat_chatbox_right_last");e(".arrowchat_next_tab").removeClass("arrowchat_next_tab_last")}if(t==2){_.addClass("arrowchat_chatbox_lr");H.addClass("arrowchat_chatbox_lr")}else{_.removeClass("arrowchat_chatbox_lr");H.removeClass("arrowchat_chatbox_lr")}if(!_.hasClass("arrowchat_chatbox_right_last")&&n||_.hasClass("arrowchat_chatbox_right_last")&&!n||!_.hasClass("arrowchat_chatbox_lr")&&r||_.hasClass("arrowchat_chatbox_lr")&&!r){St()}}function Ct(t){if(Bn!=""){I(M[Bn],O[Bn])}e(".arrowchat_tabalert").css("display","none");var n=100;if(Lt("initialize")==1)n=0;D.scrollTo(t,n,function(){if(Bn!="")if(O[Bn].offset().left<D.offset().left+D.width()&&O[Bn].offset().left-D.offset().left>=0)O[Bn].click();else Bn="";Tt();Nt()})}function kt(e,t){On[e]=t}function Lt(e){return On[e]?On[e]:""}function At(e){return Hn[e]?Hn[e]:""}function Ot(t){if(e(t).attr("id"))var n=e(t).attr("id").substr(19);else var n="";if(n=="")n=e(t).parent().attr("id").substr(19);ct(n,uc_name[n],uc_status[n],uc_avatar[n],uc_avatar_class[n],uc_link[n])}function Mt(t){if(x.is(":visible")){x.hide("slide",{direction:"up"},250)}c="";if(e(t).attr("id"))c=e(t).attr("id").substr(19);if(c=="")c=e(t).parent().attr("id").substr(19);if(rr[c]==2){e("#arrowchat_chatroom_password_id").val(c);if(e("#arrowchat_chatroom_"+c).hasClass("arrowchat_chatroom_clicked")){e("#arrowchat_chatroom_password_flyout").hide("slide",{direction:"up"},250);e(".arrowchat_chatroom_list").removeClass("arrowchat_chatroom_clicked")}else{e(".arrowchat_chatroom_list").removeClass("arrowchat_chatroom_clicked");e("#arrowchat_chatroom_"+c).addClass("arrowchat_chatroom_clicked");if(!e("#arrowchat_chatroom_password_flyout").is(":visible")){e("#arrowchat_chatroom_password_flyout").show("slide",{direction:"up"},250,function(){e("#arrowchat_chatroom_password_input").focus()})}else{e("#arrowchat_chatroom_password_flyout").hide("slide",{direction:"up"},250);e("#arrowchat_chatroom_password_flyout").show("slide",{direction:"up"},250,function(){e("#arrowchat_chatroom_password_input").focus()})}}}else{e(".arrowchat_chatroom_full_content").html('<div class="arrowchat_nofriends">'+lang[34]+"</div>");if(e("#arrowchat_chatroom_password_flyout").is(":visible")){e("#arrowchat_chatroom_password_flyout").hide("slide",{direction:"up"},250)}S.hide();Kn=c;lt(c,rr[c])}}function _t(t,n,r){var i="";if(kn==1)i=lang[137];if(Ln==1)i=lang[136];r=r.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>").replace(/\"/g,"&quot;");r=z(r);r=W(r);if(e("#arrowchat_chatroom_message_"+t).length>0)e("#arrowchat_chatroom_message_"+t+" .arrowchat_chatroom_message_content").html(pt(new Date(Math.floor((new Date).getTime()/1e3)*1e3))+r);else{y.append('<div class="arrowchat_chatroom_box_message" id="arrowchat_chatroom_message_'+t+'"><img class="arrowchat_chatroom_message_avatar" src="'+u_avatar+'" alt="" /><div class="arrowchat_chatroom_message_name">'+n+i+':</div><div class="arrowchat_chatroom_message_content  arrowchat_self">'+pt(new Date(Math.floor((new Date).getTime()/1e3)*1e3))+r+"</div></div>");y.scrollTop(5e4)}mt()}function Dt(t,n,r,i,s,o,u){ur[t]!=1&&ct(t,uc_name[t],uc_status[t],uc_avatar[t],uc_avatar_class[t],uc_link[t],1,1);if(uc_name[t]==null||uc_name[t]=="")setTimeout(function(){Dt(t,n,r,i,s,o,u)},500);else{var f="",l=false;if(parseInt(r)==1){fromname=u_name;fromid=u_id;f=" arrowchat_self";avatar=u_avatar;avatar_class=u_avatar_class;tooltip=lang[90]}else{fromname=uc_name[t];fromid=t;avatar=uc_avatar[t];avatar_class=uc_avatar_class[t];tooltip=fromname}var c=fromid;if(parseInt(o)==1)n=n.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");n=z(n);n=W(n);r!=1&&u_sounds==1&&!e(".arrowchat_textarea",M[t]).is(":focus")&&pn();separator=":&nbsp;&nbsp;";if(e("#arrowchat_message_"+s).length>0){e("#arrowchat_message_"+s+" .arrowchat_chatboxmessagecontent").html(n)}else{if(c_show_full_name!="1"){if(fromname.indexOf(" ")!=-1)fromname=fromname.slice(0,fromname.indexOf(" "))}if(uc_status[t]=="offline"&&r!=1){ft("arrowchat_chatbox_message_flyout_"+t,lang[13],"error")}if(u-lr[t]>60||lr[t]==null||cr[t]!=c||cr[t]==null||cr[t]==""){e(".arrowchat_tabcontenttext",M[t]).append('<div class="arrowchat_chatboxmessage arrowchat_clearfix" id="arrowchat_message_'+s+'"><div class="arrowchat_chatboxmessagefrom'+f+'"><div class="arrowchat_disable_avatars_name">'+fromname+'</div><img alt="'+tooltip+'" class="arrowchat_chatbox_avatar 2 '+avatar_class+'" src="'+avatar+'" /></div><div class="arrowchat_chatboxmessage_wrapper"><div class="arrowchat_chatboxmessagecontent'+f+'">'+pt(new Date(u*1e3))+n+"</div></div></div>");lr[t]=u;cr[t]=c;fr[t]=s}else{if(fr[t]!=="undefined"){e("#arrowchat_message_"+fr[t]).append('<div id="arrowchat_message_'+s+'" class="arrowchat_chatboxmessagecontent'+f+'">'+n+"</div>")}else{e(".arrowchat_tabcontenttext",M[t]).append('<div id="arrowchat_message_'+s+'" class="arrowchat_chatboxmessagecontent'+f+'">'+n+"</div>")}}if(c_disable_avatars==1||e("#arrowchat_setting_names_only :input").is(":checked")){yt(1)}e("#arrowchat_tabcontenttext_"+t).scrollTop(5e4);vt()}Bn!=t&&r!=1&&i!=1&&gt(t,1,1);r!=1&&ln(t,n,s)}}function Pt(e){if(uc_name[e]==null||uc_name[e]=="")setTimeout(function(){Pt(e)},500);else Bn!=e&&O[e].click()}function Ht(t,n){if(uc_name[t]==null||uc_name[t]=="")setTimeout(function(){Ht(t,n)},500);else{e("#arrowchat_tabcontenttext_"+t).append("<div>"+n+"</div>");e("#arrowchat_tabcontenttext_"+t).scrollTop(5e4);or[t]=1}}function Bt(){if(Un==0){e("#arrowchat_chatroom_leave").hide();e(".arrowchat_chatroom_popout").hide();e.ajax({url:c_ac_path+"includes/json/receive/receive_chatroom_list.php",cache:false,data:{chatroom_window:u_chatroom_open,chatroom_stay:u_chatroom_stay},type:"post",dataType:"json",success:function(e){jt(e)}})}}function jt(t){Kn=0;e(".arrowchat_chatroom_full_content").html("");var n={};t&&e.each(t,function(t,n){if(t=="chatrooms"){e.each(n,function(t,n){e("<div/>").attr("id","arrowchat_chatroom_"+n.id).mouseover(function(){e(this).addClass("arrowchat_chatroom_list_hover")}).mouseout(function(){e(this).removeClass("arrowchat_chatroom_list_hover")}).addClass("arrowchat_chatroom_list").html('<span class="arrowchat_chatroom_name">'+n.n+'</span><span class="arrowchat_chatroom_status arrowchat_chatroom_'+n.t+'"></span><span class="arrowchat_chatroom_count">'+n.c+lang[35]+"</span>").appendTo(e(".arrowchat_chatroom_full_content"));rr[n.id]=n.t;ir[n.id]=n.n})}});Un=1;e(".arrowchat_chatroom_list").click(function(e){Mt(e.target)})}function Ft(t){var n=0,r=0,i="";kn=0;Ln=0;if(Kn==t){e.ajax({url:c_ac_path+"includes/json/receive/receive_chatroom.php",cache:false,type:"post",data:{chatroomid:t},dataType:"json",success:function(t){if(t){var s=true;t&&e.each(t,function(t,n){if(t=="error"){e.each(n,function(e,t){s=false;Kn=0;Un=0;Bt();ft("arrowchat_chatroom_message_flyout",t.m,"error")})}});if(s){t&&e.each(t,function(t,s){if(t=="user_title"){e.each(s,function(e,t){if(t.admin==1){r=1;Ln=1}if(t.mod==1){n=1;kn=1}})}if(t=="chat_users"){var o;w.html("");e.each(s,function(t,s){if((r==1||n==1)&&s.t==1){i='<div class="arrowchat_chatroom_options_padding"><div id="arrowchat_chatroom_make_mod_'+s.id+'" class="arrowchat_chatroom_flyout_text">'+lang[52]+'</div></div><div class="arrowchat_chatroom_options_padding"><div id="arrowchat_chatroom_ban_user_'+s.id+'" class="arrowchat_chatroom_flyout_text">'+lang[53]+"</div></div>"}o=Tn(s.n);s.n=Tn(s.n).length>16?Tn(s.n).substr(0,16)+"...":s.n;e("<div/>").attr("id","arrowchat_chatroom_user_"+s.id).mouseover(function(){e(this).addClass("arrowchat_chatroom_list_hover")}).mouseout(function(){e(this).removeClass("arrowchat_chatroom_list_hover")}).addClass("arrowchat_chatroom_room_list").addClass("arrowchat_chatroom_admin_"+s.t).html('<img class="arrowchat_chatroom_avatar" src="'+s.a+'"/><span class="arrowchat_chatroom_room_name">'+s.n+'</span><span class="arrowchat_userscontentdot arrowchat_'+s.status+'"></span>').appendTo(w);e("<div/>").attr("id","arrowchat_chatroom_users_flyout_"+s.id).addClass("arrowchat_chatroom_users_flyout").html('<div class="arrowchat_chatroom_title_padding"><div id="arrowchat_chatroom_title_'+s.id+'" class="arrowchat_chatroom_flyout_text">'+o+"<br/>"+lang[43]+'</div></div><hr class="arrowchat_options_divider"/><div class="arrowchat_chatroom_options_padding"><div id="arrowchat_chatroom_visit_profile_'+s.id+'" class="arrowchat_chatroom_flyout_text">'+lang[42]+'</div></div><div class="arrowchat_chatroom_options_padding"><div id="arrowchat_chatroom_private_message_'+s.id+'" class="arrowchat_chatroom_flyout_text">'+lang[41]+'</div></div><div class="arrowchat_chatroom_options_padding"><div id="arrowchat_chatroom_block_user_'+s.id+'" class="arrowchat_chatroom_flyout_text">'+lang[84]+"</div></div>"+i).appendTo(e("#arrowchat_chatroom_user_"+s.id));if(s.t==2){e("#arrowchat_chatroom_title_"+s.id).html(o+"<br/>"+lang[44])}else if(s.t==3){e("#arrowchat_chatroom_title_"+s.id).html(o+"<br/>"+lang[45])}B(e(".arrowchat_chatroom_options_padding"),"arrowchat_options_padding_hover");It(s,r);uc_avatar[s.id]=s.a});e(".arrowchat_chatroom_admin_3").css("background-color","#"+c_admin_bg);e(".arrowchat_chatroom_admin_3").css("color","#"+c_admin_txt)}});if(c_disable_avatars==1||e("#arrowchat_setting_names_only :input").is(":checked")){e(".arrowchat_chatroom_avatar").addClass("arrowchat_hide_avatars");e(".arrowchat_chatroom_message_avatar").addClass("arrowchat_hide_avatars")}}}}});clearTimeout(Jn);Jn=setTimeout(function(){Ft(t)},6e4)}}function It(t,n){e("#arrowchat_chatroom_make_mod_"+t.id).click(function(){e.post(c_ac_path+"includes/json/send/send_settings.php",{chatroom_mod:t.id,chatroom_id:Kn},function(){})});e("#arrowchat_chatroom_remove_mod_"+t.id).click(function(){e.post(c_ac_path+"includes/json/send/send_settings.php",{chatroom_remove_mod:t.id,chatroom_id:Kn},function(){})});e("#arrowchat_chatroom_block_user_"+t.id).click(function(){e.post(c_ac_path+"includes/json/send/send_settings.php",{block_chat:t.id},function(e){if(e!="-1"){if(typeof blockList[t.id]=="undefined"){blockList[t.id]=t.id}qt();ft("arrowchat_chatroom_message_flyout",lang[103],"error")}})});e("#arrowchat_chatroom_ban_user_"+t.id).click(function(){var n=prompt(lang[57]);if(n!=null&&n!=""&&!isNaN(n)){e.post(c_ac_path+"includes/json/send/send_settings.php",{chatroom_ban:t.id,chatroom_id:Kn,chatroom_ban_length:n},function(){})}});e("#arrowchat_chatroom_visit_profile_"+t.id).click(function(){window.location=t.l});e("#arrowchat_chatroom_private_message_"+t.id).click(function(){if(t.b!=1||n==1){if(u_id!=t.id){jqac.arrowchat.chatWith(t.id)}}else{ft("arrowchat_chatroom_message_flyout",lang[46],"error")}});e("#arrowchat_chatroom_user_"+t.id).click(function(){if(jn!=t.id){e("#arrowchat_chatroom_user_"+jn).removeClass("arrowchat_chatroom_clicked");e("#arrowchat_chatroom_users_flyout_"+jn).removeClass("arrowchat_chatroom_create_flyout_display")}jn=t.id;e(this).toggleClass("arrowchat_chatroom_clicked");e("#arrowchat_chatroom_users_flyout_"+t.id).toggleClass("arrowchat_chatroom_create_flyout_display")})}function qt(){clearTimeout(Vn);e.ajax({url:c_ac_path+"includes/json/receive/receive_buddylist.php",cache:false,type:"get",dataType:"json",success:function(t){Rt(t);if(c_disable_avatars==1||e("#arrowchat_setting_names_only :input").is(":checked")){e(".arrowchat_userlist_avatar").addClass("arrowchat_hide_avatars")}Et();St()}});if(typeof c_list_heart_beat!="undefined"){var t=c_list_heart_beat*1e3}else{var t=6e4}Vn=setTimeout(function(){qt()},t)}function Rt(t){On.timestamp=Zn;var n={},r="";n.available="";n.busy="";n.offline="";n.invisible="";n.away="";Or=buddylistreceived=0;t&&e.each(t,function(t,i){if(t=="buddylist"){buddylistreceived=1;totalFriendsNumber=Or=0;e(".arrowchat_closebox_bottom_status").addClass("arrowchat_offline");e.each(i,function(t,i){longname=Tn(i.n).length>16?Tn(i.n).substr(0,16)+"...":i.n;if(or[i.id]!=null){e(".arrowchat_closebox_bottom_status",O[i.id]).removeClass("arrowchat_available").removeClass("arrowchat_busy").removeClass("arrowchat_offline").removeClass("arrowchat_away").addClass("arrowchat_"+i.s);O[i.id].removeClass("arrowchat_tab_offline").removeClass("arrowchat_away").addClass("arrowchat_tab_"+i.s);M[i.id].length>0&&e(".arrowchat_tabsubtitle .arrowchat_message",M[i.id]).html(i.m)}if(i.s=="available"||i.s=="away"||i.s=="busy")Or++;totalFriendsNumber++;if(e("#arrowchat_setting_names_only :input").is(":checked"))r="arrowchat_hide_avatars";n[i.s]+='<div id="arrowchat_userlist_'+i.id+'" class="arrowchat_userlist arrowchat_buddylist_admin_'+i.admin+'" onmouseover="jqac(this).addClass(\'arrowchat_userlist_hover\');" onmouseout="jqac(this).removeClass(\'arrowchat_userlist_hover\');"><img class="arrowchat_userlist_avatar 1 '+r+i.ac+'" src="'+i.a+'" /><span class="arrowchat_userscontentname">'+longname+'</span><span class="arrowchat_userscontentdot arrowchat_'+i.s+'"></span></div>';uc_status[i.id]=i.s;uc_name[i.id]=i.n;uc_avatar[i.id]=i.a;uc_avatar_class[i.id]=i.ac;uc_link[i.id]=i.l})}if(buddylistreceived==1&&qn==0){for(buddystatus in n){if(n.hasOwnProperty(buddystatus)){if(n[buddystatus]==""){e("#arrowchat_userslist_"+buddystatus).html("")}else{e("#arrowchat_userslist_"+buddystatus).html("<div>"+n[buddystatus]+"</div>")}}}e(".arrowchat_userlist").click(function(t){if(!e(this).hasClass("arrowchat_jabber_user"))Ot(t.target)});e("#arrowchat_userstab_text").html("<b>"+lang[4]+"</b> (<b>"+(Or+Mr)+"</b>)");er=Or;totalFriendsNumber==0&&e("#arrowchat_userslist_available").html('<div class="arrowchat_nofriends">'+lang[8]+"</div>");er==0&&e("#arrowchat_userslist_available").html('<div class="arrowchat_nofriends">'+lang[8]+"</div>");er>=c_search_min?e("#arrowchat_search_friends").show():e("#arrowchat_search_friends").hide();buddylistreceived=0}else{e("#arrowchat_userstab_text").html("<b>"+lang[4]+"</b> (<b>"+(Or+Mr)+"</b>)")}e(".arrowchat_buddylist_admin_1").css("background-color","#"+c_admin_bg);e(".arrowchat_buddylist_admin_1").css("color","#"+c_admin_txt)})}function Ut(){if(typeof CHA!="undefined"){clearTimeout(CHA)}if(typeof xOptions!="undefined"){xOptions.abort()}}function zt(){Ut();var t=c_ac_path+"includes/json/receive/receive_core.php?hash="+u_hash_id+"&init="+mr+"&room="+Kn;xOptions=e.ajax({url:t,dataType:"jsonp",success:function(t){On.timestamp=Zn;var n="",r={};r.available="";r.busy="";r.offline="";r.away="";Or=buddylistreceived=0;if(t&&t!=null){var i=0;e.each(t,function(t,s){if(t=="typing"){e.each(s,function(e,t){if(t.is_typing=="1"){Yt(t.typing_id)}else{Zt(t.typing_id)}})}if(t=="announcements"){e.each(s,function(e,t){$t(t)})}if(t=="chatroom"){var o=0,u="";e.each(s,function(e,t){if(typeof blockList[t.userid]=="undefined"){Wt(t.id,t.n,t.m,t.userid,t.t,t.global,t.mod,t.admin)}u=t;o++});if(typeof u!="undefined"){if(typeof blockList[u.userid]=="undefined"){mt();Vt(o);if(u.userid!=u_id){u_chatroom_sound==1&&!e(".arrowchat_chatroom_message_input").is(":focus")&&pn()}}}}if(t=="notifications"){var f="";e.each(s,function(e,t){Jt(t.alert_id,t.markup);f=t.markup});Kt(f)}if(t=="messages"){var l=0;e.each(s,function(t,n){Gt(n.id,n.from,n.message,n.sent,n.self,n.old);if(!e(".arrowchat_textarea",M[n.from]).is(":focus")){l=1}});Yn=1;Gn=$n;Bn!=""&&i>0&&Ht(Bn,n);vt();r!=1&&u_sounds==1&&l==1&&mr!=1&&pn()}})}kt("initialize","0");kt("currenttime","0");if(Fn!=1&&In!=1){Yn++;if(Yn>4){Gn*=2;Yn=1}if(Gn>12e3)Gn=12e3}mr++}});if(Rn==1){var n=c_heart_beat*1e3*3}else{var n=c_heart_beat*1e3}if(c_push_engine!=1){CHA=setTimeout(function(){zt()},n)}}function Wt(t,n,r,i,s,o,u,f){if(i==u_id){uc_avatar[u_id]=u_avatar}r=Qt(r);r=z(r);var l=new Date(s*1e3);if(typeof uc_avatar[i]=="undefined"){e.ajax({url:c_ac_path+"includes/json/receive/receive_user.php",data:{userid:i},type:"post",cache:false,dataType:"json",success:function(e){if(e){uc_avatar[i]=e.a;Xt(t,uc_avatar[i],n,l,r,o,u,f)}}})}else{Xt(t,uc_avatar[i],n,l,r,o,u,f)}An++}function Xt(t,n,r,i,s,o,u,f){var l=y[0].scrollHeight-y.scrollTop()-10;var c=y.outerHeight();var h="";if(u==1)h=lang[137];if(f==1)h=lang[136];if(e("#arrowchat_chatroom_message_"+t).length>0){}else{if(o==1){e("<div/>").attr("id","arrowchat_chatroom_message_"+t).addClass("arrowchat_chatroom_box_message").html('<div class="arrowchat_chatroom_message_content arrowchat_global_chatroom_message">'+pt(i)+s+"</div>").appendTo(y)}else{e("<div/>").attr("id","arrowchat_chatroom_message_"+t).addClass("arrowchat_chatroom_box_message").html('<img class="arrowchat_chatroom_message_avatar" src="'+n+'" alt="" /><div class="arrowchat_chatroom_message_name">'+r+h+':</div><div class="arrowchat_chatroom_message_content">'+pt(i)+s+"</div>").appendTo(y)}}if(c_disable_avatars==1||e("#arrowchat_setting_names_only :input").is(":checked")){e(".arrowchat_chatroom_message_avatar").addClass("arrowchat_hide_avatars")}if(l<=c){y.scrollTop(5e4)}else{ft("arrowchat_chatroom_message_flyout",lang[134],"notice")}mt()}function Vt(t){if(e("#arrowchat_chatrooms_button .arrowchat_tabalert").length>0&&t>0){var n=parseInt(e("#arrowchat_chatrooms_button .arrowchat_tabalert").html())+t;e("#arrowchat_chatrooms_button .arrowchat_tabalert").html(n);if(Nn==1){Nn=0;e("#arrowchat_chatrooms_button .arrowchat_tabalert").stop(true,true).effect("bounce",{times:3,distance:5},200,function(){Nn=1})}}else if(!h.hasClass("arrowchat_tabclick")){h.addClass("arrowchat_tab_new_message");e("<div/>").css("top","-11px").css("left",c_width_chatroom-10+"px").addClass("arrowchat_tabalert").html(t).appendTo(h)}}function $t(n){if(n.read==0&&n.data!=""){e("#arrowchat_announcement").remove();t.append(ArrowChat.Templates.announcements_display(n));e("#arrowchat_announcement .arrowchat_announce_close").click(function(){e("#arrowchat_announcement").remove();e.post(c_ac_path+"includes/json/send/send_settings.php",{announce:1},function(){})})}else{e("#arrowchat_announcement").remove()}}function Jt(t,n){e("<div/>").attr("id","arrowchat_alert_"+t).attr("class","arrowchat_notification_message_div").html(n).appendTo(e("#arrowchat_notifications_content"));gr++}function Kt(n){e("#arrowchat_optionsbutton .arrowchat_tabalertnf").remove();if(!u.hasClass("arrowchat_tabclick")){if(e("#arrowchat_notification_alert").length>0){e("#arrowchat_notification_alert").remove()}t.append('<div id="arrowchat_notification_alert"><div class="arrowchat_notification_alert_content">'+n+"</div></div>");e("#arrowchat_notification_alert .arrowchat_notifications_divider").hide();setTimeout(function(){e("#arrowchat_notification_alert").fadeOut("slow",function(){e("#arrowchat_notification_alert").remove()})},7e3);u.addClass("arrowchat_tab_new_message");e("<div/>").css("top","-10px").css("left","8px").addClass("arrowchat_tabalertnf").html(gr).prependTo(u)}if(gr>0){e("#arrowchat_no_new_notifications").css("display","none")}}function Qt(e){e=e.replace(/\\'/g,"'");e=e.replace(/\\"/g,'"');e=e.replace(/\\0/g,"\0");e=e.replace(/\\\\/g,"\\");return e}function Gt(t,n,r,i,s,o){appReceiveArrowchatMessage(n,r,i);Zn=t;clearTimeout(Dn);rn(uc_name[n]);if(Bn==n&&uc_name[n]!=""&&uc_name[n]!=null){var u=e("#arrowchat_tabcontenttext_"+n)[0].scrollHeight-e("#arrowchat_tabcontenttext_"+n).scrollTop()-10;var l=e("#arrowchat_tabcontenttext_"+n).outerHeight();var c=uc_name[n];if(uc_status[n]=="offline"){qt()}f="";if(s==1){fromname=u_name;fromid=u_id;f=" arrowchat_self 1 ";avatar=u_avatar;avatar_class=u_avatar_class;tooltip=lang[90]}else{rn(uc_name[n]);fromname=c;fromid=n;avatar=uc_avatar[n];avatar_class=uc_avatar_class[n];tooltip=fromname}var h=fromid;r=Qt(r);r=z(r);if(e("#arrowchat_message_"+t).length>0){e("#arrowchat_message_"+t+" .arrowchat_chatboxmessagecontent").html(r)}else{if(c_show_full_name!=1){if(fromname.indexOf(" ")!=-1)fromname=fromname.slice(0,fromname.indexOf(" "))}if(i-lr[n]>60||lr[n]==null||cr[n]!=h){e(".arrowchat_tabcontenttext",M[n]).append('<div class="arrowchat_chatboxmessage arrowchat_clearfix" id="arrowchat_message_'+t+'" style="display:none"><div class="arrowchat_chatboxmessagefrom'+f+'"><div class="arrowchat_disable_avatars_name">'+fromname+'</div><img alt="'+tooltip+'" class="arrowchat_chatbox_avatar 3 '+avatar_class+'" src="'+avatar+'" /></div><div class="arrowchat_chatboxmessage_wrapper"><div class="arrowchat_chatboxmessagecontent'+f+'">'+pt(new Date(i*1e3))+r+"</div></div></div>");if(c_chat_animations==1&&o!=1){e("#arrowchat_message_"+t).show("slide",{direction:"left"})}else{e("#arrowchat_message_"+t).show()}lr[n]=i;cr[n]=h;fr[n]=t}else{if(fr[n]!=="undefined"){e("#arrowchat_message_"+fr[n]).append('<div id="arrowchat_message_'+t+'" class="arrowchat_chatboxmessagecontent'+f+'">'+r+"</div>")}else{e(".arrowchat_tabcontenttext",M[n]).append('<div id="arrowchat_message_'+t+'" class="arrowchat_chatboxmessagecontent'+f+'">'+r+"</div>")}}if(c_disable_avatars==1||e("#arrowchat_setting_names_only :input").is(":checked")){yt(1)}}if(u<=l||!O[n].hasClass("arrowchat_tabclick")){e("#arrowchat_tabcontenttext_"+n).scrollTop(5e4)}else{ft("arrowchat_chatbox_message_flyout_"+n,lang[134],"notice")}s!=1&&o!=1&&ln(n,r,t)}else{r=Qt(r);Dt(n,r,s,o,t,0,i);Bn==""&&0&&Pt(n)}}function Yt(t){if(typeof O[t]!="undefined"){e(".arrowchat_closebox_bottom_status",O[t]).addClass("arrowchat_typing")}}function Zt(t){if(typeof O[t]!="undefined"){e(".arrowchat_closebox_bottom_status",O[t]).removeClass("arrowchat_typing")}}function en(){if(c_push_engine==1){Sr.unsubscribe({channel:"u"+u_id});Sr.unsubscribe({channel:"arrowchat"});if(Kn>0){Sr.unsubscribe({channel:"chatroom"+Kn})}}}function tn(){if(c_push_engine==1){Sr.subscribe({channel:"u"+u_id,callback:function(e){nn(e)}});Sr.subscribe({channel:"arrowchat",callback:function(e){nn(e)}})}}function nn(t){if("announcement"in t){$t(t.announcement)}if("notification"in t){var n;Jt(t.notification.alert_id,t.notification.markup);Kt(n)}if("chatroommessage"in t){if(typeof blockList[t.chatroommessage.userid]=="undefined"){Wt(t.chatroommessage.id,t.chatroommessage.name,t.chatroommessage.message,t.chatroommessage.userid,t.chatroommessage.sent,t.chatroommessage.global,t.chatroommessage.mod,t.chatroommessage.admin);Vt(1);if(t.chatroommessage.userid!=u_id){u_chatroom_sound==1&&!e(".arrowchat_chatroom_message_input").is(":focus")&&pn()}}}if("typing"in t){Yt(t.typing.id)}if("nottyping"in t){Zt(t.nottyping.id)}if("messages"in t){Gt(t.messages.id,t.messages.from,t.messages.message,t.messages.sent,t.messages.self,t.messages.old);t.messages.self!=1&&u_sounds==1&&!e(".arrowchat_textarea",M[t.messages.from]).is(":focus")&&pn();vt();Yn=1;Gn=$n}if("chatroomban"in t){Kn=0;Un=0;Bt();ft("arrowchat_chatroom_message_flyout",t.error2,"error")}}function rn(e){e=Tn(e);if(_n!=2){document.title=lang[30]+" "+e+"!";_n=2}else{document.title=Mn;_n=1}if(Pn==false){Dn=setTimeout(function(){rn(e)},1e3)}else{document.title=Mn;clearTimeout(Dn)}}function sn(e,t){if(t==1){Sr.subscribe({channel:e,callback:function(e){nn(e)}})}else{Sr.unsubscribe({channel:e})}}function on(){for(var r="",i="",s="",o=0;o<barLinks.length;o++){var f=barLinks[o];if(f[6]==""||f[6]==0)f[6]=16;if(o==barLinks.length-1)s=" arrowchat_right_border";r+='<div id="arrowchat_trayicon_'+o+'" class="arrowchat_tray_button arrowchat_bar_left'+s+'" style="width:'+f[6]+'px;"><div class="arrowchat_inner_button"><img class="arrowchat_tray_icon" src='+c_ac_path+"themes/"+u_theme+"/images/icons/"+f[0]+'><div class="arrowchat_tray_name">'+f[7]+"</div></div></div>";if(f[3]=="_popup")i+='<div id="arrowchat_trayicon_'+o+'_popup" class="arrowchat_traypopup" style="display:none"><div class="arrowchat_traytitle"><div class="arrowchat_name">'+f[1]+'</div><div class="arrowchat_minimizebox"></div><br clear="all"/></div><div class="arrowchat_traycontent"><div class="arrowchat_traycontenttext"><iframe allowtransparency="true" frameborder=0 width="'+f[4]+'" height="'+f[5]+'" id="arrowchat_trayicon_'+o+'_iframe"  ></iframe></div></div></div>'}n.append("<div>"+r+"</div>");t.append("<div>"+i+"</div>");e(".arrowchat_tray_button").mouseover(function(){var t=e(this).attr("id").substr(19);if(barLinks[t][6]<=16||barLinks[t][6]=="")R(e("#arrowchat_trayicon_"+t),barLinks[t][1],1);e(this).addClass("arrowchat_tabmouseover")});e(".arrowchat_tray_button").mouseout(function(){e(this).removeClass("arrowchat_tabmouseover");q()});e(".arrowchat_traytitle").mouseenter(function(){var t=e(this).parent().attr("id");t=t.substring(19,t.length-6);e(this).addClass("arrowchat_chatboxtabtitlemouseover")});e(".arrowchat_traytitle").mouseleave(function(){var t=e(this).parent().attr("id");t=t.substring(19,t.length-6);e(this).removeClass("arrowchat_chatboxtabtitlemouseover")});e(".arrowchat_traytitle").click(function(){var t=e(this).parent().attr("id");t=t.substring(19,t.length-6);e("#arrowchat_trayicon_"+t).click()});e(".arrowchat_tray_button").click(function(){var t=e(this).attr("id").substr(19);if(Bn!=""){I(M[Bn],O[Bn]);e(".arrowchat_closebox_bottom",O[Bn]).removeClass("arrowchat_closebox_bottom_click");Bn=""}I(v,p);I(l,u);var n="_self";if(barLinks[t][3])n=barLinks[t][3];if(n=="_popup"){if(tr!=t){I(e("#arrowchat_trayicon_"+tr+"_popup"),e("#arrowchat_trayicon_"+tr));tr=""}if(tr==""){e("#arrowchat_trayicon_"+t+"_popup").css("left",e("#arrowchat_trayicon_"+t).offset().left).css("bottom","25px").css("width",barLinks[t][4]);e("#arrowchat_trayicon_"+t+"_popup").addClass("arrowchat_tabopen");e("#arrowchat_trayicon_"+t).addClass("arrowchat_trayclick");if(e("#arrowchat_trayicon_"+t+"_iframe").attr("src")===undefined||e("#arrowchat_trayicon_"+t+"_iframe").attr("src")=="")e("#arrowchat_trayicon_"+t+"_iframe").attr("src",barLinks[t][2]);tr=t}else{I(e("#arrowchat_trayicon_"+tr+"_popup"),e("#arrowchat_trayicon_"+tr));tr=""}}else{var r=barLinks[t][2].replace("{USER_ID}",u_id);r=r.replace("{USER_NAME}",u_name);window.open(r,n)}})}function un(){H.click(function(){if(D.scrollLeft()==0){}else{Ct("-=148px")}});_.click(function(){if(D.scrollLeft()+D.width()==P.width()){}else{Ct("+=148px")}})}function an(){if(c_mobile_device==1){n.css("bottom","0px");var t=n.position();e(".arrowchat_tabpopup").css("bottom",e(document).height()-t.top-9+"px !important");e(".arrowchat_apppopup").css("bottom",e(document).height()-t.top-9+"px !important")}}function fn(){if(window.webkitNotifications&&window.webkitNotifications.checkPermission){window.webkitNotifications.requestPermission()}else if(window.Notification&&window.Notification.requestPermission){window.Notification.requestPermission()}else{return}}function ln(e,t,n){var r=t.replace(/<(?:.|\n)*?>/gm,"").replace(/&/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"');if(r!=""){if(window.Notification&&!Pn&&c_desktop_notify==1){var i=(new Date).getTime();var s=new window.Notification(lang[144]+Tn(uc_name[e]),{icon:uc_avatar[e],body:r,tag:n});s.ondisplay=function(e){setTimeout(function(){e.currentTarget.cancel()},5e3)}}}}function cn(){n=e("<div/>").attr("id","arrowchat_base").appendTo(t);if(c_chat_maintenance!=0||c_guests_login_msg!=0&&u_id==""){Z()}else{if(c_hide_bar_on!=0){tt();et()}st();c_notifications!=0&&at();c_chatrooms!=0&&it();bt()}if(c_links_right!=1){on()}if(c_applications_on!=0){if(u_id==""&&c_guests_apps=="1"||u_id!=""&&u_is_guest!=1||u_id!=""&&u_is_guest==1&&c_guests_apps==1){if(c_no_apps_menu!=1){ut()}ot()}}if(c_links_right==1){on()}t.append('<div id="arrowchat_sound_player_holder"></div>');_=e("<div/>").attr("id","arrowchat_chatbox_right").appendTo(n);e("<span/>").addClass("arrowchat_next_tab").appendTo(_);e("<div/>").addClass("arrowchat_tabtext").appendTo(_);e("<span/>").css("top","-5px").css("display","none").addClass("arrowchat_tabalertlr").appendTo(_);D=e("<div/>").attr("id","arrowchat_chatboxes").appendTo(n);P=e("<div/>").attr("id","arrowchat_chatboxes_wide").appendTo(D);H=e("<div/>").attr("id","arrowchat_chatbox_left").appendTo(n);e("<span/>").addClass("arrowchat_previous_tab").appendTo(H);e("<div/>").addClass("arrowchat_tabtext").appendTo(H);e("<span/>").css("top","-5px").css("display","none").addClass("arrowchat_tabalertlr").appendTo(H);un();Nt();P.css("width","0px");B(e("#arrowchat_chatbox_left, #arrowchat_chatbox_right"),"arrowchat_chatbox_lr_mouseover");e(window).bind("resize",St);kt("buddylist","1");kt("initialize","1");kt("currenttime",vr);c_facebook_app_id!=""&&e(".arrowchat_facebook_connect").show();e(window).focus(function(){Pn=true}).blur(function(){Pn=false});if(c_desktop_notify==1)e("#arrowchat_base").click(fn);if(typeof document.body.style.maxHeight==="undefined"){Wn=true;n.css("position","absolute");m.css("position","absolute");v.css("position","absolute");l.css("position","absolute");e(window).bind("scroll",function(){hn()})}if(c_push_engine==1){Sr=PUBNUB.init({publish_key:c_push_publish,subscribe_key:c_push_subscribe})}if(c_chat_maintenance!=1){for(var r=0;r<unfocus_chat.length;r++){if(unfocus_chat[r].toString().search("facebook")=="-1")ct(unfocus_chat[r],uc_name[unfocus_chat[r]],uc_status[unfocus_chat[r]],uc_avatar[unfocus_chat[r]],uc_avatar_class[unfocus_chat[r]],uc_link[unfocus_chat[r]],"1")}}if(u_hide_bar==1||u_status=="offline"){if(u_status=="offline"&&u_hide_bar!=1){e("#arrowchat_userstab_text").html("Chat (Offline)");D.hide();_.hide();H.hide()}else{n.hide();s.css("display","block")}In=1;e.idleTimer("destroy")}else if(c_chat_maintenance!=1&&u_id!=""&&u_popout_time!="1"){if(u_chat_open.toString().search("facebook")=="-1")u_chat_open!=0&&ct(u_chat_open,uc_name[u_chat_open],uc_status[u_chat_open],uc_avatar[u_chat_open],uc_avatar_class[u_chat_open],uc_link[u_chat_open]);if(c_push_engine==1){tn()}zt();e("#arrowchat_userslist_available").html('<div class="arrowchat_nofriends">'+lang[25]+"</div>");e(".arrowchat_chatroom_full_content").html('<div class="arrowchat_nofriends">'+lang[34]+"</div>");qt();u_blist_open==1&&p.click();if(u_chatroom_open!=-1){u_chatroom_open==0&&h.click();if(u_chatroom_open!=0){Kn=u_chatroom_open;Un=1;if(typeof S!="undefined")S.hide();I(v,p);I(l,u);E.css("left",h.offset().left-E.outerWidth()+h.outerWidth()).css("bottom","25px");h.toggleClass("arrowchat_tabclick").toggleClass("arrowchat_userstabclick");E.toggleClass("arrowchat_tabopen");lt(u_chatroom_open,rr[u_chatroom_open])}}if(u_chatroom_stay>0){Kn=u_chatroom_stay;Un=1;if(typeof S!="undefined")S.hide();lt(u_chatroom_stay,rr[u_chatroom_stay])}if(u_chatroom_stay==-1&&u_chatroom_open==-1&&c_chatroom_auto_join!=0){Kn=c_chatroom_auto_join;Un=1;if(typeof S!="undefined")S.hide();lt(c_chatroom_auto_join,rr[c_chatroom_auto_join])}if(u_apps_open!=""&&u_apps_open!="0"){e("#arrowchat_app_link_"+u_apps_open).click()}}else if(u_popout_time=="1"){e.idleTimer("destroy");p.hide();o.show();D.hide();_.hide();H.hide()}Q();St();if(c_mobile_device==1){e(window).bind("scroll",an);an()}e("#arrowchat_userstab_icon").addClass("arrowchat_user_"+u_status+"2")}function hn(){n.css("top",e(window).scrollTop()+e(window).height()-25);v.css("top",parseInt(e(window).height())-parseInt(v.css("bottom"))-parseInt(v.height())+e(window).scrollTop()+"px");l.css("top",parseInt(e(window).height())-parseInt(l.css("bottom"))-parseInt(l.height())+e(window).scrollTop()+"px");m.length>0&&m.css("top",parseInt(e(window).height())-parseInt(m.css("bottom"))-parseInt(m.height())+e(window).scrollTop()+"px");if(Bn!=""){M[Bn].css("position","absolute");M[Bn].css("top",parseInt(e(window).height())-parseInt(M[Bn].css("bottom"))-parseInt(M[Bn].height())+e(window).scrollTop()+"px")}}function pn(){swfobject.embedSWF(c_ac_path+"themes/"+u_theme+"/sounds/new%5Fmessage.player.swf?soundswf="+c_ac_path+"themes/"+u_theme+"/sounds/new%5Fmessage.swf&autoplay=1&loops=0","arrowchat_sound_player_holder","1","1","9.0.0")}function dn(t,n,r){var i=Sn(t).split("@")[0].split("-")[1];e.ajax({url:"http://graph.facebook.com/"+i,dataType:"json",type:"GET",async:false,success:function(e){uc_name[t]=e.name;if(typeof e.status=="undefined")uc_status[t]="offline";else uc_status[t]=e.status;uc_avatar[t]="http://graph.facebook.com/"+i+"/picture";uc_link[t]=e.link;if(n==1)vn(t);else mn(t,r)}})}function vn(e){ht(e,uc_name[e],uc_status[e],uc_avatar[e],uc_link[e],0,1);Bn=e}function mn(e,t){ht(e,uc_name[e],uc_status[e],uc_avatar[e],uc_link[e],1,1);if(t!=0)Gt("f"+t.time,t.from,t.msg,t.time/1e3,0,0);St()}function gn(t){if(t!="")Cr=t[0].msg;e.ajax({url:"//arrowjabber.com/",data:{action:"getOnlineBuddies",sid:Cr},dataType:"jsonp",type:"GET",beforeSend:function(){kr!=1&&e("#arrowchat_facebook_friends_list").html('<div class="arrowchat_nofriends">'+lang[25]+"</div>")},error:function(){jqac.arrowchat.facebookLogout()},success:function(t){if(t[0]&&t[0].error=="1"){bn(Tr)}else{var n=0;Mr=0;var r="";var i="";var s=0;e("#arrowchat_facebook_friends_list").html("");e.each(t,function(t,o){if(o.id){var u=o.id.split("@")[0].split("-")[1];o.id=En(o.id);var f=o.n.length>16?o.n.substr(0,16)+"...":o.n;Mr++;if(e("#arrowchat_setting_names_only :input").is(":checked"))r="arrowchat_hide_avatars";if(o.s=="available")i+='<div id="arrowchat_userlist_'+o.id+'" class="arrowchat_userlist arrowchat_buddylist_admin_0 arrowchat_jabber_user" onmouseover="jqac(this).addClass(\'arrowchat_userlist_hover\');" onmouseout="jqac(this).removeClass(\'arrowchat_userlist_hover\');"><img class="arrowchat_userlist_avatar 2 '+r+o.ac+'" src="'+o.a+'" /><span class="arrowchat_userscontentname">'+f+'</span><span class="arrowchat_userscontentdot arrowchat_'+o.s+'"></span></div>';uc_name[o.id]=o.n;uc_status[o.id]=o.s;uc_avatar[o.id]=o.a;uc_link[o.id]="http://www.facebook.com/"+u;if(or[o.id]!=null){e(".arrowchat_closebox_bottom_status",O[o.id]).removeClass("arrowchat_available").removeClass("arrowchat_busy").removeClass("arrowchat_offline").removeClass("arrowchat_away").addClass("arrowchat_"+o.s);O[o.id].removeClass("arrowchat_tab_offline").removeClass("arrowchat_away").addClass("arrowchat_tab_"+o.s)}if(u_chat_open==o.id){s=o.id}}if(o.md5){Nr=o.md5;n=1}});Mr==0&&e("#arrowchat_facebook_friends_list").html('<div class="arrowchat_nofriends">'+lang[8]+"</div>");e("#arrowchat_facebook_friends_list").append("<div>"+i+"</div>");if(u_hide_bar!=1&&u_status!="offline")e("#arrowchat_userstab_text").html("<b>"+lang[4]+"</b> (<b>"+(Or+Mr)+"</b>)");e(".arrowchat_jabber_user").click(function(t){if(e(t.target).attr("id"))var n=e(t.target).attr("id").substr(19);else var n="";if(n=="")n=e(t.target).parent().attr("id").substr(19);ht(n,uc_name[n],uc_status[n],uc_avatar[n],uc_link[n],0,1)});if(Lr!=1){if(Mr==1||Mr==0){Lr=1;gn("");return}}if(kr!=1){for(var r=0;r<unfocus_chat.length;r++){if(unfocus_chat[r].toString().search("facebook")!="-1"){if(uc_name[unfocus_chat[r]]!=""&&typeof uc_name[unfocus_chat[r]]!="undefined"&&uc_link[unfocus_chat[r]].toString().search("facebook")!="-1"){ht(unfocus_chat[r],uc_name[unfocus_chat[r]],uc_status[unfocus_chat[r]],uc_avatar[unfocus_chat[r]],uc_link[unfocus_chat[r]],1,1)}else{dn(unfocus_chat[r],0,0)}}}if(s!=0){e("#arrowchat_userlist_"+s).click();Bn=s}else if(u_chat_open.toString().search("facebook")!="-1"){dn(u_chat_open,1,0)}}clearTimeout(xr);xr=setTimeout(function(){gn("")},c_list_heart_beat*1e3);Et();yn();kr=1}}})}function yn(){clearTimeout(Ar);e.ajax({url:"//arrowjabber.com/",data:{action:"getRecentMessages",sid:Cr},dataType:"jsonp",type:"GET",success:function(t){if(t[0]&&t[0].error=="1"){bn(Tr)}else{e.each(t,function(t,n){n.from=En(n.from);if(typeof uc_name[n.from]=="undefined"){dn(n.from,0,n)}else{Gt("f"+n.time,n.from,n.msg,n.time/1e3,0,0)}u_sounds==1&&!e(".arrowchat_textarea",M[n.from]).is(":focus")&&pn();vt();Yn=1;Gn=$n});Ar=setTimeout(function(){yn()},c_heart_beat*1e3)}}})}function bn(t){var n=new Date;n=parseInt(n.getTime()/1e3);if(_r==0){setTimeout(function(){_r=0},1e4)}_r++;if(_r<4){e.ajax({url:"//arrowjabber.com/",data:{action:"login",access_key:t.authResponse.accessToken,fb_app_id:c_facebook_app_id,user:t.authResponse.userID},dataType:"jsonp",type:"GET",beforeSend:function(){kr!=1&&e("#arrowchat_facebook_friends_list").html('<div class="arrowchat_nofriends">'+lang[25]+"</div>")},error:function(){jqac.arrowchat.facebookLogout()},success:function(t){e.cookie("ac_facebook_id",t[0].msg,{expires:365,path:"/"});gn(t)}})}else{jqac.arrowchat.facebookLogout()}}function wn(t){e.ajax({url:"//arrowjabber.com/",data:{action:"getAllMessages",user:Sn(t),sid:Cr},dataType:"jsonp",type:"GET",success:function(n){if(n[0]&&n[0].error=="1"){bn(Tr)}else{e("#arrowchat_tabcontenttext_"+t).html("");lr[t]=null;e.each(n,function(e,t){t.from=En(t.from);if(t.type=="received"){Gt("f"+t.time,t.from,t.msg,t.time/1e3,0,1)}else{Dt(t.from,t.msg,"1","1","f"+t.time,1,t.time/1e3)}vt()})}}})}function En(e){e=e.toLowerCase();e=e.replace("-","M");e=e.replace("@","A");e=e.replace(/\./g,"D");return e}function Sn(e){e=e.replace("M","-");e=e.replace("A","@");e=e.replace(/D/g,".");return e}function xn(t,n){new_id=Sn(t);e(".arrowchat_textarea").addClass("arrowchat_message_sending");e.getJSON("//arrowjabber.com/",{action:"sendMessage",to:new_id,msg:n,sid:Cr},function(r){e(".arrowchat_textarea").removeClass("arrowchat_message_sending");if(r[0]&&r[0].error=="1"){ft("arrowchat_chatbox_message_flyout_"+typing,lang[135],"error")}else{Dt(t,n,"1","1","f"+Math.floor((new Date).getTime()),1,Math.floor((new Date).getTime()/1e3))}})}function Tn(t){var n=t;if(typeof t!="undefined"){var r=e("<div/>").attr("id","arrowchat_render").html(t).appendTo("body");n=e("#arrowchat_render").html();r.remove()}return n}var t=e("body");var n;var r;var s;var o;var u;var l;var h;var p;var v;var m=null;var g;var y;var w;var E;var S;var x;var T={};var N={};var C;var L;var A;var O=[];var M=[];var _;var D;var P;var H;var U=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig;RegExp.escape=function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")};var Nn=1,Cn=1,kn=0,Ln=0,An=0,On={},Mn=document.title,_n=1,Dn=1,Pn=true,Hn={},Bn="",jn="",Fn=0,In=0,qn=1,Rn=0,Un=0,zn=0,Wn=false,Xn,Vn,$n=3e3,Jn,Kn=-1,Qn,Gn=$n,Yn=1,Zn=0,er=0,tr="",nr=0,rr={},ir={},sr={},or={},ur={},ar={},fr={},lr={},cr={},hr={},pr=new Date,dr=pr.getDate(),vr=Math.floor(pr.getTime()/1e3),mr=1,gr=0,yr=-1,br="Powered By <a href='http://www.arrowchat.com/' target='_blank'>ArrowChat</a>",wr=0,Er,Sr,xr,Tr,Nr="",Cr="",kr=0,Lr=0,Ar,Or=0,Mr=0,_r=0,Dr;var Pr="",Hr;for(d=0;d<Themes.length;d++){if(Themes[d][2]==u_theme){Hr="selected"}else{Hr=""}Pr=Pr+'<option value="'+Themes[d][0]+'" '+Hr+">"+Themes[d][1]+"</option>"}e.ajaxSetup({scriptCharset:"utf-8",cache:false});e.expr[":"].icontains=function(e,t,n){return(e.textContent||e.innerText||jqac(e).text()||"").toLowerCase().indexOf(n[3].toLowerCase())>=0};arguments.callee.videoWith=function(e){var t=window.open(c_ac_path+"public/video/?rid="+e,"audiovideochat","status=no,toolbar=no,menubar=no,directories=no,resizable=no,location=no,scrollbars=no,width=650,height=720");t.focus()};arguments.callee.runarrowchat=cn;arguments.callee.chatroom=function(e){if(u_hide_bar==1)nt();h.click();setTimeout(function(){Kn=e;lt(e,"1")},400)};arguments.callee.chatWith=function(e){if(u_hide_bar==1)nt();ct(e,uc_name[e],uc_status[e],uc_avatar[e],uc_avatar_class[e],uc_link[e])};arguments.callee.openCloseApp=function(t){e(".arrowchat_appname_"+t).click()};arguments.callee.changeAppImage=function(t,n){e(".arrowchat_appname_"+t+" img").attr("src",c_ac_path+n)};arguments.callee.addAppAlert=function(t,n){if(e(".arrowchat_appname_"+t+" .arrowchat_tabalert").length>0&&n>0){e(".arrowchat_appname_"+t+" .arrowchat_tabalert").html(n);e(".arrowchat_appname_"+t+" .arrowchat_tabalert").effect("bounce",{times:3,distance:5},200)}else if(!e(".arrowchat_appname_"+t).hasClass("arrowchat_trayclick")){e("<div/>").css("top","-11px").css("left","6px").addClass("arrowchat_tabalert").html(n).appendTo(".arrowchat_appname_"+t)}};arguments.callee.getUser=function(t,n){e.ajax({url:c_ac_path+"includes/json/receive/receive_user.php",data:{userid:t},type:"post",cache:false,dataType:"json",success:function(e){if(e){window[n](e)}else{window[n](0)}}})};arguments.callee.sendMessage=function(t,n){n!=""&&e.post(c_ac_path+"includes/json/send/send_message.php",{to:t,message:n},function(r){if(r){if(r=="-1"){ft("arrowchat_chatbox_message_flyout_"+t,lang[102],"error")}else{Dt(t,n,1,1,r,1,1)}e(".arrowchat_tabcontenttext",M[t]).scrollTop(e(".arrowchat_tabcontenttext",M[t])[0].scrollHeight)}Yn=1})};arguments.callee.getBaseUrl=function(){return k};arguments.callee.facebook=function(t){Tr=t;e(".arrowchat_facebook_connect a").html(lang[141]);e.cookie("ac_facebook","1",{expires:365,path:"/"});e("#arrowchat_userscontent").append('<div id="arrowchat_facebook_friends" class="arrowchat_group_container"><span class="arrowchat_group_text">'+lang[143]+'</span><div class="arrowchat_group_line_container"><span class="arrowchat_group_line"></span></div></div><div id="arrowchat_facebook_friends_list"></div>');e("#arrowchat_userscontent").prepend('<div id="arrowchat_site_users" class="arrowchat_group_container"><span class="arrowchat_group_text">'+lang[142]+'</span><div class="arrowchat_group_line_container"><span class="arrowchat_group_line"></span></div></div>');Et();var n=e.cookie("ac_facebook_id");if(typeof n!="undefined"&&n!=""){Cr=n;gn("")}else if(Cr!=""){gn("")}else{bn(t)}};arguments.callee.facebookLogout=function(){clearTimeout(xr);clearTimeout(Ar);e(".arrowchat_facebook_connect a").html(lang[140]);e.removeCookie("ac_facebook",{path:"/"});e(".arrowchat_group_container").remove();e("#arrowchat_facebook_friends_list").remove();Et();Mr=0;e("#arrowchat_userstab_text").html("<b>"+lang[4]+"</b> (<b>"+(Or+Mr)+"</b>)");e(".arrowchat_jabber_user_tab .arrowchat_closebox_bottom").click()}}})(jqac);jqac(document).ready(function(){if(u_logged_in!=1&&c_disable_arrowchat!=1){jqac.arrowchat();jqac.arrowchat.runarrowchat()}})